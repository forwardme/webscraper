<!--[if IE]><![endif]--><!DOCTYPE html><!--[if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage"" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/data-visualization-with/9781491920565/ch18.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="2870136"
  data-user-uuid="fee1bd59-4e02-48a4-a7b4-152ec4c157ac"
  data-username="flankpeter"
  data-account-type="Trial"
  
  data-activated-trial-date="05/04/2018"


  data-archive="9781491920565"
  data-publishers="O&#39;Reilly Media, Inc."



  data-htmlfile-name="ch18.html"
  data-epub-title="Data Visualization with Python and JavaScript" data-debug=0 data-testing=0><![endif]--><!--[if gt IE 8]><!--><html class="no-js" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage"" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/data-visualization-with/9781491920565/ch18.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="2870136"
  data-user-uuid="fee1bd59-4e02-48a4-a7b4-152ec4c157ac"
  data-username="flankpeter"
  data-account-type="Trial"
  
  data-activated-trial-date="05/04/2018"


  data-archive="9781491920565"
  data-publishers="O&#39;Reilly Media, Inc."



  data-htmlfile-name="ch18.html"
  data-epub-title="Data Visualization with Python and JavaScript" data-debug=0 data-testing=0><!--<![endif]--><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="author" content="Safari Books Online" /><meta name="format-detection" content="telephone=no"><meta http-equiv="cleartype" content="on"/><meta name="HandheldFriendly" content="True"/><meta name="MobileOptimized" content="320"/><meta name="apple-itunes-app" content="app-id=881697395, app-argument=safaridetail://9781491920565"/><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0"/><meta property="twitter:account_id" content="4503599627559754" /><link rel="apple-touch-icon" href="/static/images/apple-touch-icon.0c29511d2d72.png"/><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"><link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900,200italic,300italic,400italic,600italic,700italic,900italic' rel='stylesheet' type='text/css'><title>18. Mapping with D3 - Data Visualization with Python and JavaScript</title><link rel="stylesheet" href="/static/CACHE/css/a04cd81b09cd.css" type="text/css" /><link rel="stylesheet" type="text/css" href="/static/css/annotator.ef38b0457d7b.css"/><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"><style type="text/css" title="ibis-book">
    @charset "utf-8";#sbo-rt-content html,#sbo-rt-content div,#sbo-rt-content div,#sbo-rt-content span,#sbo-rt-content applet,#sbo-rt-content object,#sbo-rt-content iframe,#sbo-rt-content h1,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5,#sbo-rt-content h6,#sbo-rt-content p,#sbo-rt-content blockquote,#sbo-rt-content pre,#sbo-rt-content a,#sbo-rt-content abbr,#sbo-rt-content acronym,#sbo-rt-content address,#sbo-rt-content big,#sbo-rt-content cite,#sbo-rt-content code,#sbo-rt-content del,#sbo-rt-content dfn,#sbo-rt-content em,#sbo-rt-content img,#sbo-rt-content ins,#sbo-rt-content kbd,#sbo-rt-content q,#sbo-rt-content s,#sbo-rt-content samp,#sbo-rt-content small,#sbo-rt-content strike,#sbo-rt-content strong,#sbo-rt-content sub,#sbo-rt-content sup,#sbo-rt-content tt,#sbo-rt-content var,#sbo-rt-content b,#sbo-rt-content u,#sbo-rt-content i,#sbo-rt-content center,#sbo-rt-content dl,#sbo-rt-content dt,#sbo-rt-content dd,#sbo-rt-content ol,#sbo-rt-content ul,#sbo-rt-content li,#sbo-rt-content fieldset,#sbo-rt-content form,#sbo-rt-content label,#sbo-rt-content legend,#sbo-rt-content table,#sbo-rt-content caption,#sbo-rt-content tdiv,#sbo-rt-content tfoot,#sbo-rt-content thead,#sbo-rt-content tr,#sbo-rt-content th,#sbo-rt-content td,#sbo-rt-content article,#sbo-rt-content aside,#sbo-rt-content canvas,#sbo-rt-content details,#sbo-rt-content embed,#sbo-rt-content figure,#sbo-rt-content figcaption,#sbo-rt-content footer,#sbo-rt-content header,#sbo-rt-content hgroup,#sbo-rt-content menu,#sbo-rt-content nav,#sbo-rt-content output,#sbo-rt-content ruby,#sbo-rt-content section,#sbo-rt-content summary,#sbo-rt-content time,#sbo-rt-content mark,#sbo-rt-content audio,#sbo-rt-content video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}#sbo-rt-content article,#sbo-rt-content aside,#sbo-rt-content details,#sbo-rt-content figcaption,#sbo-rt-content figure,#sbo-rt-content footer,#sbo-rt-content header,#sbo-rt-content hgroup,#sbo-rt-content menu,#sbo-rt-content nav,#sbo-rt-content section{display:block}#sbo-rt-content div{line-height:1}#sbo-rt-content ol,#sbo-rt-content ul{list-style:none}#sbo-rt-content blockquote,#sbo-rt-content q{quotes:none}#sbo-rt-content blockquote:before,#sbo-rt-content blockquote:after,#sbo-rt-content q:before,#sbo-rt-content q:after{content:none}#sbo-rt-content table{border-collapse:collapse;border-spacing:0}@page{margin:5px !important}#sbo-rt-content p{margin:10px 0 0;line-height:125%;text-align:left}#sbo-rt-content p.byline{text-align:left;margin:-33px auto 35px;font-style:italic;font-weight:bold}#sbo-rt-content div.preface p+p.byline{margin:1em 0 0}#sbo-rt-content div.preface p.byline+p.byline{margin:0}#sbo-rt-content div.sect1>p.byline{margin:-.25em 0 1em}#sbo-rt-content div.sect1>p.byline+p.byline{margin-top:-1em}#sbo-rt-content em{font-style:italic;font-family:inherit}#sbo-rt-content em strong,#sbo-rt-content strong em{font-weight:bold;font-style:italic;font-family:inherit}#sbo-rt-content strong,#sbo-rt-content span.bold{font-weight:bold}#sbo-rt-content em.replaceable{font-style:italic}#sbo-rt-content strong.userinput{font-weight:bold;font-style:normal}#sbo-rt-content span.bolditalic{font-weight:bold;font-style:italic}#sbo-rt-content a.ulink,#sbo-rt-content a.xref,#sbo-rt-content a.email,#sbo-rt-content a.link,#sbo-rt-content a{text-decoration:none;color:#8e0012}#sbo-rt-content span.lineannotation{font-style:italic;color:#a62a2a;font-family:serif}#sbo-rt-content span.underline{text-decoration:underline}#sbo-rt-content span.strikethrough{text-decoration:line-through}#sbo-rt-content span.smallcaps{font-variant:small-caps}#sbo-rt-content span.cursor{background:#000;color:#fff}#sbo-rt-content span.smaller{font-size:75%}#sbo-rt-content .boxedtext,#sbo-rt-content .keycap{border-style:solid;border-width:1px;border-color:#000;padding:1px}#sbo-rt-content span.gray50{color:#7F7F7F;}#sbo-rt-content h1,#sbo-rt-content div.toc-title,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5{-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;font-weight:bold;text-align:left;page-break-after:avoid !important;font-family:sans-serif,"DejaVuSans"}#sbo-rt-content div.toc-title{font-size:1.5em;margin-top:20px !important;margin-bottom:30px !important}#sbo-rt-content section[data-type="sect1"] h1{font-size:1.3em;color:#8e0012;margin:40px 0 8px 0}#sbo-rt-content section[data-type="sect2"] h2{font-size:1.1em;margin:30px 0 8px 0 !important}#sbo-rt-content section[data-type="sect3"] h3{font-size:1em;color:#555;margin:20px 0 8px 0 !important}#sbo-rt-content section[data-type="sect4"] h4{font-size:1em;font-weight:normal;font-style:italic;margin:15px 0 6px 0 !important}#sbo-rt-content section[data-type="chapter"]>div>h1,#sbo-rt-content section[data-type="preface"]>div>h1,#sbo-rt-content section[data-type="appendix"]>div>h1,#sbo-rt-content section[data-type="glossary"]>div>h1,#sbo-rt-content section[data-type="bibliography"]>div>h1,#sbo-rt-content section[data-type="index"]>div>h1{font-size:2em;line-height:1;margin-bottom:50px;color:#000;padding-bottom:10px;border-bottom:1px solid #000}#sbo-rt-content span.label,#sbo-rt-content span.keep-together{font-size:inherit;font-weight:inherit}#sbo-rt-content div[data-type="part"] h1{font-size:2em;text-align:center;margin-top:0 !important;margin-bottom:50px;padding:50px 0 10px 0;border-bottom:1px solid #000}#sbo-rt-content img.width-ninety{width:90%}#sbo-rt-content img{max-width:95%;margin:0 auto;padding:0}#sbo-rt-content div.figure{background-color:transparent;text-align:center !important;margin:15px 0 15px 0 !important;page-break-inside:avoid}#sbo-rt-content figure{margin:15px 0 15px 0 !important;page-break-inside:avoid}#sbo-rt-content div.figure h6{font-size:90%;text-align:center;font-weight:normal;font-style:italic;font-family:serif !important;color:#000;padding-top:10px !important;page-break-before:avoid;page-break-after:avoid}#sbo-rt-content div.informalfigure{text-align:center !important;padding:5px 0 !important}#sbo-rt-content div.sidebar{margin:15px 0 10px 0 !important;border:1px solid #DCDCDC;background-color:#F7F7F7;padding:15px !important;page-break-inside:avoid}#sbo-rt-content aside[data-type="sidebar"]{margin:15px 0 10px 0 !important;page-break-inside:avoid}#sbo-rt-content div.sidebar-title,#sbo-rt-content aside[data-type="sidebar"] h5{font-weight:bold;font-size:1em;font-family:sans-serif;text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px 0 !important;page-break-inside:avoid}#sbo-rt-content div.sidebar ol,#sbo-rt-content div.sidebar ul,#sbo-rt-content aside[data-type="sidebar"] ol,#sbo-rt-content aside[data-type="sidebar"] ul{margin-left:1.25em !important}#sbo-rt-content div.sidebar div.figure p.title,#sbo-rt-content aside[data-type="sidebar"] figcaption,#sbo-rt-content div.sidebar div.informalfigure div.caption{font-size:90%;text-align:center;font-weight:normal;font-style:italic;font-family:serif !important;color:#000;padding:5px !important;page-break-before:avoid;page-break-after:avoid}#sbo-rt-content div.sidebar div.tip,#sbo-rt-content div.sidebar div[data-type="tip"],#sbo-rt-content div.sidebar div.note,#sbo-rt-content div.sidebar div[data-type="note"],#sbo-rt-content div.sidebar div.warning,#sbo-rt-content div.sidebar div[data-type="warning"],#sbo-rt-content div.sidebar div[data-type="caution"],#sbo-rt-content div.sidebar div[data-type="important"]{margin:20px auto 20px auto !important;font-size:90%;width:85%}#sbo-rt-content aside[data-type="sidebar"] p.byline{font-size:90%;font-weight:bold;font-style:italic;text-align:center;text-indent:0;margin:5px auto 6px;page-break-after:avoid}#sbo-rt-content pre{white-space:pre-wrap;font-family:"Ubuntu Mono",monospace;margin:25px 0 25px 20px;font-size:85%;display:block;-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;overflow-wrap:break-word}#sbo-rt-content div.note pre.programlisting,#sbo-rt-content div.tip pre.programlisting,#sbo-rt-content div.warning pre.programlisting,#sbo-rt-content div.caution pre.programlisting,#sbo-rt-content div.important pre.programlisting{margin-bottom:0}#sbo-rt-content code{font-family:"Ubuntu Mono",monospace;-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;overflow-wrap:break-word}#sbo-rt-content code strong em,#sbo-rt-content code em strong,#sbo-rt-content pre em strong,#sbo-rt-content pre strong em,#sbo-rt-content strong code em code,#sbo-rt-content em code strong code,#sbo-rt-content span.bolditalic code{font-weight:bold;font-style:italic;font-family:"Ubuntu Mono BoldItal",monospace}#sbo-rt-content code em,#sbo-rt-content em code,#sbo-rt-content pre em,#sbo-rt-content em.replaceable{font-family:"Ubuntu Mono Ital",monospace;font-style:italic}#sbo-rt-content code strong,#sbo-rt-content strong code,#sbo-rt-content pre strong,#sbo-rt-content strong.userinput{font-family:"Ubuntu Mono Bold",monospace;font-weight:bold}#sbo-rt-content div[data-type="example"]{margin:10px 0 15px 0 !important}#sbo-rt-content div[data-type="example"] h1,#sbo-rt-content div[data-type="example"] h2,#sbo-rt-content div[data-type="example"] h3,#sbo-rt-content div[data-type="example"] h4,#sbo-rt-content div[data-type="example"] h5,#sbo-rt-content div[data-type="example"] h6{font-style:italic;font-weight:normal;text-align:left !important;text-transform:none !important;font-family:serif !important;margin:10px 0 5px 0 !important;border-bottom:1px solid #000}#sbo-rt-content li pre.example{padding:10px 0 !important}#sbo-rt-content div[data-type="example"] pre[data-type="programlisting"],#sbo-rt-content div[data-type="example"] pre[data-type="screen"]{margin:0}#sbo-rt-content section[data-type="titlepage"]>div>h1{font-size:2em;margin:50px 0 10px 0 !important;line-height:1;text-align:center}#sbo-rt-content section[data-type="titlepage"] h2,#sbo-rt-content section[data-type="titlepage"] p.subtitle,#sbo-rt-content section[data-type="titlepage"] p[data-type="subtitle"]{font-size:1.3em;font-weight:normal;text-align:center;margin-top:.5em;color:#555}#sbo-rt-content section[data-type="titlepage"]>div>h2[data-type="author"],#sbo-rt-content section[data-type="titlepage"] p.author{font-size:1.3em;font-family:serif !important;font-weight:bold;margin:50px 0 !important;text-align:center}#sbo-rt-content section[data-type="titlepage"] p.edition{text-align:center;text-transform:uppercase;margin-top:2em}#sbo-rt-content div.book div.titlepage div.publishername{margin-top:60%;margin-bottom:20px;text-align:center;font-size:1.25em}#sbo-rt-content div.book div.titlepage div.locations p{margin:0;text-align:center}#sbo-rt-content div.book div.titlepage div.locations p.cities{font-size:80%;text-align:center;margin-top:5px}#sbo-rt-content section.preface[title="Dedication"]>div.titlepage h2.title{text-align:center;text-transform:uppercase;font-size:1.5em;margin-top:50px;margin-bottom:50px}#sbo-rt-content ul.stafflist{margin:15px 0 15px 20px !important}#sbo-rt-content ul.stafflist li{list-style-type:none;padding:5px 0}#sbo-rt-content ul.printings li{list-style-type:none}#sbo-rt-content section.preface[title="Dedication"] p{font-style:italic;text-align:center}#sbo-rt-content div.colophon h1.title{font-size:1.3em;margin:0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon h2.subtitle{margin:0 !important;color:#000;font-family:serif !important;font-size:1em;font-weight:normal}#sbo-rt-content div.colophon div.author h3.author{font-size:1.1em;font-family:serif !important;margin:10px 0 0 !important;font-weight:normal}#sbo-rt-content div.colophon div.editor h4,#sbo-rt-content div.colophon div.editor h3.editor{color:#000;font-size:.8em;margin:15px 0 0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon div.editor h3.editor{font-size:.8em;margin:0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon div.publisher{margin-top:10px}#sbo-rt-content div.colophon div.publisher p,#sbo-rt-content div.colophon div.publisher span.publishername{margin:0;font-size:.8em}#sbo-rt-content div.legalnotice p,#sbo-rt-content div.timestamp p{font-size:.8em}#sbo-rt-content div.timestamp p{margin-top:10px}#sbo-rt-content div.colophon[title="About the Author"] h1.title,#sbo-rt-content div.colophon[title="Colophon"] h1.title{font-size:1.5em;margin:0 !important;font-family:sans-serif !important}#sbo-rt-content section.chapter div.titlepage div.author{margin:10px 0 10px 0}#sbo-rt-content section.chapter div.titlepage div.author div.affiliation{font-style:italic}#sbo-rt-content div.attribution{margin:5px 0 0 50px !important}#sbo-rt-content h3.author span.orgname{display:none}#sbo-rt-content div.epigraph{margin:10px 0 10px 20px !important;page-break-inside:avoid;font-size:90%}#sbo-rt-content div.epigraph p{font-style:italic}#sbo-rt-content blockquote,#sbo-rt-content div.blockquote{margin:10px !important;page-break-inside:avoid;font-size:95%}#sbo-rt-content blockquote p,#sbo-rt-content div.blockquote p{font-style:italic;margin:.75em 0 0 !important}#sbo-rt-content blockquote div.attribution,#sbo-rt-content blockquote p[data-type="attribution"]{margin:5px 0 10px 30px !important;text-align:right;width:80%}#sbo-rt-content blockquote div.attribution p,#sbo-rt-content blockquote p[data-type="attribution"]{font-style:normal;margin-top:5px}#sbo-rt-content blockquote div.attribution p:before,#sbo-rt-content blockquote p[data-type="attribution"]:before{font-style:normal;content:"—";-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none}#sbo-rt-content p.right{text-align:right;margin:0}#sbo-rt-content div[data-type="footnotes"]{border-top:1px solid black;margin-top:1.5em}#sbo-rt-content sub,#sbo-rt-content sup{font-size:75%;line-height:0;position:relative}#sbo-rt-content sup{top:-.5em}#sbo-rt-content sub{bottom:-.25em}#sbo-rt-content div.refentry p.refname{font-size:1em;font-family:sans-serif,"DejaVuSans";font-weight:bold;margin-bottom:5px;overflow:auto;width:100%}#sbo-rt-content div.refentry{width:100%;display:block;margin-top:2em}#sbo-rt-content div.refsynopsisdiv{display:block;clear:both}#sbo-rt-content div.refentry header{page-break-inside:avoid !important;display:block;break-inside:avoid !important;padding-top:0;border-bottom:1px solid #000}#sbo-rt-content div.refsect1 h6{font-size:.9em;font-family:sans-serif,"DejaVuSans";font-weight:bold}#sbo-rt-content div.refsect1{margin-top:3em}#sbo-rt-content dt{padding-top:10px !important;padding-bottom:0 !important}#sbo-rt-content dd{margin-left:1.5em !important;margin-bottom:.25em}#sbo-rt-content dd,#sbo-rt-content li{text-align:left}#sbo-rt-content ul{list-style-type:disc}#sbo-rt-content ul ul{list-style-type:square}#sbo-rt-content ul ul ul{list-style-type:circle}#sbo-rt-content ol{list-style-type:decimal}#sbo-rt-content ol ol{list-style-type:lower-alpha}#sbo-rt-content ol ol ol{list-style-type:lower-roman}#sbo-rt-content ol ul{list-style-type:disc}#sbo-rt-content ol ul ol{list-style-type:decimal}#sbo-rt-content ul ol{list-style-type:decimal}#sbo-rt-content ul ol ul{list-style-type:disc}#sbo-rt-content ol,#sbo-rt-content ul{list-style-position:outside;margin:15px 0 15px 1.25em}#sbo-rt-content ol li,#sbo-rt-content ul li{margin:.5em 0 .65em;line-height:125%}#sbo-rt-content div.orderedlistalpha{list-style-type:upper-alpha}#sbo-rt-content table.simplelist,#sbo-rt-content ul.simplelist{margin:15px 0 15px 20px !important}#sbo-rt-content ul.simplelist li{list-style-type:none;padding:5px 0}#sbo-rt-content table.simplelist td{border:none}#sbo-rt-content table.simplelist tr{border-bottom:none}#sbo-rt-content table.simplelist tr:nth-of-type(even){background-color:transparent}#sbo-rt-content dl.calloutlist p:first-child{margin-top:-25px !important}#sbo-rt-content dl.calloutlist dd{padding-left:0;margin-top:-25px}#sbo-rt-content dl.calloutlist img,#sbo-rt-content a.co img{padding:0}#sbo-rt-content div.toc ol{margin-top:8px !important;margin-bottom:8px !important;margin-left:0 !important;padding-left:0 !important}#sbo-rt-content div.toc ol ol{margin-left:30px !important;padding-left:0 !important}#sbo-rt-content div.toc ol li{list-style-type:none}#sbo-rt-content div.toc a{color:#8e0012}#sbo-rt-content div.toc ol a{font-size:1em;font-weight:bold}#sbo-rt-content div.toc ol>li>ol a{font-weight:bold;font-size:1em}#sbo-rt-content div.toc ol>li>ol>li>ol a{text-decoration:none;font-weight:normal;font-size:1em}#sbo-rt-content div.tip,#sbo-rt-content div[data-type="tip"],#sbo-rt-content div.note,#sbo-rt-content div[data-type="note"],#sbo-rt-content div.warning,#sbo-rt-content div[data-type="warning"],#sbo-rt-content div[data-type="caution"],#sbo-rt-content div[data-type="important"]{margin:30px !important;font-size:90%;padding:10px 8px 20px 8px !important;page-break-inside:avoid}#sbo-rt-content div.tip ol,#sbo-rt-content div.tip ul,#sbo-rt-content div[data-type="tip"] ol,#sbo-rt-content div[data-type="tip"] ul,#sbo-rt-content div.note ol,#sbo-rt-content div.note ul,#sbo-rt-content div[data-type="note"] ol,#sbo-rt-content div[data-type="note"] ul,#sbo-rt-content div.warning ol,#sbo-rt-content div.warning ul,#sbo-rt-content div[data-type="warning"] ol,#sbo-rt-content div[data-type="warning"] ul,#sbo-rt-content div[data-type="caution"] ol,#sbo-rt-content div[data-type="caution"] ul,#sbo-rt-content div[data-type="important"] ol,#sbo-rt-content div[data-type="important"] ul{margin-left:1.5em !important}#sbo-rt-content div.tip,#sbo-rt-content div[data-type="tip"],#sbo-rt-content div.note,#sbo-rt-content div[data-type="note"]{border:1px solid #BEBEBE;background-color:transparent}#sbo-rt-content div.warning,#sbo-rt-content div[data-type="warning"],#sbo-rt-content div[data-type="caution"],#sbo-rt-content div[data-type="important"]{border:1px solid #BC8F8F}#sbo-rt-content div.tip h3,#sbo-rt-content div[data-type="tip"] h6,#sbo-rt-content div[data-type="tip"] h1,#sbo-rt-content div.note h3,#sbo-rt-content div[data-type="note"] h6,#sbo-rt-content div[data-type="note"] h1,#sbo-rt-content div.warning h3,#sbo-rt-content div[data-type="warning"] h6,#sbo-rt-content div[data-type="warning"] h1,#sbo-rt-content div[data-type="caution"] h6,#sbo-rt-content div[data-type="caution"] h1,#sbo-rt-content div[data-type="important"] h1,#sbo-rt-content div[data-type="important"] h6{font-weight:bold;font-size:110%;font-family:sans-serif !important;text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px !important}#sbo-rt-content div.tip h3,#sbo-rt-content div[data-type="tip"] h6,#sbo-rt-content div.note h3,#sbo-rt-content div[data-type="note"] h6,#sbo-rt-content div[data-type="tip"] h1,#sbo-rt-content div[data-type="note"] h1{color:#737373}#sbo-rt-content div.warning h3,#sbo-rt-content div[data-type="warning"] h6,#sbo-rt-content div[data-type="caution"] h6,#sbo-rt-content div[data-type="important"] h6,#sbo-rt-content div[data-type="warning"] h1,#sbo-rt-content div[data-type="caution"] h1,#sbo-rt-content div[data-type="important"] h1{color:#C67171}#sbo-rt-content div.sect1[title="Safari® Books Online"] div.note,#sbo-rt-content div.safarienabled{background-color:transparent;margin:8px 0 0 !important;border:0 solid #BEBEBE;font-size:100%;padding:0 !important;page-break-inside:avoid}#sbo-rt-content div.sect1[title="Safari® Books Online"] div.note h3,#sbo-rt-content div.safarienabled h6{display:none}#sbo-rt-content div.table,#sbo-rt-content table{margin:15px 0 30px 0 !important;max-width:95%;border:none !important;background:none;display:table !important}#sbo-rt-content div.table,#sbo-rt-content div.informaltable,#sbo-rt-content table{page-break-inside:avoid}#sbo-rt-content tr,#sbo-rt-content tr td{border-bottom:1px solid #c3c3c3}#sbo-rt-content thead td,#sbo-rt-content thead th{border-bottom:#9d9d9d 1px solid !important;border-top:#9d9d9d 1px solid !important}#sbo-rt-content tr:nth-of-type(even){background-color:#f1f6fc}#sbo-rt-content thead{font-family:sans-serif;font-weight:bold}#sbo-rt-content td,#sbo-rt-content th{display:table-cell;padding:.3em;text-align:left;vertical-align:middle;font-size:80%}#sbo-rt-content div.informaltable table{margin:10px auto !important}#sbo-rt-content div.informaltable table tr{border-bottom:none}#sbo-rt-content div.informaltable table tr:nth-of-type(even){background-color:transparent}#sbo-rt-content div.informaltable td,#sbo-rt-content div.informaltable th{border:#9d9d9d 1px solid}#sbo-rt-content div.table-title,#sbo-rt-content table caption{font-weight:normal;font-style:italic;font-family:serif;font-size:1em;margin:10px 0 10px 0 !important;padding:0;page-break-after:avoid;text-align:left !important}#sbo-rt-content table code{font-size:smaller}#sbo-rt-content div.equation,#sbo-rt-content div[data-type="equation"]{margin:10px 0 15px 0 !important}#sbo-rt-content div.equation-title,#sbo-rt-content div[data-type="equation"] h5{font-style:italic;font-weight:normal;font-family:serif !important;font-size:90%;margin:20px 0 10px 0 !important;page-break-after:avoid}#sbo-rt-content div.equation-contents{margin-left:20px}#sbo-rt-content span.inlinemediaobject{height:.85em;display:inline-block;margin-bottom:.2em}#sbo-rt-content span.inlinemediaobject img{margin:0;height:.85em}#sbo-rt-content div.informalequation{margin:20px 0 20px 20px;width:75%}#sbo-rt-content div.informalequation img{width:75%}#sbo-rt-content div.index{text-indent:0}#sbo-rt-content div.index li{line-height:140%}#sbo-rt-content div.index a.indexterm{color:#8e0012}#sbo-rt-content div.index ul,#sbo-rt-content div[data-type="index"] ul{list-style-type:none;padding-left:0;margin-left:0}#sbo-rt-content div.index ul li{padding-left:0;margin-left:0}#sbo-rt-content div.index ul li ul li{margin-left:1em}#sbo-rt-content code.boolean,#sbo-rt-content .navy{color:rgb(0,0,128);}#sbo-rt-content code.character,#sbo-rt-content .olive{color:rgb(128,128,0);}#sbo-rt-content code.comment,#sbo-rt-content .blue{color:rgb(0,0,255);}#sbo-rt-content code.conditional,#sbo-rt-content .limegreen{color:rgb(50,205,50);}#sbo-rt-content code.constant,#sbo-rt-content .darkorange{color:rgb(255,140,0);}#sbo-rt-content code.debug,#sbo-rt-content .darkred{color:rgb(139,0,0);}#sbo-rt-content code.define,#sbo-rt-content .darkgoldenrod,#sbo-rt-content .gold{color:rgb(184,134,11);}#sbo-rt-content code.delimiter,#sbo-rt-content .dimgray{color:rgb(105,105,105);}#sbo-rt-content code.error,#sbo-rt-content .red{color:rgb(255,0,0);}#sbo-rt-content code.exception,#sbo-rt-content .salmon{color:rgb(250,128,11);}#sbo-rt-content code.float,#sbo-rt-content .steelblue{color:rgb(70,130,180);}#sbo-rt-content pre code.function,#sbo-rt-content .green{color:rgb(0,128,0);}#sbo-rt-content code.identifier,#sbo-rt-content .royalblue{color:rgb(65,105,225);}#sbo-rt-content code.ignore,#sbo-rt-content .gray{color:rgb(128,128,128);}#sbo-rt-content code.include,#sbo-rt-content .purple{color:rgb(128,0,128);}#sbo-rt-content code.keyword,#sbo-rt-content .sienna{color:rgb(160,82,45);}#sbo-rt-content code.label,#sbo-rt-content .deeppink{color:rgb(255,20,147);}#sbo-rt-content code.macro,#sbo-rt-content .orangered{color:rgb(255,69,0);}#sbo-rt-content code.number,#sbo-rt-content .brown{color:rgb(165,42,42);}#sbo-rt-content code.operator,#sbo-rt-content .black{color:#000;}#sbo-rt-content code.preCondit,#sbo-rt-content .teal{color:rgb(0,128,128);}#sbo-rt-content code.preProc,#sbo-rt-content .fuschia{color:rgb(255,0,255);}#sbo-rt-content code.repeat,#sbo-rt-content .indigo{color:rgb(75,0,130);}#sbo-rt-content code.special,#sbo-rt-content .saddlebrown{color:rgb(139,69,19);}#sbo-rt-content code.specialchar,#sbo-rt-content .magenta{color:rgb(255,0,255);}#sbo-rt-content code.specialcomment,#sbo-rt-content .seagreen{color:rgb(46,139,87);}#sbo-rt-content code.statement,#sbo-rt-content .forestgreen{color:rgb(34,139,34);}#sbo-rt-content code.storageclass,#sbo-rt-content .plum{color:rgb(221,160,221);}#sbo-rt-content code.string,#sbo-rt-content .darkred{color:rgb(139,0,0);}#sbo-rt-content code.structure,#sbo-rt-content .chocolate{color:rgb(210,106,30);}#sbo-rt-content code.tag,#sbo-rt-content .darkcyan{color:rgb(0,139,139);}#sbo-rt-content code.todo,#sbo-rt-content .black{color:#000;}#sbo-rt-content code.type,#sbo-rt-content .mediumslateblue{color:rgb(123,104,238);}#sbo-rt-content code.typedef,#sbo-rt-content .darkgreen{color:rgb(0,100,0);}#sbo-rt-content code.underlined{text-decoration:underline;}#sbo-rt-content pre code.hll{background-color:#ffc}#sbo-rt-content pre code.c{color:#09F;font-style:italic}#sbo-rt-content pre code.err{color:#A00}#sbo-rt-content pre code.k{color:#069;font-weight:bold}#sbo-rt-content pre code.o{color:#555}#sbo-rt-content pre code.cm{color:#35586C;font-style:italic}#sbo-rt-content pre code.cp{color:#099}#sbo-rt-content pre code.c1{color:#35586C;font-style:italic}#sbo-rt-content pre code.cs{color:#35586C;font-weight:bold;font-style:italic}#sbo-rt-content pre code.gd{background-color:#FCC}#sbo-rt-content pre code.ge{font-style:italic}#sbo-rt-content pre code.gr{color:#F00}#sbo-rt-content pre code.gh{color:#030;font-weight:bold}#sbo-rt-content pre code.gi{background-color:#CFC}#sbo-rt-content pre code.go{color:#000}#sbo-rt-content pre code.gp{color:#009;font-weight:bold}#sbo-rt-content pre code.gs{font-weight:bold}#sbo-rt-content pre code.gu{color:#030;font-weight:bold}#sbo-rt-content pre code.gt{color:#9C6}#sbo-rt-content pre code.kc{color:#069;font-weight:bold}#sbo-rt-content pre code.kd{color:#069;font-weight:bold}#sbo-rt-content pre code.kn{color:#069;font-weight:bold}#sbo-rt-content pre code.kp{color:#069}#sbo-rt-content pre code.kr{color:#069;font-weight:bold}#sbo-rt-content pre code.kt{color:#078;font-weight:bold}#sbo-rt-content pre code.m{color:#F60}#sbo-rt-content pre code.s{color:#C30}#sbo-rt-content pre code.na{color:#309}#sbo-rt-content pre code.nb{color:#366}#sbo-rt-content pre code.nc{color:#0A8;font-weight:bold}#sbo-rt-content pre code.no{color:#360}#sbo-rt-content pre code.nd{color:#99F}#sbo-rt-content pre code.ni{color:#999;font-weight:bold}#sbo-rt-content pre code.ne{color:#C00;font-weight:bold}#sbo-rt-content pre code.nf{color:#C0F}#sbo-rt-content pre code.nl{color:#99F}#sbo-rt-content pre code.nn{color:#0CF;font-weight:bold}#sbo-rt-content pre code.nt{color:#309;font-weight:bold}#sbo-rt-content pre code.nv{color:#033}#sbo-rt-content pre code.ow{color:#000;font-weight:bold}#sbo-rt-content pre code.w{color:#bbb}#sbo-rt-content pre code.mf{color:#F60}#sbo-rt-content pre code.mh{color:#F60}#sbo-rt-content pre code.mi{color:#F60}#sbo-rt-content pre code.mo{color:#F60}#sbo-rt-content pre code.sb{color:#C30}#sbo-rt-content pre code.sc{color:#C30}#sbo-rt-content pre code.sd{color:#C30;font-style:italic}#sbo-rt-content pre code.s2{color:#C30}#sbo-rt-content pre code.se{color:#C30;font-weight:bold}#sbo-rt-content pre code.sh{color:#C30}#sbo-rt-content pre code.si{color:#A00}#sbo-rt-content pre code.sx{color:#C30}#sbo-rt-content pre code.sr{color:#3AA}#sbo-rt-content pre code.s1{color:#C30}#sbo-rt-content pre code.ss{color:#A60}#sbo-rt-content pre code.bp{color:#366}#sbo-rt-content pre code.vc{color:#033}#sbo-rt-content pre code.vg{color:#033}#sbo-rt-content pre code.vi{color:#033}#sbo-rt-content pre code.il{color:#F60}#sbo-rt-content pre code.g{color:#050}#sbo-rt-content pre code.l{color:#C60}#sbo-rt-content pre code.l{color:#F90}#sbo-rt-content pre code.n{color:#008}#sbo-rt-content pre code.nx{color:#008}#sbo-rt-content pre code.py{color:#96F}#sbo-rt-content pre code.p{color:#000}#sbo-rt-content pre code.x{color:#F06}#sbo-rt-content div.blockquote_sampler_toc{width:95%;margin:5px 5px 5px 10px !important}#sbo-rt-content div{font-family:serif;text-align:left}#sbo-rt-content .gray-background,#sbo-rt-content .reverse-video{background:#2E2E2E;color:#FFF}#sbo-rt-content .light-gray-background{background:#A0A0A0}#sbo-rt-content .preserve-whitespace{white-space:pre-wrap}#sbo-rt-content span.gray{color:#4C4C4C}
    </style><script> // <![CDATA[
    var g = {
      position_cache: {
        
          "chapter": "/api/v1/book/9781491920565/chapter/ch18.html",
          "book_id": "9781491920565",
          "chapter_uri": "ch18.html",
          "position": 0,
          "user_uuid": "fee1bd59-4e02-48a4-a7b4-152ec4c157ac",
          "next_chapter_uri": "/library/view/data-visualization-with/9781491920565/ch19.html"
        
      },
      title: "Data Visualization with Python and JavaScript",
      author_list: "Kyran Dale",
      format: "book",
      source: "application/epub+zip",
      is_system_book: true,
      is_public: false,
      loaded_from_server: true,
      allow_scripts: false,
      has_mathml: false,
      show_ios_app_teaser: false
    };
    // ]]></script><script src="/static/js/src/modernizr.js"></script><script>
    
      
       window.PUBLIC_ANNOTATIONS = false;
      

      window.MOBILE_PUBLIC_ANNOTATIONS = false;

    

    
      window.PRIVACY_CONTROL_OVERRIDE = false;
    

    
      window.PRIVACY_CONTROL_SWITCH = true;
    

    
      window.PUBLISHER_PAGES = true;
    

      window.SBO = {
        "constants": {
          "SITB_ENDPOINT": "https://www.safaribooksonline.com/api/v2/sitb/",
          "SEARCH_SELECT_ENDPOINT": "https://www.safaribooksonline.com/api/v2/search/select/",
          "ENABLE_ONLINE_TRAINING": true
        }
      };
  </script><link rel="canonical" href="https://www.safaribooksonline.com/library/view/data-visualization-with/9781491920565/ch18.html"/><meta name="description" content=" Chapter 18. Mapping with D3 Building and customizing map visualizations is one of D3’s core strengths. It has some very sophisticated libraries, allowing for all kinds of projections, from ... "><meta property="og:title" content="18. Mapping with D3" /><meta itemprop="isPartOf" content="/library/view/data-visualization-with/9781491920565/" /><meta itemprop="name" content="18. Mapping with D3" /><meta property="og:url" itemprop="url" content="https://www.safaribooksonline.com/library/view/data-visualization-with/9781491920565/ch18.html" /><meta property="og:site_name" content="Safari" /><meta property="og:image" itemprop="thumbnailUrl" content="https://www.safaribooksonline.com/library/cover/9781491920565/" /><meta property="og:description" itemprop="description" content=" Chapter 18. Mapping with D3 Building and customizing map visualizations is one of D3’s core strengths. It has some very sophisticated libraries, allowing for all kinds of projections, from ... "><meta itemprop="inLanguage" content="en" /><meta itemprop="publisher" content="O&#39;Reilly Media, Inc." /><meta property="og:type" content="book" /><meta property="og:book:isbn" itemprop="isbn" content="9781491920510" /><meta property="og:book:author" itemprop="author" content="Kyran Dale" /><meta property="og:book:tag" itemprop="about" content="JavaScript" /><meta property="og:book:tag" itemprop="about" content="Python" /><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@safari"><script>
    window.ENABLE_BOWERBIRD_COLLECTIONS = true;
  </script><style type="text/css" id="font-styles" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-size: <%= font_size %> !important; }"></style><style type="text/css" id="font-family" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-family: <%= font_family %> !important; }"></style><style type="text/css" id="column-width" data-template="#sbo-rt-content { max-width: <%= column_width %>% !important; margin: 0 auto !important; }"></style><noscript><meta http-equiv="refresh" content="0; url=/library/no-js/" /></noscript><script type="text/javascript">
    (function(i,s,o,g,r,a,m) {
      i['GoogleAnalyticsObject']=r;
      i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();
      a=s.createElement(o),m=s.getElementsByTagName(o)[0];
      a.async=1;
      a.src=g;
      m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    var matches = document.cookie.match(/BrowserCookie\s*=\s*([a-f0-9\-]{36})/),
      user_uuid = null;

    if (matches && matches.length === 2) {
      user_uuid = matches[1];
    }

  
    ga('create', 'UA-39299553-7', {'userId': 'fee1bd59-4e02-48a4-a7b4-152ec4c157ac' });
  

  
    
      ga('set', 'dimension1', 'Trial');
    
  

  ga('set', 'dimension6', user_uuid);

  
    ga('set', 'dimension2', 'fee1bd59-4e02-48a4-a7b4-152ec4c157ac');
    
  

  

  

  //enable enhanced link tracking
  ga('require', 'linkid', 'linkid.js');

  // reading interface will track pageviews itself
  if (document.location.pathname.indexOf("/library/view") !== 0) {
    ga('send', 'pageview');
  }
  </script><script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5P4V6Z');
  </script><script defer src="/static/js/build/vendor.e2e622a103f9.js"></script><script defer src="/static/js/build/reader.84feb506aa44.js"></script></head>


<body class="reading sidenav nav-collapsed  scalefonts">

    
  
  <noscript> 
    <iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P4V6Z"
            height="0" width="0"
            style="display:none;visibility:hidden">
    </iframe>
  </noscript>
  



    
      <div class="hide working" role="status">
        <div class="working-image"></div>
      </div>
      <div class="sbo-site-nav">
        





<a href="#container" class="skip">Skip to content</a><header class="topbar t-topbar"><nav role="navigation" class="js-site-nav"><ul class="topnav"><li class="t-logo"><a href="/home/" class="l0 None safari-home nav-icn js-keyboard-nav-home"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>Safari Home Icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M4 9.9L4 9.9 4 18 16 18 16 9.9 10 4 4 9.9ZM2.6 8.1L2.6 8.1 8.7 1.9 10 0.5 11.3 1.9 17.4 8.1 18 8.7 18 9.5 18 18.1 18 20 16.1 20 3.9 20 2 20 2 18.1 2 9.5 2 8.7 2.6 8.1Z"/><rect x="10" y="12" width="3" height="7"/><rect transform="translate(18.121320, 10.121320) rotate(-315.000000) translate(-18.121320, -10.121320) " x="16.1" y="9.1" width="4" height="2"/><rect transform="translate(2.121320, 10.121320) scale(-1, 1) rotate(-315.000000) translate(-2.121320, -10.121320) " x="0.1" y="9.1" width="4" height="2"/></g></svg><span>Safari Home</span></a></li><li><a href="/r/" class="t-recommendations-nav l0 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>recommendations icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M50 25C50 18.2 44.9 12.5 38.3 11.7 37.5 5.1 31.8 0 25 0 18.2 0 12.5 5.1 11.7 11.7 5.1 12.5 0 18.2 0 25 0 31.8 5.1 37.5 11.7 38.3 12.5 44.9 18.2 50 25 50 31.8 50 37.5 44.9 38.3 38.3 44.9 37.5 50 31.8 50 25ZM25 3.1C29.7 3.1 33.6 6.9 34.4 11.8 30.4 12.4 26.9 15.1 25 18.8 23.1 15.1 19.6 12.4 15.6 11.8 16.4 6.9 20.3 3.1 25 3.1ZM34.4 15.6C33.6 19.3 30.7 22.2 27.1 22.9 27.8 19.2 30.7 16.3 34.4 15.6ZM22.9 22.9C19.2 22.2 16.3 19.3 15.6 15.6 19.3 16.3 22.2 19.2 22.9 22.9ZM3.1 25C3.1 20.3 6.9 16.4 11.8 15.6 12.4 19.6 15.1 23.1 18.8 25 15.1 26.9 12.4 30.4 11.8 34.4 6.9 33.6 3.1 29.7 3.1 25ZM22.9 27.1C22.2 30.7 19.3 33.6 15.6 34.4 16.3 30.7 19.2 27.8 22.9 27.1ZM25 46.9C20.3 46.9 16.4 43.1 15.6 38.2 19.6 37.6 23.1 34.9 25 31.3 26.9 34.9 30.4 37.6 34.4 38.2 33.6 43.1 29.7 46.9 25 46.9ZM27.1 27.1C30.7 27.8 33.6 30.7 34.4 34.4 30.7 33.6 27.8 30.7 27.1 27.1ZM38.2 34.4C37.6 30.4 34.9 26.9 31.3 25 34.9 23.1 37.6 19.6 38.2 15.6 43.1 16.4 46.9 20.3 46.9 25 46.9 29.7 43.1 33.6 38.2 34.4Z"/></g></svg><span>Recommended</span></a></li><li><a href="/playlists/" class="t-queue-nav l0 nav-icn None"><?xml version="1.0" encoding="UTF-8"?><svg width="21px" height="17px" viewBox="0 0 21 17" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><!-- Generator: Sketch 46.2 (44496) - http://www.bohemiancoding.com/sketch --><title>icon_Playlist_sml</title><desc>Created with Sketch.</desc><defs></defs><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="icon_Playlist_sml" fill-rule="nonzero" fill="#000000"><g id="playlist-icon"><g id="Group-6"><rect id="Rectangle-path" x="5" y="0" width="16" height="3" rx="0.5"></rect><circle id="Oval" cx="1.5" cy="1.5" r="1.5"></circle></g><g id="Group-5" transform="translate(0.000000, 7.000000)"><circle id="Oval" cx="1.5" cy="1.5" r="1.5"></circle><rect id="Rectangle-path" x="5" y="0" width="16" height="3" rx="0.5"></rect></g><g id="Group-5-Copy" transform="translate(0.000000, 14.000000)"><circle id="Oval" cx="1.5" cy="1.5" r="1.5"></circle><rect id="Rectangle-path" x="5" y="0" width="16" height="3" rx="0.5"></rect></g></g></g></g></svg><span>
                 Playlists
              </span></a></li><li class="search"><a href="#" class="t-search-nav trigger nav-icn l0" data-dropdown-selector=".searchbox"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>search icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M31.3 0C20.9 0 12.5 8.4 12.5 18.8 12.5 22.5 13.6 25.9 15.4 28.8L1.2 42.9C-0.4 44.5-0.4 47.2 1.2 48.8 2 49.6 3.1 50 4.2 50 5.2 50 6.3 49.6 7.1 48.8L21.2 34.6C24.1 36.5 27.5 37.5 31.3 37.5 41.6 37.5 50 29.1 50 18.8 50 8.4 41.6 0 31.3 0ZM31.3 31.3C24.4 31.3 18.8 25.6 18.8 18.8 18.8 11.9 24.4 6.3 31.3 6.3 38.1 6.3 43.8 11.9 43.8 18.8 43.8 25.6 38.1 31.3 31.3 31.3Z"/></g></svg><span>Search</span></a></li><li class="usermenu dropdown"><a href="#" class="trigger l0 nav-icn nav-dropdown"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>navigation arrow</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M0.1 12.5L9.7 3.1C9.8 3 9.9 3 10 3 10.1 3 10.2 3 10.3 3.1L19.9 12.5C20 12.5 20 12.6 20 12.8 20 12.9 20 13 19.9 13L17 15.9C16.9 16 16.8 16 16.7 16 16.5 16 16.4 16 16.4 15.9L10 9.7 3.6 15.9C3.6 16 3.5 16 3.3 16 3.2 16 3.1 16 3 15.9L0.1 13C0 12.9 0 12.8 0 12.7 0 12.7 0 12.6 0.1 12.5Z"/></g></svg><span>Expand Nav</span></a><div class="drop-content"><ul><li><a href="/history/" class="t-recent-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>recent items icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 0C11.2 0 0 11.2 0 25 0 38.8 11.2 50 25 50 38.8 50 50 38.8 50 25 50 11.2 38.8 0 25 0ZM6.3 25C6.3 14.6 14.6 6.3 25 6.3 35.4 6.3 43.8 14.6 43.8 25 43.8 35.4 35.4 43.8 25 43.8 14.6 43.8 6.3 35.4 6.3 25ZM31.8 31.5C32.5 30.5 32.4 29.2 31.6 28.3L27.1 23.8 27.1 12.8C27.1 11.5 26.2 10.4 25 10.4 23.9 10.4 22.9 11.5 22.9 12.8L22.9 25.7 28.8 31.7C29.2 32.1 29.7 32.3 30.2 32.3 30.8 32.3 31.3 32 31.8 31.5Z"/></g></svg><span>History</span></a></li><li><a href="/topics" class="t-topics-link l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 55" width="20" height="20" version="1.1" fill="#4A3C31"><desc>topics icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 55L50 41.262 50 13.762 25 0 0 13.762 0 41.262 25 55ZM8.333 37.032L8.333 17.968 25 8.462 41.667 17.968 41.667 37.032 25 46.538 8.333 37.032Z"/></g></svg><span>Topics</span></a></li><li><a href="/tutorials/" class="l1 nav-icn t-tutorials-nav js-toggle-menu-item None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>tutorials icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M15.8 18.2C15.8 18.2 15.9 18.2 16 18.2 16.1 18.2 16.2 18.2 16.4 18.2 16.5 18.2 16.7 18.1 16.9 18 17 17.9 17.1 17.8 17.2 17.7 17.3 17.6 17.4 17.5 17.4 17.4 17.5 17.2 17.6 16.9 17.6 16.7 17.6 16.6 17.6 16.5 17.6 16.4 17.5 16.2 17.5 16.1 17.4 15.9 17.3 15.8 17.2 15.6 17 15.5 16.8 15.3 16.6 15.3 16.4 15.2 16.2 15.2 16 15.2 15.8 15.2 15.7 15.2 15.5 15.3 15.3 15.4 15.2 15.4 15.1 15.5 15 15.7 14.9 15.8 14.8 15.9 14.7 16 14.7 16.1 14.6 16.3 14.6 16.4 14.6 16.5 14.6 16.6 14.6 16.6 14.6 16.7 14.6 16.9 14.6 17 14.6 17.1 14.7 17.3 14.7 17.4 14.8 17.6 15 17.7 15.1 17.9 15.2 18 15.3 18 15.5 18.1 15.5 18.1 15.6 18.2 15.7 18.2 15.7 18.2 15.7 18.2 15.8 18.2L15.8 18.2ZM9.4 11.5C9.5 11.5 9.5 11.5 9.6 11.5 9.7 11.5 9.9 11.5 10 11.5 10.2 11.5 10.3 11.4 10.5 11.3 10.6 11.2 10.8 11.1 10.9 11 10.9 10.9 11 10.8 11.1 10.7 11.2 10.5 11.2 10.2 11.2 10 11.2 9.9 11.2 9.8 11.2 9.7 11.2 9.5 11.1 9.4 11 9.2 10.9 9.1 10.8 8.9 10.6 8.8 10.5 8.7 10.3 8.6 10 8.5 9.9 8.5 9.7 8.5 9.5 8.5 9.3 8.5 9.1 8.6 9 8.7 8.8 8.7 8.7 8.8 8.6 9 8.5 9.1 8.4 9.2 8.4 9.3 8.2 9.5 8.2 9.8 8.2 10 8.2 10.1 8.2 10.2 8.2 10.3 8.2 10.5 8.3 10.6 8.4 10.7 8.5 10.9 8.6 11.1 8.7 11.2 8.9 11.3 9 11.4 9.1 11.4 9.2 11.4 9.3 11.5 9.3 11.5 9.3 11.5 9.4 11.5 9.4 11.5L9.4 11.5ZM3 4.8C3.1 4.8 3.1 4.8 3.2 4.8 3.4 4.8 3.5 4.8 3.7 4.8 3.8 4.8 4 4.7 4.1 4.6 4.3 4.5 4.4 4.4 4.5 4.3 4.6 4.2 4.6 4.1 4.7 4 4.8 3.8 4.8 3.5 4.8 3.3 4.8 3.1 4.8 3 4.8 2.9 4.7 2.8 4.7 2.6 4.6 2.5 4.5 2.3 4.4 2.2 4.2 2.1 4 1.9 3.8 1.9 3.6 1.8 3.5 1.8 3.3 1.8 3.1 1.8 2.9 1.8 2.7 1.9 2.6 2 2.4 2.1 2.3 2.2 2.2 2.3 2.1 2.4 2 2.5 2 2.6 1.8 2.8 1.8 3 1.8 3.3 1.8 3.4 1.8 3.5 1.8 3.6 1.8 3.8 1.9 3.9 2 4 2.1 4.2 2.2 4.4 2.4 4.5 2.5 4.6 2.6 4.7 2.7 4.7 2.8 4.7 2.9 4.8 2.9 4.8 3 4.8 3 4.8 3 4.8L3 4.8ZM13.1 15.2C13.2 15.1 13.2 15.1 13.2 15.1 13.3 14.9 13.4 14.7 13.6 14.5 13.8 14.2 14.1 14 14.4 13.8 14.7 13.6 15.1 13.5 15.5 13.4 15.9 13.4 16.3 13.4 16.7 13.5 17.2 13.5 17.6 13.7 17.9 13.9 18.2 14.1 18.5 14.4 18.7 14.7 18.9 15 19.1 15.3 19.2 15.6 19.3 15.9 19.4 16.1 19.4 16.4 19.4 17 19.3 17.5 19.1 18.1 19 18.3 18.9 18.5 18.7 18.7 18.5 19 18.3 19.2 18 19.4 17.7 19.6 17.3 19.8 16.9 19.9 16.6 20 16.3 20 16 20 15.8 20 15.6 20 15.4 19.9 15.4 19.9 15.4 19.9 15.4 19.9 15.2 19.9 15 19.8 14.9 19.8 14.8 19.7 14.7 19.7 14.6 19.7 14.4 19.6 14.3 19.5 14.1 19.3 13.7 19.1 13.4 18.7 13.2 18.4 13.1 18.1 12.9 17.8 12.9 17.5 12.8 17.3 12.8 17.1 12.8 16.9L3.5 14.9C3.3 14.9 3.1 14.8 3 14.8 2.7 14.7 2.4 14.5 2.1 14.3 1.7 14 1.4 13.7 1.2 13.3 1 13 0.9 12.6 0.8 12.3 0.7 12 0.7 11.7 0.7 11.4 0.7 11 0.8 10.5 1 10.1 1.1 9.8 1.3 9.5 1.6 9.2 1.8 8.9 2.1 8.7 2.4 8.5 2.8 8.3 3.2 8.1 3.6 8.1 3.9 8 4.2 8 4.5 8 4.6 8 4.8 8 4.9 8.1L6.8 8.5C6.8 8.4 6.8 8.4 6.8 8.4 6.9 8.2 7.1 8 7.2 7.8 7.5 7.5 7.7 7.3 8 7.1 8.4 6.9 8.7 6.8 9.1 6.7 9.5 6.7 10 6.7 10.4 6.8 10.8 6.8 11.2 7 11.5 7.2 11.8 7.5 12.1 7.7 12.4 8 12.6 8.3 12.7 8.6 12.8 8.9 12.9 9.2 13 9.4 13 9.7 13 9.7 13 9.8 13 9.8 13.6 9.9 14.2 10.1 14.9 10.2 15 10.2 15 10.2 15.1 10.2 15.3 10.2 15.4 10.2 15.6 10.2 15.8 10.1 16 10 16.2 9.9 16.4 9.8 16.5 9.6 16.6 9.5 16.8 9.2 16.9 8.8 16.9 8.5 16.9 8.3 16.9 8.2 16.8 8 16.8 7.8 16.7 7.7 16.6 7.5 16.5 7.3 16.3 7.2 16.2 7.1 16 7 15.9 6.9 15.8 6.9 15.7 6.9 15.6 6.8 15.5 6.8L6.2 4.8C6.2 5 6 5.2 5.9 5.3 5.7 5.6 5.5 5.8 5.3 6 4.9 6.2 4.5 6.4 4.1 6.5 3.8 6.6 3.5 6.6 3.2 6.6 3 6.6 2.8 6.6 2.7 6.6 2.6 6.6 2.6 6.5 2.6 6.5 2.5 6.5 2.3 6.5 2.1 6.4 1.8 6.3 1.6 6.1 1.3 6 1 5.7 0.7 5.4 0.5 5 0.3 4.7 0.2 4.4 0.1 4.1 0 3.8 0 3.6 0 3.3 0 2.8 0.1 2.2 0.4 1.7 0.5 1.5 0.7 1.3 0.8 1.1 1.1 0.8 1.3 0.6 1.6 0.5 2 0.3 2.3 0.1 2.7 0.1 3.1 0 3.6 0 4 0.1 4.4 0.2 4.8 0.3 5.1 0.5 5.5 0.8 5.7 1 6 1.3 6.2 1.6 6.3 1.9 6.4 2.3 6.5 2.5 6.6 2.7 6.6 3 6.6 3 6.6 3.1 6.6 3.1 9.7 3.8 12.8 4.4 15.9 5.1 16.1 5.1 16.2 5.2 16.4 5.2 16.7 5.3 16.9 5.5 17.2 5.6 17.5 5.9 17.8 6.2 18.1 6.5 18.3 6.8 18.4 7.2 18.6 7.5 18.6 7.9 18.7 8.2 18.7 8.6 18.7 9 18.6 9.4 18.4 9.8 18.3 10.1 18.2 10.3 18 10.6 17.8 10.9 17.5 11.1 17.3 11.3 16.9 11.6 16.5 11.8 16 11.9 15.7 12 15.3 12 15 12 14.8 12 14.7 12 14.5 11.9 13.9 11.8 13.3 11.7 12.6 11.5 12.5 11.7 12.4 11.9 12.3 12 12.1 12.3 11.9 12.5 11.7 12.7 11.3 12.9 10.9 13.1 10.5 13.2 10.2 13.3 9.9 13.3 9.6 13.3 9.4 13.3 9.2 13.3 9 13.2 9 13.2 9 13.2 9 13.2 8.8 13.2 8.7 13.2 8.5 13.1 8.2 13 8 12.8 7.7 12.6 7.4 12.4 7.1 12 6.8 11.7 6.7 11.4 6.6 11.1 6.5 10.8 6.4 10.6 6.4 10.4 6.4 10.2 5.8 10.1 5.2 9.9 4.5 9.8 4.4 9.8 4.4 9.8 4.3 9.8 4.1 9.8 4 9.8 3.8 9.8 3.6 9.9 3.4 10 3.2 10.1 3 10.2 2.9 10.4 2.8 10.5 2.6 10.8 2.5 11.1 2.5 11.5 2.5 11.6 2.5 11.8 2.6 12 2.6 12.1 2.7 12.3 2.8 12.5 2.9 12.6 3.1 12.8 3.2 12.9 3.3 13 3.5 13.1 3.6 13.1 3.7 13.1 3.8 13.2 3.9 13.2L13.1 15.2 13.1 15.2Z"/></g></svg><span>Tutorials</span></a></li><li class="nav-offers flyout-parent"><a href="#" class="l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>offers icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M35.9 20.6L27 15.5C26.1 15 24.7 15 23.7 15.5L14.9 20.6C13.9 21.1 13.2 22.4 13.2 23.4L13.2 41.4C13.2 42.4 13.9 43.7 14.9 44.2L23.3 49C24.2 49.5 25.6 49.5 26.6 49L35.9 43.6C36.8 43.1 37.6 41.8 37.6 40.8L37.6 23.4C37.6 22.4 36.8 21.1 35.9 20.6L35.9 20.6ZM40 8.2C39.1 7.6 37.6 7.6 36.7 8.2L30.2 11.9C29.3 12.4 29.3 13.2 30.2 13.8L39.1 18.8C40 19.4 40.7 20.6 40.7 21.7L40.7 39C40.7 40.1 41.4 40.5 42.4 40L48.2 36.6C49.1 36.1 49.8 34.9 49.8 33.8L49.8 15.6C49.8 14.6 49.1 13.3 48.2 12.8L40 8.2 40 8.2ZM27 10.1L33.6 6.4C34.5 5.9 34.5 5 33.6 4.5L26.6 0.5C25.6 0 24.2 0 23.3 0.5L16.7 4.2C15.8 4.7 15.8 5.6 16.7 6.1L23.7 10.1C24.7 10.6 26.1 10.6 27 10.1ZM10.1 21.7C10.1 20.6 10.8 19.4 11.7 18.8L20.6 13.8C21.5 13.2 21.5 12.4 20.6 11.9L13.6 7.9C12.7 7.4 11.2 7.4 10.3 7.9L1.6 12.8C0.7 13.3 0 14.6 0 15.6L0 33.8C0 34.9 0.7 36.1 1.6 36.6L8.4 40.5C9.3 41 10.1 40.6 10.1 39.6L10.1 21.7 10.1 21.7Z"/></g></svg><span>Offers & Deals</span></a><ul class="flyout"><li><a href="https://get.oreilly.com/email-signup.html" target="_blank" class="l2 nav-icn"><span>Newsletters</span></a></li></ul></li><li class="nav-highlights"><a href="/u/fee1bd59-4e02-48a4-a7b4-152ec4c157ac/" class="t-highlights-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 35" width="20" height="20" version="1.1" fill="#4A3C31"><desc>highlights icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M13.325 18.071L8.036 18.071C8.036 11.335 12.36 7.146 22.5 5.594L22.5 0C6.37 1.113 0 10.632 0 22.113 0 29.406 3.477 35 10.403 35 15.545 35 19.578 31.485 19.578 26.184 19.578 21.556 17.211 18.891 13.325 18.071L13.325 18.071ZM40.825 18.071L35.565 18.071C35.565 11.335 39.86 7.146 50 5.594L50 0C33.899 1.113 27.5 10.632 27.5 22.113 27.5 29.406 30.977 35 37.932 35 43.045 35 47.078 31.485 47.078 26.184 47.078 21.556 44.74 18.891 40.825 18.071L40.825 18.071Z"/></g></svg><span>Highlights</span></a></li><li><a href="/u/" class="t-settings-nav l1 js-settings nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"/></g></svg><span>Settings</span></a></li><li><a href="https://www.safaribooksonline.com/public/support" class="l1 no-icon">Support</a></li><li><a href="/accounts/logout/" class="l1 no-icon">Sign Out</a></li></ul><ul class="profile"><li><a href="/u/" class="l2 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"/></g></svg><span>Settings</span></a><span class="l2 t-nag-notification"  id="nav-nag" ><strong class="trial-green">7</strong> days left in your trial.
  
  

  
    
      

<a class="" href="/subscribe/">Subscribe</a>.


    
  

  

</span></li><li><a href="https://www.safaribooksonline.com/public/support" class="l2">Support</a></li><li><a href="/accounts/logout/" class="l2">Sign Out</a></li></ul></div></li></ul></nav></header>


      </div>
      <div id="container" class="application">
        
          <div class="nav-container clearfix">
            


            
            
          </div>

          

  <div class="js-toc">
    
      <div class="sbo-reading-menu sbo-menu-top"><section class="sbo-toc-container toc-menu"><a href="#" class="sbo-toc-thumb"><span class="sbo-title ss-list"><h1><div class="visuallyhidden">Table of Contents for </div>
      
      Data Visualization with Python and JavaScript
      
    </h1></span></a><div class="toc-contents"></div></section></div>

    

    <div class="interface-controls interface-controls-top">
      <ul class="interface-control-btns js-bitlist js-reader">
        <li class="js-search-in-archive search-in-archive t-search-in-archive"><a href="#" title="Search in archive" class="js-search-controls search-controls"><span class="icon">Search in book...</span></a><form class="search-archive-bar js-search-form"><input type="search" name="query" placeholder="Search inside this book..." autocomplete="off"></form><div class="search-archive-results"><div class="js-sitb-results-region"></div></div></li><li class="queue-control"><div class="js-content-uri" data-content-uri="/api/v1/book/9781491920565/chapter/ch18.html"><div class="js-collections-dropdown collections-dropdown menu-bit-cards"></div></div></li><li class="js-font-control-panel font-control-activator"><a href="#" data-push-state="false" id="font-controls" title="Change font size" aria-label="Change font size"><span class="icon">Toggle Font Controls</span></a></li><li class="dropdown sharing-controls"><a href="#" class="trigger" data-push-state="false" title="Share" aria-label="Share"><i class="fa fa-share"></i></a><ul class="social-sharing dropdown-menu"><li><a
        class="twitter share-button t-twitter"
        target="_blank"
        aria-label="Share this section on Twitter"
        title="Share this section on Twitter"
      
        href="https://twitter.com/share?url=https://www.safaribooksonline.com/library/view/data-visualization-with/9781491920565/ch18.html&text=Data%20Visualization%20with%20Python%20and%20JavaScript&via=safari"
      ><span>Twitter</span></a></li><li><a
        class="facebook share-button t-facebook"
        target="_blank"
        aria-label="Share this section on Facebook"
        title="Share this section on Facebook"
        href="https://www.facebook.com/sharer/sharer.php?u=https://www.safaribooksonline.com/library/view/data-visualization-with/9781491920565/ch18.html"
      ><span>Facebook</span></a></li><li><a
        class="googleplus share-button t-googleplus"
        target="_blank"
        aria-label="Share this secton on Google Plus"
        title="Share this secton on Google Plus"
        href="https://plus.google.com/share?url=https://www.safaribooksonline.com/library/view/data-visualization-with/9781491920565/ch18.html"
      ><span>Google Plus</span></a></li><li><a
        class="email share-button t-email"
        aria-label="Share this section via email"
        title="Share this section via email"
      
        href="mailto:?subject=Safari: 18.%20Mapping%20with%20D3&body=https://www.safaribooksonline.com/library/view/data-visualization-with/9781491920565/ch18.html%0D%0Afrom Data%20Visualization%20with%20Python%20and%20JavaScript%0D%0A"
      ><span>Email</span></a></li></ul></li>
      </ul>
    </div>

    <section role="document">
        
        



 <!--[if lt IE 9]>
  
<![endif]-->



  <script defer src="/static/js/build/djangoMessagesPage.893631b34e7a.js"></script>


        
	  <div class="t-sbo-prev sbo-prev sbo-nav-top">
  
    
      
        <a href="/library/view/data-visualization-with/9781491920565/ch17.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">17. Visualizing Individual Prizes</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-top">
  
    
      
        <a href="/library/view/data-visualization-with/9781491920565/ch19.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">19. Visualizing Individual Winners</div>
        </a>
    
  
  </div>



<div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 18. Mapping with D3"><div class="chapter" id="chapter_d3_maps">
<h1><span class="label">Chapter 18. </span>Mapping with D3</h1>


<p><a data-type="indexterm" data-primary="D3 library" data-secondary="map visualizations" data-tertiary="benefits of" id="idm140319392813824"></a>Building and customizing map visualizations is one of D3’s core strengths. It has some very sophisticated libraries, allowing for all kinds of projections, from the workhorse Mercator and orthographic to more esoteric ones such as conicEquidistant. Mapping seems to be something of an obsession for Mike Bostock and Jason Davies, D3’s core devs, and their attention to detail is striking. If you have a mapping problem, chances are D3 can do the heavy lifting required.<sup><a data-type="noteref" id="idm140319392812112-marker" href="ch18.html#idm140319392812112">1</a></sup> In this chapter, we’ll use our Nobel Prize visualization (Nobel-viz) map (<a data-type="xref" href="#d3maps_target">Figure 18-1</a>) to introduce the core D3 mapping concepts.</p>

<figure><div id="d3maps_target" class="figure">
<img src="dvpj_1403.png" alt="dvpj 1403" width="699" height="351">
<h6><span class="label">Figure 18-1. </span>This chapter’s target element</h6>
</div></figure>






<section data-type="sect1" data-pdf-bookmark="Available Maps"><div class="sect1" id="idm140319392808768">
<h1>Available Maps</h1>

<p><a data-type="indexterm" data-primary="D3 library" data-secondary="map visualizations" data-tertiary="available maps" id="idm140319392807520"></a><a data-type="indexterm" data-primary="Shapefile" id="idm140319392806432"></a><a data-type="indexterm" data-primary="geographic information system (GIS)" id="idm140319392805824"></a>The most popular mapping format is the aging <a href="https://en.wikipedia.org/wiki/Shapefile">Shapefile</a>, developed for geographic information system (GIS) software. There  are many free and proprietary desktop programs<sup><a data-type="noteref" id="idm140319392804336-marker" href="ch18.html#idm140319392804336">2</a></sup> to manipulate and produce Shapefiles.</p>

<p><a data-type="indexterm" data-primary="TopoJSON" id="idm140319392802832"></a>Unfortunately, Shapefiles were not designed for the Web, which would far rather deal in a JSON-based map format, and demands small, efficient representations to limit bandwidth and related lag.</p>

<p>The good news is that there are many convenient ways to convert Shapefiles to our preferred TopoJSON format,<sup><a data-type="noteref" id="idm140319392801376-marker" href="ch18.html#idm140319392801376">3</a></sup> meaning you can manipulate your Shapefiles in software and then convert them to a web-friendly format. The standard way of finding maps for web dataviz is to first look for TopoJSON or GeoJSON versions, then search among the richer pool of Shapefiles, and, as a last resort, roll your own using a Shapefile, or equivalent, editor. Depending on how much map visualization  you intend to do, there will probably be an off-the-shelf solution. For things like world maps or continental projections (e.g., the popular Albers-USA), you can usually find a number of solutions with different degrees of accuracy.</p>

<p>For our Nobel map, we want a global mapping, at least showing all 58 Nobel Prize–winning nations, with labeled shapes for pretty much all of them. Luckily, D3 provides a number of example world maps, one at 50m grid resolution, the other a smaller 110m resolution map. The latter is fine for our fairly crude requirements.<sup><a data-type="noteref" id="idm140319392799408-marker" href="ch18.html#idm140319392799408">4</a></sup></p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="D3’s Mapping Data Formats"><div class="sect1" id="idm140319392798576">
<h1>D3’s Mapping Data Formats</h1>

<p><a data-type="indexterm" data-primary="D3 library" data-secondary="map visualizations" data-tertiary="data formats" id="D3mapdata18"></a><a data-type="indexterm" data-primary="Bostock, Mike" id="idm140319392796128"></a>D3 makes use of two JSON-based geometric data formats, <a href="http://geojson.org/">GeoJSON</a> and <a href="https://github.com/mbostock/topojson">TopoJSON</a>, an extension of GeoJSON devised by Mike Bostock that encodes topology. GeoJSON is more intuitive to read, but TopoJSON is far more efficient in most cases. Typically, maps are converted to TopoJSON for web delivery, where size is an important consideration. The TopoJSON is then converted to GeoJSON via D3 on the browser, to simplify SVG path creation, feature optimization, and so on.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>There is a nice summation of the differences between TopoJSON and GeoJSON on <a href="http://bit.ly/2621NJg">Stack Overflow</a>.</p>
</div>

<p>Let’s have a look at the two formats now. Understanding their basic structure is important and a little effort there will pay off, especially as your mapping endeavors become more ambitious.</p>








<section data-type="sect2" data-pdf-bookmark="GeoJSON"><div class="sect2" id="idm140319392791392">
<h2>GeoJSON</h2>

<p><a data-type="indexterm" data-primary="GeoJSON" id="idm140319392790144"></a>GeoJSON files contain one <code>type</code> object, one of Point, MultiPoint, LineString, MultiLineString, Polygon, MultiPolygon, GeometryCollection, Feature, or FeatureCollection. The case of the type member values must be <a href="http://bit.ly/1V2p2Yr">CamelCase</a>, as shown here. They may also contain a <code>crs</code> member, specifying a particular coordinate reference system.</p>

<p>FeatureCollections are the largest GeoJSON container, and maps with more than one region are usually specified with these. FeatureCollections contain a <code>features</code> array, each element of which is a GeoJSON object of a type listed in the previous paragraph.</p>

<p><a data-type="xref" href="#d3maps_geojson">Example 18-1</a> shows a typical FeatureCollection containing an array of country maps, the boundaries of which are specified by Polygons.</p>
<div id="d3maps_geojson" data-type="example">
<h5><span class="label">Example 18-1. </span>The GeoJSON mapping data format</h5>

<pre data-type="programlisting" data-code-language="json"><code class="p">{</code><code>
  </code><code class="nt">"type"</code><code class="p">:</code><code> </code><code class="s2">"FeatureCollection"</code><code class="p">,</code><code> </code><a class="co" id="co_mapping_with_d3_CO1-1" href="#callout_mapping_with_d3_CO1-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
  </code><code class="nt">"features"</code><code class="p">:</code><code> </code><code class="p">[</code><code> </code><a class="co" id="co_mapping_with_d3_CO1-2" href="#callout_mapping_with_d3_CO1-2"><img src="2.png" alt="2" width="12" height="12"></a><code>
    </code><code class="p">{</code><code>
      </code><code class="nt">"type"</code><code class="p">:</code><code> </code><code class="s2">"Feature"</code><code class="p">,</code><code>
      </code><code class="nt">"id"</code><code class="p">:</code><code> </code><code class="s2">"AFG"</code><code class="p">,</code><code>
      </code><code class="nt">"properties"</code><code class="p">:</code><code> </code><code class="p">{</code><code>
        </code><code class="nt">"name"</code><code class="p">:</code><code> </code><code class="s2">"Afghanistan"</code><code>
      </code><code class="p">}</code><code class="p">,</code><code>
      </code><code class="nt">"geometry"</code><code class="p">:</code><code> </code><code class="p">{</code><code> </code><a class="co" id="co_mapping_with_d3_CO1-3" href="#callout_mapping_with_d3_CO1-3"><img src="3.png" alt="3" width="12" height="12"></a><code>
        </code><code class="nt">"type"</code><code class="p">:</code><code> </code><code class="s2">"Polygon"</code><code class="p">,</code><code>
        </code><code class="nt">"coordinates"</code><code class="p">:</code><code> </code><code class="p">[</code><code>
          </code><code class="p">[</code><code>
            </code><code class="p">[</code><code>
              </code><code class="mf">61.210817</code><code class="p">,</code><code> </code><a class="co" id="co_mapping_with_d3_CO1-4" href="#callout_mapping_with_d3_CO1-4"><img src="4.png" alt="4" width="12" height="12"></a><code>
              </code><code class="mf">35.650072</code><code>
            </code><code class="p">]</code><code class="p">,</code><code>
            </code><code class="p">[</code><code>
              </code><code class="mf">62.230651</code><code class="p">,</code><code>
              </code><code class="mf">35.270664</code><code>
            </code><code class="p">]</code><code class="p">,</code><code>
            </code><code class="err">.</code><code class="err">.</code><code class="err">.</code><code>
          </code><code class="p">]</code><code>
        </code><code class="p">]</code><code>
      </code><code class="p">}</code><code>
    </code><code class="p">}</code><code class="p">,</code><code>
    </code><code class="err">.</code><code class="err">.</code><code class="err">.</code><code>
    </code><code class="p">{</code><code>
      </code><code class="nt">"type"</code><code class="p">:</code><code> </code><code class="s2">"Feature"</code><code class="p">,</code><code>
      </code><code class="nt">"id"</code><code class="p">:</code><code> </code><code class="s2">"ZWE"</code><code class="p">,</code><code>
      </code><code class="nt">"properties"</code><code class="p">:</code><code> </code><code class="p">{</code><code>
        </code><code class="nt">"name"</code><code class="p">:</code><code> </code><code class="s2">"Zimbabwe"</code><code>
      </code><code class="p">}</code><code class="p">,</code><code>
      </code><code class="nt">"geometry"</code><code class="p">:</code><code> </code><code class="p">{</code><code>
        </code><code class="nt">"type"</code><code class="p">:</code><code> </code><code class="s2">"Polygon"</code><code class="p">,</code><code>
        </code><code class="nt">"coordinates"</code><code class="p">:</code><code> </code><code class="p">[</code><code>
          </code><code class="p">[</code><code>
            </code><code class="p">[</code><code class="err">.</code><code class="err">.</code><code class="err">.</code><code>
      </code><code class="err">}</code><code>
    </code><code class="err">}</code><code>
  </code><code class="p">]</code><code>
</code><code class="err">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_mapping_with_d3_CO1-1" href="#co_mapping_with_d3_CO1-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>Each GeoJSON file contains a single object wth a type and containing…</p></dd>
<dt><a class="co" id="callout_mapping_with_d3_CO1-2" href="#co_mapping_with_d3_CO1-2"><img src="2.png" alt="2" width="12" height="12"></a></dt>
<dd><p>…an  array of Features—in this case, country objects…</p></dd>
<dt><a class="co" id="callout_mapping_with_d3_CO1-3" href="#co_mapping_with_d3_CO1-3"><img src="3.png" alt="3" width="12" height="12"></a></dt>
<dd><p>…with coordinate-based, polygonal geometry.</p></dd>
<dt><a class="co" id="callout_mapping_with_d3_CO1-4" href="#co_mapping_with_d3_CO1-4"><img src="4.png" alt="4" width="12" height="12"></a></dt>
<dd><p>Note that the geographic coordinates are given in [Longitude, Latitude] pairs, the reverse of conventional geographic positioning. This is because GeoJSON use an [X,Y] coordinate scheme.</p></dd>
</dl></div>

<p>Although GeoJSON is more succinct than Shapefiles and in the preferred  JSON format, there is a lot of redundancy in the encoding of maps. For example, shared boundaries are specified twice and the floating-point coordinate format is fairly inflexible and, for many jobs, too precise. The TopoJSON format was designed to address these issues and produce a far more efficient way of delivering maps to the browser.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="TopoJSON"><div class="sect2" id="idm140319392640080">
<h2>TopoJSON</h2>

<p><a data-type="indexterm" data-primary="TopoJSON" id="topoj18"></a>Developed by Mike Bostock, TopoJSON is an extension to GeoJSON that encodes topology, stitching geometries together from a shared pool of line segments called arcs. Because they reuse these arcs, TopoJSON files are typically 80% smaller than their GeoJSON equivalents! In addition, taking a topological approach to map representation enables a number of techniques that use topology. One of these is topology-preserving shape simplification,<sup><a data-type="noteref" id="idm140319392657472-marker" href="ch18.html#idm140319392657472">5</a></sup> which can eliminate 95% of map points while retaining sufficient detail. Cartograms and automatic map coloring are also facilitated. <a data-type="xref" href="#d3maps_topojson_basic">Example 18-2</a>  shows the structure of a TopoJSON file.</p>
<div id="d3maps_topojson_basic" data-type="example">
<h5><span class="label">Example 18-2. </span>Structure of our TopoJSON world map</h5>

<pre data-type="programlisting">{
   "type":"Topology",   <a class="co" id="co_mapping_with_d3_CO2-1" href="#callout_mapping_with_d3_CO2-1"><img src="1.png" alt="1" width="12" height="12"></a>
   "objects:{           <a class="co" id="co_mapping_with_d3_CO2-2" href="#callout_mapping_with_d3_CO2-2"><img src="2.png" alt="2" width="12" height="12"></a>
      "countries":{
        "type": "GeometryCollection",
        "geometries": [{
        "_id":24, "arcs":[[6,7,8],[10,11,12]], ... <a class="co" id="co_mapping_with_d3_CO2-3" href="#callout_mapping_with_d3_CO2-3"><img src="3.png" alt="3" width="12" height="12"></a>
      ...},
      "land":{...},
   },
   "arcs":[[[67002,72360],[284,-219],[209..]], &lt;-- arc number 0 <a class="co" id="co_mapping_with_d3_CO2-4" href="#callout_mapping_with_d3_CO2-4"><img src="4.png" alt="4" width="12" height="12"></a>
           [[70827,73379],[50,-165]], ...      &lt;-- arc number 1
   ...]
   "transform":{        <a class="co" id="co_mapping_with_d3_CO2-5" href="#callout_mapping_with_d3_CO2-5"><img src="5.png" alt="5" width="12" height="12"></a>
      "scale":[
         0.003600036...,
         0.001736468...,
       ],
       "translate":[
          -180,
          -90
       ]
   }
}</pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_mapping_with_d3_CO2-1" href="#co_mapping_with_d3_CO2-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>TopoJSON objects have a Topology type and must contain an <code>objects</code> object and an array of <code>arcs</code>.</p></dd>
<dt><a class="co" id="callout_mapping_with_d3_CO2-2" href="#co_mapping_with_d3_CO2-2"><img src="2.png" alt="2" width="12" height="12"></a></dt>
<dd><p>In this case, the objects are <code>countries</code> and <code>land</code>, both being arc-defined GeometryCollections.</p></dd>
<dt><a class="co" id="callout_mapping_with_d3_CO2-3" href="#co_mapping_with_d3_CO2-3"><img src="3.png" alt="3" width="12" height="12"></a></dt>
<dd><p>Each geometry (in this case defining a country shape) is defined by a number of arc paths, comprising continuous arcs referenced by their index in the <code>arcs</code> array <img src="4.png" alt="4" width="12" height="12">.</p></dd>
<dt><a class="co" id="callout_mapping_with_d3_CO2-4" href="#co_mapping_with_d3_CO2-4"><img src="4.png" alt="4" width="12" height="12"></a></dt>
<dd><p>An array of component arcs used to construct the objects. The arcs are referenced by index.</p></dd>
<dt><a class="co" id="callout_mapping_with_d3_CO2-5" href="#co_mapping_with_d3_CO2-5"><img src="5.png" alt="5" width="12" height="12"></a></dt>
<dd><p>Numbers needed to quantize positions as integers rather than floats.</p></dd>
</dl></div>

<p>Given that you probably won’t be manipulating TopoJSON files directly but instead converting Shapefiles or GeoJSON files into them, and that D3 converts the arc-based shapes into SVG paths, the most important thing to know is how to create efficient TopoJSON files from existing GeoJSON and <a href="http://www.esri.com/">ESRI</a> shapefiles. Handily, D3 provides <code>topojson</code>, a command-line utility to do just this.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Converting Maps to TopoJSON"><div class="sect2" id="idm140319392699904">
<h2>Converting Maps to TopoJSON</h2>

<p>You can install TopoJSON via the node repositories (see <a data-type="xref" href="ch01.html#chapter_install">Chapter 1</a>), using the <code>-g</code> flag to make it a global install.</p>

<pre data-type="programlisting" data-code-language="bash"><code class="nv">$ </code>npm install -g topojson</pre>

<p>With <code>topojson</code> installed, converting an existing GeoJSON or Shapefile into TopoJSON is as easy as can be. Here we call <code>topojson</code> from the command line on a GeoJSON <em>geo_input.json</em> file, specifying an output file <em>topo_output.json</em>:</p>

<pre data-type="programlisting" data-code-language="bash"><code class="nv">$ </code>topojson -o topo_output.json geo_input.json</pre>

<p>Alternatively, you can pipe the result to a file:</p>

<pre data-type="programlisting" data-code-language="bash"><code class="nv">$ </code>topojson geo_input.json &gt; topo_output.json</pre>

<p><code>topojson</code> will also convert ESRI shapefiles:</p>

<pre data-type="programlisting" data-code-language="bash"><code class="nv">$ </code>topojson -o topo_output.json input.shp</pre>

<p><code>topojson</code> can also convert CSV files into TopoJSON, where each CSV row represents a point feature.</p>

<p><code>topojson</code> has a number of useful options, such as quantization, which allows you to specify your map’s precision. Playing around with this option can result in a much smaller file with little perceptible reduction in quality. Simplification is a similar option, allowing you to play with the balance of detail and file size. You can see the full spec on the <a href="https://github.com/mbostock/topojson/wiki/Command-Line-Reference">TopoJSON GitHub page</a>.</p>

<p>If you want to convert your map files programmatically, there <span class="keep-together">is a handy</span> Python library for the job, <em>topojson.py</em>. You can find it on <a href="https://github.com/calvinmetcalf/topojson.py">GitHub</a>.</p>

<p>Now that we’ve got our map data in a light, efficient, web-optimized format, let’s see how we use JavaScript to turn it into interactive web maps.<a data-type="indexterm" data-primary="" data-startref="D3mapdata18" id="idm140319392517824"></a><a data-type="indexterm" data-primary="" data-startref="topoj18" id="idm140319392516848"></a></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="D3 Geo, Projections, and Paths"><div class="sect1" id="idm140319392699344">
<h1>D3 Geo, Projections, and Paths</h1>

<p><a data-type="indexterm" data-primary="D3 library" data-secondary="map visualizations" data-tertiary="d3.geo library" id="D3mapgeo18"></a>D3 has a client-side <code>topojson</code> library, dedicated to dealing with <span class="keep-together">TopoJSON</span> data. This converts the optimized, arc-based TopoJSON to the coordinate-based GeoJSON, ready to be manipulated by D3’s <code>projection</code>s and <code>paths</code>, objects in the <code>d3.geo</code> library.</p>

<p><a data-type="xref" href="#d3maps_topojsoncode">Example 18-3</a> shows the process of extracting the GeoJSON features needed by our Nobel map from the TopoJSON <em>world-100m.json</em> map. This provides us with the coordinate-based polygons representing our countries and their borders.</p>

<p>In order to extract the GeoJSON features we require from the <span class="keep-together">TopoJSON</span> <code>world</code> object just delivered to the browser, we use <code>topojson</code>’s <code>feature</code> and <code>mesh</code> methods. <code>feature</code> returns the GeoJSON Feature or FeatureCollection for the specified object and <code>mesh</code> the GeoJSON MutliLineString geometry object representing the mesh for the specified object.</p>

<p><a data-type="indexterm" data-primary="feature method (TopoJSON)" id="idm140319392431728"></a><a data-type="indexterm" data-primary="mesh method (TopoJSON)" id="idm140319392430656"></a>The <code>feature</code> and <code>mesh</code> methods take as their first argument the <span class="keep-together">TopoJSON</span> object and as their second a reference to the feature we want to extract (<code>land</code> and <code>countries</code> in <a data-type="xref" href="#d3maps_topojsoncode">Example 18-3</a>). In our world map, <code>countries</code> is a FeatureCollection with a <code>features</code> array of countries (<a data-type="xref" href="#d3maps_topojsoncode">Example 18-3</a>, <img src="2.png" alt="2" width="12" height="12">).</p>

<p>The <code>mesh</code> method has a third argument, which specifies a filter function, taking as arguments the two geometry objects (<code>a</code> and <code>b</code>) sharing the mesh arc. If the arc is unshared, then <code>a</code> and <code>b</code> are the same, allowing us to filter out external borders in our world map (<a data-type="xref" href="#d3maps_topojsoncode">Example 18-3</a>, <img src="3.png" alt="3" width="12" height="12">).</p>
<div id="d3maps_topojsoncode" data-type="example">
<h5><span class="label">Example 18-3. </span>Extracting our TopoJSON features</h5>

<pre data-type="programlisting" data-code-language="js"><code>    </code><code class="nx">queue</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" id="co_mapping_with_d3_CO3-1" href="#callout_mapping_with_d3_CO3-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
        </code><code class="p">.</code><code class="nx">defer</code><code class="p">(</code><code class="nx">d3</code><code class="p">.</code><code class="nx">json</code><code class="p">,</code><code> </code><code class="s2">"data/world-110m.json"</code><code class="p">)</code><code> </code><code class="c1">// world map
</code><code>        </code><code class="c1">//...
</code><code>        </code><code class="p">.</code><code class="nx">await</code><code class="p">(</code><code class="nx">ready</code><code class="p">)</code><code class="p">;</code><code>
    </code><code class="c1">//...
</code><code>    </code><code class="kd">function</code><code> </code><code class="nx">ready</code><code class="p">(</code><code class="nx">error</code><code class="p">,</code><code> </code><code class="nx">worldMap</code><code class="p">...</code><code class="p">)</code><code class="p">{</code><code>
      </code><code class="c1">//...
</code><code>      </code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">initMap</code><code class="p">(</code><code class="nx">worldMap</code><code class="p">,</code><code> </code><code class="p">...</code><code>
    </code><code class="p">}</code><code>
    </code><code class="c1">//...
</code><code>    </code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">initMap</code><code> </code><code class="o">=</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">world</code><code class="p">,</code><code> </code><code class="p">...</code><code class="p">)</code><code class="p">{</code><code>

        </code><code class="kd">var</code><code> </code><code class="nx">land</code><code> </code><code class="o">=</code><code> </code><code class="nx">topojson</code><code class="p">.</code><code class="nx">feature</code><code class="p">(</code><code class="nx">world</code><code class="p">,</code><code> </code><code class="nx">world</code><code class="p">.</code><code class="nx">objects</code><code class="p">.</code><code class="nx">land</code><code class="p">)</code><code class="p">,</code><code>
            </code><code class="nx">countries</code><code> </code><code class="o">=</code><code> </code><code class="nx">topojson</code><code>
              </code><code class="p">.</code><code class="nx">feature</code><code class="p">(</code><code class="nx">world</code><code class="p">,</code><code> </code><code class="nx">world</code><code class="p">.</code><code class="nx">objects</code><code class="p">.</code><code class="nx">countries</code><code class="p">)</code><code>
              </code><code class="p">.</code><code class="nx">features</code><code class="p">,</code><code> </code><a class="co" id="co_mapping_with_d3_CO3-2" href="#callout_mapping_with_d3_CO3-2"><img src="2.png" alt="2" width="12" height="12"></a><code>
            </code><code class="nx">borders</code><code> </code><code class="o">=</code><code> </code><code class="nx">topojson</code><code class="p">.</code><code class="nx">mesh</code><code class="p">(</code><code>
              </code><code class="nx">world</code><code class="p">,</code><code> </code><code class="nx">world</code><code class="p">.</code><code class="nx">objects</code><code class="p">.</code><code class="nx">countries</code><code class="p">,</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">a</code><code class="p">,</code><code> </code><code class="nx">b</code><code class="p">)</code><code class="p">{</code><code>
                </code><code class="k">return</code><code> </code><code class="nx">a</code><code> </code><code class="o">!==</code><code> </code><code class="nx">b</code><code class="p">;</code><code> </code><a class="co" id="co_mapping_with_d3_CO3-3" href="#callout_mapping_with_d3_CO3-3"><img src="3.png" alt="3" width="12" height="12"></a><code>
              </code><code class="p">}</code><code class="p">)</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_mapping_with_d3_CO3-1" href="#co_mapping_with_d3_CO3-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>Uses D3’s queue to asynchronously load the map data in <span class="keep-together">TopoJSON</span> format.</p></dd>
<dt><a class="co" id="callout_mapping_with_d3_CO3-2" href="#co_mapping_with_d3_CO3-2"><img src="2.png" alt="2" width="12" height="12"></a></dt>
<dd><p>Uses <code>topojson</code> to extract our desired features from the <span class="keep-together">TopoJSON</span> data, delivering them in the GeoJSON format.</p></dd>
<dt><a class="co" id="callout_mapping_with_d3_CO3-3" href="#co_mapping_with_d3_CO3-3"><img src="3.png" alt="3" width="12" height="12"></a></dt>
<dd><p>Filters for only internal borders, shared between countries. If an arc is only used by one geometry (in this case, a country), then <code>a</code> and <code>b</code> are identical.</p></dd>
</dl></div>

<p>Map presentation in D3 generally follows a standard pattern. We first create a D3 <code>projection</code>, using one of D3’s many and varied alternatives. We then create a <code>path</code> using this <code>projection</code>. This <code>path</code> is then used to convert the features and meshes extracted from our TopoJSON object into the SVG paths displayed in the browser window.  Let’s now look at the rich subject of D3 <code>projection</code>s.</p>








<section data-type="sect2" data-pdf-bookmark="Projections"><div class="sect2" id="sect_projections">
<h2>Projections</h2>

<p><a data-type="indexterm" data-primary="projections (D3 library)" id="proj18"></a>Probably the chief challenge for maps, since the time it was appreciated that the Earth is spheroidal, is that of representing a three-dimensional globe, or significant parts of it, in a two-dimensional form. In 1569, the Flemish cartographer Gerardus Mercator famously resolved this by extending lines from the Earth’s center to significant boundary coordinates and then projecting them onto a surrounding cylinder. This had the useful property of representing lines of constant course, known as <em>rhumb lines</em>, as straight line segments, a very useful feature for the seafaring navigators intended to use the map. Unfortunately, the projection process distorts distances and size, magnifying the scale as one moves from the equator to the pole. As a result of this, the huge African continent appears not much bigger than Greenland when in reality it is around 14 times the size.</p>

<p>All projections are, like Mercator’s, a compromise, and what’s great about D3 is that the rich array of choices means one can balance these compromises to find the right projection for the job.<sup><a data-type="noteref" id="idm140319392181776-marker" href="ch18.html#idm140319392181776">6</a></sup> <a data-type="xref" href="#d3maps_projections">Figure 18-2</a> shows some alternative <code>projection</code>s for our Nobel map, including the equirectangular one chosen for the final visualization. The constraint was to show all Nobel Prize–winning countries within the rectangular window and to try to maximize the space available, particularly in Europe where there are many countries that are small geographically but have a relatively large prize haul.</p>

<figure><div id="d3maps_projections" class="figure">
<img src="dvpj_1802.png" alt="dvpj 1802" width="1125" height="701">
<h6><span class="label">Figure 18-2. </span>Some alternative mapping projections for the Nobel map</h6>
</div></figure>

<p>To create a D3 <code>projection</code>, just use one of the applicable <code>d3.geo</code> methods:</p>

<pre data-type="programlisting" data-code-language="js"><code class="kd">var</code> <code class="nx">projection</code> <code class="o">=</code> <code class="nx">d3</code><code class="p">.</code><code class="nx">geo</code><code class="p">.</code><code class="nx">equirectangular</code><code class="p">()</code>
<code class="p">...</code></pre>

<p>D3 <code>projection</code>s have a number of useful methods. It’s common to use the <code>translate</code> method to translate the map by half the width and height of the container, overriding the default of [480, 250]. You can also set the precision, which affects the degree of <em>adaptive resampling</em> used in the <code>projection</code>. Adaptive resampling is a clever technique to increase the accuracy of projected lines while still performing efficiently.<sup><a data-type="noteref" id="idm140319392164800-marker" href="ch18.html#idm140319392164800">7</a></sup> The scale of the map and its center’s longitude and latitude can be set by the <code>scale</code> and <code>center</code> methods.</p>

<p>Putting the <code>projection</code> methods together, the following code is that used by our Nobel-viz world equirectangular map. Note that it’s hand-tweaked to maximize the space given to Nobel Prize–winning countries. The two poles are truncated, there being no winners in either the Arctic or Antarctic (note that equirectangular maps assume a width/height ratio of 2):</p>

<pre data-type="programlisting" data-code-language="js"><code class="kd">var</code><code> </code><code class="nx">projection</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">geo</code><code class="p">.</code><code class="nx">equirectangular</code><code class="p">(</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">scale</code><code class="p">(</code><code class="mi">193</code><code> </code><code class="o">*</code><code> </code><code class="p">(</code><code class="nx">height</code><code class="o">/</code><code class="mi">480</code><code class="p">)</code><code class="p">)</code><code> </code><a class="co" id="co_mapping_with_d3_CO4-1" href="#callout_mapping_with_d3_CO4-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
    </code><code class="p">.</code><code class="nx">center</code><code class="p">(</code><code class="p">[</code><code class="mi">15</code><code class="p">,</code><code class="mi">15</code><code class="p">]</code><code class="p">)</code><code> </code><a class="co" id="co_mapping_with_d3_CO4-2" href="#callout_mapping_with_d3_CO4-2"><img src="2.png" alt="2" width="12" height="12"></a><code>
    </code><code class="p">.</code><code class="nx">translate</code><code class="p">(</code><code class="p">[</code><code class="nx">width</code><code> </code><code class="o">/</code><code> </code><code class="mi">2</code><code class="p">,</code><code> </code><code class="nx">height</code><code> </code><code class="o">/</code><code> </code><code class="mi">2</code><code class="p">]</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">precision</code><code class="p">(</code><code class="p">.</code><code class="mi">1</code><code class="p">)</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_mapping_with_d3_CO4-1" href="#co_mapping_with_d3_CO4-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>Enlarged slightly; the default height is 480 and scale 153.</p></dd>
<dt><a class="co" id="callout_mapping_with_d3_CO4-2" href="#co_mapping_with_d3_CO4-2"><img src="2.png" alt="2" width="12" height="12"></a></dt>
<dd><p>Centered at 15 degrees east, 15 degrees north.</p></dd>
</dl>

<p>With our equirectangular <code>projection</code> defined, let’s see how you use it to create a <code>path</code>, which will in turn be used to create the SVG maps.<a data-type="indexterm" data-primary="" data-startref="proj18" id="idm140319392136224"></a></p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Paths"><div class="sect2" id="idm140319392527616">
<h2>Paths</h2>

<p><a data-type="indexterm" data-primary="paths (D3 library)" id="path18"></a>Once you’ve settled on an appropriate <code>projection</code> for your map, you use it to create a D3 geographic <code>path</code> generator, which is a specialized variant of the SVG <code>path</code> generator (<code>d3.svg.path</code>). This <code>path</code> takes any GeoJSON feature or geometry object, such as a FeatureCollection, Polygon, or Point, and returns the SVG path data string for the <code>d</code> element. For example, with our map <code>borders</code> object, the geographic border coordinates describing a <code>MultiLineString</code> are converted into path coordinates for SVG.</p>

<p>Generally, we create our <code>path</code> and set its <code>projection</code> in one go:</p>

<pre data-type="programlisting" data-code-language="js"><code class="kd">var</code> <code class="nx">projection</code> <code class="o">=</code> <code class="nx">d3</code><code class="p">.</code><code class="nx">geo</code><code class="p">.</code><code class="nx">equirectangular</code><code class="p">()</code>
<code class="c1">// ...</code>

<code class="kd">var</code> <code class="nx">path</code> <code class="o">=</code> <code class="nx">d3</code><code class="p">.</code><code class="nx">geo</code><code class="p">.</code><code class="nx">path</code><code class="p">()</code>
             <code class="p">.</code><code class="nx">projection</code><code class="p">(</code><code class="nx">projection</code><code class="p">);</code></pre>

<p>Typically, we use the <code>path</code> as a function to generate the <code>d</code> attribute to an SVG path, using GeoJSON data bound using the <code>datum</code> method (used to bind a single object—not array—and shorthand for <code>data([objects])</code>). So to use the borders data we just extracted using <code>topojson.mesh</code> to draw our country borders, we use the <span class="keep-together">following</span>:</p>

<pre data-type="programlisting" data-code-language="js"><code class="c1">// BOUNDRY MARKS</code>
<code class="nx">svg</code><code class="p">.</code><code class="nx">insert</code><code class="p">(</code><code class="s2">"path"</code><code class="p">,</code> <code class="s2">".graticule"</code><code class="p">)</code> <code class="c1">// insert before the graticule</code>
    <code class="p">.</code><code class="nx">datum</code><code class="p">(</code><code class="nx">borders</code><code class="p">)</code>
    <code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"class"</code><code class="p">,</code> <code class="s2">"boundary"</code><code class="p">)</code>
    <code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"d"</code><code class="p">,</code> <code class="nx">path</code><code class="p">);</code></pre>

<p><a data-type="xref" href="#d3maps_paths">Figure 18-3</a> shows output from the Chrome Console for the <span class="keep-together">TopoJSON</span> <code>borders</code> object, extracted from our world-map data, and the resultant path generated by our D3.geo <code>path</code>, using the equirectangular <code>projection</code>.</p>

<figure><div id="d3maps_paths" class="figure">
<img src="dvpj_1803.png" alt="dvpj 1803" width="1565" height="770">
<h6><span class="label">Figure 18-3. </span>Path generator, from geometry to SVG path</h6>
</div></figure>

<p>The geo-path generator is the mainstay of D3 map presentations. I recommend playing around with different <code>projection</code>s with simple geometries to get a feel for things, investigating the astonishing number of examples found at <a href="http://bl.ocks.org/mbostock">bl.ocks.org</a> and the docs on
<a href="https://github.com/mbostock/d3/wiki/Geo-Projections">D3’s GitHub page</a>,
and checking out this <a href="http://bl.ocks.org/mbostock/3711652">great little demo</a>.</p>

<p>Now let’s look at one of the useful <code>d3.geo</code> components you’ll use in your maps, the <code>graticule</code> (or map grid).<a data-type="indexterm" data-primary="" data-startref="path18" id="idm140319391963248"></a></p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Graticules"><div class="sect2" id="idm140319392134656">
<h2>Graticules</h2>

<p><a data-type="indexterm" data-primary="graticules (D3 library)" id="idm140319391960832"></a>A useful component of <code>d3.geo</code> and one used in our Nobel map is the <code>graticule</code>, one of the geo shape generators.<sup><a data-type="noteref" id="idm140319391958960-marker" href="ch18.html#idm140319391958960">8</a></sup> This creates a global mesh of meridians (lines of longitude) and parallels (lines of latitude), spaced by default at 10 degrees. When our <code>path</code> is applied to this <code>graticule</code>, it generates a suitably projected grid, as shown back in <a data-type="xref" href="#d3maps_target">Figure 18-1</a>.</p>

<p><a data-type="xref" href="#d3maps_graticule">Example 18-4</a> shows how to add a <code>graticule</code> to your map. Note that if you want your grid to overlay your map paths, then its SVG path should come after the map paths in the DOM tree. As you’ll see, you can use D3’s <code>insert</code> method to enforce this order.</p>
<div id="d3maps_graticule" data-type="example">
<h5><span class="label">Example 18-4. </span>Creating a graticule</h5>

<pre data-type="programlisting" data-code-language="js"><code class="kd">var</code><code> </code><code class="nx">graticule</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">geo</code><code class="p">.</code><code class="nx">graticule</code><code class="p">(</code><code class="p">)</code><code>
                  </code><code class="p">.</code><code class="nx">step</code><code class="p">(</code><code class="p">[</code><code class="mi">20</code><code class="p">,</code><code> </code><code class="mi">20</code><code class="p">]</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" id="co_mapping_with_d3_CO5-1" href="#callout_mapping_with_d3_CO5-1"><img src="1.png" alt="1" width="12" height="12"></a><code>

</code><code class="nx">svg</code><code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s2">"path"</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">datum</code><code class="p">(</code><code class="nx">graticule</code><code class="p">)</code><code> </code><a class="co" id="co_mapping_with_d3_CO5-2" href="#callout_mapping_with_d3_CO5-2"><img src="2.png" alt="2" width="12" height="12"></a><code>
    </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"class"</code><code class="p">,</code><code> </code><code class="s2">"graticule"</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"d"</code><code class="p">,</code><code> </code><code class="nx">path</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" id="co_mapping_with_d3_CO5-3" href="#callout_mapping_with_d3_CO5-3"><img src="3.png" alt="3" width="12" height="12"></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_mapping_with_d3_CO5-1" href="#co_mapping_with_d3_CO5-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>Create <code>graticule</code>, overriding the default 10 degree steps.</p></dd>
<dt><a class="co" id="callout_mapping_with_d3_CO5-2" href="#co_mapping_with_d3_CO5-2"><img src="2.png" alt="2" width="12" height="12"></a></dt>
<dd><p>Note the <code>datum</code> shorthand for data(<code>[graticule]</code>).</p></dd>
<dt><a class="co" id="callout_mapping_with_d3_CO5-3" href="#co_mapping_with_d3_CO5-3"><img src="3.png" alt="3" width="12" height="12"></a></dt>
<dd><p>Use the <code>path</code> generator to receive the <code>graticule</code> data and return a grid path.</p></dd>
</dl></div>

<p>Now that we have our grid overlay and the ability to turn our map file into SVG paths with the required <code>projection</code>, let’s put the elements together.<a data-type="indexterm" data-primary="" data-startref="D3mapgeo18" id="idm140319391893216"></a></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Putting the Elements Together"><div class="sect1" id="idm140319392515312">
<h1>Putting the Elements Together</h1>

<p><a data-type="indexterm" data-primary="D3 library" data-secondary="map visualizations" data-tertiary="building maps" id="D3mapbuild18"></a>Using the <code>projection</code>, <code>path</code>, and <code>graticule</code> components discussed, we’ll now create the basic map. This map is intended to respond to user events, highlighting those countries represented by the selected winners, and reflecting the number of winners with a filled red circle at the countries’ centers. We’ll deal with this interactive update separately.</p>

<p><a data-type="xref" href="#d3maps_basic_map_code">Example 18-5</a> shows the code required to build a basic global map. It follows what should now be a familiar pattern, getting the <code>mapContainer</code> from its div container (id <code>nobel-map</code>), appending an <code>&lt;svg&gt;</code> tag to it, and then proceeding to add SVG elements, which in this case are D3-generated map paths.</p>

<p>Our map has fixed components (e.g., the choice of <code>projection</code> and <code>path</code>) that are not dependent on any data change and are defined outside the initializing <code>nbviz.initMap</code> method. <code>nbviz.initMap</code> is called when the visualization is initialized with data from the server. It receives the TopoJSON <code>world</code> object and uses it to build the basic map with the <code>path</code> object. <a data-type="xref" href="#d3maps_basic_map">Figure 18-4</a> shows the result.</p>
<div id="d3maps_basic_map_code" data-type="example">
<h5><span class="label">Example 18-5. </span>Building the map basics</h5>

<pre data-type="programlisting" data-code-language="js"><code class="c1">// DIMENSIONS AND SVG
</code><code class="kd">var</code><code> </code><code class="nx">mapContainer</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s1">'#nobel-map'</code><code class="p">)</code><code class="p">;</code><code>
</code><code class="kd">var</code><code> </code><code class="nx">boundingRect</code><code> </code><code class="o">=</code><code> </code><code class="nx">mapContainer</code><code class="p">.</code><code class="nx">node</code><code class="p">(</code><code class="p">)</code><code class="p">.</code><code class="nx">getBoundingClientRect</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code>
</code><code class="kd">var</code><code> </code><code class="nx">width</code><code> </code><code class="o">=</code><code> </code><code class="nx">boundingRect</code><code class="p">.</code><code class="nx">width</code><code>
    </code><code class="nx">height</code><code> </code><code class="o">=</code><code> </code><code class="nx">boundingRect</code><code class="p">.</code><code class="nx">height</code><code class="p">;</code><code>
</code><code class="kd">var</code><code> </code><code class="nx">svg</code><code> </code><code class="o">=</code><code> </code><code class="nx">mapContainer</code><code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s1">'svg'</code><code class="p">)</code><code class="p">;</code><code>
</code><code class="c1">// OUR CHOSEN PROJECTION
</code><code class="kd">var</code><code> </code><code class="nx">projection</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">geo</code><code class="p">.</code><code class="nx">equirectangular</code><code class="p">(</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">scale</code><code class="p">(</code><code class="mi">193</code><code> </code><code class="o">*</code><code> </code><code class="p">(</code><code class="nx">height</code><code class="o">/</code><code class="mi">480</code><code class="p">)</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">center</code><code class="p">(</code><code class="p">[</code><code class="mi">15</code><code class="p">,</code><code class="mi">15</code><code class="p">]</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">translate</code><code class="p">(</code><code class="p">[</code><code class="nx">width</code><code> </code><code class="o">/</code><code> </code><code class="mi">2</code><code class="p">,</code><code> </code><code class="nx">height</code><code> </code><code class="o">/</code><code> </code><code class="mi">2</code><code class="p">]</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">precision</code><code class="p">(</code><code class="p">.</code><code class="mi">1</code><code class="p">)</code><code class="p">;</code><code>
</code><code class="c1">// CREATE PATH WITH PROJECTION
</code><code class="kd">var</code><code> </code><code class="nx">path</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">geo</code><code class="p">.</code><code class="nx">path</code><code class="p">(</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">projection</code><code class="p">(</code><code class="nx">projection</code><code class="p">)</code><code class="p">;</code><code>
</code><code class="c1">// ADD GRATICULE
</code><code class="kd">var</code><code> </code><code class="nx">graticule</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">geo</code><code class="p">.</code><code class="nx">graticule</code><code class="p">(</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">step</code><code class="p">(</code><code class="p">[</code><code class="mi">20</code><code class="p">,</code><code> </code><code class="mi">20</code><code class="p">]</code><code class="p">)</code><code class="p">;</code><code>
</code><code class="nx">svg</code><code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s2">"path"</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">datum</code><code class="p">(</code><code class="nx">graticule</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"class"</code><code class="p">,</code><code> </code><code class="s2">"graticule"</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"d"</code><code class="p">,</code><code> </code><code class="nx">path</code><code class="p">)</code><code class="p">;</code><code>
</code><code class="c1">// A RADIUS SCALE FOR OUR CENTROID INDICATORS
</code><code class="kd">var</code><code> </code><code class="nx">radiusScale</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">scale</code><code class="p">.</code><code class="nx">sqrt</code><code class="p">(</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">range</code><code class="p">(</code><code class="p">[</code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">MIN_CENTROID_RADIUS</code><code class="p">,</code><code> </code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">MAX_CENTROID_RADIUS</code><code class="p">]</code><code class="p">)</code><code class="p">;</code><code>
</code><code class="c1">// OBJECT TO MAP COUNTRY NAME TO GEOJSON OBJECT
</code><code class="kd">var</code><code> </code><code class="nx">cnameToCountry</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code class="p">}</code><code class="p">;</code><code>
</code><code class="c1">// INITIAL MAP CREATION, USING DOWNLOADED MAP DATA
</code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">initMap</code><code> </code><code class="o">=</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">world</code><code class="p">,</code><code> </code><code class="nx">names</code><code class="p">)</code><code> </code><code class="p">{</code><code> </code><a class="co" id="co_mapping_with_d3_CO6-1" href="#callout_mapping_with_d3_CO6-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
    </code><code class="c1">// EXTRACT OUR REQUIRED FEATURES FROM THE TOPOJSON
</code><code>    </code><code class="kd">var</code><code> </code><code class="nx">land</code><code> </code><code class="o">=</code><code> </code><code class="nx">topojson</code><code class="p">.</code><code class="nx">feature</code><code class="p">(</code><code class="nx">world</code><code class="p">,</code><code> </code><code class="nx">world</code><code class="p">.</code><code class="nx">objects</code><code class="p">.</code><code class="nx">land</code><code class="p">)</code><code class="p">,</code><code>
        </code><code class="nx">countries</code><code> </code><code class="o">=</code><code> </code><code class="nx">topojson</code><code class="p">.</code><code class="nx">feature</code><code class="p">(</code><code class="nx">world</code><code class="p">,</code><code> </code><code class="nx">world</code><code class="p">.</code><code class="nx">objects</code><code class="p">.</code><code class="nx">countries</code><code class="p">)</code><code>
                      </code><code class="p">.</code><code class="nx">features</code><code class="p">,</code><code>
        </code><code class="nx">borders</code><code> </code><code class="o">=</code><code> </code><code class="nx">topojson</code><code class="p">.</code><code class="nx">mesh</code><code class="p">(</code><code class="nx">world</code><code class="p">,</code><code> </code><code class="nx">world</code><code class="p">.</code><code class="nx">objects</code><code class="p">.</code><code class="nx">countries</code><code class="p">,</code><code>
                    </code><code class="kd">function</code><code class="p">(</code><code class="nx">a</code><code class="p">,</code><code> </code><code class="nx">b</code><code class="p">)</code><code> </code><code class="p">{</code><code> </code><code class="k">return</code><code> </code><code class="nx">a</code><code> </code><code class="o">!==</code><code> </code><code class="nx">b</code><code class="p">;</code><code> </code><code class="p">}</code><code class="p">)</code><code class="p">;</code><code>
    </code><code class="c1">// MAIN WORLD MAP
</code><code>    </code><code class="nx">svg</code><code class="p">.</code><code class="nx">insert</code><code class="p">(</code><code class="s2">"path"</code><code class="p">,</code><code> </code><code class="s2">".graticule"</code><code class="p">)</code><code> </code><a class="co" id="co_mapping_with_d3_CO6-2" href="#callout_mapping_with_d3_CO6-2"><img src="2.png" alt="2" width="12" height="12"></a><code>
        </code><code class="p">.</code><code class="nx">datum</code><code class="p">(</code><code class="nx">land</code><code class="p">)</code><code>                 </code><a class="co" id="co_mapping_with_d3_CO6-3" href="#callout_mapping_with_d3_CO6-3"><img src="3.png" alt="3" width="12" height="12"></a><code>
        </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"class"</code><code class="p">,</code><code> </code><code class="s2">"land"</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"d"</code><code class="p">,</code><code> </code><code class="nx">path</code><code class="p">)</code><code>
    </code><code class="p">;</code><code>
    </code><code class="c1">// COUNTRY PATHS
</code><code>    </code><code class="nx">svg</code><code class="p">.</code><code class="nx">insert</code><code class="p">(</code><code class="s2">"g"</code><code class="p">,</code><code> </code><code class="s2">".graticule"</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"class"</code><code class="p">,</code><code> </code><code class="s1">'countries'</code><code class="p">)</code><code class="p">;</code><code>
    </code><code class="c1">// COUNTRIES VALUE-INDICATORS
</code><code>    </code><code class="nx">svg</code><code class="p">.</code><code class="nx">insert</code><code class="p">(</code><code class="s2">"g"</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"class"</code><code class="p">,</code><code> </code><code class="s2">"centroids"</code><code class="p">)</code><code class="p">;</code><code>
    </code><code class="c1">// BOUNDARY LINES
</code><code>    </code><code class="nx">svg</code><code class="p">.</code><code class="nx">insert</code><code class="p">(</code><code class="s2">"path"</code><code class="p">,</code><code> </code><code class="s2">".graticule"</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">datum</code><code class="p">(</code><code class="nx">borders</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"class"</code><code class="p">,</code><code> </code><code class="s2">"boundary"</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"d"</code><code class="p">,</code><code> </code><code class="nx">path</code><code class="p">)</code><code class="p">;</code><code>

    </code><code class="c1">// CREATE OBJECT MAPPING COUNTRY NAMES TO GEOJSON SHAPES
</code><code>    </code><code class="kd">var</code><code> </code><code class="nx">idToCountry</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code class="p">}</code><code class="p">;</code><code>
    </code><code class="nx">countries</code><code class="p">.</code><code class="nx">forEach</code><code class="p">(</code><code class="kd">function</code><code class="p">(</code><code class="nx">c</code><code class="p">)</code><code> </code><code class="p">{</code><code>
        </code><code class="nx">idToCountry</code><code class="p">[</code><code class="nx">c</code><code class="p">.</code><code class="nx">id</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="nx">c</code><code class="p">;</code><code>
    </code><code class="p">}</code><code class="p">)</code><code class="p">;</code><code>

    </code><code class="nx">names</code><code class="p">.</code><code class="nx">forEach</code><code class="p">(</code><code class="kd">function</code><code class="p">(</code><code class="nx">n</code><code class="p">)</code><code> </code><code class="p">{</code><code>
        </code><code class="nx">cnameToCountry</code><code class="p">[</code><code class="nx">n</code><code class="p">.</code><code class="nx">name</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="nx">idToCountry</code><code class="p">[</code><code class="nx">n</code><code class="p">.</code><code class="nx">id</code><code class="p">]</code><code class="p">;</code><code> </code><a class="co" id="co_mapping_with_d3_CO6-4" href="#callout_mapping_with_d3_CO6-4"><img src="4.png" alt="4" width="12" height="12"></a><code>
    </code><code class="p">}</code><code class="p">)</code><code class="p">;</code><code>

</code><code class="p">}</code><code class="p">;</code><code>
</code><code class="c1">// ...
</code><code class="c1">// DRAW MAP ON DATA LOAD
</code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">drawMap</code><code class="p">(</code><code class="nx">world</code><code class="p">,</code><code> </code><code class="nx">names</code><code class="p">,</code><code> </code><code class="nx">countryData</code><code class="p">)</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_mapping_with_d3_CO6-1" href="#co_mapping_with_d3_CO6-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p><code>world</code> TopoJSON object with the country features with a <code>names</code> array connecting country names to country feature ids (e.g., <code>{id:36, name: <em>Australia</em>}</code>).</p></dd>
<dt><a class="co" id="callout_mapping_with_d3_CO6-2" href="#co_mapping_with_d3_CO6-2"><img src="2.png" alt="2" width="12" height="12"></a></dt>
<dd><p>Note that we insert this <code>path</code> before the <code>graticule</code> grid, keeping the grid overlay on top.</p></dd>
<dt><a class="co" id="callout_mapping_with_d3_CO6-3" href="#co_mapping_with_d3_CO6-3"><img src="3.png" alt="3" width="12" height="12"></a></dt>
<dd><p>Uses <code>datum</code> to assign the whole <code>land</code> object to our <code>path</code>.</p></dd>
<dt><a class="co" id="callout_mapping_with_d3_CO6-4" href="#co_mapping_with_d3_CO6-4"><img src="4.png" alt="4" width="12" height="12"></a></dt>
<dd><p>Object that, if given country-name key, returns its respective GeoJSON geometry.</p></dd>
</dl></div>

<figure><div id="d3maps_basic_map" class="figure">
<img src="dvpj_1804.png" alt="dvpj 1804" width="702" height="350">
<h6><span class="label">Figure 18-4. </span>The basic map</h6>
</div></figure>

<p>With our map shapes in place, we can use a little CSS to style <a data-type="xref" href="#d3maps_basic_map">Figure 18-4</a>, adding a light azure for the oceans and light gray for the land. The <code>graticule</code> is a half-transparent dark gray and the country boundaries white:</p>

<pre data-type="programlisting" data-code-language="css"><code class="c">/* NOBEL-MAP STYLES */</code>
<code class="nf">#nobel-map</code> <code class="p">{</code>
    <code class="k">background</code><code class="o">:</code> <code class="nb">azure</code><code class="p">;</code>
<code class="p">}</code>

<code class="nc">.graticule</code> <code class="p">{</code>
    <code class="k">fill</code><code class="o">:</code> <code class="nb">none</code><code class="p">;</code>
    <code class="k">stroke</code><code class="o">:</code> <code class="m">#777</code><code class="p">;</code>
    <code class="k">stroke-width</code><code class="o">:</code> <code class="m">.5px</code><code class="p">;</code>
    <code class="n">stroke</code><code class="o">-</code><code class="k">opacity</code><code class="o">:</code> <code class="o">.</code><code class="m">5</code><code class="p">;</code>
<code class="p">}</code>

<code class="nc">.land</code> <code class="p">{</code>
    <code class="k">fill</code><code class="o">:</code> <code class="m">#ddd</code><code class="p">;</code>
<code class="p">}</code>

<code class="nc">.boundary</code> <code class="p">{</code>
    <code class="k">fill</code><code class="o">:</code> <code class="nb">none</code><code class="p">;</code>
    <code class="k">stroke</code><code class="o">:</code> <code class="m">#fff</code><code class="p">;</code>
    <code class="k">stroke-width</code><code class="o">:</code> <code class="m">.5px</code><code class="p">;</code>
<code class="p">}</code></pre>

<p>With the SVG map assembled, let’s see how we use the winners dataset to draw the Nobel Prize–winning countries and the red indicator for number of wins.<a data-type="indexterm" data-primary="" data-startref="D3mapbuild18" id="idm140319391292720"></a></p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Updating the Map"><div class="sect1" id="idm140319391084688">
<h1>Updating the Map</h1>

<p><a data-type="indexterm" data-primary="D3 library" data-secondary="map visualizations" data-tertiary="updating maps" id="D3mapup18"></a>The first time our Nobel map gets updated is when the visualization is initialized. At this point the selected dataset is unfiltered, containing all the Nobel Prize winners. Subsequently, in response to filters applied by the user (e.g., all the Chemistry winners or those from France), the dataset will change and our map changes to reflect that.</p>

<p>So updating the map involves sending it a dataset of the Nobel Prize–winning countries with their current prize haul, dependent on the user filters applied.  To do this, we use an <code>updateMap</code> method:</p>

<pre data-type="programlisting" data-code-language="js"><code class="nx">nbviz</code><code class="p">.</code><code class="nx">updateMap</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(</code><code class="nx">countryData</code><code class="p">)</code> <code class="p">{</code> <code class="c1">//...</code></pre>

<p>The <code>countryData</code> array has this form:</p>

<pre data-type="programlisting" data-code-language="js"><code class="p">[</code><code>
  </code><code class="p">{</code><code>
   </code><code class="nx">code</code><code class="o">:</code><code> </code><code class="s2">"USA"</code><code class="p">,</code><code>
   </code><code class="nx">key</code><code class="o">:</code><code> </code><code class="s2">"United States"</code><code class="p">,</code><code>
   </code><code class="nx">population</code><code class="o">:</code><code> </code><code class="mi">319259000</code><code class="p">,</code><code>
   </code><code class="nx">value</code><code class="o">:</code><code> </code><code class="mi">336</code><code> </code><a class="co" id="co_mapping_with_d3_CO7-1" href="#callout_mapping_with_d3_CO7-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
  </code><code class="p">}</code><code class="p">,</code><code>
  </code><code class="c1">// ... 56 more countries
</code><code class="p">]</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_mapping_with_d3_CO7-1" href="#co_mapping_with_d3_CO7-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>The number of winners for the US in the currently selected dataset.</p></dd>
</dl>

<p>We want to convert this array before sending it to our D3 map.  The following code does this job, providing an array of country objects with properties <code>geo</code> (the country’s GeoJSON geometry), <code>name</code> (the country name), and <code>number</code> (the country’s number of Nobel Prize <span class="keep-together">winners</span>).</p>

<pre data-type="programlisting" data-code-language="js"><code class="kd">var</code><code> </code><code class="nx">mapData</code><code> </code><code class="o">=</code><code> </code><code class="nx">countryData</code><code>
    </code><code class="p">.</code><code class="nx">filter</code><code class="p">(</code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code> </code><code class="p">{</code><code>
        </code><code class="k">return</code><code> </code><code class="nx">d</code><code class="p">.</code><code class="nx">value</code><code> </code><code class="o">&gt;</code><code> </code><code class="mi">0</code><code class="p">;</code><code> </code><a class="co" id="co_mapping_with_d3_CO8-1" href="#callout_mapping_with_d3_CO8-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
    </code><code class="p">}</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">map</code><code class="p">(</code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code> </code><code class="p">{</code><code>
    </code><code class="k">return</code><code> </code><code class="p">{</code><code>
        </code><code class="nx">geo</code><code class="o">:</code><code> </code><code class="nx">cnameToCountry</code><code class="p">[</code><code class="nx">d</code><code class="p">.</code><code class="nx">key</code><code class="p">]</code><code class="p">,</code><code> </code><a class="co" id="co_mapping_with_d3_CO8-2" href="#callout_mapping_with_d3_CO8-2"><img src="2.png" alt="2" width="12" height="12"></a><code>
        </code><code class="nx">name</code><code class="o">:</code><code> </code><code class="nx">d</code><code class="p">.</code><code class="nx">key</code><code class="p">,</code><code>
        </code><code class="nx">number</code><code class="o">:</code><code> </code><code class="nx">d</code><code class="p">.</code><code class="nx">value</code><code>
    </code><code class="p">}</code><code class="p">;</code><code>
</code><code class="p">}</code><code class="p">)</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_mapping_with_d3_CO8-1" href="#co_mapping_with_d3_CO8-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>Filters out countries with no winners—we only display winning countries on the map.</p></dd>
<dt><a class="co" id="callout_mapping_with_d3_CO8-2" href="#co_mapping_with_d3_CO8-2"><img src="2.png" alt="2" width="12" height="12"></a></dt>
<dd><p>Uses the country’s key (its name in this case) to retrieve its GeoJSON feature.</p></dd>
</dl>

<p>We want to display a red circular indicator at the center of our winning countries, indicating the number of prizes won. The circles’ areas should be proportional to the number of prizes won (absolute or per capita), which means (by circle area = pi × radius-squared) their radius should be a function of the square root of that prize number. D3 provides a handy <code>sqrt</code> scale for just such a need, allowing you to set a domain (min and max prize number in this case) and a range (min and max indicator radius).</p>

<p>Let’s see a quick example of the <code>sqrt</code> scale in action. In the following, we set a scale with a domain between 0 and 100 and a zero-based range with a maximum area of 25 (5 × 5). This means calling the scale with 50 (half the range) should give the square root of half the maximum area (12.5):</p>

<pre data-type="programlisting" data-code-language="js"><code class="kd">var</code> <code class="nx">sc</code> <code class="o">=</code> <code class="nx">d3</code><code class="p">.</code><code class="nx">scale</code><code class="p">.</code><code class="nx">sqrt</code><code class="p">().</code><code class="nx">domain</code><code class="p">([</code><code class="mi">0</code><code class="p">,</code> <code class="mi">100</code><code class="p">]).</code><code class="nx">range</code><code class="p">([</code><code class="mi">0</code><code class="p">,</code> <code class="mi">5</code><code class="p">]);</code>
<code class="nx">sc</code><code class="p">(</code><code class="mi">50</code><code class="p">)</code> <code class="c1">// returns 3.5353..., the square root of 12.5</code></pre>

<p>To create our indicator radius scale, we create a <code>sqrt</code> scale using  the maximum and minimum radii specified in <em>nbviz_core.js</em> to set its range:</p>

<pre data-type="programlisting" data-code-language="js"><code class="kd">var</code> <code class="nx">radiusScale</code> <code class="o">=</code> <code class="nx">d3</code><code class="p">.</code><code class="nx">scale</code><code class="p">.</code><code class="nx">sqrt</code><code class="p">()</code>
    <code class="p">.</code><code class="nx">range</code><code class="p">([</code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">MIN_CENTROID_RADIUS</code><code class="p">,</code>
    <code class="nx">nbviz</code><code class="p">.</code><code class="nx">MAX_CENTROID_RADIUS</code><code class="p">]);</code></pre>

<p>In order to get the domain to our scales, we use this <code>mapData</code> to get the maximum number of winners per country and use that value as the domain’s upper value, with <code>0</code> for its lower:</p>

<pre data-type="programlisting" data-code-language="js"><code class="kd">var</code> <code class="nx">maxWinners</code> <code class="o">=</code> <code class="nx">d3</code><code class="p">.</code><code class="nx">max</code><code class="p">(</code><code class="nx">mapData</code><code class="p">.</code><code class="nx">map</code><code class="p">(</code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">return</code> <code class="nx">d</code><code class="p">.</code><code class="nx">number</code><code class="p">;</code>
<code class="p">}));</code>
<code class="c1">// DOMAIN OF VALUE-INDINCATOR SCALE</code>
<code class="nx">radiusScale</code><code class="p">.</code><code class="nx">domain</code><code class="p">([</code><code class="mi">0</code><code class="p">,</code> <code class="nx">maxWinners</code><code class="p">]);</code></pre>

<p>To add our country shapes to the existing map, we bind <code>mapData</code> to a selection on the <code>countries</code> group of class <code>country</code> and implement an update pattern (see <a data-type="xref" href="ch16.html#d3bar_update">“The Update Pattern”</a>) to first add any country shapes required by the <code>mapData</code>. Instead of removing unbound country paths, we use the CSS <code>opacity</code> property to make the bound countries visible and the unbound invisible. A two-second transition is used to make these countries fade in and out appropriately. <a data-type="xref" href="#d3maps_update_countries_code">Example 18-6</a> shows the update pattern.</p>
<div id="d3maps_update_countries_code" data-type="example">
<h5><span class="label">Example 18-6. </span>Updating the country shapes</h5>

<pre data-type="programlisting" data-code-language="js"><code class="nx">nbviz</code><code class="p">.</code><code class="nx">updateMap</code><code> </code><code class="o">=</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">countryData</code><code class="p">)</code><code> </code><code class="p">{</code><code>
</code><code class="c1">//  mapData = filtered countryData
</code><code class="c1">//  ...
</code><code>    </code><code class="c1">// BIND MAP DATA TO THE COUNTRY PATHS USING THE NAME KEY
</code><code>    </code><code class="kd">var</code><code> </code><code class="nx">countries</code><code> </code><code class="o">=</code><code> </code><code class="nx">svg</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s1">'.countries'</code><code class="p">)</code><code class="p">.</code><code class="nx">selectAll</code><code class="p">(</code><code class="s1">'.country'</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">data</code><code class="p">(</code><code class="nx">mapData</code><code class="p">,</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code> </code><code class="p">{</code><code>
            </code><code class="k">return</code><code> </code><code class="nx">d</code><code class="p">.</code><code class="nx">name</code><code class="p">;</code><code>
        </code><code class="p">}</code><code class="p">)</code><code class="p">;</code><code>
    </code><code class="c1">// ENTER AND APPEND ANY NEW COUNTRIES
</code><code>    </code><code class="nx">countries</code><code class="p">.</code><code class="nx">enter</code><code class="p">(</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s1">'path'</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s1">'class'</code><code class="p">,</code><code> </code><code class="s1">'country'</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">on</code><code class="p">(</code><code class="s1">'mouseenter'</code><code class="p">,</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code> </code><code class="p">{</code><code> </code><a class="co" id="co_mapping_with_d3_CO9-1" href="#callout_mapping_with_d3_CO9-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
            </code><code class="c1">// console.log('Entered ' + d.name);
</code><code>            </code><code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="k">this</code><code class="p">)</code><code class="p">.</code><code class="nx">classed</code><code class="p">(</code><code class="s1">'active'</code><code class="p">,</code><code> </code><code class="kc">true</code><code class="p">)</code><code class="p">;</code><code>
        </code><code class="p">}</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">on</code><code class="p">(</code><code class="s1">'mouseout'</code><code class="p">,</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code> </code><code class="p">{</code><code>
            </code><code class="c1">// console.log('Left ' + d.name);
</code><code>            </code><code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="k">this</code><code class="p">)</code><code class="p">.</code><code class="nx">classed</code><code class="p">(</code><code class="s1">'active'</code><code class="p">,</code><code> </code><code class="kc">false</code><code class="p">)</code><code class="p">;</code><code>
        </code><code class="p">}</code><code class="p">)</code><code>
    </code><code class="p">;</code><code>
    </code><code class="c1">// UPDATE ALL BOUND COUNTRIES
</code><code>    </code><code class="nx">countries</code><code>
        </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s1">'name'</code><code class="p">,</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code> </code><code class="p">{</code><code>
            </code><code class="k">return</code><code> </code><code class="nx">d</code><code class="p">.</code><code class="nx">name</code><code class="p">;</code><code>
        </code><code class="p">}</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">classed</code><code class="p">(</code><code class="s1">'visible'</code><code class="p">,</code><code> </code><code class="kc">true</code><code class="p">)</code><code> </code><a class="co" id="co_mapping_with_d3_CO9-2" href="#callout_mapping_with_d3_CO9-2"><img src="2.png" alt="2" width="12" height="12"></a><code>
        </code><code class="p">.</code><code class="nx">transition</code><code class="p">(</code><code class="p">)</code><code class="p">.</code><code class="nx">duration</code><code class="p">(</code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">TRANS_DURATION</code><code class="p">)</code><code> </code><a class="co" id="co_mapping_with_d3_CO9-3" href="#callout_mapping_with_d3_CO9-3"><img src="3.png" alt="3" width="12" height="12"></a><code>
        </code><code class="p">.</code><code class="nx">style</code><code class="p">(</code><code class="s1">'opacity'</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s1">'d'</code><code class="p">,</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code> </code><code class="p">{</code><code>
            </code><code class="k">return</code><code> </code><code class="nx">path</code><code class="p">(</code><code class="nx">d</code><code class="p">.</code><code class="nx">geo</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" id="co_mapping_with_d3_CO9-4" href="#callout_mapping_with_d3_CO9-4"><img src="4.png" alt="4" width="12" height="12"></a><code>
        </code><code class="p">}</code><code class="p">)</code><code class="p">;</code><code>
    </code><code class="c1">// REMOVE ANY UNBOUND COUNTRIES
</code><code>    </code><code class="nx">countries</code><code class="p">.</code><code class="nx">exit</code><code class="p">(</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">classed</code><code class="p">(</code><code class="s1">'visible'</code><code class="p">,</code><code> </code><code class="kc">false</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">transition</code><code class="p">(</code><code class="p">)</code><code class="p">.</code><code class="nx">duration</code><code class="p">(</code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">TRANS_DURATION</code><code class="p">)</code><code> </code><a class="co" id="co_mapping_with_d3_CO9-5" href="#callout_mapping_with_d3_CO9-5"><img src="5.png" alt="5" width="12" height="12"></a><code>
        </code><code class="p">.</code><code class="nx">style</code><code class="p">(</code><code class="s1">'opacity'</code><code class="p">,</code><code> </code><code class="mi">0</code><code class="p">)</code><code class="p">;</code><code>
    </code><code class="c1">//...
</code><code class="p">}</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_mapping_with_d3_CO9-1" href="#co_mapping_with_d3_CO9-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>Classes a country as <code>active</code> as the mouse cursor enters it, and as <code>inactive</code> as it leaves.</p></dd>
<dt><a class="co" id="callout_mapping_with_d3_CO9-2" href="#co_mapping_with_d3_CO9-2"><img src="2.png" alt="2" width="12" height="12"></a></dt>
<dd><p>We keep track of the visible and invisible (<code>opacity</code> of <code>0</code>) countries by using a <code>visible</code> class. We’ll use this in <a data-type="xref" href="#sect_tooltip">“Building a Simple Tooltip”</a> to decide whether to show a mouse tooltip over a country.</p></dd>
<dt><a class="co" id="callout_mapping_with_d3_CO9-3" href="#co_mapping_with_d3_CO9-3"><img src="3.png" alt="3" width="12" height="12"></a></dt>
<dd><p>Fades in any newly data-bound countries over two seconds by increasing their <code>opacity</code> to <code>1</code>.</p></dd>
<dt><a class="co" id="callout_mapping_with_d3_CO9-4" href="#co_mapping_with_d3_CO9-4"><img src="4.png" alt="4" width="12" height="12"></a></dt>
<dd><p>Builds the country’s <code>path</code> using its <code>geo</code> GeoJSON feature.</p></dd>
<dt><a class="co" id="callout_mapping_with_d3_CO9-5" href="#co_mapping_with_d3_CO9-5"><img src="5.png" alt="5" width="12" height="12"></a></dt>
<dd><p>Fades out any data-unbound countries by setting their <code>opacity</code> to <code>0</code> over two seconds—<code>nbviz.TRANS_DATA-UNBOUND</code> is <code>2000</code> (ms).</p></dd>
</dl></div>

<p>Note that we add a CSS <code>country</code> class to countries in <code>mapData</code>, setting their color to a light khaki green. In addition to this the mouse events are used to class the country <code>active</code> if the cursor is over it, highlighting it with a darker green. Here are the CSS classes:</p>

<pre data-type="programlisting" data-code-language="css"><code class="nc">.country</code><code class="p">{</code>
    <code class="k">fill</code><code class="o">:</code> <code class="nb">rgb</code><code class="p">(</code><code class="m">175</code><code class="o">,</code> <code class="m">195</code><code class="o">,</code> <code class="m">186</code><code class="p">);</code> <code class="c">/* light green */</code>
<code class="p">}</code>

<code class="nc">.country.active</code><code class="p">{</code>
    <code class="k">fill</code><code class="o">:</code> <code class="nb">rgb</code><code class="p">(</code><code class="m">155</code><code class="o">,</code> <code class="m">175</code><code class="o">,</code> <code class="m">166</code><code class="p">);</code> <code class="c">/* dark green */</code>
<code class="p">}</code></pre>

<p>The update pattern shown in <a data-type="xref" href="#d3maps_update_countries_code">Example 18-6</a> will smoothly transition from old to new datasets, produced in response to user-applied filters and passed to <code>updateMap</code>. All we need now is to add similarly responsive filled circular indicators, centered on the active countries and reflecting their current value, either an absolute or relative (per capita) measure of their Nobel Prize haul.<a data-type="indexterm" data-primary="" data-startref="D3mapup18" id="idm140319390994256"></a></p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Adding Value Indicators"><div class="sect1" id="idm140319391083872">
<h1>Adding Value Indicators</h1>

<p><a data-type="indexterm" data-primary="D3 library" data-secondary="map visualizations" data-tertiary="adding value indicators" id="D3mapvalue17"></a>To add our circular value indicators, we want an update pattern that mirrors that used to create our country SVG paths. We want to bind to the <code>mapData</code> dataset and append, update, and remove our indicator circles accordingly. As with the country shapes, we’ll adjust the indicators’ opacity to add and remove them from the map.</p>

<p>The indicators need to be placed at the center of their respective countries. D3’s <code>path</code> generator  provides a number of useful utility methods for dealing with GeoJSON geometries. One of them is centroid, which computes the projected centroid for the specified feature:</p>

<pre data-type="programlisting" data-code-language="js"><code class="c1">// Given the GeoJSON of country (country.geo)</code>
<code class="c1">// calculate x, y coords of center</code>
<code class="kd">var</code> <code class="nx">center</code> <code class="o">=</code> <code class="nx">path</code><code class="p">.</code><code class="nx">centroid</code><code class="p">(</code><code class="nx">country</code><code class="p">.</code><code class="nx">geo</code><code class="p">);</code>
<code class="c1">// center = [x, y]</code></pre>

<p>While <code>path.centroid</code> does a pretty good job as a rule, and is very useful for labeling shape, boundaries, and so on, it can produce strange results, particularly with highly concave geometries.  Handily, the world country data we stored in <a data-type="xref" href="ch05.html#country_data">“Getting Country Data for the Nobel Dataviz”</a> contains the central coordinates of all our Nobel Prize countries.</p>

<p>We’ll first write a little method to retrieve those given a <code>mapData</code> object:</p>

<pre data-type="programlisting" data-code-language="js"><code class="kd">var</code><code> </code><code class="nx">getCentroid</code><code> </code><code class="o">=</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code> </code><code class="p">{</code><code>
    </code><code class="kd">var</code><code> </code><code class="nx">latlng</code><code> </code><code class="o">=</code><code> </code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">data</code><code class="p">.</code><code class="nx">nationalData</code><code class="p">[</code><code class="nx">d</code><code class="p">.</code><code class="nx">name</code><code class="p">]</code><code class="p">.</code><code class="nx">latlng</code><code class="p">;</code><code> </code><a class="co" id="co_mapping_with_d3_CO10-1" href="#callout_mapping_with_d3_CO10-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
    </code><code class="k">return</code><code> </code><code class="nx">projection</code><code class="p">(</code><code class="p">[</code><code class="nx">latlng</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="p">,</code><code> </code><code class="nx">latlng</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="p">]</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" id="co_mapping_with_d3_CO10-2" href="#callout_mapping_with_d3_CO10-2"><img src="2.png" alt="2" width="12" height="12"></a><code>
</code><code class="p">}</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_mapping_with_d3_CO10-1" href="#co_mapping_with_d3_CO10-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>Get the latitude and longitude of our country’s center by name, using the stored world country data.</p></dd>
<dt><a class="co" id="callout_mapping_with_d3_CO10-2" href="#co_mapping_with_d3_CO10-2"><img src="2.png" alt="2" width="12" height="12"></a></dt>
<dd><p>Use our equirectangular <code>projection</code> to turn these into SVG coordinates.</p></dd>
</dl>

<p>As shown in <a data-type="xref" href="#d3maps_centroid_code">Example 18-7</a>, we bind our <code>mapData</code> to the selection of all elements of class <code>centroid</code> in the <code>centroids</code> group we added in <a data-type="xref" href="#d3maps_basic_map_code">Example 18-5</a>. The data is bound via the <code>name</code> key.</p>
<div id="d3maps_centroid_code" data-type="example">
<h5><span class="label">Example 18-7. </span>Adding prize-haul indicators to the Nobel countries’ centroids</h5>

<pre data-type="programlisting" data-code-language="js"><code class="nx">nbviz</code><code class="p">.</code><code class="nx">updateMap</code><code> </code><code class="o">=</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">countryData</code><code class="p">)</code><code> </code><code class="p">{</code><code>
</code><code class="c1">//...
</code><code>    </code><code class="c1">// BIND MAP DATA WITH NAME KEY
</code><code>    </code><code class="kd">var</code><code> </code><code class="nx">centroids</code><code> </code><code class="o">=</code><code> </code><code class="nx">svg</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s1">'.centroids'</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">selectAll</code><code class="p">(</code><code class="s2">".centroid"</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">data</code><code class="p">(</code><code class="nx">mapData</code><code class="p">,</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code> </code><code class="p">{</code><code>
            </code><code class="k">return</code><code> </code><code class="nx">d</code><code class="p">.</code><code class="nx">name</code><code class="p">;</code><code> </code><a class="co" id="co_mapping_with_d3_CO11-1" href="#callout_mapping_with_d3_CO11-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
        </code><code class="p">}</code><code class="p">)</code><code class="p">;</code><code>
    </code><code class="c1">// ENTER TO APPEND INDICATORS
</code><code>    </code><code class="nx">centroids</code><code class="p">.</code><code class="nx">enter</code><code class="p">(</code><code class="p">)</code><code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s1">'circle'</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"class"</code><code class="p">,</code><code> </code><code class="s2">"centroid"</code><code class="p">)</code><code class="p">;</code><code>
    </code><code class="c1">// UPDATE RADIUS AND OPACITY OF INDICATORS
</code><code>    </code><code class="nx">centroids</code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"name"</code><code class="p">,</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code> </code><code class="p">{</code><code>
        </code><code class="k">return</code><code> </code><code class="nx">d</code><code class="p">.</code><code class="nx">name</code><code class="p">;</code><code>
    </code><code class="p">}</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"cx"</code><code class="p">,</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code> </code><code class="p">{</code><code>
            </code><code class="k">return</code><code> </code><code class="nx">getCentroid</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="p">;</code><code> </code><a class="co" id="co_mapping_with_d3_CO11-2" href="#callout_mapping_with_d3_CO11-2"><img src="2.png" alt="2" width="12" height="12"></a><code>
        </code><code class="p">}</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"cy"</code><code class="p">,</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code> </code><code class="p">{</code><code>
            </code><code class="k">return</code><code> </code><code class="nx">getCentroid</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="p">;</code><code>
        </code><code class="p">}</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">classed</code><code class="p">(</code><code class="s1">'active'</code><code class="p">,</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code> </code><code class="p">{</code><code>
            </code><code class="k">return</code><code> </code><code class="nx">d</code><code class="p">.</code><code class="nx">name</code><code> </code><code class="o">===</code><code> </code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">activeCountry</code><code class="p">;</code><code> </code><a class="co" id="co_mapping_with_d3_CO11-3" href="#callout_mapping_with_d3_CO11-3"><img src="3.png" alt="3" width="12" height="12"></a><code>
        </code><code class="p">}</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">transition</code><code class="p">(</code><code class="p">)</code><code class="p">.</code><code class="nx">duration</code><code class="p">(</code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">MAP_DURATION</code><code class="p">)</code><code> </code><a class="co" id="co_mapping_with_d3_CO11-4" href="#callout_mapping_with_d3_CO11-4"><img src="4.png" alt="4" width="12" height="12"></a><code>
        </code><code class="p">.</code><code class="nx">style</code><code class="p">(</code><code class="s1">'opacity'</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"r"</code><code class="p">,</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code> </code><code class="p">{</code><code>
            </code><code class="k">return</code><code> </code><code class="nx">radiusScale</code><code class="p">(</code><code class="o">+</code><code class="nx">d</code><code class="p">.</code><code class="nx">number</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" id="co_mapping_with_d3_CO11-5" href="#callout_mapping_with_d3_CO11-5"><img src="5.png" alt="5" width="12" height="12"></a><code>
        </code><code class="p">}</code><code class="p">)</code><code class="p">;</code><code>
    </code><code class="c1">// MAKE UNBOUND INDICATORS INVISIBLE
</code><code>    </code><code class="nx">centroids</code><code class="p">.</code><code class="nx">exit</code><code class="p">(</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">style</code><code class="p">(</code><code class="s1">'opacity'</code><code class="p">,</code><code> </code><code class="mi">0</code><code class="p">)</code><code class="p">;</code><code>

</code><code class="p">}</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_mapping_with_d3_CO11-1" href="#co_mapping_with_d3_CO11-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>Binds the data to the centroid elements using the <code>name</code> key.</p></dd>
<dt><a class="co" id="callout_mapping_with_d3_CO11-2" href="#co_mapping_with_d3_CO11-2"><img src="2.png" alt="2" width="12" height="12"></a></dt>
<dd><p>Uses our <code>getCentroid</code> method to turn geo-coords into SVG coords.</p></dd>
<dt><a class="co" id="callout_mapping_with_d3_CO11-3" href="#co_mapping_with_d3_CO11-3"><img src="3.png" alt="3" width="12" height="12"></a></dt>
<dd><p>If the country is currently selected, class it <code>active</code>.</p></dd>
<dt><a class="co" id="callout_mapping_with_d3_CO11-4" href="#co_mapping_with_d3_CO11-4"><img src="4.png" alt="4" width="12" height="12"></a></dt>
<dd><p>Fades in newly active indicators over two seconds.</p></dd>
<dt><a class="co" id="callout_mapping_with_d3_CO11-5" href="#co_mapping_with_d3_CO11-5"><img src="5.png" alt="5" width="12" height="12"></a></dt>
<dd><p>Our <code>sqrt</code> scale adjusts the radius to keep the indicator circle area proportionate to <code>number</code> of winners (either absolute or per capita).</p></dd>
</dl></div>

<p>Using a bit of CSS, we can make the indicators red and slightly transparent, allowing map details and, where they are densely packed in Europe, other indicators to show through. If the country is selected by the user, using the country filter on the UI bar, it is classed as <code>active</code> and given a golden hue. Here’s the CSS to do that:</p>

<pre data-type="programlisting" data-code-language="css"><code class="nc">.centroid</code><code class="p">{</code><code>
    </code><code class="k">fill</code><code class="o">:</code><code> </code><code class="nb">red</code><code class="p">;</code><code>
    </code><code class="k">fill-opacity</code><code class="o">:</code><code class="m">0</code><code class="o">.</code><code class="m">3</code><code class="p">;</code><code>
    </code><code class="k">pointer-events</code><code class="o">:</code><code class="nb">none</code><code class="p">;</code><code> </code><a class="co" id="co_mapping_with_d3_CO12-1" href="#callout_mapping_with_d3_CO12-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
</code><code class="p">}</code><code>

</code><code class="nc">.centroid</code><code class="nc">.active</code><code> </code><code class="p">{</code><code>
    </code><code class="k">fill</code><code class="o">:</code><code class="nb">goldenrod</code><code class="p">;</code><code>
    </code><code class="k">fill-opacity</code><code class="o">:</code><code class="m">0</code><code class="o">.</code><code class="m">6</code><code class="p">;</code><code>
</code><code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_mapping_with_d3_CO12-1" href="#co_mapping_with_d3_CO12-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>This allows mouse events to propagate to country shapes below the circles, allowing the user to still click on them.</p></dd>
</dl>

<p>The active centroid indicators we just added are the last element of our Nobel Prize map. Now let’s take a look at the complete article.<a data-type="indexterm" data-primary="" data-startref="D3mapvalue17" id="idm140319389974304"></a></p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Our Completed Map"><div class="sect1" id="idm140319390993152">
<h1>Our Completed Map</h1>

<p><a data-type="indexterm" data-primary="D3 library" data-secondary="map visualizations" data-tertiary="completed map" id="D3mapcomp18"></a>With the country and indicator update patterns in place, our map should respond to user-driven filtering with a smooth transition. <a data-type="xref" href="#d3maps_transition">Figure 18-5</a> shows the result of selecting Nobel Prizes for Economics. Only winning countries remain highlighted and the value indicators are resized, reflecting American dominance of this category.</p>

<figure><div id="d3maps_transition" class="figure">
<img src="dvpj_1805.png" alt="dvpj 1805" width="1236" height="537">
<h6><span class="label">Figure 18-5. </span>(A) Shows the map with the full Nobel dataset; (B) Prizes are filtered by category, showing the Economics winners (and the dominance of the US economists)</h6>
</div></figure>

<p>The map as it stands in not interactive but does show when a user hovers over a particular country with a mouse, by calling the <code>mouseenter</code> and <code>mouseout</code> callback functions and adding or removing an <code>active</code> class. These callbacks could easily be used to add more functionality to the map, such as tooltips or the use of the coutries as clickable data filters. Let’s now use these to build a simple tooltip, to show the country the mouse is hovering over and some simple prize information.<a data-type="indexterm" data-primary="" data-startref="D3mapcomp18" id="idm140319389936496"></a></p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Building a Simple Tooltip"><div class="sect1" id="sect_tooltip">
<h1>Building a Simple Tooltip</h1>

<p><a data-type="indexterm" data-primary="D3 library" data-secondary="map visualizations" data-tertiary="tooltips" id="D3maptool18"></a>Tooltips and other interactive widgets are the kind of thing commonly demanded of data visualizers and though they can get quite involved, particularly if they themselves are interactive (e.g., menus that appear on mouse hover), there are some simple recipes that are very handy to know. In this section, I’ll show how to build a simple but pretty effective tooltip. <a data-type="xref" href="#d3map_tooltip">Figure 18-6</a> shows what we’re aiming to build.</p>

<figure><div id="d3map_tooltip" class="figure">
<img src="dvpj_1404.png" alt="dvpj 1404" width="469" height="194">
<h6><span class="label">Figure 18-6. </span>A simple tooltip for our Nobel Prize map</h6>
</div></figure>

<p>Let’s remind ourselves of our current <code>countries</code> update, with <code>mouseenter</code> and <code>mouseout</code> callback functions:</p>

<pre data-type="programlisting" data-code-language="js">    <code class="c1">// ENTER AND APPEND ANY NEW COUNTRIES</code>
    <code class="nx">countries</code><code class="p">.</code><code class="nx">enter</code><code class="p">()</code>
        <code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s1">'path'</code><code class="p">)</code>
        <code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s1">'class'</code><code class="p">,</code> <code class="s1">'country'</code><code class="p">)</code>
        <code class="p">.</code><code class="nx">on</code><code class="p">(</code><code class="s1">'mouseenter'</code><code class="p">,</code> <code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code> <code class="p">{</code>
            <code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="k">this</code><code class="p">).</code><code class="nx">classed</code><code class="p">(</code><code class="s1">'active'</code><code class="p">,</code> <code class="kc">true</code><code class="p">);</code>
        <code class="p">})</code>
        <code class="p">.</code><code class="nx">on</code><code class="p">(</code><code class="s1">'mouseout'</code><code class="p">,</code> <code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code> <code class="p">{</code>
            <code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="k">this</code><code class="p">).</code><code class="nx">classed</code><code class="p">(</code><code class="s1">'active'</code><code class="p">,</code> <code class="kc">false</code><code class="p">);</code>
        <code class="p">})</code>
    <code class="p">;</code></pre>

<p>In order to add a tooltip to our map, we need to do three things:</p>
<ol>
<li>
<p>Create a tooltip box in HTML with placeholders for the information we want to display—in this case, country name and number of wins in the selected prize category.</p>
</li>
<li>
<p>Display this HTML box over the mouse when the user moves it into a country and hide it when they move the mouse out.</p>
</li>
<li>
<p>Update the box when displayed using the data bound to the country underneath the mouse.</p>
</li>

</ol>

<p>We create the HTML for the tooltip by adding a content block to the Nobel-viz map section, with id <code>map-tooltip</code>, an <code>&lt;h2&gt;</code> header for its title, and a <code>&lt;p&gt;</code> tag for the tooltip’s text:</p>

<pre data-type="programlisting" data-code-language="html"><code class="c">&lt;!-- templates/index.html  --&gt;</code>
      <code class="c">&lt;!-- ...  --&gt;</code>
        <code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"nobel-map"</code><code class="nt">&gt;</code>
          <code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"map-tooltip"</code><code class="nt">&gt;</code>
            <code class="nt">&lt;h2&gt;&lt;/h2&gt;</code>
            <code class="nt">&lt;p&gt;&lt;/p&gt;</code>
          <code class="nt">&lt;/div&gt;</code>
      <code class="c">&lt;!-- ...  --&gt;</code></pre>

<p>We’ll also need some CSS for the tooltip’s look and feel, added to our <em>style.css</em> file:</p>

<pre data-type="programlisting" data-code-language="css"><code class="c">/* css/style.css */</code><code>
</code><code class="c">/* MAP TOOLTIP */</code><code>
</code><code class="nf">#map-tooltip</code><code> </code><code class="p">{</code><code>
    </code><code class="k">position</code><code class="o">:</code><code> </code><code class="nb">absolute</code><code class="p">;</code><code>
    </code><code class="k">pointer-events</code><code class="o">:</code><code class="nb">none</code><code class="p">;</code><code> </code><a class="co" id="co_mapping_with_d3_CO13-1" href="#callout_mapping_with_d3_CO13-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
    </code><code class="k">color</code><code class="o">:</code><code class="m">#eee</code><code class="p">;</code><code>
    </code><code class="k">font-size</code><code class="o">:</code><code class="m">12px</code><code class="p">;</code><code>
    </code><code class="k">opacity</code><code class="o">:</code><code class="m">0</code><code class="o">.</code><code class="m">7</code><code class="p">;</code><code> </code><code class="c">/* a little transparent */</code><code>
    </code><code class="k">background</code><code class="o">:</code><code class="m">#222</code><code class="p">;</code><code>
    </code><code class="k">border</code><code class="o">:</code><code class="m">2px</code><code> </code><code class="nb">solid</code><code> </code><code class="m">#555</code><code class="p">;</code><code>
    </code><code class="k">border-color</code><code class="o">:</code><code> </code><code class="nb">goldenrod</code><code class="p">;</code><code>
    </code><code class="k">padding</code><code class="o">:</code><code class="m">10px</code><code class="p">;</code><code>
    </code><code class="k">left</code><code class="o">:</code><code> </code><code class="m">-999px</code><code class="p">;</code><code> </code><a class="co" id="co_mapping_with_d3_CO13-2" href="#callout_mapping_with_d3_CO13-2"><img src="2.png" alt="2" width="12" height="12"></a><code>
</code><code class="p">}</code><code>

</code><code class="nf">#map-tooltip</code><code> </code><code class="nt">h2</code><code> </code><code class="p">{</code><code>
    </code><code class="k">text-align</code><code class="o">:</code><code> </code><code class="nb">center</code><code class="p">;</code><code>
    </code><code class="k">padding</code><code class="o">:</code><code> </code><code class="m">0px</code><code class="p">;</code><code>
    </code><code class="k">margin</code><code class="o">:</code><code> </code><code class="m">0px</code><code class="p">;</code><code>
</code><code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_mapping_with_d3_CO13-1" href="#co_mapping_with_d3_CO13-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>Setting <code>pointer-events</code> to <code>none</code> effectively lets you click on things underneath the tooltip.</p></dd>
<dt><a class="co" id="callout_mapping_with_d3_CO13-2" href="#co_mapping_with_d3_CO13-2"><img src="2.png" alt="2" width="12" height="12"></a></dt>
<dd><p>Initially, the tooltip is hidden far to the (virtual) left of the browser window, using a large negative x index.</p></dd>
</dl>

<p>With our tooltip’s HTML in place and the element hidden to the left of the browser window (<code>left</code> is –999 pixels), we just need to extend our <code>mousein</code> and <code>mouseout</code> callback functions to display or hide the tooltip. The <code>mousein</code> function, called when the user moves the mouse into a country, does most of the work:</p>

<pre data-type="programlisting" data-code-language="js"><code class="c1">// ...
</code><code class="nx">countries</code><code class="p">.</code><code class="nx">enter</code><code class="p">(</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s1">'path'</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s1">'class'</code><code class="p">,</code><code> </code><code class="s1">'country'</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">on</code><code class="p">(</code><code class="s1">'mouseenter'</code><code class="p">,</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code> </code><code class="p">{</code><code>

        </code><code class="kd">var</code><code> </code><code class="nx">country</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="k">this</code><code class="p">)</code><code class="p">;</code><code>
        </code><code class="c1">// don't do anything if the country is not visible
</code><code>        </code><code class="k">if</code><code class="p">(</code><code class="o">!</code><code class="nx">country</code><code class="p">.</code><code class="nx">classed</code><code class="p">(</code><code class="s1">'visible'</code><code class="p">)</code><code class="p">)</code><code class="p">{</code><code> </code><code class="k">return</code><code class="p">;</code><code> </code><code class="p">}</code><code>

        </code><code class="c1">// get the country data object
</code><code>        </code><code class="kd">var</code><code> </code><code class="nx">cData</code><code> </code><code class="o">=</code><code> </code><code class="nx">country</code><code class="p">.</code><code class="nx">datum</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code>
        </code><code class="c1">// if only one prize, use singular 'prize'
</code><code>        </code><code class="kd">var</code><code> </code><code class="nx">prize_string</code><code> </code><code class="o">=</code><code> </code><code class="p">(</code><code class="nx">cData</code><code class="p">.</code><code class="nx">number</code><code> </code><code class="o">===</code><code> </code><code class="mi">1</code><code class="p">)</code><code class="o">?</code><code>
            </code><code class="s1">' prize in '</code><code class="o">:</code><code> </code><code class="s1">' prizes in '</code><code class="p">;</code><code>
        </code><code class="c1">// set the header and text of the tooltip
</code><code>        </code><code class="nx">tooltip</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s1">'h2'</code><code class="p">)</code><code class="p">.</code><code class="nx">text</code><code class="p">(</code><code class="nx">cData</code><code class="p">.</code><code class="nx">name</code><code class="p">)</code><code class="p">;</code><code>
        </code><code class="nx">tooltip</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s1">'p'</code><code class="p">)</code><code class="p">.</code><code class="nx">text</code><code class="p">(</code><code class="nx">cData</code><code class="p">.</code><code class="nx">number</code><code>
            </code><code class="o">+</code><code> </code><code class="nx">prize_string</code><code> </code><code class="o">+</code><code> </code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">activeCategory</code><code class="p">)</code><code class="p">;</code><code>
        </code><code class="c1">// set the border color according to selected
</code><code>        </code><code class="c1">// prize category
</code><code>        </code><code class="kd">var</code><code> </code><code class="nx">borderColor</code><code> </code><code class="o">=</code><code>
          </code><code class="p">(</code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">activeCategory</code><code> </code><code class="o">===</code><code> </code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">ALL_CATS</code><code class="p">)</code><code class="o">?</code><code>
            </code><code class="s1">'goldenrod'</code><code class="o">:</code><code>
            </code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">categoryFill</code><code class="p">(</code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">activeCategory</code><code class="p">)</code><code class="p">;</code><code>
        </code><code class="nx">tooltip</code><code class="p">.</code><code class="nx">style</code><code class="p">(</code><code class="s1">'border-color'</code><code class="p">,</code><code> </code><code class="nx">borderColor</code><code class="p">)</code><code class="p">;</code><code>

        </code><code class="kd">var</code><code> </code><code class="nx">mouseCoords</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">mouse</code><code class="p">(</code><code class="k">this</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" id="co_mapping_with_d3_CO14-1" href="#callout_mapping_with_d3_CO14-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
        </code><code class="kd">var</code><code> </code><code class="nx">w</code><code> </code><code class="o">=</code><code> </code><code class="nb">parseInt</code><code class="p">(</code><code class="nx">tooltip</code><code class="p">.</code><code class="nx">style</code><code class="p">(</code><code class="s1">'width'</code><code class="p">)</code><code class="p">)</code><code class="p">,</code><code> </code><a class="co" id="co_mapping_with_d3_CO14-2" href="#callout_mapping_with_d3_CO14-2"><img src="2.png" alt="2" width="12" height="12"></a><code>
            </code><code class="nx">h</code><code> </code><code class="o">=</code><code> </code><code class="nb">parseInt</code><code class="p">(</code><code class="nx">tooltip</code><code class="p">.</code><code class="nx">style</code><code class="p">(</code><code class="s1">'height'</code><code class="p">)</code><code class="p">)</code><code class="p">;</code><code>
        </code><code class="nx">tooltip</code><code class="p">.</code><code class="nx">style</code><code class="p">(</code><code class="s1">'top'</code><code class="p">,</code><code> </code><code class="p">(</code><code class="nx">mouseCoords</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code> </code><code class="o">-</code><code> </code><code class="nx">h</code><code class="p">)</code><code> </code><code class="o">+</code><code> </code><code class="s1">'px'</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" id="co_mapping_with_d3_CO14-3" href="#callout_mapping_with_d3_CO14-3"><img src="3.png" alt="3" width="12" height="12"></a><code>
        </code><code class="nx">tooltip</code><code class="p">.</code><code class="nx">style</code><code class="p">(</code><code class="s1">'left'</code><code class="p">,</code><code> </code><code class="p">(</code><code class="nx">mouseCoords</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code> </code><code class="o">-</code><code> </code><code class="nx">w</code><code class="o">/</code><code class="mi">2</code><code class="p">)</code><code> </code><code class="o">+</code><code> </code><code class="s1">'px'</code><code class="p">)</code><code class="p">;</code><code>

        </code><code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="k">this</code><code class="p">)</code><code class="p">.</code><code class="nx">classed</code><code class="p">(</code><code class="s1">'active'</code><code class="p">,</code><code> </code><code class="kc">true</code><code class="p">)</code><code class="p">;</code><code>
    </code><code class="p">}</code><code class="p">)</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_mapping_with_d3_CO14-1" href="#co_mapping_with_d3_CO14-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>D3’s <code>mouse</code> method returns the mouse coordinates (here, relative to the parent map group) in pixels, which we can use to position the tooltip.</p></dd>
<dt><a class="co" id="callout_mapping_with_d3_CO14-2" href="#co_mapping_with_d3_CO14-2"><img src="2.png" alt="2" width="12" height="12"></a></dt>
<dd><p>We get the computed width and height of the tooltip box, which has been adjusted to accommodate our country title and prize string.</p></dd>
<dt><a class="co" id="callout_mapping_with_d3_CO14-3" href="#co_mapping_with_d3_CO14-3"><img src="3.png" alt="3" width="12" height="12"></a></dt>
<dd><p>We use the mouse coordinates and the width and height of the tooltip box to position the box centered horizontally and roughly above the mouse cursor (the width and height don’t include our 10px of padding around the tooltip’s <code>&lt;div&gt;</code>).</p></dd>
</dl>

<p>With the <code>mouseenter</code> callback function written, we now only need a <code>mouseout</code> to hide the tooltip by placing it far to the left of the browser window:</p>

<pre data-type="programlisting" data-code-language="js"><code class="nx">countries</code><code class="p">.</code><code class="nx">enter</code><code class="p">()</code>
    <code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s1">'path'</code><code class="p">)</code>
    <code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s1">'class'</code><code class="p">,</code> <code class="s1">'country'</code><code class="p">)</code>
    <code class="c1">// ...</code>
    <code class="p">.</code><code class="nx">on</code><code class="p">(</code><code class="s1">'mouseout'</code><code class="p">,</code> <code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code> <code class="p">{</code>
        <code class="nx">tooltip</code><code class="p">.</code><code class="nx">style</code><code class="p">(</code><code class="s1">'left'</code><code class="p">,</code> <code class="s1">'-9999px'</code><code class="p">);</code>
        <code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="k">this</code><code class="p">).</code><code class="nx">classed</code><code class="p">(</code><code class="s1">'active'</code><code class="p">,</code> <code class="kc">false</code><code class="p">);</code>
    <code class="p">})</code></pre>

<p>With the <code>mouseenter</code> and <code>mouseout</code> functions operating in concert, you should see the tooltip appearing and disappearing where needed, just as shown in <a data-type="xref" href="#d3map_tooltip">Figure 18-6</a>.</p>

<p>Now that we’ve built the map component of our Nobel dataviz, let’s summarize what we’ve learned before moving on to show how user input drives the visualization.<a data-type="indexterm" data-primary="" data-startref="D3maptool18" id="idm140319389090032"></a></p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Summary"><div class="sect1" id="idm140319389934800">
<h1>Summary</h1>

<p>D3 mapping is a rich area, with many varied projections and lots of utility methods to help with manipulating geometries. But building a map follows a fairly standard procedure, as demonstrated in the chapter: you first choose your projection—say, a Mercator or maybe the Albers conic projection commonly used for mapping the US. You then use this projection to create a D3 <code>path</code> generator, which turns GeoJSON features into SVG paths, creating the map you see. The GeoJSON will normally be extracted from more efficient <span class="keep-together">TopoJSON</span> data.</p>

<p>This chapter also demonstrated how easy it is with D3 to interactively highlight your map and deal with cursor movements. Taken together, the basic set of skills learned should allow you to start building your own mapping visualizations.</p>

<p>Now that we’ve constructed all of our SVG-based graphical elements, let’s see how well D3 works with conventional HTML elements by building our winners’ list and an individual’s biography box.</p>
</div></section>







<div data-type="footnotes"><p data-type="footnote" id="idm140319392812112"><sup><a href="ch18.html#idm140319392812112-marker">1</a></sup> The math of projections, particularly interpolative transitions and the like, can get quite involved.</p><p data-type="footnote" id="idm140319392804336"><sup><a href="ch18.html#idm140319392804336-marker">2</a></sup> I use and thoroughly recommend the open source <a href="http://www.qgis.org/en/site/">QGIS</a>.</p><p data-type="footnote" id="idm140319392801376"><sup><a href="ch18.html#idm140319392801376-marker">3</a></sup> Python’s topojson.py and the TopoJSON command-line program.</p><p data-type="footnote" id="idm140319392799408"><sup><a href="ch18.html#idm140319392799408-marker">4</a></sup> As we’ll see, it does lack a couple of our Nobel Prize countries, but these are too small to be clickable and we have the coordinates of their centers, allowing for a visual cue to be overlaid.</p><p data-type="footnote" id="idm140319392657472"><sup><a href="ch18.html#idm140319392657472-marker">5</a></sup> See <a href="http://bost.ocks.org/mike/simplify/"><em class="hyperlink">http://bost.ocks.org/mike/simplify/</em></a> for a very cool example.</p><p data-type="footnote" id="idm140319392181776"><sup><a href="ch18.html#idm140319392181776-marker">6</a></sup> The <a href="https://github.com/d3/d3-geo-projection">extended set of D3 <code>projection</code>s</a> is part of an extension of D3, not in the main core.</p><p data-type="footnote" id="idm140319392164800"><sup><a href="ch18.html#idm140319392164800-marker">7</a></sup> See <a href="http://bl.ocks.org/mbostock/3795544"><em class="hyperlink">http://bl.ocks.org/mbostock/3795544</em></a> for a nice demonstration.</p><p data-type="footnote" id="idm140319391958960"><sup><a href="ch18.html#idm140319391958960-marker">8</a></sup> See <a href="https://github.com/mbostock/d3/wiki/Geo-Paths#shape-generators">the D3 GitHub</a> for a full list.</p></div></div></section></div>



  <div class="t-sbo-prev sbo-prev sbo-nav-bottom">
  
    
      
        <a href="/library/view/data-visualization-with/9781491920565/ch17.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">17. Visualizing Individual Prizes</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-bottom">
  
    
      
        <a href="/library/view/data-visualization-with/9781491920565/ch19.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">19. Visualizing Individual Winners</div>
        </a>
    
  
  </div>


        
    </section>
  </div>
<section class="sbo-saved-archives"></section>



          
          
  




    
    
      <div id="js-subscribe-nag" class="subscribe-nag clearfix trial-panel t-subscribe-nag">
        
        
          
          

          
            <p>You have 7 days left in your trial, Flankpeter. Subscribe today. <a href="/subscribe/" class="ga-active-trial-subscribe-nag">See pricing options.</a></p>
          
        
        

      </div>

    
    



        
      </div>
      




  <footer class="pagefoot t-pagefoot">
    <a href="#" class="icon-up"><div class="visuallyhidden">Back to top</div></a>
    <ul class='js-footer-nav'>
      
        <li><a class="t-recommendations-footer" href="/r/">Recommended</a></li>
      
      <li>
      
      <a class="t-queue-footer" href="/playlists/">Playlists</a>
      
      </li>
      
        <li><a class="t-recent-footer" href="/history/">History</a></li>
        <li><a class="t-topics-footer" href="/topics?q=*&limit=21">Topics</a></li>
      
      
        <li><a class="t-tutorials-footer" href="/tutorials/">Tutorials</a></li>
      
      <li><a class="t-settings-footer js-settings" href="/u/">Settings</a></li>
      <li class="full-support"><a href="https://www.safaribooksonline.com/public/support">Support</a></li>
      <li><a href="https://www.safaribooksonline.com/apps/">Get the App</a></li>
      <li><a href="/accounts/logout/">Sign Out</a></li>
    </ul>
    <span class="copyright">&#169; 2018 <a href="https://www.safaribooksonline.com" target="_blank">Safari</a>.</span>
    <a href="/terms/">Terms of Service</a> /
    <a href="/privacy/">Privacy Policy</a>
  </footer>




    

    <script src="/jsi18n/web/" charset="utf-8"></script>
    <script src="/library/jsi18n/appcache/" charset="utf-8"></script>
  </body>
</html>
