<!--[if IE]><![endif]--><!DOCTYPE html><!--[if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage"" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/data-visualization-with/9781491920565/ch16.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="2870136"
  data-user-uuid="fee1bd59-4e02-48a4-a7b4-152ec4c157ac"
  data-username="flankpeter"
  data-account-type="Trial"
  
  data-activated-trial-date="05/04/2018"


  data-archive="9781491920565"
  data-publishers="O&#39;Reilly Media, Inc."



  data-htmlfile-name="ch16.html"
  data-epub-title="Data Visualization with Python and JavaScript" data-debug=0 data-testing=0><![endif]--><!--[if gt IE 8]><!--><html class="no-js" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage"" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/data-visualization-with/9781491920565/ch16.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="2870136"
  data-user-uuid="fee1bd59-4e02-48a4-a7b4-152ec4c157ac"
  data-username="flankpeter"
  data-account-type="Trial"
  
  data-activated-trial-date="05/04/2018"


  data-archive="9781491920565"
  data-publishers="O&#39;Reilly Media, Inc."



  data-htmlfile-name="ch16.html"
  data-epub-title="Data Visualization with Python and JavaScript" data-debug=0 data-testing=0><!--<![endif]--><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="author" content="Safari Books Online" /><meta name="format-detection" content="telephone=no"><meta http-equiv="cleartype" content="on"/><meta name="HandheldFriendly" content="True"/><meta name="MobileOptimized" content="320"/><meta name="apple-itunes-app" content="app-id=881697395, app-argument=safaridetail://9781491920565"/><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0"/><meta property="twitter:account_id" content="4503599627559754" /><link rel="apple-touch-icon" href="/static/images/apple-touch-icon.0c29511d2d72.png"/><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"><link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900,200italic,300italic,400italic,600italic,700italic,900italic' rel='stylesheet' type='text/css'><title>16. Introducing D3—The Story of a Bar Chart - Data Visualization with Python and JavaScript</title><link rel="stylesheet" href="/static/CACHE/css/a04cd81b09cd.css" type="text/css" /><link rel="stylesheet" type="text/css" href="/static/css/annotator.ef38b0457d7b.css"/><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"><style type="text/css" title="ibis-book">
    @charset "utf-8";#sbo-rt-content html,#sbo-rt-content div,#sbo-rt-content div,#sbo-rt-content span,#sbo-rt-content applet,#sbo-rt-content object,#sbo-rt-content iframe,#sbo-rt-content h1,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5,#sbo-rt-content h6,#sbo-rt-content p,#sbo-rt-content blockquote,#sbo-rt-content pre,#sbo-rt-content a,#sbo-rt-content abbr,#sbo-rt-content acronym,#sbo-rt-content address,#sbo-rt-content big,#sbo-rt-content cite,#sbo-rt-content code,#sbo-rt-content del,#sbo-rt-content dfn,#sbo-rt-content em,#sbo-rt-content img,#sbo-rt-content ins,#sbo-rt-content kbd,#sbo-rt-content q,#sbo-rt-content s,#sbo-rt-content samp,#sbo-rt-content small,#sbo-rt-content strike,#sbo-rt-content strong,#sbo-rt-content sub,#sbo-rt-content sup,#sbo-rt-content tt,#sbo-rt-content var,#sbo-rt-content b,#sbo-rt-content u,#sbo-rt-content i,#sbo-rt-content center,#sbo-rt-content dl,#sbo-rt-content dt,#sbo-rt-content dd,#sbo-rt-content ol,#sbo-rt-content ul,#sbo-rt-content li,#sbo-rt-content fieldset,#sbo-rt-content form,#sbo-rt-content label,#sbo-rt-content legend,#sbo-rt-content table,#sbo-rt-content caption,#sbo-rt-content tdiv,#sbo-rt-content tfoot,#sbo-rt-content thead,#sbo-rt-content tr,#sbo-rt-content th,#sbo-rt-content td,#sbo-rt-content article,#sbo-rt-content aside,#sbo-rt-content canvas,#sbo-rt-content details,#sbo-rt-content embed,#sbo-rt-content figure,#sbo-rt-content figcaption,#sbo-rt-content footer,#sbo-rt-content header,#sbo-rt-content hgroup,#sbo-rt-content menu,#sbo-rt-content nav,#sbo-rt-content output,#sbo-rt-content ruby,#sbo-rt-content section,#sbo-rt-content summary,#sbo-rt-content time,#sbo-rt-content mark,#sbo-rt-content audio,#sbo-rt-content video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}#sbo-rt-content article,#sbo-rt-content aside,#sbo-rt-content details,#sbo-rt-content figcaption,#sbo-rt-content figure,#sbo-rt-content footer,#sbo-rt-content header,#sbo-rt-content hgroup,#sbo-rt-content menu,#sbo-rt-content nav,#sbo-rt-content section{display:block}#sbo-rt-content div{line-height:1}#sbo-rt-content ol,#sbo-rt-content ul{list-style:none}#sbo-rt-content blockquote,#sbo-rt-content q{quotes:none}#sbo-rt-content blockquote:before,#sbo-rt-content blockquote:after,#sbo-rt-content q:before,#sbo-rt-content q:after{content:none}#sbo-rt-content table{border-collapse:collapse;border-spacing:0}@page{margin:5px !important}#sbo-rt-content p{margin:10px 0 0;line-height:125%;text-align:left}#sbo-rt-content p.byline{text-align:left;margin:-33px auto 35px;font-style:italic;font-weight:bold}#sbo-rt-content div.preface p+p.byline{margin:1em 0 0}#sbo-rt-content div.preface p.byline+p.byline{margin:0}#sbo-rt-content div.sect1>p.byline{margin:-.25em 0 1em}#sbo-rt-content div.sect1>p.byline+p.byline{margin-top:-1em}#sbo-rt-content em{font-style:italic;font-family:inherit}#sbo-rt-content em strong,#sbo-rt-content strong em{font-weight:bold;font-style:italic;font-family:inherit}#sbo-rt-content strong,#sbo-rt-content span.bold{font-weight:bold}#sbo-rt-content em.replaceable{font-style:italic}#sbo-rt-content strong.userinput{font-weight:bold;font-style:normal}#sbo-rt-content span.bolditalic{font-weight:bold;font-style:italic}#sbo-rt-content a.ulink,#sbo-rt-content a.xref,#sbo-rt-content a.email,#sbo-rt-content a.link,#sbo-rt-content a{text-decoration:none;color:#8e0012}#sbo-rt-content span.lineannotation{font-style:italic;color:#a62a2a;font-family:serif}#sbo-rt-content span.underline{text-decoration:underline}#sbo-rt-content span.strikethrough{text-decoration:line-through}#sbo-rt-content span.smallcaps{font-variant:small-caps}#sbo-rt-content span.cursor{background:#000;color:#fff}#sbo-rt-content span.smaller{font-size:75%}#sbo-rt-content .boxedtext,#sbo-rt-content .keycap{border-style:solid;border-width:1px;border-color:#000;padding:1px}#sbo-rt-content span.gray50{color:#7F7F7F;}#sbo-rt-content h1,#sbo-rt-content div.toc-title,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5{-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;font-weight:bold;text-align:left;page-break-after:avoid !important;font-family:sans-serif,"DejaVuSans"}#sbo-rt-content div.toc-title{font-size:1.5em;margin-top:20px !important;margin-bottom:30px !important}#sbo-rt-content section[data-type="sect1"] h1{font-size:1.3em;color:#8e0012;margin:40px 0 8px 0}#sbo-rt-content section[data-type="sect2"] h2{font-size:1.1em;margin:30px 0 8px 0 !important}#sbo-rt-content section[data-type="sect3"] h3{font-size:1em;color:#555;margin:20px 0 8px 0 !important}#sbo-rt-content section[data-type="sect4"] h4{font-size:1em;font-weight:normal;font-style:italic;margin:15px 0 6px 0 !important}#sbo-rt-content section[data-type="chapter"]>div>h1,#sbo-rt-content section[data-type="preface"]>div>h1,#sbo-rt-content section[data-type="appendix"]>div>h1,#sbo-rt-content section[data-type="glossary"]>div>h1,#sbo-rt-content section[data-type="bibliography"]>div>h1,#sbo-rt-content section[data-type="index"]>div>h1{font-size:2em;line-height:1;margin-bottom:50px;color:#000;padding-bottom:10px;border-bottom:1px solid #000}#sbo-rt-content span.label,#sbo-rt-content span.keep-together{font-size:inherit;font-weight:inherit}#sbo-rt-content div[data-type="part"] h1{font-size:2em;text-align:center;margin-top:0 !important;margin-bottom:50px;padding:50px 0 10px 0;border-bottom:1px solid #000}#sbo-rt-content img.width-ninety{width:90%}#sbo-rt-content img{max-width:95%;margin:0 auto;padding:0}#sbo-rt-content div.figure{background-color:transparent;text-align:center !important;margin:15px 0 15px 0 !important;page-break-inside:avoid}#sbo-rt-content figure{margin:15px 0 15px 0 !important;page-break-inside:avoid}#sbo-rt-content div.figure h6{font-size:90%;text-align:center;font-weight:normal;font-style:italic;font-family:serif !important;color:#000;padding-top:10px !important;page-break-before:avoid;page-break-after:avoid}#sbo-rt-content div.informalfigure{text-align:center !important;padding:5px 0 !important}#sbo-rt-content div.sidebar{margin:15px 0 10px 0 !important;border:1px solid #DCDCDC;background-color:#F7F7F7;padding:15px !important;page-break-inside:avoid}#sbo-rt-content aside[data-type="sidebar"]{margin:15px 0 10px 0 !important;page-break-inside:avoid}#sbo-rt-content div.sidebar-title,#sbo-rt-content aside[data-type="sidebar"] h5{font-weight:bold;font-size:1em;font-family:sans-serif;text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px 0 !important;page-break-inside:avoid}#sbo-rt-content div.sidebar ol,#sbo-rt-content div.sidebar ul,#sbo-rt-content aside[data-type="sidebar"] ol,#sbo-rt-content aside[data-type="sidebar"] ul{margin-left:1.25em !important}#sbo-rt-content div.sidebar div.figure p.title,#sbo-rt-content aside[data-type="sidebar"] figcaption,#sbo-rt-content div.sidebar div.informalfigure div.caption{font-size:90%;text-align:center;font-weight:normal;font-style:italic;font-family:serif !important;color:#000;padding:5px !important;page-break-before:avoid;page-break-after:avoid}#sbo-rt-content div.sidebar div.tip,#sbo-rt-content div.sidebar div[data-type="tip"],#sbo-rt-content div.sidebar div.note,#sbo-rt-content div.sidebar div[data-type="note"],#sbo-rt-content div.sidebar div.warning,#sbo-rt-content div.sidebar div[data-type="warning"],#sbo-rt-content div.sidebar div[data-type="caution"],#sbo-rt-content div.sidebar div[data-type="important"]{margin:20px auto 20px auto !important;font-size:90%;width:85%}#sbo-rt-content aside[data-type="sidebar"] p.byline{font-size:90%;font-weight:bold;font-style:italic;text-align:center;text-indent:0;margin:5px auto 6px;page-break-after:avoid}#sbo-rt-content pre{white-space:pre-wrap;font-family:"Ubuntu Mono",monospace;margin:25px 0 25px 20px;font-size:85%;display:block;-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;overflow-wrap:break-word}#sbo-rt-content div.note pre.programlisting,#sbo-rt-content div.tip pre.programlisting,#sbo-rt-content div.warning pre.programlisting,#sbo-rt-content div.caution pre.programlisting,#sbo-rt-content div.important pre.programlisting{margin-bottom:0}#sbo-rt-content code{font-family:"Ubuntu Mono",monospace;-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;overflow-wrap:break-word}#sbo-rt-content code strong em,#sbo-rt-content code em strong,#sbo-rt-content pre em strong,#sbo-rt-content pre strong em,#sbo-rt-content strong code em code,#sbo-rt-content em code strong code,#sbo-rt-content span.bolditalic code{font-weight:bold;font-style:italic;font-family:"Ubuntu Mono BoldItal",monospace}#sbo-rt-content code em,#sbo-rt-content em code,#sbo-rt-content pre em,#sbo-rt-content em.replaceable{font-family:"Ubuntu Mono Ital",monospace;font-style:italic}#sbo-rt-content code strong,#sbo-rt-content strong code,#sbo-rt-content pre strong,#sbo-rt-content strong.userinput{font-family:"Ubuntu Mono Bold",monospace;font-weight:bold}#sbo-rt-content div[data-type="example"]{margin:10px 0 15px 0 !important}#sbo-rt-content div[data-type="example"] h1,#sbo-rt-content div[data-type="example"] h2,#sbo-rt-content div[data-type="example"] h3,#sbo-rt-content div[data-type="example"] h4,#sbo-rt-content div[data-type="example"] h5,#sbo-rt-content div[data-type="example"] h6{font-style:italic;font-weight:normal;text-align:left !important;text-transform:none !important;font-family:serif !important;margin:10px 0 5px 0 !important;border-bottom:1px solid #000}#sbo-rt-content li pre.example{padding:10px 0 !important}#sbo-rt-content div[data-type="example"] pre[data-type="programlisting"],#sbo-rt-content div[data-type="example"] pre[data-type="screen"]{margin:0}#sbo-rt-content section[data-type="titlepage"]>div>h1{font-size:2em;margin:50px 0 10px 0 !important;line-height:1;text-align:center}#sbo-rt-content section[data-type="titlepage"] h2,#sbo-rt-content section[data-type="titlepage"] p.subtitle,#sbo-rt-content section[data-type="titlepage"] p[data-type="subtitle"]{font-size:1.3em;font-weight:normal;text-align:center;margin-top:.5em;color:#555}#sbo-rt-content section[data-type="titlepage"]>div>h2[data-type="author"],#sbo-rt-content section[data-type="titlepage"] p.author{font-size:1.3em;font-family:serif !important;font-weight:bold;margin:50px 0 !important;text-align:center}#sbo-rt-content section[data-type="titlepage"] p.edition{text-align:center;text-transform:uppercase;margin-top:2em}#sbo-rt-content div.book div.titlepage div.publishername{margin-top:60%;margin-bottom:20px;text-align:center;font-size:1.25em}#sbo-rt-content div.book div.titlepage div.locations p{margin:0;text-align:center}#sbo-rt-content div.book div.titlepage div.locations p.cities{font-size:80%;text-align:center;margin-top:5px}#sbo-rt-content section.preface[title="Dedication"]>div.titlepage h2.title{text-align:center;text-transform:uppercase;font-size:1.5em;margin-top:50px;margin-bottom:50px}#sbo-rt-content ul.stafflist{margin:15px 0 15px 20px !important}#sbo-rt-content ul.stafflist li{list-style-type:none;padding:5px 0}#sbo-rt-content ul.printings li{list-style-type:none}#sbo-rt-content section.preface[title="Dedication"] p{font-style:italic;text-align:center}#sbo-rt-content div.colophon h1.title{font-size:1.3em;margin:0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon h2.subtitle{margin:0 !important;color:#000;font-family:serif !important;font-size:1em;font-weight:normal}#sbo-rt-content div.colophon div.author h3.author{font-size:1.1em;font-family:serif !important;margin:10px 0 0 !important;font-weight:normal}#sbo-rt-content div.colophon div.editor h4,#sbo-rt-content div.colophon div.editor h3.editor{color:#000;font-size:.8em;margin:15px 0 0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon div.editor h3.editor{font-size:.8em;margin:0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon div.publisher{margin-top:10px}#sbo-rt-content div.colophon div.publisher p,#sbo-rt-content div.colophon div.publisher span.publishername{margin:0;font-size:.8em}#sbo-rt-content div.legalnotice p,#sbo-rt-content div.timestamp p{font-size:.8em}#sbo-rt-content div.timestamp p{margin-top:10px}#sbo-rt-content div.colophon[title="About the Author"] h1.title,#sbo-rt-content div.colophon[title="Colophon"] h1.title{font-size:1.5em;margin:0 !important;font-family:sans-serif !important}#sbo-rt-content section.chapter div.titlepage div.author{margin:10px 0 10px 0}#sbo-rt-content section.chapter div.titlepage div.author div.affiliation{font-style:italic}#sbo-rt-content div.attribution{margin:5px 0 0 50px !important}#sbo-rt-content h3.author span.orgname{display:none}#sbo-rt-content div.epigraph{margin:10px 0 10px 20px !important;page-break-inside:avoid;font-size:90%}#sbo-rt-content div.epigraph p{font-style:italic}#sbo-rt-content blockquote,#sbo-rt-content div.blockquote{margin:10px !important;page-break-inside:avoid;font-size:95%}#sbo-rt-content blockquote p,#sbo-rt-content div.blockquote p{font-style:italic;margin:.75em 0 0 !important}#sbo-rt-content blockquote div.attribution,#sbo-rt-content blockquote p[data-type="attribution"]{margin:5px 0 10px 30px !important;text-align:right;width:80%}#sbo-rt-content blockquote div.attribution p,#sbo-rt-content blockquote p[data-type="attribution"]{font-style:normal;margin-top:5px}#sbo-rt-content blockquote div.attribution p:before,#sbo-rt-content blockquote p[data-type="attribution"]:before{font-style:normal;content:"—";-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none}#sbo-rt-content p.right{text-align:right;margin:0}#sbo-rt-content div[data-type="footnotes"]{border-top:1px solid black;margin-top:1.5em}#sbo-rt-content sub,#sbo-rt-content sup{font-size:75%;line-height:0;position:relative}#sbo-rt-content sup{top:-.5em}#sbo-rt-content sub{bottom:-.25em}#sbo-rt-content div.refentry p.refname{font-size:1em;font-family:sans-serif,"DejaVuSans";font-weight:bold;margin-bottom:5px;overflow:auto;width:100%}#sbo-rt-content div.refentry{width:100%;display:block;margin-top:2em}#sbo-rt-content div.refsynopsisdiv{display:block;clear:both}#sbo-rt-content div.refentry header{page-break-inside:avoid !important;display:block;break-inside:avoid !important;padding-top:0;border-bottom:1px solid #000}#sbo-rt-content div.refsect1 h6{font-size:.9em;font-family:sans-serif,"DejaVuSans";font-weight:bold}#sbo-rt-content div.refsect1{margin-top:3em}#sbo-rt-content dt{padding-top:10px !important;padding-bottom:0 !important}#sbo-rt-content dd{margin-left:1.5em !important;margin-bottom:.25em}#sbo-rt-content dd,#sbo-rt-content li{text-align:left}#sbo-rt-content ul{list-style-type:disc}#sbo-rt-content ul ul{list-style-type:square}#sbo-rt-content ul ul ul{list-style-type:circle}#sbo-rt-content ol{list-style-type:decimal}#sbo-rt-content ol ol{list-style-type:lower-alpha}#sbo-rt-content ol ol ol{list-style-type:lower-roman}#sbo-rt-content ol ul{list-style-type:disc}#sbo-rt-content ol ul ol{list-style-type:decimal}#sbo-rt-content ul ol{list-style-type:decimal}#sbo-rt-content ul ol ul{list-style-type:disc}#sbo-rt-content ol,#sbo-rt-content ul{list-style-position:outside;margin:15px 0 15px 1.25em}#sbo-rt-content ol li,#sbo-rt-content ul li{margin:.5em 0 .65em;line-height:125%}#sbo-rt-content div.orderedlistalpha{list-style-type:upper-alpha}#sbo-rt-content table.simplelist,#sbo-rt-content ul.simplelist{margin:15px 0 15px 20px !important}#sbo-rt-content ul.simplelist li{list-style-type:none;padding:5px 0}#sbo-rt-content table.simplelist td{border:none}#sbo-rt-content table.simplelist tr{border-bottom:none}#sbo-rt-content table.simplelist tr:nth-of-type(even){background-color:transparent}#sbo-rt-content dl.calloutlist p:first-child{margin-top:-25px !important}#sbo-rt-content dl.calloutlist dd{padding-left:0;margin-top:-25px}#sbo-rt-content dl.calloutlist img,#sbo-rt-content a.co img{padding:0}#sbo-rt-content div.toc ol{margin-top:8px !important;margin-bottom:8px !important;margin-left:0 !important;padding-left:0 !important}#sbo-rt-content div.toc ol ol{margin-left:30px !important;padding-left:0 !important}#sbo-rt-content div.toc ol li{list-style-type:none}#sbo-rt-content div.toc a{color:#8e0012}#sbo-rt-content div.toc ol a{font-size:1em;font-weight:bold}#sbo-rt-content div.toc ol>li>ol a{font-weight:bold;font-size:1em}#sbo-rt-content div.toc ol>li>ol>li>ol a{text-decoration:none;font-weight:normal;font-size:1em}#sbo-rt-content div.tip,#sbo-rt-content div[data-type="tip"],#sbo-rt-content div.note,#sbo-rt-content div[data-type="note"],#sbo-rt-content div.warning,#sbo-rt-content div[data-type="warning"],#sbo-rt-content div[data-type="caution"],#sbo-rt-content div[data-type="important"]{margin:30px !important;font-size:90%;padding:10px 8px 20px 8px !important;page-break-inside:avoid}#sbo-rt-content div.tip ol,#sbo-rt-content div.tip ul,#sbo-rt-content div[data-type="tip"] ol,#sbo-rt-content div[data-type="tip"] ul,#sbo-rt-content div.note ol,#sbo-rt-content div.note ul,#sbo-rt-content div[data-type="note"] ol,#sbo-rt-content div[data-type="note"] ul,#sbo-rt-content div.warning ol,#sbo-rt-content div.warning ul,#sbo-rt-content div[data-type="warning"] ol,#sbo-rt-content div[data-type="warning"] ul,#sbo-rt-content div[data-type="caution"] ol,#sbo-rt-content div[data-type="caution"] ul,#sbo-rt-content div[data-type="important"] ol,#sbo-rt-content div[data-type="important"] ul{margin-left:1.5em !important}#sbo-rt-content div.tip,#sbo-rt-content div[data-type="tip"],#sbo-rt-content div.note,#sbo-rt-content div[data-type="note"]{border:1px solid #BEBEBE;background-color:transparent}#sbo-rt-content div.warning,#sbo-rt-content div[data-type="warning"],#sbo-rt-content div[data-type="caution"],#sbo-rt-content div[data-type="important"]{border:1px solid #BC8F8F}#sbo-rt-content div.tip h3,#sbo-rt-content div[data-type="tip"] h6,#sbo-rt-content div[data-type="tip"] h1,#sbo-rt-content div.note h3,#sbo-rt-content div[data-type="note"] h6,#sbo-rt-content div[data-type="note"] h1,#sbo-rt-content div.warning h3,#sbo-rt-content div[data-type="warning"] h6,#sbo-rt-content div[data-type="warning"] h1,#sbo-rt-content div[data-type="caution"] h6,#sbo-rt-content div[data-type="caution"] h1,#sbo-rt-content div[data-type="important"] h1,#sbo-rt-content div[data-type="important"] h6{font-weight:bold;font-size:110%;font-family:sans-serif !important;text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px !important}#sbo-rt-content div.tip h3,#sbo-rt-content div[data-type="tip"] h6,#sbo-rt-content div.note h3,#sbo-rt-content div[data-type="note"] h6,#sbo-rt-content div[data-type="tip"] h1,#sbo-rt-content div[data-type="note"] h1{color:#737373}#sbo-rt-content div.warning h3,#sbo-rt-content div[data-type="warning"] h6,#sbo-rt-content div[data-type="caution"] h6,#sbo-rt-content div[data-type="important"] h6,#sbo-rt-content div[data-type="warning"] h1,#sbo-rt-content div[data-type="caution"] h1,#sbo-rt-content div[data-type="important"] h1{color:#C67171}#sbo-rt-content div.sect1[title="Safari® Books Online"] div.note,#sbo-rt-content div.safarienabled{background-color:transparent;margin:8px 0 0 !important;border:0 solid #BEBEBE;font-size:100%;padding:0 !important;page-break-inside:avoid}#sbo-rt-content div.sect1[title="Safari® Books Online"] div.note h3,#sbo-rt-content div.safarienabled h6{display:none}#sbo-rt-content div.table,#sbo-rt-content table{margin:15px 0 30px 0 !important;max-width:95%;border:none !important;background:none;display:table !important}#sbo-rt-content div.table,#sbo-rt-content div.informaltable,#sbo-rt-content table{page-break-inside:avoid}#sbo-rt-content tr,#sbo-rt-content tr td{border-bottom:1px solid #c3c3c3}#sbo-rt-content thead td,#sbo-rt-content thead th{border-bottom:#9d9d9d 1px solid !important;border-top:#9d9d9d 1px solid !important}#sbo-rt-content tr:nth-of-type(even){background-color:#f1f6fc}#sbo-rt-content thead{font-family:sans-serif;font-weight:bold}#sbo-rt-content td,#sbo-rt-content th{display:table-cell;padding:.3em;text-align:left;vertical-align:middle;font-size:80%}#sbo-rt-content div.informaltable table{margin:10px auto !important}#sbo-rt-content div.informaltable table tr{border-bottom:none}#sbo-rt-content div.informaltable table tr:nth-of-type(even){background-color:transparent}#sbo-rt-content div.informaltable td,#sbo-rt-content div.informaltable th{border:#9d9d9d 1px solid}#sbo-rt-content div.table-title,#sbo-rt-content table caption{font-weight:normal;font-style:italic;font-family:serif;font-size:1em;margin:10px 0 10px 0 !important;padding:0;page-break-after:avoid;text-align:left !important}#sbo-rt-content table code{font-size:smaller}#sbo-rt-content div.equation,#sbo-rt-content div[data-type="equation"]{margin:10px 0 15px 0 !important}#sbo-rt-content div.equation-title,#sbo-rt-content div[data-type="equation"] h5{font-style:italic;font-weight:normal;font-family:serif !important;font-size:90%;margin:20px 0 10px 0 !important;page-break-after:avoid}#sbo-rt-content div.equation-contents{margin-left:20px}#sbo-rt-content span.inlinemediaobject{height:.85em;display:inline-block;margin-bottom:.2em}#sbo-rt-content span.inlinemediaobject img{margin:0;height:.85em}#sbo-rt-content div.informalequation{margin:20px 0 20px 20px;width:75%}#sbo-rt-content div.informalequation img{width:75%}#sbo-rt-content div.index{text-indent:0}#sbo-rt-content div.index li{line-height:140%}#sbo-rt-content div.index a.indexterm{color:#8e0012}#sbo-rt-content div.index ul,#sbo-rt-content div[data-type="index"] ul{list-style-type:none;padding-left:0;margin-left:0}#sbo-rt-content div.index ul li{padding-left:0;margin-left:0}#sbo-rt-content div.index ul li ul li{margin-left:1em}#sbo-rt-content code.boolean,#sbo-rt-content .navy{color:rgb(0,0,128);}#sbo-rt-content code.character,#sbo-rt-content .olive{color:rgb(128,128,0);}#sbo-rt-content code.comment,#sbo-rt-content .blue{color:rgb(0,0,255);}#sbo-rt-content code.conditional,#sbo-rt-content .limegreen{color:rgb(50,205,50);}#sbo-rt-content code.constant,#sbo-rt-content .darkorange{color:rgb(255,140,0);}#sbo-rt-content code.debug,#sbo-rt-content .darkred{color:rgb(139,0,0);}#sbo-rt-content code.define,#sbo-rt-content .darkgoldenrod,#sbo-rt-content .gold{color:rgb(184,134,11);}#sbo-rt-content code.delimiter,#sbo-rt-content .dimgray{color:rgb(105,105,105);}#sbo-rt-content code.error,#sbo-rt-content .red{color:rgb(255,0,0);}#sbo-rt-content code.exception,#sbo-rt-content .salmon{color:rgb(250,128,11);}#sbo-rt-content code.float,#sbo-rt-content .steelblue{color:rgb(70,130,180);}#sbo-rt-content pre code.function,#sbo-rt-content .green{color:rgb(0,128,0);}#sbo-rt-content code.identifier,#sbo-rt-content .royalblue{color:rgb(65,105,225);}#sbo-rt-content code.ignore,#sbo-rt-content .gray{color:rgb(128,128,128);}#sbo-rt-content code.include,#sbo-rt-content .purple{color:rgb(128,0,128);}#sbo-rt-content code.keyword,#sbo-rt-content .sienna{color:rgb(160,82,45);}#sbo-rt-content code.label,#sbo-rt-content .deeppink{color:rgb(255,20,147);}#sbo-rt-content code.macro,#sbo-rt-content .orangered{color:rgb(255,69,0);}#sbo-rt-content code.number,#sbo-rt-content .brown{color:rgb(165,42,42);}#sbo-rt-content code.operator,#sbo-rt-content .black{color:#000;}#sbo-rt-content code.preCondit,#sbo-rt-content .teal{color:rgb(0,128,128);}#sbo-rt-content code.preProc,#sbo-rt-content .fuschia{color:rgb(255,0,255);}#sbo-rt-content code.repeat,#sbo-rt-content .indigo{color:rgb(75,0,130);}#sbo-rt-content code.special,#sbo-rt-content .saddlebrown{color:rgb(139,69,19);}#sbo-rt-content code.specialchar,#sbo-rt-content .magenta{color:rgb(255,0,255);}#sbo-rt-content code.specialcomment,#sbo-rt-content .seagreen{color:rgb(46,139,87);}#sbo-rt-content code.statement,#sbo-rt-content .forestgreen{color:rgb(34,139,34);}#sbo-rt-content code.storageclass,#sbo-rt-content .plum{color:rgb(221,160,221);}#sbo-rt-content code.string,#sbo-rt-content .darkred{color:rgb(139,0,0);}#sbo-rt-content code.structure,#sbo-rt-content .chocolate{color:rgb(210,106,30);}#sbo-rt-content code.tag,#sbo-rt-content .darkcyan{color:rgb(0,139,139);}#sbo-rt-content code.todo,#sbo-rt-content .black{color:#000;}#sbo-rt-content code.type,#sbo-rt-content .mediumslateblue{color:rgb(123,104,238);}#sbo-rt-content code.typedef,#sbo-rt-content .darkgreen{color:rgb(0,100,0);}#sbo-rt-content code.underlined{text-decoration:underline;}#sbo-rt-content pre code.hll{background-color:#ffc}#sbo-rt-content pre code.c{color:#09F;font-style:italic}#sbo-rt-content pre code.err{color:#A00}#sbo-rt-content pre code.k{color:#069;font-weight:bold}#sbo-rt-content pre code.o{color:#555}#sbo-rt-content pre code.cm{color:#35586C;font-style:italic}#sbo-rt-content pre code.cp{color:#099}#sbo-rt-content pre code.c1{color:#35586C;font-style:italic}#sbo-rt-content pre code.cs{color:#35586C;font-weight:bold;font-style:italic}#sbo-rt-content pre code.gd{background-color:#FCC}#sbo-rt-content pre code.ge{font-style:italic}#sbo-rt-content pre code.gr{color:#F00}#sbo-rt-content pre code.gh{color:#030;font-weight:bold}#sbo-rt-content pre code.gi{background-color:#CFC}#sbo-rt-content pre code.go{color:#000}#sbo-rt-content pre code.gp{color:#009;font-weight:bold}#sbo-rt-content pre code.gs{font-weight:bold}#sbo-rt-content pre code.gu{color:#030;font-weight:bold}#sbo-rt-content pre code.gt{color:#9C6}#sbo-rt-content pre code.kc{color:#069;font-weight:bold}#sbo-rt-content pre code.kd{color:#069;font-weight:bold}#sbo-rt-content pre code.kn{color:#069;font-weight:bold}#sbo-rt-content pre code.kp{color:#069}#sbo-rt-content pre code.kr{color:#069;font-weight:bold}#sbo-rt-content pre code.kt{color:#078;font-weight:bold}#sbo-rt-content pre code.m{color:#F60}#sbo-rt-content pre code.s{color:#C30}#sbo-rt-content pre code.na{color:#309}#sbo-rt-content pre code.nb{color:#366}#sbo-rt-content pre code.nc{color:#0A8;font-weight:bold}#sbo-rt-content pre code.no{color:#360}#sbo-rt-content pre code.nd{color:#99F}#sbo-rt-content pre code.ni{color:#999;font-weight:bold}#sbo-rt-content pre code.ne{color:#C00;font-weight:bold}#sbo-rt-content pre code.nf{color:#C0F}#sbo-rt-content pre code.nl{color:#99F}#sbo-rt-content pre code.nn{color:#0CF;font-weight:bold}#sbo-rt-content pre code.nt{color:#309;font-weight:bold}#sbo-rt-content pre code.nv{color:#033}#sbo-rt-content pre code.ow{color:#000;font-weight:bold}#sbo-rt-content pre code.w{color:#bbb}#sbo-rt-content pre code.mf{color:#F60}#sbo-rt-content pre code.mh{color:#F60}#sbo-rt-content pre code.mi{color:#F60}#sbo-rt-content pre code.mo{color:#F60}#sbo-rt-content pre code.sb{color:#C30}#sbo-rt-content pre code.sc{color:#C30}#sbo-rt-content pre code.sd{color:#C30;font-style:italic}#sbo-rt-content pre code.s2{color:#C30}#sbo-rt-content pre code.se{color:#C30;font-weight:bold}#sbo-rt-content pre code.sh{color:#C30}#sbo-rt-content pre code.si{color:#A00}#sbo-rt-content pre code.sx{color:#C30}#sbo-rt-content pre code.sr{color:#3AA}#sbo-rt-content pre code.s1{color:#C30}#sbo-rt-content pre code.ss{color:#A60}#sbo-rt-content pre code.bp{color:#366}#sbo-rt-content pre code.vc{color:#033}#sbo-rt-content pre code.vg{color:#033}#sbo-rt-content pre code.vi{color:#033}#sbo-rt-content pre code.il{color:#F60}#sbo-rt-content pre code.g{color:#050}#sbo-rt-content pre code.l{color:#C60}#sbo-rt-content pre code.l{color:#F90}#sbo-rt-content pre code.n{color:#008}#sbo-rt-content pre code.nx{color:#008}#sbo-rt-content pre code.py{color:#96F}#sbo-rt-content pre code.p{color:#000}#sbo-rt-content pre code.x{color:#F06}#sbo-rt-content div.blockquote_sampler_toc{width:95%;margin:5px 5px 5px 10px !important}#sbo-rt-content div{font-family:serif;text-align:left}#sbo-rt-content .gray-background,#sbo-rt-content .reverse-video{background:#2E2E2E;color:#FFF}#sbo-rt-content .light-gray-background{background:#A0A0A0}#sbo-rt-content .preserve-whitespace{white-space:pre-wrap}#sbo-rt-content span.gray{color:#4C4C4C}
    </style><script> // <![CDATA[
    var g = {
      position_cache: {
        
          "chapter": "/api/v1/book/9781491920565/chapter/ch16.html",
          "book_id": "9781491920565",
          "chapter_uri": "ch16.html",
          "position": 0,
          "user_uuid": "fee1bd59-4e02-48a4-a7b4-152ec4c157ac",
          "next_chapter_uri": "/library/view/data-visualization-with/9781491920565/ch17.html"
        
      },
      title: "Data Visualization with Python and JavaScript",
      author_list: "Kyran Dale",
      format: "book",
      source: "application/epub+zip",
      is_system_book: true,
      is_public: false,
      loaded_from_server: true,
      allow_scripts: false,
      has_mathml: false,
      show_ios_app_teaser: false
    };
    // ]]></script><script src="/static/js/src/modernizr.js"></script><script>
    
      
       window.PUBLIC_ANNOTATIONS = false;
      

      window.MOBILE_PUBLIC_ANNOTATIONS = false;

    

    
      window.PRIVACY_CONTROL_OVERRIDE = false;
    

    
      window.PRIVACY_CONTROL_SWITCH = true;
    

    
      window.PUBLISHER_PAGES = true;
    

      window.SBO = {
        "constants": {
          "SITB_ENDPOINT": "https://www.safaribooksonline.com/api/v2/sitb/",
          "SEARCH_SELECT_ENDPOINT": "https://www.safaribooksonline.com/api/v2/search/select/",
          "ENABLE_ONLINE_TRAINING": true
        }
      };
  </script><link rel="canonical" href="https://www.safaribooksonline.com/library/view/data-visualization-with/9781491920565/ch16.html"/><meta name="description" content=" Chapter 16. Introducing D3—The Story of a Bar Chart In Chapter 15 we imagined our Nobel Prize visualization by breaking it into component elements. In this chapter, I will ... "><meta property="og:title" content="16. Introducing D3—The Story of a Bar Chart" /><meta itemprop="isPartOf" content="/library/view/data-visualization-with/9781491920565/" /><meta itemprop="name" content="16. Introducing D3—The Story of a Bar Chart" /><meta property="og:url" itemprop="url" content="https://www.safaribooksonline.com/library/view/data-visualization-with/9781491920565/ch16.html" /><meta property="og:site_name" content="Safari" /><meta property="og:image" itemprop="thumbnailUrl" content="https://www.safaribooksonline.com/library/cover/9781491920565/" /><meta property="og:description" itemprop="description" content=" Chapter 16. Introducing D3—The Story of a Bar Chart In Chapter 15 we imagined our Nobel Prize visualization by breaking it into component elements. In this chapter, I will ... "><meta itemprop="inLanguage" content="en" /><meta itemprop="publisher" content="O&#39;Reilly Media, Inc." /><meta property="og:type" content="book" /><meta property="og:book:isbn" itemprop="isbn" content="9781491920510" /><meta property="og:book:author" itemprop="author" content="Kyran Dale" /><meta property="og:book:tag" itemprop="about" content="JavaScript" /><meta property="og:book:tag" itemprop="about" content="Python" /><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@safari"><script>
    window.ENABLE_BOWERBIRD_COLLECTIONS = true;
  </script><style type="text/css" id="font-styles" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-size: <%= font_size %> !important; }"></style><style type="text/css" id="font-family" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-family: <%= font_family %> !important; }"></style><style type="text/css" id="column-width" data-template="#sbo-rt-content { max-width: <%= column_width %>% !important; margin: 0 auto !important; }"></style><noscript><meta http-equiv="refresh" content="0; url=/library/no-js/" /></noscript><script type="text/javascript">
    (function(i,s,o,g,r,a,m) {
      i['GoogleAnalyticsObject']=r;
      i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();
      a=s.createElement(o),m=s.getElementsByTagName(o)[0];
      a.async=1;
      a.src=g;
      m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    var matches = document.cookie.match(/BrowserCookie\s*=\s*([a-f0-9\-]{36})/),
      user_uuid = null;

    if (matches && matches.length === 2) {
      user_uuid = matches[1];
    }

  
    ga('create', 'UA-39299553-7', {'userId': 'fee1bd59-4e02-48a4-a7b4-152ec4c157ac' });
  

  
    
      ga('set', 'dimension1', 'Trial');
    
  

  ga('set', 'dimension6', user_uuid);

  
    ga('set', 'dimension2', 'fee1bd59-4e02-48a4-a7b4-152ec4c157ac');
    
  

  

  

  //enable enhanced link tracking
  ga('require', 'linkid', 'linkid.js');

  // reading interface will track pageviews itself
  if (document.location.pathname.indexOf("/library/view") !== 0) {
    ga('send', 'pageview');
  }
  </script><script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5P4V6Z');
  </script><script defer src="/static/js/build/vendor.e2e622a103f9.js"></script><script defer src="/static/js/build/reader.84feb506aa44.js"></script></head>


<body class="reading sidenav nav-collapsed  scalefonts">

    
  
  <noscript> 
    <iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P4V6Z"
            height="0" width="0"
            style="display:none;visibility:hidden">
    </iframe>
  </noscript>
  



    
      <div class="hide working" role="status">
        <div class="working-image"></div>
      </div>
      <div class="sbo-site-nav">
        





<a href="#container" class="skip">Skip to content</a><header class="topbar t-topbar"><nav role="navigation" class="js-site-nav"><ul class="topnav"><li class="t-logo"><a href="/home/" class="l0 None safari-home nav-icn js-keyboard-nav-home"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>Safari Home Icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M4 9.9L4 9.9 4 18 16 18 16 9.9 10 4 4 9.9ZM2.6 8.1L2.6 8.1 8.7 1.9 10 0.5 11.3 1.9 17.4 8.1 18 8.7 18 9.5 18 18.1 18 20 16.1 20 3.9 20 2 20 2 18.1 2 9.5 2 8.7 2.6 8.1Z"/><rect x="10" y="12" width="3" height="7"/><rect transform="translate(18.121320, 10.121320) rotate(-315.000000) translate(-18.121320, -10.121320) " x="16.1" y="9.1" width="4" height="2"/><rect transform="translate(2.121320, 10.121320) scale(-1, 1) rotate(-315.000000) translate(-2.121320, -10.121320) " x="0.1" y="9.1" width="4" height="2"/></g></svg><span>Safari Home</span></a></li><li><a href="/r/" class="t-recommendations-nav l0 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>recommendations icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M50 25C50 18.2 44.9 12.5 38.3 11.7 37.5 5.1 31.8 0 25 0 18.2 0 12.5 5.1 11.7 11.7 5.1 12.5 0 18.2 0 25 0 31.8 5.1 37.5 11.7 38.3 12.5 44.9 18.2 50 25 50 31.8 50 37.5 44.9 38.3 38.3 44.9 37.5 50 31.8 50 25ZM25 3.1C29.7 3.1 33.6 6.9 34.4 11.8 30.4 12.4 26.9 15.1 25 18.8 23.1 15.1 19.6 12.4 15.6 11.8 16.4 6.9 20.3 3.1 25 3.1ZM34.4 15.6C33.6 19.3 30.7 22.2 27.1 22.9 27.8 19.2 30.7 16.3 34.4 15.6ZM22.9 22.9C19.2 22.2 16.3 19.3 15.6 15.6 19.3 16.3 22.2 19.2 22.9 22.9ZM3.1 25C3.1 20.3 6.9 16.4 11.8 15.6 12.4 19.6 15.1 23.1 18.8 25 15.1 26.9 12.4 30.4 11.8 34.4 6.9 33.6 3.1 29.7 3.1 25ZM22.9 27.1C22.2 30.7 19.3 33.6 15.6 34.4 16.3 30.7 19.2 27.8 22.9 27.1ZM25 46.9C20.3 46.9 16.4 43.1 15.6 38.2 19.6 37.6 23.1 34.9 25 31.3 26.9 34.9 30.4 37.6 34.4 38.2 33.6 43.1 29.7 46.9 25 46.9ZM27.1 27.1C30.7 27.8 33.6 30.7 34.4 34.4 30.7 33.6 27.8 30.7 27.1 27.1ZM38.2 34.4C37.6 30.4 34.9 26.9 31.3 25 34.9 23.1 37.6 19.6 38.2 15.6 43.1 16.4 46.9 20.3 46.9 25 46.9 29.7 43.1 33.6 38.2 34.4Z"/></g></svg><span>Recommended</span></a></li><li><a href="/playlists/" class="t-queue-nav l0 nav-icn None"><?xml version="1.0" encoding="UTF-8"?><svg width="21px" height="17px" viewBox="0 0 21 17" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><!-- Generator: Sketch 46.2 (44496) - http://www.bohemiancoding.com/sketch --><title>icon_Playlist_sml</title><desc>Created with Sketch.</desc><defs></defs><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="icon_Playlist_sml" fill-rule="nonzero" fill="#000000"><g id="playlist-icon"><g id="Group-6"><rect id="Rectangle-path" x="5" y="0" width="16" height="3" rx="0.5"></rect><circle id="Oval" cx="1.5" cy="1.5" r="1.5"></circle></g><g id="Group-5" transform="translate(0.000000, 7.000000)"><circle id="Oval" cx="1.5" cy="1.5" r="1.5"></circle><rect id="Rectangle-path" x="5" y="0" width="16" height="3" rx="0.5"></rect></g><g id="Group-5-Copy" transform="translate(0.000000, 14.000000)"><circle id="Oval" cx="1.5" cy="1.5" r="1.5"></circle><rect id="Rectangle-path" x="5" y="0" width="16" height="3" rx="0.5"></rect></g></g></g></g></svg><span>
                 Playlists
              </span></a></li><li class="search"><a href="#" class="t-search-nav trigger nav-icn l0" data-dropdown-selector=".searchbox"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>search icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M31.3 0C20.9 0 12.5 8.4 12.5 18.8 12.5 22.5 13.6 25.9 15.4 28.8L1.2 42.9C-0.4 44.5-0.4 47.2 1.2 48.8 2 49.6 3.1 50 4.2 50 5.2 50 6.3 49.6 7.1 48.8L21.2 34.6C24.1 36.5 27.5 37.5 31.3 37.5 41.6 37.5 50 29.1 50 18.8 50 8.4 41.6 0 31.3 0ZM31.3 31.3C24.4 31.3 18.8 25.6 18.8 18.8 18.8 11.9 24.4 6.3 31.3 6.3 38.1 6.3 43.8 11.9 43.8 18.8 43.8 25.6 38.1 31.3 31.3 31.3Z"/></g></svg><span>Search</span></a></li><li class="usermenu dropdown"><a href="#" class="trigger l0 nav-icn nav-dropdown"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>navigation arrow</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M0.1 12.5L9.7 3.1C9.8 3 9.9 3 10 3 10.1 3 10.2 3 10.3 3.1L19.9 12.5C20 12.5 20 12.6 20 12.8 20 12.9 20 13 19.9 13L17 15.9C16.9 16 16.8 16 16.7 16 16.5 16 16.4 16 16.4 15.9L10 9.7 3.6 15.9C3.6 16 3.5 16 3.3 16 3.2 16 3.1 16 3 15.9L0.1 13C0 12.9 0 12.8 0 12.7 0 12.7 0 12.6 0.1 12.5Z"/></g></svg><span>Expand Nav</span></a><div class="drop-content"><ul><li><a href="/history/" class="t-recent-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>recent items icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 0C11.2 0 0 11.2 0 25 0 38.8 11.2 50 25 50 38.8 50 50 38.8 50 25 50 11.2 38.8 0 25 0ZM6.3 25C6.3 14.6 14.6 6.3 25 6.3 35.4 6.3 43.8 14.6 43.8 25 43.8 35.4 35.4 43.8 25 43.8 14.6 43.8 6.3 35.4 6.3 25ZM31.8 31.5C32.5 30.5 32.4 29.2 31.6 28.3L27.1 23.8 27.1 12.8C27.1 11.5 26.2 10.4 25 10.4 23.9 10.4 22.9 11.5 22.9 12.8L22.9 25.7 28.8 31.7C29.2 32.1 29.7 32.3 30.2 32.3 30.8 32.3 31.3 32 31.8 31.5Z"/></g></svg><span>History</span></a></li><li><a href="/topics" class="t-topics-link l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 55" width="20" height="20" version="1.1" fill="#4A3C31"><desc>topics icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 55L50 41.262 50 13.762 25 0 0 13.762 0 41.262 25 55ZM8.333 37.032L8.333 17.968 25 8.462 41.667 17.968 41.667 37.032 25 46.538 8.333 37.032Z"/></g></svg><span>Topics</span></a></li><li><a href="/tutorials/" class="l1 nav-icn t-tutorials-nav js-toggle-menu-item None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>tutorials icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M15.8 18.2C15.8 18.2 15.9 18.2 16 18.2 16.1 18.2 16.2 18.2 16.4 18.2 16.5 18.2 16.7 18.1 16.9 18 17 17.9 17.1 17.8 17.2 17.7 17.3 17.6 17.4 17.5 17.4 17.4 17.5 17.2 17.6 16.9 17.6 16.7 17.6 16.6 17.6 16.5 17.6 16.4 17.5 16.2 17.5 16.1 17.4 15.9 17.3 15.8 17.2 15.6 17 15.5 16.8 15.3 16.6 15.3 16.4 15.2 16.2 15.2 16 15.2 15.8 15.2 15.7 15.2 15.5 15.3 15.3 15.4 15.2 15.4 15.1 15.5 15 15.7 14.9 15.8 14.8 15.9 14.7 16 14.7 16.1 14.6 16.3 14.6 16.4 14.6 16.5 14.6 16.6 14.6 16.6 14.6 16.7 14.6 16.9 14.6 17 14.6 17.1 14.7 17.3 14.7 17.4 14.8 17.6 15 17.7 15.1 17.9 15.2 18 15.3 18 15.5 18.1 15.5 18.1 15.6 18.2 15.7 18.2 15.7 18.2 15.7 18.2 15.8 18.2L15.8 18.2ZM9.4 11.5C9.5 11.5 9.5 11.5 9.6 11.5 9.7 11.5 9.9 11.5 10 11.5 10.2 11.5 10.3 11.4 10.5 11.3 10.6 11.2 10.8 11.1 10.9 11 10.9 10.9 11 10.8 11.1 10.7 11.2 10.5 11.2 10.2 11.2 10 11.2 9.9 11.2 9.8 11.2 9.7 11.2 9.5 11.1 9.4 11 9.2 10.9 9.1 10.8 8.9 10.6 8.8 10.5 8.7 10.3 8.6 10 8.5 9.9 8.5 9.7 8.5 9.5 8.5 9.3 8.5 9.1 8.6 9 8.7 8.8 8.7 8.7 8.8 8.6 9 8.5 9.1 8.4 9.2 8.4 9.3 8.2 9.5 8.2 9.8 8.2 10 8.2 10.1 8.2 10.2 8.2 10.3 8.2 10.5 8.3 10.6 8.4 10.7 8.5 10.9 8.6 11.1 8.7 11.2 8.9 11.3 9 11.4 9.1 11.4 9.2 11.4 9.3 11.5 9.3 11.5 9.3 11.5 9.4 11.5 9.4 11.5L9.4 11.5ZM3 4.8C3.1 4.8 3.1 4.8 3.2 4.8 3.4 4.8 3.5 4.8 3.7 4.8 3.8 4.8 4 4.7 4.1 4.6 4.3 4.5 4.4 4.4 4.5 4.3 4.6 4.2 4.6 4.1 4.7 4 4.8 3.8 4.8 3.5 4.8 3.3 4.8 3.1 4.8 3 4.8 2.9 4.7 2.8 4.7 2.6 4.6 2.5 4.5 2.3 4.4 2.2 4.2 2.1 4 1.9 3.8 1.9 3.6 1.8 3.5 1.8 3.3 1.8 3.1 1.8 2.9 1.8 2.7 1.9 2.6 2 2.4 2.1 2.3 2.2 2.2 2.3 2.1 2.4 2 2.5 2 2.6 1.8 2.8 1.8 3 1.8 3.3 1.8 3.4 1.8 3.5 1.8 3.6 1.8 3.8 1.9 3.9 2 4 2.1 4.2 2.2 4.4 2.4 4.5 2.5 4.6 2.6 4.7 2.7 4.7 2.8 4.7 2.9 4.8 2.9 4.8 3 4.8 3 4.8 3 4.8L3 4.8ZM13.1 15.2C13.2 15.1 13.2 15.1 13.2 15.1 13.3 14.9 13.4 14.7 13.6 14.5 13.8 14.2 14.1 14 14.4 13.8 14.7 13.6 15.1 13.5 15.5 13.4 15.9 13.4 16.3 13.4 16.7 13.5 17.2 13.5 17.6 13.7 17.9 13.9 18.2 14.1 18.5 14.4 18.7 14.7 18.9 15 19.1 15.3 19.2 15.6 19.3 15.9 19.4 16.1 19.4 16.4 19.4 17 19.3 17.5 19.1 18.1 19 18.3 18.9 18.5 18.7 18.7 18.5 19 18.3 19.2 18 19.4 17.7 19.6 17.3 19.8 16.9 19.9 16.6 20 16.3 20 16 20 15.8 20 15.6 20 15.4 19.9 15.4 19.9 15.4 19.9 15.4 19.9 15.2 19.9 15 19.8 14.9 19.8 14.8 19.7 14.7 19.7 14.6 19.7 14.4 19.6 14.3 19.5 14.1 19.3 13.7 19.1 13.4 18.7 13.2 18.4 13.1 18.1 12.9 17.8 12.9 17.5 12.8 17.3 12.8 17.1 12.8 16.9L3.5 14.9C3.3 14.9 3.1 14.8 3 14.8 2.7 14.7 2.4 14.5 2.1 14.3 1.7 14 1.4 13.7 1.2 13.3 1 13 0.9 12.6 0.8 12.3 0.7 12 0.7 11.7 0.7 11.4 0.7 11 0.8 10.5 1 10.1 1.1 9.8 1.3 9.5 1.6 9.2 1.8 8.9 2.1 8.7 2.4 8.5 2.8 8.3 3.2 8.1 3.6 8.1 3.9 8 4.2 8 4.5 8 4.6 8 4.8 8 4.9 8.1L6.8 8.5C6.8 8.4 6.8 8.4 6.8 8.4 6.9 8.2 7.1 8 7.2 7.8 7.5 7.5 7.7 7.3 8 7.1 8.4 6.9 8.7 6.8 9.1 6.7 9.5 6.7 10 6.7 10.4 6.8 10.8 6.8 11.2 7 11.5 7.2 11.8 7.5 12.1 7.7 12.4 8 12.6 8.3 12.7 8.6 12.8 8.9 12.9 9.2 13 9.4 13 9.7 13 9.7 13 9.8 13 9.8 13.6 9.9 14.2 10.1 14.9 10.2 15 10.2 15 10.2 15.1 10.2 15.3 10.2 15.4 10.2 15.6 10.2 15.8 10.1 16 10 16.2 9.9 16.4 9.8 16.5 9.6 16.6 9.5 16.8 9.2 16.9 8.8 16.9 8.5 16.9 8.3 16.9 8.2 16.8 8 16.8 7.8 16.7 7.7 16.6 7.5 16.5 7.3 16.3 7.2 16.2 7.1 16 7 15.9 6.9 15.8 6.9 15.7 6.9 15.6 6.8 15.5 6.8L6.2 4.8C6.2 5 6 5.2 5.9 5.3 5.7 5.6 5.5 5.8 5.3 6 4.9 6.2 4.5 6.4 4.1 6.5 3.8 6.6 3.5 6.6 3.2 6.6 3 6.6 2.8 6.6 2.7 6.6 2.6 6.6 2.6 6.5 2.6 6.5 2.5 6.5 2.3 6.5 2.1 6.4 1.8 6.3 1.6 6.1 1.3 6 1 5.7 0.7 5.4 0.5 5 0.3 4.7 0.2 4.4 0.1 4.1 0 3.8 0 3.6 0 3.3 0 2.8 0.1 2.2 0.4 1.7 0.5 1.5 0.7 1.3 0.8 1.1 1.1 0.8 1.3 0.6 1.6 0.5 2 0.3 2.3 0.1 2.7 0.1 3.1 0 3.6 0 4 0.1 4.4 0.2 4.8 0.3 5.1 0.5 5.5 0.8 5.7 1 6 1.3 6.2 1.6 6.3 1.9 6.4 2.3 6.5 2.5 6.6 2.7 6.6 3 6.6 3 6.6 3.1 6.6 3.1 9.7 3.8 12.8 4.4 15.9 5.1 16.1 5.1 16.2 5.2 16.4 5.2 16.7 5.3 16.9 5.5 17.2 5.6 17.5 5.9 17.8 6.2 18.1 6.5 18.3 6.8 18.4 7.2 18.6 7.5 18.6 7.9 18.7 8.2 18.7 8.6 18.7 9 18.6 9.4 18.4 9.8 18.3 10.1 18.2 10.3 18 10.6 17.8 10.9 17.5 11.1 17.3 11.3 16.9 11.6 16.5 11.8 16 11.9 15.7 12 15.3 12 15 12 14.8 12 14.7 12 14.5 11.9 13.9 11.8 13.3 11.7 12.6 11.5 12.5 11.7 12.4 11.9 12.3 12 12.1 12.3 11.9 12.5 11.7 12.7 11.3 12.9 10.9 13.1 10.5 13.2 10.2 13.3 9.9 13.3 9.6 13.3 9.4 13.3 9.2 13.3 9 13.2 9 13.2 9 13.2 9 13.2 8.8 13.2 8.7 13.2 8.5 13.1 8.2 13 8 12.8 7.7 12.6 7.4 12.4 7.1 12 6.8 11.7 6.7 11.4 6.6 11.1 6.5 10.8 6.4 10.6 6.4 10.4 6.4 10.2 5.8 10.1 5.2 9.9 4.5 9.8 4.4 9.8 4.4 9.8 4.3 9.8 4.1 9.8 4 9.8 3.8 9.8 3.6 9.9 3.4 10 3.2 10.1 3 10.2 2.9 10.4 2.8 10.5 2.6 10.8 2.5 11.1 2.5 11.5 2.5 11.6 2.5 11.8 2.6 12 2.6 12.1 2.7 12.3 2.8 12.5 2.9 12.6 3.1 12.8 3.2 12.9 3.3 13 3.5 13.1 3.6 13.1 3.7 13.1 3.8 13.2 3.9 13.2L13.1 15.2 13.1 15.2Z"/></g></svg><span>Tutorials</span></a></li><li class="nav-offers flyout-parent"><a href="#" class="l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>offers icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M35.9 20.6L27 15.5C26.1 15 24.7 15 23.7 15.5L14.9 20.6C13.9 21.1 13.2 22.4 13.2 23.4L13.2 41.4C13.2 42.4 13.9 43.7 14.9 44.2L23.3 49C24.2 49.5 25.6 49.5 26.6 49L35.9 43.6C36.8 43.1 37.6 41.8 37.6 40.8L37.6 23.4C37.6 22.4 36.8 21.1 35.9 20.6L35.9 20.6ZM40 8.2C39.1 7.6 37.6 7.6 36.7 8.2L30.2 11.9C29.3 12.4 29.3 13.2 30.2 13.8L39.1 18.8C40 19.4 40.7 20.6 40.7 21.7L40.7 39C40.7 40.1 41.4 40.5 42.4 40L48.2 36.6C49.1 36.1 49.8 34.9 49.8 33.8L49.8 15.6C49.8 14.6 49.1 13.3 48.2 12.8L40 8.2 40 8.2ZM27 10.1L33.6 6.4C34.5 5.9 34.5 5 33.6 4.5L26.6 0.5C25.6 0 24.2 0 23.3 0.5L16.7 4.2C15.8 4.7 15.8 5.6 16.7 6.1L23.7 10.1C24.7 10.6 26.1 10.6 27 10.1ZM10.1 21.7C10.1 20.6 10.8 19.4 11.7 18.8L20.6 13.8C21.5 13.2 21.5 12.4 20.6 11.9L13.6 7.9C12.7 7.4 11.2 7.4 10.3 7.9L1.6 12.8C0.7 13.3 0 14.6 0 15.6L0 33.8C0 34.9 0.7 36.1 1.6 36.6L8.4 40.5C9.3 41 10.1 40.6 10.1 39.6L10.1 21.7 10.1 21.7Z"/></g></svg><span>Offers & Deals</span></a><ul class="flyout"><li><a href="https://get.oreilly.com/email-signup.html" target="_blank" class="l2 nav-icn"><span>Newsletters</span></a></li></ul></li><li class="nav-highlights"><a href="/u/fee1bd59-4e02-48a4-a7b4-152ec4c157ac/" class="t-highlights-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 35" width="20" height="20" version="1.1" fill="#4A3C31"><desc>highlights icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M13.325 18.071L8.036 18.071C8.036 11.335 12.36 7.146 22.5 5.594L22.5 0C6.37 1.113 0 10.632 0 22.113 0 29.406 3.477 35 10.403 35 15.545 35 19.578 31.485 19.578 26.184 19.578 21.556 17.211 18.891 13.325 18.071L13.325 18.071ZM40.825 18.071L35.565 18.071C35.565 11.335 39.86 7.146 50 5.594L50 0C33.899 1.113 27.5 10.632 27.5 22.113 27.5 29.406 30.977 35 37.932 35 43.045 35 47.078 31.485 47.078 26.184 47.078 21.556 44.74 18.891 40.825 18.071L40.825 18.071Z"/></g></svg><span>Highlights</span></a></li><li><a href="/u/" class="t-settings-nav l1 js-settings nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"/></g></svg><span>Settings</span></a></li><li><a href="https://www.safaribooksonline.com/public/support" class="l1 no-icon">Support</a></li><li><a href="/accounts/logout/" class="l1 no-icon">Sign Out</a></li></ul><ul class="profile"><li><a href="/u/" class="l2 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"/></g></svg><span>Settings</span></a><span class="l2 t-nag-notification"  id="nav-nag" ><strong class="trial-green">7</strong> days left in your trial.
  
  

  
    
      

<a class="" href="/subscribe/">Subscribe</a>.


    
  

  

</span></li><li><a href="https://www.safaribooksonline.com/public/support" class="l2">Support</a></li><li><a href="/accounts/logout/" class="l2">Sign Out</a></li></ul></div></li></ul></nav></header>


      </div>
      <div id="container" class="application">
        
          <div class="nav-container clearfix">
            


            
            
          </div>

          

  <div class="js-toc">
    
      <div class="sbo-reading-menu sbo-menu-top"><section class="sbo-toc-container toc-menu"><a href="#" class="sbo-toc-thumb"><span class="sbo-title ss-list"><h1><div class="visuallyhidden">Table of Contents for </div>
      
      Data Visualization with Python and JavaScript
      
    </h1></span></a><div class="toc-contents"></div></section></div>

    

    <div class="interface-controls interface-controls-top">
      <ul class="interface-control-btns js-bitlist js-reader">
        <li class="js-search-in-archive search-in-archive t-search-in-archive"><a href="#" title="Search in archive" class="js-search-controls search-controls"><span class="icon">Search in book...</span></a><form class="search-archive-bar js-search-form"><input type="search" name="query" placeholder="Search inside this book..." autocomplete="off"></form><div class="search-archive-results"><div class="js-sitb-results-region"></div></div></li><li class="queue-control"><div class="js-content-uri" data-content-uri="/api/v1/book/9781491920565/chapter/ch16.html"><div class="js-collections-dropdown collections-dropdown menu-bit-cards"></div></div></li><li class="js-font-control-panel font-control-activator"><a href="#" data-push-state="false" id="font-controls" title="Change font size" aria-label="Change font size"><span class="icon">Toggle Font Controls</span></a></li><li class="dropdown sharing-controls"><a href="#" class="trigger" data-push-state="false" title="Share" aria-label="Share"><i class="fa fa-share"></i></a><ul class="social-sharing dropdown-menu"><li><a
        class="twitter share-button t-twitter"
        target="_blank"
        aria-label="Share this section on Twitter"
        title="Share this section on Twitter"
      
        href="https://twitter.com/share?url=https://www.safaribooksonline.com/library/view/data-visualization-with/9781491920565/ch16.html&text=Data%20Visualization%20with%20Python%20and%20JavaScript&via=safari"
      ><span>Twitter</span></a></li><li><a
        class="facebook share-button t-facebook"
        target="_blank"
        aria-label="Share this section on Facebook"
        title="Share this section on Facebook"
        href="https://www.facebook.com/sharer/sharer.php?u=https://www.safaribooksonline.com/library/view/data-visualization-with/9781491920565/ch16.html"
      ><span>Facebook</span></a></li><li><a
        class="googleplus share-button t-googleplus"
        target="_blank"
        aria-label="Share this secton on Google Plus"
        title="Share this secton on Google Plus"
        href="https://plus.google.com/share?url=https://www.safaribooksonline.com/library/view/data-visualization-with/9781491920565/ch16.html"
      ><span>Google Plus</span></a></li><li><a
        class="email share-button t-email"
        aria-label="Share this section via email"
        title="Share this section via email"
      
        href="mailto:?subject=Safari: 16.%20Introducing%20D3%E2%80%94The%20Story%20of%20a%20Bar%20Chart&body=https://www.safaribooksonline.com/library/view/data-visualization-with/9781491920565/ch16.html%0D%0Afrom Data%20Visualization%20with%20Python%20and%20JavaScript%0D%0A"
      ><span>Email</span></a></li></ul></li>
      </ul>
    </div>

    <section role="document">
        
        



 <!--[if lt IE 9]>
  
<![endif]-->



  <script defer src="/static/js/build/djangoMessagesPage.893631b34e7a.js"></script>


        
	  <div class="t-sbo-prev sbo-prev sbo-nav-top">
  
    
      
        <a href="/library/view/data-visualization-with/9781491920565/ch15.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">15. Building a Visualization</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-top">
  
    
      
        <a href="/library/view/data-visualization-with/9781491920565/ch17.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">17. Visualizing Individual Prizes</div>
        </a>
    
  
  </div>



<div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 16. Introducing D3—The Story of a Bar Chart"><div class="chapter" id="chapter_d3_intro">
<h1><span class="label">Chapter 16. </span>Introducing D3—The Story of a Bar Chart</h1>


<p><a data-type="indexterm" data-primary="bar charts, planning for" data-see="also D3 library" id="idm140319398987760"></a>In <a data-type="xref" href="ch15.html#chapter_building_viz">Chapter 15</a> we imagined our Nobel Prize visualization by breaking it into component elements. In this chapter, I will gently introduce you to D3 by showing you how to build the bar chart we need (<a data-type="xref" href="#target_barchart">Figure 16-1</a>).</p>

<figure><div id="target_barchart" class="figure">
<img src="dvpj_1405.png" alt="dvpj 1405" width="698" height="250">
<h6><span class="label">Figure 16-1. </span>This chapter’s target bar chart</h6>
</div></figure>

<p><a data-type="indexterm" data-primary="D3 library" data-secondary="benefits of" id="idm140319398982496"></a>D3 is much more than a charting library. It’s a library you use to build charting libraries, among other things. So why am I introducing you to D3 by way of that ultra-conventional visualization, the bar chart? First, because there should be a little thrill in crafting one from scratch for the first time, having total control over the look and feel of the chart and being unconstrained by whatever prejudices a particular charting library has. And second, because it just happens to be a great way to cover the fundamental elements of D3, particularly data binding and the enter-exit-remove update pattern. If you get those fundamentals in place, you’re well on your way to employing the full power and expressivity D3 offers, and producing something more novel than a bar chart.</p>

<p>We’ll be using some of the webdev covered in <a data-type="xref" href="ch04.html#chapter_webdev101">Chapter 4</a>, particularly the SVG graphics that are D3’s specialty (see <a data-type="xref" href="ch04.html#sect_svg">“Scalable Vector Graphics”</a>). I recommend using the fantastic, purpose-built D3 site <a href="http://blockbuilder.org/">blockbuilder.org</a> to try out some of the code snippets.</p>

<p>Before we begin building the bar chart, let’s consider its elements.</p>






<section data-type="sect1" data-pdf-bookmark="Framing the Problem"><div class="sect1" id="idm140319398977248">
<h1>Framing the Problem</h1>

<p><a data-type="indexterm" data-primary="D3 library" data-secondary="bar charts" data-tertiary="key components" id="idm140319398975728"></a>A bar chart has three key components: the axes, legends and labels, and, of course, the bars. As we’re producing a modern, interactive bar chart component, we’ll need the axes and bars to transform in response to user interaction—namely, filtering the set of prize winners via the top selectors (see <a data-type="xref" href="ch14.html#imagine_ui">Figure 14-1</a>).</p>

<p>We’ll build the chart one step at a time, ending with D3 transitions, which can make your D3 creations more engaging and attractive.  But first we’ll cover the basics of D3:</p>

<ul>
<li>
<p>Selecting DOM elements in your web page</p>
</li>
<li>
<p>Getting and setting their attributes, properties, and styles</p>
</li>
<li>
<p>Appending and inserting DOM elements</p>
</li>
</ul>

<p>With these basics firmly in place, we’ll move on to the joys of data binding, where D3 begins to flex its muscles.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Working with Selections"><div class="sect1" id="idm140319398968736">
<h1>Working with Selections</h1>

<p><a data-type="indexterm" data-primary="D3 library" data-secondary="working with selections" id="D3select16"></a><a data-type="indexterm" data-primary="selections (D3 library)" id="selectD16"></a>Selections are the backbone of D3. Using jQuery-like CSS selectors, D3 can select and manipulate individual and grouped DOM elements. All D3 chained operations begin by selecting a DOM element or set of elements using the <code>select</code> and <code>selectAll</code> methods. <code>select</code> returns the first matching element; <code>selectAll</code> returns the set of matching elements.</p>

<p><a data-type="xref" href="#d3bar_selections">Figure 16-2</a> shows some example of D3 selections, using the <code>select</code> and <code>selectAll</code> methods. These selections are used to change the <code>height</code> attribute of one or more bars. The <code>select</code> method returns the first <code>rect</code> (id <code>barL</code>) with class <code>bar</code>, whereas <code>selectAll</code> can return any combination of the <code>rect</code>s depending on the query provided.</p>

<figure><div id="d3bar_selections" class="figure">
<img src="dvpj_1602.png" alt="dvpj 1602" width="1097" height="1383">
<h6><span class="label">Figure 16-2. </span>Selecting elements and changing attributes: three rectangles are built with the initial HTML. Selections are then made and the height attributes of one or more bar adjusted.</h6>
</div></figure>

<p><a data-type="indexterm" data-primary="CSS (Cascading Style Sheets)" data-secondary="applying with D3 library" id="CSS16"></a>In addition to setting attributes (the named strings on the DOM elements; e.g., <code>id</code> or <code>class</code>), D3 allows you to set elements’ CSS styles, properties (e.g., whether a checkbox is checked), text, and HTML.</p>

<p><a data-type="xref" href="#d3bar_selects">Figure 16-3</a> shows all the ways in which a DOM element can be changed with D3. With these few methods, you can achieve pretty much any look and feel you want.</p>

<figure><div id="d3bar_selects" class="figure">
<img src="dvpj_1603.png" alt="dvpj 1603" width="500" height="83">
<h6><span class="label">Figure 16-3. </span>Changing a DOM element with D3</h6>
</div></figure>

<p><a data-type="xref" href="#d3bar_setting_bar">Figure 16-4</a> shows how we can apply CSS styling by adding a class to the element or directly setting a style. We first select the middle bar using its id <code>barM</code>. The <code>classed</code> method is then used to apply a yellow highlight (see the CSS) and the <code>height</code> attribute set to 50 px. The <code>style</code> method is then used to apply a red fill to the bar directly.</p>

<figure><div id="d3bar_setting_bar" class="figure">
<img src="dvpj_1604.png" alt="dvpj 1604" width="487" height="144">
<h6><span class="label">Figure 16-4. </span>Setting attributes and style</h6>
</div></figure>

<p>D3’s <code>text</code> method sets the text content of applicable DOM tags, such as <code>div</code>, <code>p</code>, <code>h*</code> headers, and SVG text elements. To see the <code>text</code> method in action, let’s create a little title placeholder with some HTML:</p>

<pre data-type="programlisting" data-code-language="html"><code class="cp">&lt;!DOCTYPE html&gt;</code>
<code class="nt">&lt;meta</code> <code class="na">charset=</code><code class="s">"utf-8"</code><code class="nt">&gt;</code>

<code class="nt">&lt;body&gt;</code>
  <code class="nt">&lt;h2&gt;</code>title holder<code class="nt">&lt;/h2&gt;</code>
<code class="nt">&lt;/body&gt;</code></pre>

<p><a data-type="xref" href="#d3bar_text">Figure 16-5</a> (before) shows the resulting browser page.</p>

<p class="pagebreak-before">Now let’s create a <code>fancy-title</code> CSS class with a large, bold font:</p>

<pre data-type="programlisting" data-code-language="css"><code class="nc">.fancy-title</code> <code class="p">{</code>
    <code class="k">font-size</code><code class="o">:</code> <code class="m">24px</code><code class="p">;</code>
    <code class="k">font-weight</code><code class="o">:</code> <code class="nb">bold</code><code class="p">;</code>
<code class="p">}</code></pre>

<p>We can now use D3 to select the title header, add the <code>fancy-title</code> class to it, and then set its text to My Bar Chart:</p>

<pre data-type="programlisting" data-code-language="js"><code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s1">'#title#)</code>
<code class="s1">  .classed('</code><code class="nx">fancy</code><code class="o">-</code><code class="nx">title</code><code class="s1">', true)</code>
<code class="s1">  .text('</code><code class="nx">My</code> <code class="nx">Bar</code> <code class="nx">Chart</code><code class="err">'</code><code class="p">);</code></pre>

<p><a data-type="xref" href="#d3bar_text">Figure 16-5</a> (after) shows the resulting enlarged and emboldened title.</p>

<figure><div id="d3bar_text" class="figure">
<img src="dvpj_1605.png" alt="dvpj 1605" width="781" height="160">
<h6><span class="label">Figure 16-5. </span>Setting text and style with D3</h6>
</div></figure>

<p>In addition to setting the properties of DOM elements, we can use selections to get those properties. Leaving out the second argument to one of the methods listed in <a data-type="xref" href="#d3bar_selects">Figure 16-3</a> allows you to get information about the web page’s setup.</p>

<p><a data-type="xref" href="#d3bar_getter_bar">Figure 16-6</a> shows how to get the key properties from an SVG rectangle. As we’ll see, getting attributes like <code>width</code> and <code>height</code> from an SVG element can be very useful for programmatic adaptation and adjustment.</p>

<figure><div id="d3bar_getter_bar" class="figure">
<img src="dvpj_1606.png" alt="dvpj 1606" width="907" height="277">
<h6><span class="label">Figure 16-6. </span>Getting a rect bar’s details</h6>
</div></figure>

<p><a data-type="xref" href="#d3bar_getter_text">Figure 16-7</a> demonstrates the <code>html</code> and <code>text</code> getter methods. After creating a little list (id <code>silly-list</code>), we use D3 to select it and get various properties.  The <code>html</code> method returns the HTML of the list’s child <code>&lt;li&gt;</code> tags, while the <code>text</code> method returns the text contained in the list, with the HTML tags stripped. Note that for parent tags, the formatting of any text returned is a little messy, but maybe good enough for a string search or two.</p>

<figure><div id="d3bar_getter_text" class="figure">
<img src="dvpj_1607.png" alt="dvpj 1607" width="788" height="359">
<h6><span class="label">Figure 16-7. </span>Getting HTML and text from a list tag</h6>
</div></figure>

<p>So far we’ve been manipulating the attributes, styles, and properties of existing DOM elements. This is a useful skill, but D3 comes into its own when we start creating DOM elements programmatically using its <code>append</code> and <code>insert</code> methods. Let’s look at these now.<a data-type="indexterm" data-primary="" data-startref="D3select16" id="idm140319398773680"></a><a data-type="indexterm" data-primary="" data-startref="selectD16" id="idm140319398772704"></a><a data-type="indexterm" data-primary="" data-startref="CSS16" id="idm140319398771760"></a></p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Adding DOM Elements"><div class="sect1" id="idm140319398967792">
<h1>Adding DOM Elements</h1>

<p><a data-type="indexterm" data-primary="D3 library" data-secondary="bar charts" data-tertiary="adding DOM elements" id="D3barDOM16"></a><a data-type="indexterm" data-primary="Document Object Model (DOM)" id="DOM16"></a><a data-type="indexterm" data-primary="elements" data-secondary="appending/inserting" id="idm140319398766752"></a>We’ve seen how to select  and manipulate the attributes, styles, and properties of DOM elements. Now we’ll see how D3 allows us to append and insert elements, programmatically adapting the DOM tree.</p>

<p>We’ll start with a little HTML skeleton containing a <code>nobel-bar</code> placeholder:</p>

<pre data-type="programlisting" data-code-language="html"><code class="cp">&lt;!DOCTYPE html&gt;</code><code>
</code><code class="nt">&lt;meta</code><code> </code><code class="na">charset=</code><code class="s">"utf-8"</code><code class="nt">&gt;</code><code>
</code><code class="nt">&lt;link</code><code> </code><code class="na">rel=</code><code class="s">"stylesheet"</code><code> </code><code class="na">href=</code><code class="s">"style.css"</code><code> </code><code class="nt">/&gt;</code><code>

</code><code class="nt">&lt;body</code><code class="nt">&gt;</code><code>
  </code><code class="nt">&lt;div</code><code> </code><code class="na">id=</code><code class="s">'nobel-bar'</code><code class="nt">&gt;</code><code class="nt">&lt;/div&gt;</code><code>

  </code><code class="nt">&lt;script
    </code><code class="na">src=</code><code class="s">"https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16
    /d3.js"</code><code class="nt">&gt;</code><code>
  </code><code class="nt">&lt;/script&gt;</code><code>
  </code><code class="nt">&lt;script </code><code class="na">type=</code><code class="s">"text/javascript"</code><code> </code><code class="na">src=</code><code class="s">"script.js"</code><code class="nt">&gt;</code><code class="nt">&lt;/script&gt;</code><code> </code><a class="co" id="co_introducing_d3__8212_the_story_of_a_bar_chart_CO1-1" href="#callout_introducing_d3__8212_the_story_of_a_bar_chart_CO1-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
</code><code class="nt">&lt;/body&gt;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_introducing_d3__8212_the_story_of_a_bar_chart_CO1-1" href="#co_introducing_d3__8212_the_story_of_a_bar_chart_CO1-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>The <em>script.js</em> file is where we’ll add our bar chart’s JavaScript code.</p></dd>
</dl>

<p>Let’s set the size of the <code>nobel-bar</code> element with a little CSS, placed in <em>style.css</em>:</p>

<pre data-type="programlisting" data-code-language="css"><code class="nf">#nobel-bar</code> <code class="p">{</code>
  <code class="k">width</code><code class="o">:</code> <code class="m">600px</code><code class="p">;</code>
  <code class="k">height</code><code class="o">:</code> <code class="m">400px</code><code class="p">;</code>
<code class="p">}</code></pre>

<p><a data-type="indexterm" data-primary="SVG (Scalable Vector Graphics)" data-secondary="providing SVG frames" id="idm140319398758208"></a><a data-type="indexterm" data-primary="append method (D3 library)" id="idm140319398757136"></a>Usually the first thing one does when creating a chart with D3 is to provide an SVG frame for it. This involves appending an <code>&lt;svg&gt;</code> canvas element to a <code>div</code> chartholder and then appending a <code>&lt;g&gt;</code> group to the <code>&lt;svg&gt;</code> to hold specific chart elements (in our case, the chart bars). This group has margins to accommodate axes, axes labels, and titles.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm140319398713088">
<h5>Getting the Dimensions of an Element</h5>
<p><a data-type="indexterm" data-primary="elements" data-secondary="getting dimensions of" id="idm140319398711840"></a><a data-type="indexterm" data-primary="dimensions" id="idm140319398710864"></a><a data-type="indexterm" data-primary="size" id="idm140319398710192"></a>It’s very common when programming in D3, or any other JavaScript visualization library, to require the width and height of an SVG or HTML element to use as the basis for setting the size of component elements. One way of doing this is to use D3’s <code>style</code> component to grab the CSS dimensions and then use the <code>parseInt</code> function to get an integer value:</p>

<pre data-type="programlisting" data-code-language="js"><code class="cm">/* CSS: #nobel-bar { width: 600px }; */</code><code>

</code><code class="kd">var</code><code> </code><code class="nx">width</code><code> </code><code class="o">=</code><code> </code><code class="nb">parseInt</code><code class="p">(</code><code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s1">'#nobel-bar'</code><code class="p">)</code><code>
                       </code><code class="p">.</code><code class="nx">style</code><code class="p">(</code><code class="s1">'width'</code><code class="p">)</code><code class="p">,</code><code> </code><code class="mi">10</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" id="co_introducing_d3__8212_the_story_of_a_bar_chart_CO2-1" href="#callout_introducing_d3__8212_the_story_of_a_bar_chart_CO2-1"><img src="1.png" alt="1" width="12" height="12"></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_introducing_d3__8212_the_story_of_a_bar_chart_CO2-1" href="#co_introducing_d3__8212_the_story_of_a_bar_chart_CO2-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>The result of calling the <code>style</code> method is the string <code>'600px'</code>, which we can convert to the number 600 using the <code>parseInt</code> function.</p></dd>
</dl>

<p>This method works pretty well as a rule, although the <code>parseInt</code> feels a bit hacky, turning the string <code>'600px'</code> into the number 600.</p>

<p>Arguably, a better, more robust approach is to get the dimensions of the bounding box of the HTML or SVG element in question. These give both the width, height, and relative position of the element, using the <code>node</code> method to get the DOM element.</p>

<pre data-type="programlisting" data-code-language="js"><code class="c1">// For an HTML element, starting with the D3 +ele+ selection</code>
<code class="kd">var</code> <code class="nx">bRect</code> <code class="o">=</code> <code class="nx">ele</code><code class="p">.</code><code class="nx">node</code><code class="p">().</code><code class="nx">getBoundingClientRect</code><code class="p">();</code>
<code class="c1">// e.g., bRect is {width: 600, height: 400, ... }</code>
<code class="c1">// For an SVG element use the getBBox method:</code>
<code class="kd">var</code> <code class="nx">bBox</code> <code class="o">=</code> <code class="nx">eleSVG</code><code class="p">.</code><code class="nx">node</code><code class="p">().</code><code class="nx">getBBox</code><code class="p">();</code>
<code class="c1">// e.g., bBox is {width: 600, height: 400, x: 100, y: 100}</code></pre>
</div></aside>

<p>Conventionally, you will specify the margin of your chart in a <code>margin</code> object and then use that and the CSS-specified width and height of the chart container to derive the width and height of your chart group. The required JavaScript looks like <a data-type="xref" href="#d3bar_dimensions_code">Example 16-1</a>.</p>
<div id="d3bar_dimensions_code" data-type="example">
<h5><span class="label">Example 16-1. </span>Getting our bar chart’s dimensions</h5>

<pre data-type="programlisting" data-code-language="js"><code>    </code><code class="kd">var</code><code> </code><code class="nx">chartHolder</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s2">"#nobel-bar"</code><code class="p">)</code><code class="p">;</code><code>

    </code><code class="kd">var</code><code> </code><code class="nx">margin</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code class="nx">top</code><code class="o">:</code><code class="mi">20</code><code class="p">,</code><code> </code><code class="nx">right</code><code class="o">:</code><code class="mi">20</code><code class="p">,</code><code> </code><code class="nx">bottom</code><code class="o">:</code><code class="mi">30</code><code class="p">,</code><code> </code><code class="nx">left</code><code class="o">:</code><code class="mi">40</code><code class="p">}</code><code class="p">;</code><code>

    </code><code class="kd">var</code><code> </code><code class="nx">boundingRect</code><code> </code><code class="o">=</code><code> </code><code class="nx">chartHolder</code><code class="p">.</code><code class="nx">node</code><code class="p">(</code><code class="p">)</code><code>
      </code><code class="p">.</code><code class="nx">getBoundingClientRect</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" id="co_introducing_d3__8212_the_story_of_a_bar_chart_CO3-1" href="#callout_introducing_d3__8212_the_story_of_a_bar_chart_CO3-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
    </code><code class="kd">var</code><code> </code><code class="nx">width</code><code> </code><code class="o">=</code><code> </code><code class="nx">boundingRect</code><code class="p">.</code><code class="nx">width</code><code> </code><code class="o">-</code><code> </code><code class="nx">margin</code><code class="p">.</code><code class="nx">left</code><code> </code><code class="o">-</code><code> </code><code class="nx">margin</code><code class="p">.</code><code class="nx">right</code><code class="p">,</code><code>
    </code><code class="nx">height</code><code> </code><code class="o">=</code><code> </code><code class="nx">boundingRect</code><code class="p">.</code><code class="nx">height</code><code> </code><code class="o">-</code><code> </code><code class="nx">margin</code><code class="p">.</code><code class="nx">top</code><code> </code><code class="o">-</code><code> </code><code class="nx">margin</code><code class="p">.</code><code class="nx">bottom</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_introducing_d3__8212_the_story_of_a_bar_chart_CO3-1" href="#co_introducing_d3__8212_the_story_of_a_bar_chart_CO3-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>Gets the bounding rectangle for our Nobel bar chart’s panel, using it to set the width and height of its bar container group.</p></dd>
</dl></div>

<p>With the width and height of our bar group in hand, we use D3 to build our chart’s frame, appending the required <code>&lt;svg&gt;</code> and <code>&lt;g&gt;</code> tags and specifying the size of the SVG canvas and translation of the bar group:</p>

<pre data-type="programlisting" data-code-language="js"><code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s1">'#nobel-bar'</code><code class="p">).</code><code class="nx">append</code><code class="p">(</code><code class="s2">"svg"</code><code class="p">)</code>
    <code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"width"</code><code class="p">,</code> <code class="nx">width</code> <code class="o">+</code> <code class="nx">margin</code><code class="p">.</code><code class="nx">left</code> <code class="o">+</code> <code class="nx">margin</code><code class="p">.</code><code class="nx">right</code><code class="p">)</code>
    <code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"height"</code><code class="p">,</code> <code class="nx">height</code> <code class="o">+</code> <code class="nx">margin</code><code class="p">.</code><code class="nx">top</code> <code class="o">+</code> <code class="nx">margin</code><code class="p">.</code><code class="nx">bottom</code><code class="p">)</code>
    <code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s2">"g"</code><code class="p">).</code><code class="nx">classed</code><code class="p">(</code><code class="s1">'chart'</code><code class="p">,</code> <code class="kc">true</code><code class="p">)</code>
    <code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"transform"</code><code class="p">,</code> <code class="s2">"translate("</code> <code class="o">+</code> <code class="nx">margin</code><code class="p">.</code><code class="nx">left</code> <code class="o">+</code> <code class="s2">","</code>
                                  <code class="o">+</code> <code class="nx">margin</code><code class="p">.</code><code class="nx">top</code> <code class="o">+</code> <code class="s2">")"</code><code class="p">);</code></pre>

<p>This changes the HTML of the <code>nobel-bar</code> content block:</p>

<pre data-type="programlisting" data-code-language="html">...
    <code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"nobel-bar"</code><code class="nt">&gt;</code>
      <code class="nt">&lt;svg</code> <code class="na">width=</code><code class="s">"600"</code> <code class="na">height=</code><code class="s">"400"</code><code class="nt">&gt;</code>
        <code class="nt">&lt;g</code> <code class="na">class=</code><code class="s">"chart"</code> <code class="na">transform=</code><code class="s">"translate(40, 20)"</code><code class="nt">&gt;&lt;/g&gt;</code>
      <code class="nt">&lt;/svg&gt;</code>
    <code class="nt">&lt;/div&gt;</code>
...</pre>

<p>The resulting SVG framework is shown in <a data-type="xref" href="#d3bar_frame">Figure 16-8</a>.  The <code>&lt;svg&gt;</code> element’s width and height are the sum of its child group and the surrounding margins. The child group is offset using <code>transform</code> to translate it <code>margin.left</code> pixels to the right and <code>margin.top</code> pixels down (by SVG convention, in the positive y direction).</p>

<figure><div id="d3bar_frame" class="figure">
<img src="dvpj_1608.png" alt="dvpj 1608" width="855" height="348">
<h6><span class="label">Figure 16-8. </span>Building our bar chart’s frame</h6>
</div></figure>

<p>With our frame in place, let’s use <code>append</code> to add a few bars. We’ll use a little dummy data: an array of objects with the top slice of Nobel Prize–winning countries by prize number.</p>

<pre data-type="programlisting" data-code-language="js"><code class="kd">var</code> <code class="nx">nobelData</code> <code class="o">=</code> <code class="p">[</code>
    <code class="p">{</code><code class="nx">key</code><code class="o">:</code><code class="s1">'United States'</code><code class="p">,</code> <code class="nx">value</code><code class="o">:</code><code class="mi">336</code><code class="p">},</code>
    <code class="p">{</code><code class="nx">key</code><code class="o">:</code><code class="s1">'United Kingdom'</code><code class="p">,</code> <code class="nx">value</code><code class="o">:</code><code class="mi">98</code><code class="p">},</code>
    <code class="p">{</code><code class="nx">key</code><code class="o">:</code><code class="s1">'Germany'</code><code class="p">,</code> <code class="nx">value</code><code class="o">:</code><code class="mi">79</code><code class="p">},</code>
    <code class="p">{</code><code class="nx">key</code><code class="o">:</code><code class="s1">'France'</code><code class="p">,</code> <code class="nx">value</code><code class="o">:</code><code class="mi">60</code><code class="p">},</code>
    <code class="p">{</code><code class="nx">key</code><code class="o">:</code><code class="s1">'Sweden'</code><code class="p">,</code> <code class="nx">value</code><code class="o">:</code><code class="mi">29</code><code class="p">},</code>
    <code class="p">{</code><code class="nx">key</code><code class="o">:</code><code class="s1">'Switzerland'</code><code class="p">,</code> <code class="nx">value</code><code class="o">:</code><code class="mi">23</code><code class="p">},</code>
    <code class="p">{</code><code class="nx">key</code><code class="o">:</code><code class="s1">'Japan'</code><code class="p">,</code> <code class="nx">value</code><code class="o">:</code><code class="mi">21</code><code class="p">},</code>
    <code class="p">{</code><code class="nx">key</code><code class="o">:</code><code class="s1">'Russia'</code><code class="p">,</code> <code class="nx">value</code><code class="o">:</code><code class="mi">19</code><code class="p">},</code>
    <code class="p">{</code><code class="nx">key</code><code class="o">:</code><code class="s1">'Netherlands'</code><code class="p">,</code> <code class="nx">value</code><code class="o">:</code><code class="mi">17</code><code class="p">},</code>
    <code class="p">{</code><code class="nx">key</code><code class="o">:</code><code class="s1">'Austria'</code><code class="p">,</code> <code class="nx">value</code><code class="o">:</code><code class="mi">14</code><code class="p">}</code>
<code class="p">];</code></pre>

<p>To build a crude bar chart,<sup><a data-type="noteref" id="idm140319398340448-marker" href="ch16.html#idm140319398340448">1</a></sup> we can iterate through the <code>nobelData</code> array, appending a bar to the chart group as we go. <a data-type="xref" href="#d3bar_10bars_crude_code">Example 16-2</a> demonstrates this. After building a basic frame for our chart, we iterate through the <code>nobelData</code> array, using the <code>value</code> fields to set the bar’s height and y-position. <a data-type="xref" href="#d3bar_10bars">Figure 16-9</a> shows how the object values are used to append bars to our chart group. Note that because SVG uses a downward y-axis, you have to displace the bars by the height of the bar chart minus that of the bar in order to put the bar chart the right way up. As we’ll see later, by using D3’s scales, we can limit such geometric bookkeeping.</p>
<div id="d3bar_10bars_crude_code" data-type="example">
<h5><span class="label">Example 16-2. </span>Building a crude bar chart with <code>append</code></h5>

<pre data-type="programlisting" data-code-language="javascript"><code class="kd">var</code><code> </code><code class="nx">buildCrudeBarchart</code><code> </code><code class="o">=</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="p">)</code><code> </code><code class="p">{</code><code>

    </code><code class="kd">var</code><code> </code><code class="nx">chartHolder</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s2">"#nobel-bar"</code><code class="p">)</code><code class="p">;</code><code>

    </code><code class="kd">var</code><code> </code><code class="nx">margin</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code class="nx">top</code><code class="o">:</code><code class="mi">20</code><code class="p">,</code><code> </code><code class="nx">right</code><code class="o">:</code><code class="mi">20</code><code class="p">,</code><code> </code><code class="nx">bottom</code><code class="o">:</code><code class="mi">30</code><code class="p">,</code><code> </code><code class="nx">left</code><code class="o">:</code><code class="mi">40</code><code class="p">}</code><code class="p">;</code><code>
    </code><code class="kd">var</code><code> </code><code class="nx">boundingRect</code><code> </code><code class="o">=</code><code> </code><code class="nx">chartHolder</code><code class="p">.</code><code class="nx">node</code><code class="p">(</code><code class="p">)</code><code class="p">.</code><code class="nx">getBoundingClientRect</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code>
    </code><code class="kd">var</code><code> </code><code class="nx">width</code><code> </code><code class="o">=</code><code> </code><code class="nx">boundingRect</code><code class="p">.</code><code class="nx">width</code><code> </code><code class="o">-</code><code> </code><code class="nx">margin</code><code class="p">.</code><code class="nx">left</code><code> </code><code class="o">-</code><code> </code><code class="nx">margin</code><code class="p">.</code><code class="nx">right</code><code class="p">,</code><code>
    </code><code class="nx">height</code><code> </code><code class="o">=</code><code> </code><code class="nx">boundingRect</code><code class="p">.</code><code class="nx">height</code><code> </code><code class="o">-</code><code> </code><code class="nx">margin</code><code class="p">.</code><code class="nx">top</code><code> </code><code class="o">-</code><code> </code><code class="nx">margin</code><code class="p">.</code><code class="nx">bottom</code><code class="p">;</code><code>
    </code><code class="kd">var</code><code> </code><code class="nx">barWidth</code><code> </code><code class="o">=</code><code> </code><code class="nx">width</code><code class="o">/</code><code class="nx">nobelData</code><code class="p">.</code><code class="nx">length</code><code class="p">;</code><code>

    </code><code class="kd">var</code><code> </code><code class="nx">svg</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s1">'#nobel-bar'</code><code class="p">)</code><code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s2">"svg"</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"width"</code><code class="p">,</code><code> </code><code class="nx">width</code><code> </code><code class="o">+</code><code> </code><code class="nx">margin</code><code class="p">.</code><code class="nx">left</code><code> </code><code class="o">+</code><code> </code><code class="nx">margin</code><code class="p">.</code><code class="nx">right</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"height"</code><code class="p">,</code><code> </code><code class="nx">height</code><code> </code><code class="o">+</code><code> </code><code class="nx">margin</code><code class="p">.</code><code class="nx">top</code><code> </code><code class="o">+</code><code> </code><code class="nx">margin</code><code class="p">.</code><code class="nx">bottom</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s2">"g"</code><code class="p">)</code><code class="p">.</code><code class="nx">classed</code><code class="p">(</code><code class="s1">'chart'</code><code class="p">,</code><code> </code><code class="kc">true</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"transform"</code><code class="p">,</code><code> </code><code class="s2">"translate("</code><code> </code><code class="o">+</code><code> </code><code class="nx">margin</code><code class="p">.</code><code class="nx">left</code><code> </code><code class="o">+</code><code> </code><code class="s2">","</code><code>
        </code><code class="o">+</code><code> </code><code class="nx">margin</code><code class="p">.</code><code class="nx">top</code><code> </code><code class="o">+</code><code> </code><code class="s2">")"</code><code class="p">)</code><code class="p">;</code><code>

    </code><code class="nx">nobelData</code><code class="p">.</code><code class="nx">forEach</code><code class="p">(</code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">,</code><code> </code><code class="nx">i</code><code class="p">)</code><code> </code><code class="p">{</code><code> </code><a class="co" id="co_introducing_d3__8212_the_story_of_a_bar_chart_CO4-1" href="#callout_introducing_d3__8212_the_story_of_a_bar_chart_CO4-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
        </code><code class="nx">svg</code><code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s1">'rect'</code><code class="p">)</code><code class="p">.</code><code class="nx">classed</code><code class="p">(</code><code class="s1">'bar'</code><code class="p">,</code><code> </code><code class="kc">true</code><code class="p">)</code><code>
            </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s1">'height'</code><code class="p">,</code><code> </code><code class="nx">d</code><code class="p">.</code><code class="nx">value</code><code class="p">)</code><code>
            </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s1">'width'</code><code class="p">,</code><code> </code><code class="nx">barWidth</code><code class="p">)</code><code>
            </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s1">'y'</code><code class="p">,</code><code> </code><code class="nx">height</code><code class="o">-</code><code class="nx">d</code><code class="p">.</code><code class="nx">value</code><code class="p">)</code><code>
            </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s1">'x'</code><code class="p">,</code><code> </code><code class="nx">i</code><code class="o">*</code><code class="p">(</code><code class="nx">barWidth</code><code class="p">)</code><code class="p">)</code><code class="p">;</code><code>
    </code><code class="p">}</code><code class="p">)</code><code class="p">;</code><code>
</code><code class="p">}</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_introducing_d3__8212_the_story_of_a_bar_chart_CO4-1" href="#co_introducing_d3__8212_the_story_of_a_bar_chart_CO4-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>Iterates through each of the objects in <code>nobelData</code>, the <code>forEach</code> method providing object and array index to an anonymous function.</p></dd>
</dl></div>

<figure><div id="d3bar_10bars" class="figure">
<img src="dvpj_1609.png" alt="dvpj 1609" width="1565" height="840">
<h6><span class="label">Figure 16-9. </span>Programming a basic bar chart with D3</h6>
</div></figure>

<p><a data-type="indexterm" data-primary="insert method (D3 library)" id="idm140319397680240"></a>The other way in which D3 can add elements to the DOM tree is with its <code>insert</code> method. <code>insert</code> works like <code>append</code> but adds a second selector argument to allow you to place elements before a particular position in an sequence of tags, such as at the beginning of an ordered list. <a data-type="xref" href="#d3bar_insert">Figure 16-10</a> demonstrates the use of <code>insert</code>: list items in the <code>silly-list</code> are selected just like <code>append</code> and then a second argument (e.g., <code>':first-child'</code>) specifies the element to insert before.</p>

<figure><div id="d3bar_insert" class="figure">
<img src="dvpj_1610.png" alt="dvpj 1610" width="1336" height="787">
<h6><span class="label">Figure 16-10. </span>Using D3’s insert method to add list items</h6>
</div></figure>

<p>For SVG elements, positioned directly within their parent group using x and y coordinates, <code>insert</code> might seem redundant. But, as discussed in <a data-type="xref" href="ch04.html#sect_svg_layering">“Layering and Transparency”</a>, DOM ordering is important in SVG as elements are layered, meaning that the last element in the DOM tree overlays any previous. We’ll see an example of this in <a data-type="xref" href="ch18.html#chapter_d3_maps">Chapter 18</a> where we have a grid overlay (or <code>graticule</code>) for our world map. We want this grid to be drawn above all other map elements so use <code>insert</code> to place those elements before it.</p>

<p>Our crude bar chart in <a data-type="xref" href="#d3bar_10bars">Figure 16-9</a> is crying out for a little refinement. Let’s see how we can improve things, first with D3’s powerful <code>scale</code> objects and then with D3’s biggest idea, data binding.<a data-type="indexterm" data-primary="" data-startref="D3barDOM16" id="idm140319397667984"></a><a data-type="indexterm" data-primary="" data-startref="DOM16" id="idm140319397667008"></a></p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Leveraging D3"><div class="sect1" id="idm140319398769984">
<h1>Leveraging D3</h1>

<p><a data-type="indexterm" data-primary="D3 library" data-secondary="bar charts" data-tertiary="integrating datasets" id="idm140319397665296"></a>In <a data-type="xref" href="#d3bar_10bars_crude_code">Example 16-2</a>, we built a basic,  no-frills bar chart with D3. This chart had a number of problems. First, looping through the data array is a bit clunky. What if we wanted to adapt the dataset for our chart? We’d need some way of adding or removing bars in response and then updating the resulting bars with the new data and redrawing everything. We’d also need to keep scaling the bar dimensions in x and y to reflect the different number of bars and a different maximum bar value. That’s quite a lot of bookkeeping already and things could get messy fast. Also, where do we keep the changing datasets? Every data-driven change to our chart would require passing the dataset around and then constructing a loop to iterate over elements. It feels as if the data exists outside the chained D3 workflow when it really needs to be integral to it.</p>

<p>The solution to elegantly integrating our dataset with D3 lies in the concept of data binding, D3’s biggest idea. The scaling problems are sorted by one of D3’s most useful utility libraries: scale. We’ll take a look at these now and then unleash the power of D3 with some data binding.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Measuring Up with D3’s Scales"><div class="sect1" id="idm140319397979824">
<h1>Measuring Up with D3’s Scales</h1>

<p><a data-type="indexterm" data-primary="D3 library" data-secondary="bar charts" data-tertiary="scales" id="D3barscale16"></a><a data-type="indexterm" data-primary="scales (D3 library)" data-secondary="benefits of" id="idm140319397976896"></a>The fundamental idea behind D3’s scales is a mapping from an input domain to an output range. This simple procedure can remove a lot of the persnickety aspects of building charts, visualizations, and the like. As you get more comfortable with scales, you’ll find more and more situations where you can apply them. Mastering them is a key component to relaxed, effortless D3.</p>

<p><a data-type="indexterm" data-primary="scales (D3 library)" data-secondary="categories of" id="idm140319397975168"></a>D3 provides a lot of scales, dividing them into three main categories: quantitative, ordinal, and time<sup><a data-type="noteref" id="idm140319397973952-marker" href="ch16.html#idm140319397973952">2</a></sup> scales. There are exotic mappings to suit most conceivable situations, but you’ll probably find yourself using the linear and ordinal scales much of the time, at least while you win your D3 spurs.</p>

<p>In use, D3 scales can appear slightly strange because they are part object, part function. What this means is that after creating your scale, you can call various methods on it to set its properties (e.g., <code>domain</code> to set its domain), but you can also call it as a function with a domain argument to return a range value. The following example should make the distinction clear:</p>

<pre data-type="programlisting" data-code-language="js"><code class="kd">var</code><code> </code><code class="nx">scale</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">scale</code><code class="p">.</code><code class="nx">linear</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code> </code><code class="c1">// create a linear scale
</code><code class="nx">scale</code><code class="p">.</code><code class="nx">domain</code><code class="p">(</code><code class="p">[</code><code class="mi">0</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">]</code><code class="p">)</code><code class="p">.</code><code class="nx">range</code><code class="p">(</code><code class="p">[</code><code class="mi">0</code><code class="p">,</code><code> </code><code class="mi">100</code><code class="p">]</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" id="co_introducing_d3__8212_the_story_of_a_bar_chart_CO5-1" href="#callout_introducing_d3__8212_the_story_of_a_bar_chart_CO5-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
</code><code class="nx">scale</code><code class="p">(</code><code class="mf">0.5</code><code class="p">)</code><code> </code><code class="c1">// returns 50 </code><a class="co" id="co_introducing_d3__8212_the_story_of_a_bar_chart_CO5-2" href="#callout_introducing_d3__8212_the_story_of_a_bar_chart_CO5-2"><img src="2.png" alt="2" width="12" height="12"></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_introducing_d3__8212_the_story_of_a_bar_chart_CO5-1" href="#co_introducing_d3__8212_the_story_of_a_bar_chart_CO5-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>We use the scale’s <code>domain</code> and <code>range</code> methods to map from 0 → 1 to 0 → 100.</p></dd>
<dt><a class="co" id="callout_introducing_d3__8212_the_story_of_a_bar_chart_CO5-2" href="#co_introducing_d3__8212_the_story_of_a_bar_chart_CO5-2"><img src="2.png" alt="2" width="12" height="12"></a></dt>
<dd><p>We call the scale like a function with a domain argument of <code>0.5</code>, returning a range value of <code>50</code>.</p></dd>
</dl>

<p>Let’s look at the two main D3 scales, the quantitative and the ordinal, showing how we use them to build our bar chart as we go.</p>








<section data-type="sect2" data-pdf-bookmark="Quantitative Scales"><div class="sect2" id="idm140319397921840">
<h2>Quantitative Scales</h2>

<p><a data-type="indexterm" data-primary="scales (D3 library)" data-secondary="quantitative scales" id="SCquant16"></a><a data-type="indexterm" data-primary="quantitative scales" id="quant16"></a>A D3 quantitative scale you’ll usually employ when building line-charts, bar charts, scatter plots, and the like is <code>linear</code>, mapping a continuous domain to a continuous range. For example, we want our bar heights to be a linear function of the <code>nobelData</code> values. The range of values to be mapped to is between the maximum and minimum height of the bars in pixels (400 px to 0 px) and the domain to be mapped from is between the smallest conceivable value (0) and, in our case, the largest value in the array (336 US winners). In the following code, we first use D3’s <code>max</code> method to get the largest value in our <code>nobelData</code> array, using that to specify the end of our domain:</p>

<pre data-type="programlisting" data-code-language="js"><code class="kd">var</code> <code class="nx">maxWinners</code> <code class="o">=</code> <code class="nx">d3</code><code class="p">.</code><code class="nx">max</code><code class="p">(</code><code class="nx">nobelData</code><code class="p">,</code> <code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">){</code>
                   <code class="k">return</code> <code class="o">+</code><code class="nx">d</code><code class="p">.</code><code class="nx">value</code><code class="p">;</code>
                   <code class="p">});</code>

<code class="kd">var</code> <code class="nx">yScale</code> <code class="o">=</code> <code class="nx">d3</code><code class="p">.</code><code class="nx">scale</code><code class="p">.</code><code class="nx">linear</code><code class="p">()</code>
                 <code class="p">.</code><code class="nx">domain</code><code class="p">([</code><code class="mi">0</code><code class="p">,</code> <code class="nx">maxWinners</code><code class="p">])</code> <code class="cm">/* [0, 336] */</code>
                 <code class="p">.</code><code class="nx">range</code><code class="p">([</code><code class="nx">height</code><code class="p">,</code> <code class="mi">0</code><code class="p">]);</code></pre>

<p>One little trick to note is that our range decreases from its maximum. This is because we want to use it to specify a positive displacement along the SVG downward y-axis in order to make the bar chart’s y-axis point upward (i.e., the smaller the bar height, the larger the y displacement required). Conversely, you can see that the largest bar (the US winners tally) isn’t displaced at all (see <a data-type="xref" href="#d3bar_scales_y">Figure 16-11</a>).</p>

<figure><div id="d3bar_scales_y" class="figure">
<img src="dvpj_1611.png" alt="dvpj 1611" width="777" height="282">
<h6><span class="label">Figure 16-11. </span>Using D3’s linear scale to fix the domain and range of our bar chart’s y-axis</h6>
</div></figure>

<p><a data-type="indexterm" data-primary="interpolate method (D3 library)" id="idm140319397825808"></a><a data-type="indexterm" data-primary="linear scales (D3 library)" id="idm140319397825136"></a>We’re using the simplest possible linear scale for our bar chart’s y-axis, mapping from one numeric range to another, but D3’s linear scales can do a lot more. The key to understanding this is D3’s <code>interpolate</code> method.<sup><a data-type="noteref" id="idm140319397823760-marker" href="ch16.html#idm140319397823760">3</a></sup> This takes two values and returns an <code>interpolator</code> between them. So, for the range of our <code>yScale</code> in <a data-type="xref" href="#d3bar_scales_y">Figure 16-11</a>, <code>interpolate</code> returns a numeric <code>interpolator</code> for the values <code>400</code> and <code>0</code>:</p>

<pre data-type="programlisting" data-code-language="js"><code class="kd">var</code><code> </code><code class="nx">numInt</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">interpolate</code><code class="p">(</code><code class="mi">400</code><code class="p">,</code><code> </code><code class="mi">0</code><code class="p">)</code><code class="p">;</code><code>

</code><code class="nx">numInt</code><code class="p">(</code><code class="mi">0</code><code class="p">)</code><code class="p">;</code><code> </code><code class="c1">//   400 </code><a class="co" id="co_introducing_d3__8212_the_story_of_a_bar_chart_CO6-1" href="#callout_introducing_d3__8212_the_story_of_a_bar_chart_CO6-1"><img src="1.png" alt="1" width="12" height="12"></a><code class="c1">
</code><code class="nx">numInt</code><code class="p">(</code><code class="mf">0.5</code><code class="p">)</code><code class="p">;</code><code> </code><code class="c1">// 200
</code><code class="nx">numInt</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code><code class="p">;</code><code> </code><code class="c1">//   0</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_introducing_d3__8212_the_story_of_a_bar_chart_CO6-1" href="#co_introducing_d3__8212_the_story_of_a_bar_chart_CO6-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>Interpolators have a default domain of [0,1].</p></dd>
</dl>

<p>The <code>interpolate</code> method can deal with more than just numbers. Strings, color codes, and even objects are handled sensibly. You can also specify more than two numbers for your domain array—just make sure that domain and range arrays are the same size.<sup><a data-type="noteref" id="idm140319397765904-marker" href="ch16.html#idm140319397765904">4</a></sup> We can combine these two facts to create a useful colormap:<sup><a data-type="noteref" id="idm140319397765216-marker" href="ch16.html#idm140319397765216">5</a></sup></p>

<pre data-type="programlisting" data-code-language="js"><code class="kd">var</code> <code class="nx">color</code> <code class="o">=</code> <code class="nx">d3</code><code class="p">.</code><code class="nx">scale</code><code class="p">.</code><code class="nx">linear</code><code class="p">()</code>
    <code class="p">.</code><code class="nx">domain</code><code class="p">([</code><code class="o">-</code><code class="mi">1</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="mi">1</code><code class="p">])</code>
    <code class="p">.</code><code class="nx">range</code><code class="p">([</code><code class="s2">"red"</code><code class="p">,</code> <code class="s2">"green"</code><code class="p">,</code> <code class="s2">"blue"</code><code class="p">]);</code>

<code class="nx">color</code><code class="p">(</code><code class="mi">0</code><code class="p">)</code> <code class="c1">// "#008000" green's hex code</code>
<code class="nx">color</code><code class="p">(</code><code class="mf">0.5</code><code class="p">)</code> <code class="c1">// "004080" slate blue</code></pre>

<p>D3’s linear scales have a lot of useful utility methods and rich functionality. The numeric maps will probably be your workhorse scale, but I recommend reading the <a href="http://bit.ly/1UAO0lI">D3 docs</a> to fully appreciate how flexible the linear scales are. On that web page, you’ll find D3’s other quantitative scales, to suit almost every quantitative occasion:</p>

<ul>
<li>
<p><a data-type="indexterm" data-primary="power scales (D3 library)" id="idm140319398040176"></a>Power scales, similar to linear but with exponential transform (e.g., <code>sqrt</code>)</p>
</li>
<li>
<p><a data-type="indexterm" data-primary="log scales (D3 library)" id="idm140319398038224"></a>Log scales, similar to linear but with logarithmic transform</p>
</li>
<li>
<p><a data-type="indexterm" data-primary="quantize/quantile scales (D3 library)" id="idm140319398036688"></a>Quantize scales, a variant of linear with a discrete range; that is, although the input is continuous, the output is divided into segments or buckets (e.g., [1, 2, 3, 4, 5])</p>
</li>
<li>
<p>Quantile scales, often used for color palettes, are similar to quantize scales but have discrete or bucketed domains as well as ranges</p>
</li>
<li>
<p><a data-type="indexterm" data-primary="identity scales (D3 library)" id="idm140319398033984"></a>Identity scales, linear with the same domain and range (fairly esoteric)</p>
</li>
</ul>

<p>Quantitative scales are great for manipulating continuously valued quantities, but often we want to get values based on a discrete domain (e.g., names or categories). D3 has a specialized set of ordinal scales to meet this need.<a data-type="indexterm" data-primary="" data-startref="quant16" id="idm140319398032432"></a><a data-type="indexterm" data-primary="" data-startref="SCquant16" id="idm140319398031456"></a></p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Ordinal Scales"><div class="sect2" id="idm140319397921216">
<h2>Ordinal Scales</h2>

<p><a data-type="indexterm" data-primary="scales (D3 library)" data-secondary="ordinal scales" id="idm140319397637552"></a><a data-type="indexterm" data-primary="ordinal scales (D3 library)" id="idm140319397636576"></a>Ordinal scales take an array of values as their domain and map these to discrete or continuous ranges, producing a single mapped value for each. To explicitly create a one-to-one mapping, we use the scale’s <code>range</code> method:</p>

<pre data-type="programlisting" data-code-language="js"><code class="kd">var</code> <code class="nx">oScale</code> <code class="o">=</code> <code class="nx">d3</code><code class="p">.</code><code class="nx">scale</code><code class="p">.</code><code class="nx">ordinal</code><code class="p">()</code>
               <code class="p">.</code><code class="nx">domain</code><code class="p">([</code><code class="s1">'a'</code><code class="p">,</code> <code class="s1">'b'</code><code class="p">,</code> <code class="s1">'c'</code><code class="p">,</code> <code class="s1">'d'</code><code class="p">,</code> <code class="s1">'e'</code><code class="p">])</code>
               <code class="p">.</code><code class="nx">range</code><code class="p">([</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="mi">3</code><code class="p">,</code> <code class="mi">4</code><code class="p">,</code> <code class="mi">5</code><code class="p">]);</code>

<code class="nx">oScale</code><code class="p">(</code><code class="s1">'c'</code><code class="p">);</code> <code class="c1">// 3</code></pre>

<p>In the case of our bar chart, we want to map an array of indices to a continuous range, to provide our bars’ x-coordinates. For this, we can use the <code>rangeBands</code> or the <code>rangeRoundBands</code> methods, the latter snapping output values to individual pixels. Here, we use <code>rangeRoundBands</code> to map an array of numbers to a continuous range:</p>

<pre data-type="programlisting" data-code-language="js"><code class="kd">var</code> <code class="nx">oScale</code> <code class="o">=</code> <code class="nx">d3</code><code class="p">.</code><code class="nx">scale</code><code class="p">.</code><code class="nx">ordinal</code><code class="p">()</code>
               <code class="p">.</code><code class="nx">domain</code><code class="p">([</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="mi">3</code><code class="p">,</code> <code class="mi">4</code><code class="p">,</code> <code class="mi">5</code><code class="p">])</code>
               <code class="p">.</code><code class="nx">rangeRoundBands</code><code class="p">([</code><code class="mi">0</code><code class="p">,</code> <code class="mi">400</code><code class="p">]);</code>

<code class="nx">oScale</code><code class="p">(</code><code class="mi">3</code><code class="p">)</code> <code class="c1">// 160</code>
<code class="nx">oScale</code><code class="p">(</code><code class="mi">5</code><code class="p">)</code> <code class="c1">// 320</code></pre>

<p>In building our original crude bar chart (<a data-type="xref" href="#d3bar_10bars_crude_code">Example 16-2</a>), we used a <code>barWidth</code> variable to size the bars. Implementing padding between the bars would have required a padding variable and necessary adjustments to <code>barWidth</code> and the bar positions. With our new ordinal scale, we get these things for free, removing the fiddly bookkeeping. Calling the <code>xScale</code>’s <code>rangeBand</code> (note the singular form) method provides the calculated bar widths. We can also provide the <code>rangeBands</code> method with a second argument, specifying the padding between the bars as a fraction of the space occupied by each bar. The <code>rangeBand</code> value is adjusted accordingly. Here are some examples of this in action:</p>

<pre data-type="programlisting" data-code-language="js"><code class="kd">var</code><code> </code><code class="nx">oScale</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">scale</code><code class="p">.</code><code class="nx">ordinal</code><code class="p">(</code><code class="p">)</code><code>
               </code><code class="p">.</code><code class="nx">domain</code><code class="p">(</code><code class="p">[</code><code class="mi">1</code><code class="p">,</code><code> </code><code class="mi">2</code><code class="p">]</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" id="co_introducing_d3__8212_the_story_of_a_bar_chart_CO7-1" href="#callout_introducing_d3__8212_the_story_of_a_bar_chart_CO7-1"><img src="1.png" alt="1" width="12" height="12"></a><code>

</code><code class="nx">oScale</code><code class="p">.</code><code class="nx">rangeRoundBands</code><code class="p">(</code><code class="p">[</code><code class="mi">0</code><code class="p">,</code><code> </code><code class="mi">100</code><code class="p">]</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" id="co_introducing_d3__8212_the_story_of_a_bar_chart_CO7-2" href="#callout_introducing_d3__8212_the_story_of_a_bar_chart_CO7-2"><img src="2.png" alt="2" width="12" height="12"></a><code>
</code><code class="nx">oScale</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code><code class="p">;</code><code> </code><code class="c1">// 50
</code><code class="nx">oScale</code><code class="p">.</code><code class="nx">rangeBand</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code> </code><code class="c1">// 50
</code><code>

</code><code class="nx">oScale</code><code class="p">.</code><code class="nx">rangeRoundBands</code><code class="p">(</code><code class="p">[</code><code class="mi">0</code><code class="p">,</code><code> </code><code class="mi">100</code><code class="p">]</code><code class="p">,</code><code> </code><code class="mf">0.1</code><code class="p">)</code><code class="p">;</code><code> </code><code class="c1">// pBpBp </code><a class="co" id="co_introducing_d3__8212_the_story_of_a_bar_chart_CO7-3" href="#callout_introducing_d3__8212_the_story_of_a_bar_chart_CO7-3"><img src="3.png" alt="3" width="12" height="12"></a><code class="c1">
</code><code class="nx">oScale</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code><code class="p">;</code><code> </code><code class="c1">// 5
</code><code class="nx">oScale</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code><code class="p">;</code><code> </code><code class="c1">// 52
</code><code class="nx">oScale</code><code class="p">.</code><code class="nx">rangeBand</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code> </code><code class="c1">// 42, the padded bar width</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_introducing_d3__8212_the_story_of_a_bar_chart_CO7-1" href="#co_introducing_d3__8212_the_story_of_a_bar_chart_CO7-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>Stores the scale with a fixed domain; useful if we anticipate the range changing.</p></dd>
<dt><a class="co" id="callout_introducing_d3__8212_the_story_of_a_bar_chart_CO7-2" href="#co_introducing_d3__8212_the_story_of_a_bar_chart_CO7-2"><img src="2.png" alt="2" width="12" height="12"></a></dt>
<dd><p><code>rangeRoundBands</code> snaps (rounds) the output values to integers.</p></dd>
<dt><a class="co" id="callout_introducing_d3__8212_the_story_of_a_bar_chart_CO7-3" href="#co_introducing_d3__8212_the_story_of_a_bar_chart_CO7-3"><img src="3.png" alt="3" width="12" height="12"></a></dt>
<dd><p>We specify a padding (<code>p</code>) factor of <code>0.1</code> * allocated bar(<code>B</code>)-space.</p></dd>
</dl>

<p><a data-type="xref" href="#d3bar_scales_x">Figure 16-12</a> shows our bar chart’s ordinal x-scale with a padding factor of <code>0.1</code>. The continuous range is 600 (pixels), which is the width of the bar chart, and the domain is an array of integers representing the individual bars. As shown, providing <code>xScale</code> with a bar’s index number returns its position on the x-axis.</p>

<figure><div id="d3bar_scales_x" class="figure">
<img src="dvpj_1612.png" alt="dvpj 1612" width="790" height="297">
<h6><span class="label">Figure 16-12. </span>Setting the domain and range of our bar chart’s x-scale, using a padding factor of 0.1</h6>
</div></figure>

<p>Armed with our D3 scales, let’s turn to D3’s central concept, binding data to the DOM in order to drive changes to it.</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Unleashing the Power of D3 with Data Binding"><div class="sect1" id="idm140319397638528">
<h1>Unleashing the Power of D3 with Data Binding</h1>

<p><a data-type="indexterm" data-primary="D3 library" data-secondary="bar charts" data-tertiary="data binding" id="idm140319397185680"></a><a data-type="indexterm" data-primary="data binding (D3 library)" data-secondary="benefits of" id="idm140319397184160"></a>D3 stands for <em>Data-Driven Documents</em>, and up to now we haven’t really been driving with our data. In order to unleash D3, we need to embrace its big idea, which is binding the data in our dataset to its respective DOM elements and updating the web page (document) based on this integration. This small step of binding data to the DOM enables a huge amount of functionality when combined with the most powerful D3 methods, <code>enter</code> and <code>exit</code>. With <code>enter</code>, we can return any data that is not bound to a DOM element and use it to create a new one (to which it is then bound). <code>exit</code>, the counterpart of <code>enter</code>, allows us to find any DOM elements that are unbound to data and, for example, remove them (with the <code>remove()</code> method). Working in conjunction, <code>enter</code> and <code>exit</code> make updating a bar chart a cinch and are almost certainly at work in the cooler D3 demos you’ve seen.</p>

<p>In order to demonstrate D3’s data binding, let’s start with our bar-less chart, with SVG canvas and chart group in place:</p>

<pre data-type="programlisting" data-code-language="html">...
    <code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"nobel-bar"</code><code class="nt">&gt;</code>
      <code class="nt">&lt;svg</code> <code class="na">width=</code><code class="s">"600"</code> <code class="na">height=</code><code class="s">"400"</code><code class="nt">&gt;</code>
        <code class="nt">&lt;g</code> <code class="na">class=</code><code class="s">"chart"</code> <code class="na">transform=</code><code class="s">"translate(40, 20)"</code><code class="nt">&gt;&lt;/g&gt;</code>
      <code class="nt">&lt;/svg&gt;</code>
    <code class="nt">&lt;/div&gt;</code>
...</pre>

<p>In order to bind data with D3, we first need some data in the right form. Generally that will be an array of objects, like our bar chart’s <code>nobelData</code>:</p>

<pre data-type="programlisting" data-code-language="js"><code class="kd">var</code> <code class="nx">nobelData</code> <code class="o">=</code> <code class="p">[</code>
    <code class="p">{</code><code class="nx">key</code><code class="o">:</code><code class="s1">'United States'</code><code class="p">,</code> <code class="nx">value</code><code class="o">:</code><code class="mi">336</code><code class="p">},</code>
    <code class="p">{</code><code class="nx">key</code><code class="o">:</code><code class="s1">'United Kingdom'</code><code class="p">,</code> <code class="nx">value</code><code class="o">:</code><code class="mi">98</code><code class="p">},</code>
    <code class="p">{</code><code class="nx">key</code><code class="o">:</code><code class="s1">'Germany'</code><code class="p">,</code> <code class="nx">value</code><code class="o">:</code><code class="mi">79</code><code class="p">},</code>
    <code class="p">...</code>
<code class="p">]</code></pre>

<p>With this data in hand, binding it to the DOM is easy. We just make a standard D3 selection and then use the <code>data</code> method to bind the data to it. We’ll store the result in a <code>bars</code> variable:</p>

<pre data-type="programlisting" data-code-language="js"><code class="kd">var</code> <code class="nx">svg</code> <code class="o">=</code> <code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s1">'#nobel-bar .chart'</code><code class="p">);</code>

<code class="kd">var</code> <code class="nx">bars</code> <code class="o">=</code>  <code class="nx">svg</code><code class="p">.</code><code class="nx">selectAll</code><code class="p">(</code><code class="s1">'.bar'</code><code class="p">)</code>
              <code class="p">.</code><code class="nx">data</code><code class="p">(</code><code class="nx">nobelData</code><code class="p">);</code></pre>

<p>We now come to a slightly counterintuitive aspect of D3’s <code>data</code> method. Our first <code>select</code> returned the <code>chart</code> group in our <code>nobel-bar</code> SVG canvas, but the second <code>selectAll</code> returned all elements with class <code>bars</code>, of which there are none. If there are no bars, what exactly are we binding the data to? The answer is that behind the scenes, D3 is keeping the books and that the <code>bars</code> object returned by <code>data</code> knows which DOM elements have been bound to the <code>nobelData</code> and, just as crucially, which haven’t.  We’ll now see how to make use of this fact using the fundamental <code>enter</code> method.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="The enter Method"><div class="sect1" id="idm140319396962112">
<h1>The enter Method</h1>

<p><a data-type="indexterm" data-primary="enter method (D3 library)" id="enter16"></a><a data-type="indexterm" data-primary="D3 library" data-secondary="bar charts" data-tertiary="enter method" id="D3barenter16"></a><a data-type="indexterm" data-primary="data binding (D3 library)" data-secondary="enter method" id="DBenter16"></a>D3’s <a href="https://github.com/mbostock/d3/wiki/Selections#enter"><code>enter</code></a> method (and its sibling, <code>exit</code>) is both the basis for D3’s superb power and expressiveness and also the root of much confusion. It’s worth coming to grips with it at a low level if you really want your D3 skills to grow. Let’s introduce it now, with a very simple and slow demonstration.</p>

<p>We’ll start with a canonically simple little demonstration, adding a bar rectangle for each member of our Nobel Prize data. We’ll use the first six Nobel Prize–winning countries as our bound data:</p>

<pre data-type="programlisting" data-code-language="js"><code class="kd">var</code> <code class="nx">nobelData</code> <code class="o">=</code> <code class="p">[</code>
    <code class="p">{</code><code class="nx">key</code><code class="o">:</code><code class="s1">'United States'</code><code class="p">,</code> <code class="nx">value</code><code class="o">:</code><code class="mi">200</code><code class="p">},</code>
    <code class="p">{</code><code class="nx">key</code><code class="o">:</code><code class="s1">'United Kingdom'</code><code class="p">,</code> <code class="nx">value</code><code class="o">:</code><code class="mi">80</code><code class="p">},</code>
    <code class="p">{</code><code class="nx">key</code><code class="o">:</code><code class="s1">'France'</code><code class="p">,</code> <code class="nx">value</code><code class="o">:</code><code class="mi">47</code><code class="p">},</code>
    <code class="p">{</code><code class="nx">key</code><code class="o">:</code><code class="s1">'Switzerland'</code><code class="p">,</code> <code class="nx">value</code><code class="o">:</code><code class="mi">23</code><code class="p">},</code>
    <code class="p">{</code><code class="nx">key</code><code class="o">:</code><code class="s1">'Japan'</code><code class="p">,</code> <code class="nx">value</code><code class="o">:</code><code class="mi">21</code><code class="p">},</code>
    <code class="p">{</code><code class="nx">key</code><code class="o">:</code><code class="s1">'Austria'</code><code class="p">,</code> <code class="nx">value</code><code class="o">:</code><code class="mi">12</code><code class="p">}</code>
<code class="p">];</code></pre>

<p>With our dataset in hand, let’s first use D3 to grab the chart group, saving it to an <code>svg</code> variable. We’ll use that to make a selection of all elements of class <code>bar</code> (none at the moment):</p>

<pre data-type="programlisting" data-code-language="js"><code class="kd">var</code> <code class="nx">svg</code> <code class="o">=</code> <code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s1">'#nobel-bar .chart'</code><code class="p">);</code>

<code class="kd">var</code> <code class="nx">bars</code> <code class="o">=</code> <code class="nx">svg</code><code class="p">.</code><code class="nx">selectAll</code><code class="p">(</code><code class="s1">'.bar'</code><code class="p">)</code>
    <code class="p">.</code><code class="nx">data</code><code class="p">(</code><code class="nx">nobelData</code><code class="p">);</code></pre>

<p>Now although the <code>bars</code> selection is empty, behind the scenes D3 has kept a record of the data we’ve just bound to it. At this point, we can use that fact and the <code>enter</code> method to create a few bars with our data. Calling enter on our <code>bars</code> selection returns a subselection of all the data (<code>nobelData</code>, in this case) that was not bound to a bar. Since there were no bars in the original selection (our chart being empty), all the data is unbound, so <code>enter</code> returns an enter election (essentially placeholder nodes for all the unbound data) of size six:</p>

<pre data-type="programlisting" data-code-language="js"><code class="nx">bars</code> <code class="o">=</code> <code class="nx">bars</code><code class="p">.</code><code class="nx">enter</code><code class="p">();</code> <code class="err">#</code> <code class="nx">returns</code> <code class="nx">six</code> <code class="nx">placeholder</code> <code class="nx">nodes</code></pre>

<p>We can use the placeholder nodes in <code>bars</code> to create some DOM elements—in our case, a few bars. We won’t bother with trying to put them the right way up (the y-axis being down from the top of the screen by convention), but we will use the data values and indexes to set the position and height of the bars:</p>

<pre data-type="programlisting" data-code-language="js"><code class="nx">bars</code><code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s1">'rect'</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">classed</code><code class="p">(</code><code class="s1">'bar'</code><code class="p">,</code><code> </code><code class="kc">true</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s1">'width'</code><code class="p">,</code><code> </code><code class="mi">10</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s1">'height'</code><code class="p">,</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code class="p">{</code><code class="k">return</code><code> </code><code class="nx">d</code><code class="p">.</code><code class="nx">value</code><code class="p">;</code><code class="p">}</code><code class="p">)</code><code> </code><a class="co" id="co_introducing_d3__8212_the_story_of_a_bar_chart_CO8-1" href="#callout_introducing_d3__8212_the_story_of_a_bar_chart_CO8-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
    </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s1">'x'</code><code class="p">,</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">,</code><code> </code><code class="nx">i</code><code class="p">)</code><code> </code><code class="p">{</code><code> </code><code class="k">return</code><code> </code><code class="nx">i</code><code> </code><code class="o">*</code><code> </code><code class="mi">12</code><code class="p">;</code><code> </code><code class="p">}</code><code class="p">)</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_introducing_d3__8212_the_story_of_a_bar_chart_CO8-1" href="#co_introducing_d3__8212_the_story_of_a_bar_chart_CO8-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>If you provide a callback function to D3’s setter methods (<code>attr</code>, <code>style</code>, etc.), then the first and second arguments provided are the value of the individual data object (e.g., <code>d == {key: 'United States', value: 200}</code>) and its index (<code>i</code>).</p></dd>
</dl>

<p>Using the callback functions to set height and the x position (allowing a padding of 2 px) of the bars, calling <code>append</code> on our six node selection produces <a data-type="xref" href="#d3bar_enter_full">Figure 16-13</a>.</p>

<figure><div id="d3bar_enter_full" class="figure">
<img src="dvpj_1613.png" alt="dvpj 1613" width="427" height="292">
<h6><span class="label">Figure 16-13. </span>Producing some bars with D3’s enter method</h6>
</div></figure>

<p>I’d encourage you generally to use Chrome’s (or equivalent) Elements tab to investigate the HTML your D3 is producing. Investigating our mini–bar chart with Elements shows <a data-type="xref" href="#d3bar_enter_elements">Figure 16-14</a>.</p>

<figure><div id="d3bar_enter_elements" class="figure">
<img src="dvpj_1614.png" alt="dvpj 1614" width="434" height="291">
<h6><span class="label">Figure 16-14. </span>Using the Elements tab to see the HTML generated by enter and append</h6>
</div></figure>

<p>So we’ve seen what happens when we call <code>enter</code> on an empty selection. But what happens when we already have a few bars, which we would have in an interactive chart with a user-driven, changing dataset?</p>

<p>Let’s add a couple of <code>bar</code> class rectangles to our starting HTML:</p>

<pre data-type="programlisting" data-code-language="html"><code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"nobel-bar"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;svg</code> <code class="na">width=</code><code class="s">"600"</code> <code class="na">height=</code><code class="s">"400"</code><code class="nt">&gt;</code>
    <code class="nt">&lt;g</code> <code class="na">class=</code><code class="s">"chart"</code> <code class="na">transform=</code><code class="s">"translate(40, 20)"</code><code class="nt">&gt;</code>
      <code class="nt">&lt;rect</code> <code class="na">class=</code><code class="s">'bar'</code><code class="nt">&gt;&lt;/rect&gt;</code>
      <code class="nt">&lt;rect</code> <code class="na">class=</code><code class="s">'bar'</code><code class="nt">&gt;&lt;/rect&gt;</code>
    <code class="nt">&lt;/g&gt;</code>
  <code class="nt">&lt;/svg&gt;</code>
<code class="nt">&lt;/div&gt;</code></pre>

<p>If we now perform the same data binding and entering as before, on calling <code>data</code> on our selection, the two placeholder rectangles bind to the first two members of our <code>nobelData</code> array (i.e., <code>[{key: 'United States', value: 200}, {key: 'United Kingdom', value:80}]</code>). This means that <code>enter</code>, which returns only unbound data placeholders, now returns only four placeholders, associated with the last four elements of the <code>nobelData</code> array:</p>

<pre data-type="programlisting" data-code-language="js" class="pagebreak-before"><code class="kd">var</code> <code class="nx">svg</code> <code class="o">=</code> <code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s1">'#nobel-bar .chart'</code><code class="p">);</code>

<code class="kd">var</code> <code class="nx">bars</code> <code class="o">=</code> <code class="nx">svg</code><code class="p">.</code><code class="nx">selectAll</code><code class="p">(</code><code class="s1">'.bar'</code><code class="p">)</code>
    <code class="p">.</code><code class="nx">data</code><code class="p">(</code><code class="nx">nobelData</code><code class="p">);</code>

<code class="nx">bars</code> <code class="o">=</code> <code class="nx">bars</code><code class="p">.</code><code class="nx">enter</code><code class="p">();</code> <code class="err">#</code> <code class="k">return</code> <code class="nx">four</code> <code class="nx">placeholder</code> <code class="nx">nodes</code></pre>

<p>If we now call <code>append</code> on the entered <code>bars</code>, as before, we get the result shown in <a data-type="xref" href="#d3bar_enter_part">Figure 16-15</a>, showing the last four bars (note that they preserve their index <code>i</code>, used to set their x positions) rendered.</p>

<figure><div id="d3bar_enter_part" class="figure">
<img src="dvpj_1615.png" alt="dvpj 1615" width="419" height="128">
<h6><span class="label">Figure 16-15. </span>Calling enter and append with existing bars</h6>
</div></figure>

<p><a data-type="xref" href="#d3bar_enter_elements_part">Figure 16-16</a> shows the HTML generated for the last four bars. As we’ll see, the data from the first two elements is now bound to the two dummy nodes we added to the initial bar group. We just haven’t used it yet to adjust those rectangles’ attributes. Updating old bars with new data is the one of the key elements  of the update pattern we’ll see shortly.</p>

<figure><div id="d3bar_enter_elements_part" class="figure">
<img src="dvpj_1616.png" alt="dvpj 1616" width="498" height="285">
<h6><span class="label">Figure 16-16. </span>Using the Elements tab to see the HTML generated by enter and append on a partial selection</h6>
</div></figure>

<p>To emphasize, coming to grips with <code>enter</code> and <code>exit</code> (and <code>remove</code>) is vital to healthy progress with D3. Play around a bit, inspect the HTML you’re producing, enter a bit of data, and generally get a bit messy, learning the ins and outs. Let’s have a little look at accessing the bound data before moving on to the D3’s nexus, the update <span class="keep-together">pattern</span>.<a data-type="indexterm" data-primary="" data-startref="enter16" id="idm140319396563536"></a><a data-type="indexterm" data-primary="" data-startref="D3barenter16" id="idm140319396562528"></a><a data-type="indexterm" data-primary="" data-startref="DBenter16" id="idm140319396561584"></a></p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Accessing the Bound Data"><div class="sect1" id="idm140319397008880">
<h1>Accessing the Bound Data</h1>

<p><a data-type="indexterm" data-primary="D3 library" data-secondary="bar charts" data-tertiary="accessing bound data" id="idm140319396559744"></a><a data-type="indexterm" data-primary="data binding (D3 library)" data-secondary="accessing bound data" id="idm140319396558096"></a>A good way to see what’s happening to the DOM is to use your browser’s HTML inspector and console to track D3’s changes. In <a data-type="xref" href="#d3bar_enter_full">Figure 16-13</a>, we use Chrome’s console to look at the <code>rect</code> element representing the first bar in <a data-type="xref" href="#d3bar_enter_part">Figure 16-15</a>, before data has been bound and after the <code>nobelData</code> has been bound to the bars using the <code>data</code> method. As you can see, D3 has added a <code>__data__</code> object to the <code>rect</code> element with which to store its bound data—in this case, the first member of our <code>nobelData</code> list. The <code>__data__</code> object is used by D3’s internal bookkeeping and, fundamentally, the data in it made available to functions supplied to update methods such as <code>attr</code>.</p>

<figure><div id="d3bar_console_db" class="figure">
<img src="dvpj_1617.png" alt="dvpj 1617" width="1565" height="811">
<h6><span class="label">Figure 16-17. </span>Using the Chrome console to show the addition of a __data__ object after data binding using D3’s data method</h6>
</div></figure>

<p>Let’s look at a little example of using the data in an element’s <code>__data__</code> object to set its <code>name</code> attribute.  The <code>name</code> attribute can be useful for making specific D3 selections. For example, if the user selects a particular country, we can now use D3 to get all its named components and adjust their style if needed.  We’ll use the bar with bound data in <a data-type="xref" href="#d3bar_console_db">Figure 16-17</a> and set the name using the <code>key</code> property of its bound data:</p>

<pre data-type="programlisting" data-code-language="js"><code class="kd">var</code><code> </code><code class="nx">bar</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s1">'#nobel-bar .bar'</code><code class="p">)</code><code class="p">;</code><code>

</code><code class="nx">bar</code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s1">'name'</code><code class="p">,</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">,</code><code> </code><code class="nx">i</code><code class="p">)</code><code class="p">{</code><code> </code><a class="co" id="co_introducing_d3__8212_the_story_of_a_bar_chart_CO9-1" href="#callout_introducing_d3__8212_the_story_of_a_bar_chart_CO9-1"><img src="1.png" alt="1" width="12" height="12"></a><code>

    </code><code class="kd">var</code><code> </code><code class="nx">sane_key</code><code> </code><code class="o">=</code><code> </code><code class="nx">d</code><code class="p">.</code><code class="nx">key</code><code class="p">.</code><code class="nx">replace</code><code class="p">(</code><code class="sr">/ /g</code><code class="p">,</code><code> </code><code class="s1">'_'</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" id="co_introducing_d3__8212_the_story_of_a_bar_chart_CO9-2" href="#callout_introducing_d3__8212_the_story_of_a_bar_chart_CO9-2"><img src="2.png" alt="2" width="12" height="12"></a><code>

    </code><code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'__data__ is: '</code><code> </code><code class="o">+</code><code> </code><code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code>
    </code><code class="o">+</code><code> </code><code class="s1">', index is '</code><code> </code><code class="o">+</code><code> </code><code class="nx">i</code><code class="p">)</code><code>

    </code><code class="k">return</code><code> </code><code class="s1">'bar__'</code><code> </code><code class="o">+</code><code> </code><code class="nx">sane_key</code><code class="p">;</code><code> </code><a class="co" id="co_introducing_d3__8212_the_story_of_a_bar_chart_CO9-3" href="#callout_introducing_d3__8212_the_story_of_a_bar_chart_CO9-3"><img src="3.png" alt="3" width="12" height="12"></a><code>
    </code><code class="p">}</code><code class="p">)</code><code class="p">;</code><code>
</code><code class="c1">// console out:
</code><code class="c1">// __data__ is: {"key":"United States","value":336}, index is 0</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_introducing_d3__8212_the_story_of_a_bar_chart_CO9-1" href="#co_introducing_d3__8212_the_story_of_a_bar_chart_CO9-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>All D3 setter methods can take a function as their second argument. This function receives the data (<code>d</code>) bound to the selected element and its position in the data array (<code>i</code>).</p></dd>
<dt><a class="co" id="callout_introducing_d3__8212_the_story_of_a_bar_chart_CO9-2" href="#co_introducing_d3__8212_the_story_of_a_bar_chart_CO9-2"><img src="2.png" alt="2" width="12" height="12"></a></dt>
<dd><p>We use a regular expression (regex) to replace all spaces in the key with underscores (e.g., United States → United_States).</p></dd>
<dt><a class="co" id="callout_introducing_d3__8212_the_story_of_a_bar_chart_CO9-3" href="#co_introducing_d3__8212_the_story_of_a_bar_chart_CO9-3"><img src="3.png" alt="3" width="12" height="12"></a></dt>
<dd><p>This will set the bar’s <code>id</code> to <code>'bar__United_States'</code>.</p></dd>
</dl>

<p>All the setter methods listed in <a data-type="xref" href="#d3bar_selects">Figure 16-3</a> (<code>attr</code>, <code>style</code>, <code>text</code>, etc.) can take a function as a second argument, which will receive data bound to the element and the element’s array index. The return of this function is used to set the value of the property. As we’ll see, with interactive visualizations’ changes to the visualized dataset will be reflected when we bind the new data and then use these functional setters to adapt attributes, styles, and properties accordingly.</p>

<p>Now that we’ve seen how bind data objects to DOM elements and use that data to add and adapt elements, let’s look at how to update our visualizations as our data changes. The update pattern we’ll learn is the core to using D3 effectively, and it or a close variant will be employed in pretty much all the cool D3 demos you’ve seen.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="The Update Pattern"><div class="sect1" id="d3bar_update">
<h1>The Update Pattern</h1>

<p><a data-type="indexterm" data-primary="D3 library" data-secondary="bar charts" data-tertiary="update pattern" id="D3barup16"></a><a data-type="indexterm" data-primary="data binding (D3 library)" data-secondary="update pattern" id="DBup16"></a><a data-type="indexterm" data-primary="update pattern (D3 library)" id="update16"></a>The previous section showed how we can bind our data to the DOM, use it to append or insert elements, and use data-driven functions to change attributes of the elements. We now want to put these concepts together to fulfill our goal of creating charts or visualizations that can be updated with new data, allowing for user-driven changes and the full scope of interactivity. <a data-type="indexterm" data-primary="data-join method (D3 library)" id="idm140319396455824"></a>To do this, we’ll employ an update pattern that makes use of one of D3’s core concepts, the <a href="http://bost.ocks.org/mike/join/">data-join</a>. With the <code>enter</code> method, we’ve already seen one half of the data-join methods at work. Now we’ll see how it works in conjunction with its sibling <code>exit</code> to create the update pattern.<sup><a data-type="noteref" id="idm140319396453440-marker" href="ch16.html#idm140319396453440">6</a></sup></p>
<div data-type="tip"><h6>Tip</h6>
<p>Although you may anticipate building one-off charts, with a single data-binding process, it’s good to get into the habit of asking yourself “What if I need to change the data dynamically?” If the answer is not immediately obvious, you have probably implemented a bad D3 design. Catching yourself in the act means you can do a little code audit and make the necessary changes before things start to deteriorate. It’s good to kick yourself out of this habit, but also, because D3 is somewhat of a craft skill, constantly reaffirming that best practice will pay off when you need it.</p>
</div>

<p><a data-type="xref" href="#d3bar_update_pattern">Figure 16-18</a> shows a D3 update pattern.</p>
<ol>
<li>
<p>First we bind the <code>nobelData</code> to a selection of bars (of class <code>bar</code>) containing two existing bars (B<sub>0</sub> and B<sub>1</sub>). The first two data objects (O<sub>1</sub> and O<sub>2</sub>) are bound to their respective bars, leaving the rest of the objects unbound.</p>
</li>
<li>
<p>Using <code>enter</code> on the <code>bars</code> update selector returns an array with placeholders for all the unbound data objects. These are then used to append new bars to the bar group.</p>
</li>
<li>
<p>We then use chained attribute setters on all the bars in the <code>bars</code> update selector, including the bars we just appended (now freshly bound to their data). We use our x and y scales to get the correct dimensions and positions for the bars. Note that the code to update the scales’ domains given the new data is not shown but will be shortly.</p>
</li>
<li>
<p>Finally we use <code>enter</code>’s counterpart in the data-join, <code>exit</code>, to return any bar elements that are not bound to data (in this case an empty list). We then <code>remove</code> any of these.</p>
</li>

</ol>

<figure><div id="d3bar_update_pattern" class="figure">
<img src="dvpj_1618.png" alt="dvpj 1618" width="527" height="514">
<h6><span class="label">Figure 16-18. </span>D3 update pattern</h6>
</div></figure>
<div data-type="tip"><h6>Tip</h6>
<p>The update pattern just described is found in some shape or other in almost all interactive D3 charts, and getting your head around it is fundamental to “getting” D3. In fact, I think that if you “get” the update pattern, you “get” D3, so spend some time thinking about it. I’d suggest playing around at <a href="http://blockbuilder.org">Blockbuilder</a> (with many thousands of update pattern examples available) and going to the huge collection of D3 examples at <a href="http://bl.ocks.org/mbostock"><em class="hyperlink">http://bl.ocks.org/mbostock</em></a>. Pick an example and see if you can locate and understand its update pattern.</p>
</div>

<p><a data-type="xref" href="#d3bar_update_removal">Figure 16-19</a> shows the update pattern with removal of some unbound dataless bars. Whereas in <a data-type="xref" href="#d3bar_update_pattern">Figure 16-18</a> there were more data objects than bars, here the data-join (1) has fewer objects than bars, leaving two bars (B2 and B3) unbound. Entering the data (2) results in an empty array, with no objects unbound to bars. In (3) we update the first two bars with their new data. Note that the bar widths, specified by <code>xScale.rangeBand()</code>, will change as we update our ordinal <code>xScale</code>’s domain from [0, 1, 2, 3] to [0, 1], to reflect the change in our size of our dataset. In <a data-type="xref" href="#d3bar_update_pattern">Figure 16-18</a>, exiting the <code>bars</code> resulted in an empty list, there being no unbound bars. Here, bars B2 and B3 have no data associated with them and are returned by the <code>exit</code> method. A subsequent <code>remove</code> call removes them from the DOM tree, leaving our updated bar chart clutter-free.</p>

<figure><div id="d3bar_update_removal" class="figure">
<img src="dvpj_1619.png" alt="dvpj 1619" width="1080" height="1087">
<h6><span class="label">Figure 16-19. </span>D3 update pattern with removal</h6>
</div></figure>

<p><a data-type="xref" href="#d3bar_update_code">Example 16-3</a> shows the complete code for our no-frills bar chart with the update pattern incorporated. Note that the chart details that are independent of the data (our <code>nobelData</code> array) are specified outside of the <code>update</code> function (e.g., the scale ranges), specified by the height and width in pixels of our bar chart, in turn established by the CSS-defined width and height of the <code>#nobel-bar</code> container and the <code>margin</code> variable. Any aspects of the chart that might change with new data are shifted into the <code>update</code> function. So the scale domains, specified by the length of the data array and its maximum value, are set separately from the ranges and updated every time the data changes.</p>

<p>Note also that, once the charts framework is in place, we are only interested in the <code>update</code> method and supplying it with any new data. As we’ll see, this allows us to harness JavaScript’s closure and create safe, reusable chart objects, hiding the chart’s <em>innards</em> from the user and reducing possible code conflicts.</p>
<div id="d3bar_update_code" data-type="example">
<h5><span class="label">Example 16-3. </span>Making a bar chart with the update pattern</h5>

<pre data-type="programlisting" data-code-language="js"><code class="c1">// GETTING THE CHART DIMENSIONS
</code><code class="kd">var</code><code> </code><code class="nx">chartHolder</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s2">"#nobel-bar"</code><code class="p">)</code><code class="p">;</code><code>
</code><code class="kd">var</code><code> </code><code class="nx">margin</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code class="nx">top</code><code class="o">:</code><code class="mi">20</code><code class="p">,</code><code> </code><code class="nx">right</code><code class="o">:</code><code class="mi">20</code><code class="p">,</code><code> </code><code class="nx">bottom</code><code class="o">:</code><code class="mi">30</code><code class="p">,</code><code> </code><code class="nx">left</code><code class="o">:</code><code class="mi">40</code><code class="p">}</code><code class="p">;</code><code>
</code><code class="kd">var</code><code> </code><code class="nx">boundingRect</code><code> </code><code class="o">=</code><code> </code><code class="nx">chartHolder</code><code class="p">.</code><code class="nx">node</code><code class="p">(</code><code class="p">)</code><code class="p">.</code><code class="nx">getBoundingClientRect</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code>
</code><code class="kd">var</code><code> </code><code class="nx">width</code><code> </code><code class="o">=</code><code> </code><code class="nx">boundingRect</code><code class="p">.</code><code class="nx">width</code><code> </code><code class="o">-</code><code> </code><code class="nx">margin</code><code class="p">.</code><code class="nx">left</code><code> </code><code class="o">-</code><code> </code><code class="nx">margin</code><code class="p">.</code><code class="nx">right</code><code class="p">,</code><code>
</code><code class="nx">height</code><code> </code><code class="o">=</code><code> </code><code class="nx">boundingRect</code><code class="p">.</code><code class="nx">height</code><code> </code><code class="o">-</code><code> </code><code class="nx">margin</code><code class="p">.</code><code class="nx">top</code><code> </code><code class="o">-</code><code> </code><code class="nx">margin</code><code class="p">.</code><code class="nx">bottom</code><code class="p">;</code><code>
</code><code class="c1">// SCALES WITH RANGES
</code><code class="kd">var</code><code> </code><code class="nx">xScale</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">scale</code><code class="p">.</code><code class="nx">ordinal</code><code class="p">(</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">rangeBands</code><code class="p">(</code><code class="p">[</code><code class="mi">0</code><code class="p">,</code><code> </code><code class="nx">width</code><code class="p">]</code><code class="p">,</code><code> </code><code class="mf">0.1</code><code class="p">)</code><code class="p">;</code><code>

</code><code class="kd">var</code><code> </code><code class="nx">yScale</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">scale</code><code class="p">.</code><code class="nx">linear</code><code class="p">(</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">rangeRound</code><code class="p">(</code><code class="p">[</code><code class="nx">height</code><code class="p">,</code><code> </code><code class="mi">0</code><code class="p">]</code><code class="p">)</code><code class="p">;</code><code>
</code><code class="c1">// CHART-HOLDER GROUP
</code><code class="kd">var</code><code> </code><code class="nx">svg</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s1">'#nobel-bar'</code><code class="p">)</code><code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s2">"svg"</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"width"</code><code class="p">,</code><code> </code><code class="nx">width</code><code> </code><code class="o">+</code><code> </code><code class="nx">margin</code><code class="p">.</code><code class="nx">left</code><code> </code><code class="o">+</code><code> </code><code class="nx">margin</code><code class="p">.</code><code class="nx">right</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"height"</code><code class="p">,</code><code> </code><code class="nx">height</code><code> </code><code class="o">+</code><code> </code><code class="nx">margin</code><code class="p">.</code><code class="nx">top</code><code> </code><code class="o">+</code><code> </code><code class="nx">margin</code><code class="p">.</code><code class="nx">bottom</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s2">"g"</code><code class="p">)</code><code class="p">.</code><code class="nx">classed</code><code class="p">(</code><code class="s1">'chart'</code><code class="p">,</code><code> </code><code class="kc">true</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"transform"</code><code class="p">,</code><code> </code><code class="s2">"translate("</code><code> </code><code class="o">+</code><code>
          </code><code class="nx">margin</code><code class="p">.</code><code class="nx">left</code><code> </code><code class="o">+</code><code> </code><code class="s2">","</code><code> </code><code class="o">+</code><code> </code><code class="nx">margin</code><code class="p">.</code><code class="nx">top</code><code> </code><code class="o">+</code><code> </code><code class="s2">")"</code><code class="p">)</code><code class="p">;</code><code>
</code><code class="c1">// OUR UPDATE FUNCTION
</code><code class="kd">var</code><code> </code><code class="nx">update</code><code> </code><code class="o">=</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">data</code><code class="p">)</code><code class="p">{</code><code>
    </code><code class="c1">// UPDATE SCALE DOMAINS FOR CHANGED DATA
</code><code>    </code><code class="nx">xScale</code><code class="p">.</code><code class="nx">domain</code><code class="p">(</code><code class="nx">d3</code><code class="p">.</code><code class="nx">range</code><code class="p">(</code><code class="nx">data</code><code class="p">.</code><code class="nx">length</code><code class="p">)</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" id="co_introducing_d3__8212_the_story_of_a_bar_chart_CO10-1" href="#callout_introducing_d3__8212_the_story_of_a_bar_chart_CO10-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
    </code><code class="nx">yScale</code><code class="p">.</code><code class="nx">domain</code><code class="p">(</code><code class="p">[</code><code class="mi">0</code><code class="p">,</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">max</code><code class="p">(</code><code class="nx">data</code><code class="p">.</code><code class="nx">map</code><code class="p">(</code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code> </code><code class="p">{</code><code> </code><a class="co" id="co_introducing_d3__8212_the_story_of_a_bar_chart_CO10-2" href="#callout_introducing_d3__8212_the_story_of_a_bar_chart_CO10-2"><img src="2.png" alt="2" width="12" height="12"></a><code>
        </code><code class="k">return</code><code> </code><code class="nx">d</code><code class="p">.</code><code class="nx">value</code><code class="p">;</code><code>
    </code><code class="p">}</code><code class="p">)</code><code class="p">)</code><code class="p">]</code><code class="p">)</code><code class="p">;</code><code>
    </code><code class="c1">// JOIN DATA TO BAR-GROUP
</code><code>    </code><code class="kd">var</code><code> </code><code class="nx">bars</code><code> </code><code class="o">=</code><code> </code><code class="nx">svg</code><code class="p">.</code><code class="nx">selectAll</code><code class="p">(</code><code class="s1">'.bar'</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">data</code><code class="p">(</code><code class="nx">data</code><code class="p">)</code><code class="p">;</code><code>
    </code><code class="c1">// APPEND BARS FOR UNBOUND DATA
</code><code>    </code><code class="nx">bars</code><code class="p">.</code><code class="nx">enter</code><code class="p">(</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s1">'rect'</code><code class="p">)</code><code class="p">.</code><code class="nx">classed</code><code class="p">(</code><code class="s1">'bar'</code><code class="p">,</code><code> </code><code class="kc">true</code><code class="p">)</code><code class="p">;</code><code>
    </code><code class="c1">// UPDATE ALL BARS WITH BOUND DATA
</code><code>    </code><code class="nx">bars</code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s1">'height'</code><code class="p">,</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">,</code><code> </code><code class="nx">i</code><code class="p">)</code><code class="p">{</code><code>
      </code><code class="k">return</code><code> </code><code class="nx">height</code><code class="o">-</code><code class="nx">yScale</code><code class="p">(</code><code class="nx">d</code><code class="p">.</code><code class="nx">value</code><code class="p">)</code><code class="p">;</code><code> </code><code class="p">}</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s1">'width'</code><code class="p">,</code><code> </code><code class="nx">xScale</code><code class="p">.</code><code class="nx">rangeBand</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s1">'y'</code><code class="p">,</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code> </code><code class="p">{</code><code>
            </code><code class="k">return</code><code> </code><code class="nx">yScale</code><code class="p">(</code><code class="nx">d</code><code class="p">.</code><code class="nx">value</code><code class="p">)</code><code class="p">;</code><code>
        </code><code class="p">}</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s1">'x'</code><code class="p">,</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">,</code><code> </code><code class="nx">i</code><code class="p">)</code><code> </code><code class="p">{</code><code>
            </code><code class="k">return</code><code> </code><code class="nx">xScale</code><code class="p">(</code><code class="nx">i</code><code class="p">)</code><code class="p">;</code><code>
        </code><code class="p">}</code><code class="p">)</code><code class="p">;</code><code>
    </code><code class="c1">// REMOVE ANY BARS WITHOUT BOUND DATA
</code><code>    </code><code class="nx">bars</code><code class="p">.</code><code class="nx">exit</code><code class="p">(</code><code class="p">)</code><code class="p">.</code><code class="nx">remove</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code>
</code><code class="p">}</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_introducing_d3__8212_the_story_of_a_bar_chart_CO10-1" href="#co_introducing_d3__8212_the_story_of_a_bar_chart_CO10-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>Our x-scale domain is just [0, 1, … <em>n</em>-1], where <em>n</em> is the length of our dataset. <code>d3.range</code> is a handy method, which takes an input integer <em>n</em> and produces an array [0, … <em>n</em>–1].</p></dd>
<dt><a class="co" id="callout_introducing_d3__8212_the_story_of_a_bar_chart_CO10-2" href="#co_introducing_d3__8212_the_story_of_a_bar_chart_CO10-2"><img src="2.png" alt="2" width="12" height="12"></a></dt>
<dd><p>Use D3’s <code>max</code> method to get the max value in our dataset.<a data-type="indexterm" data-primary="" data-startref="DBup16" id="idm140319395699264"></a><a data-type="indexterm" data-primary="" data-startref="update16" id="idm140319395698288"></a><a data-type="indexterm" data-primary="" data-startref="D3barup16" id="idm140319395697344"></a></p></dd>
</dl></div>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Axes and Labels"><div class="sect1" id="sect_axes_labels">
<h1>Axes and Labels</h1>

<p><a data-type="indexterm" data-primary="data binding (D3 library)" data-secondary="axes/labels" id="DBax16"></a><a data-type="indexterm" data-primary="axes (D3 library)" id="ax16"></a><a data-type="indexterm" data-primary="labels (D3 library)" id="lb16"></a><a data-type="indexterm" data-primary="D3 library" data-secondary="bar charts" data-tertiary="axes/labels" id="D3barax16"></a>Now that we have a working update pattern, we will add the axes and axes labels that any self-respecting bar chart needs.</p>

<p>D3 doesn’t offer a lot in the way of high-level chart elements, encouraging you to roll your own. But it does provide a convenient <code>axis</code> object, which takes the sting out of having to craft the SVG elements yourself. It’s easy to use and, as you would expect, plays nicely with our data update patterns, allowing for axes ticks and labels that change in response to the data presented.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm140319395123760">
<h5>D3 Axes</h5>
<p>D3 axes can be confusing at first, feeling just a little bit magical. It’s best to think of them as a plugin<sup><a data-type="noteref" id="idm140319395122064-marker" href="ch16.html#idm140319395122064">7</a></sup> that generates the correct axis HTML (lines, ticks, tick labels, etc.) for you and which can respond sensibly to changes in data (i.e., if you change the range of your scales, the axes can change in response using nice, smooth transitions that look pretty cool).</p>

<p>Generally with a D3 axis, you will create an SVG group to hold it and then call the axis on it, having set the scale it will represent. During the <code>call</code>, the axis object will <em>stamp</em> the correct HTML on the DOM. So, as a simple demo,  the following page describes a simple chart setup with an SVG <code>x-axis</code> group and a D3 axis. Calling the axis on the axis group generates the HTML lines and text needed for an axis.</p>

<pre data-type="programlisting" data-code-language="html"><code class="cp">&lt;!DOCTYPE html&gt;</code><code>
</code><code class="nt">&lt;meta</code><code> </code><code class="na">charset=</code><code class="s">"utf-8"</code><code class="nt">&gt;</code><code>
</code><code class="nt">&lt;script
    </code><code class="na">src=</code><code class="s">"https://cdnjs.cloudflare.com/ajax/
         libs/d3/3.5.5/d3.min.js"</code><code class="nt">&gt;</code><code>
</code><code class="nt">&lt;/script&gt;</code><code>
</code><code class="nt">&lt;style</code><code class="nt">&gt;</code><code> </code><code class="nt">svg</code><code class="p">{</code><code class="k">width</code><code class="o">:</code><code class="m">600px</code><code class="p">;</code><code> </code><code class="k">height</code><code class="o">:</code><code class="m">400px</code><code class="p">}</code><code> </code><code class="nt">&lt;/style&gt;</code><code>

</code><code class="nt">&lt;body</code><code class="nt">&gt;</code><code>
  </code><code class="nt">&lt;svg</code><code class="nt">&gt;</code><code>
    </code><code class="nt">&lt;g</code><code> </code><code class="na">id=</code><code class="s">'chart'</code><code> </code><code class="na">transform=</code><code class="s">'translate(20,20)'</code><code class="nt">&gt;</code><code>
      </code><code class="nt">&lt;g</code><code> </code><code class="na">id=</code><code class="s">'x-axis'</code><code class="nt">&gt;</code><code class="nt">&lt;/g&gt;</code><code>
    </code><code class="nt">&lt;/g&gt;</code><code>
  </code><code class="nt">&lt;/svg&gt;</code><code>
  </code><code class="nt">&lt;script</code><code class="nt">&gt;</code><code>
    </code><code class="kd">var</code><code> </code><code class="nx">scale</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">scale</code><code class="p">.</code><code class="nx">linear</code><code class="p">(</code><code class="p">)</code><code>
                  </code><code class="p">.</code><code class="nx">domain</code><code class="p">(</code><code class="p">[</code><code class="mi">0</code><code class="p">,</code><code> </code><code class="mi">10</code><code class="p">]</code><code class="p">)</code><code class="p">.</code><code class="nx">range</code><code class="p">(</code><code class="p">[</code><code class="mi">0</code><code class="p">,</code><code class="mi">400</code><code class="p">]</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" id="co_introducing_d3__8212_the_story_of_a_bar_chart_CO11-1" href="#callout_introducing_d3__8212_the_story_of_a_bar_chart_CO11-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
    </code><code class="kd">var</code><code> </code><code class="nx">xaxis</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">svg</code><code class="p">.</code><code class="nx">axis</code><code class="p">(</code><code class="p">)</code><code class="p">.</code><code class="nx">scale</code><code class="p">(</code><code class="nx">scale</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" id="co_introducing_d3__8212_the_story_of_a_bar_chart_CO11-2" href="#callout_introducing_d3__8212_the_story_of_a_bar_chart_CO11-2"><img src="2.png" alt="2" width="12" height="12"></a><code>
    </code><code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s1">'#x-axis'</code><code class="p">)</code><code class="p">.</code><code class="nx">call</code><code class="p">(</code><code class="nx">xaxis</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" id="co_introducing_d3__8212_the_story_of_a_bar_chart_CO11-3" href="#callout_introducing_d3__8212_the_story_of_a_bar_chart_CO11-3"><img src="3.png" alt="3" width="12" height="12"></a><code>
  </code><code class="nt">&lt;/script&gt;</code><code>
</code><code class="nt">&lt;/body&gt;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_introducing_d3__8212_the_story_of_a_bar_chart_CO11-1" href="#co_introducing_d3__8212_the_story_of_a_bar_chart_CO11-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>Creates a scale with a domain of 0 to 10 and a range of 400 (pixels).</p></dd>
<dt><a class="co" id="callout_introducing_d3__8212_the_story_of_a_bar_chart_CO11-2" href="#co_introducing_d3__8212_the_story_of_a_bar_chart_CO11-2"><img src="2.png" alt="2" width="12" height="12"></a></dt>
<dd><p>Creates a D3 axis, using the scale just defined.</p></dd>
<dt><a class="co" id="callout_introducing_d3__8212_the_story_of_a_bar_chart_CO11-3" href="#co_introducing_d3__8212_the_story_of_a_bar_chart_CO11-3"><img src="3.png" alt="3" width="12" height="12"></a></dt>
<dd><p>Calling the D3 axis on our <code>x-axis</code> group creates the axis HTML branch shown in <a data-type="xref" href="#d3bar_axis_side_html">Figure 16-21</a>, which looks like <a data-type="xref" href="#d3bar_axis_side">Figure 16-20</a>.</p></dd>
</dl>

<figure><div id="d3bar_axis_side" class="figure">
<img src="dvpj_1620.png" alt="dvpj 1620" width="437" height="53">
<h6><span class="label">Figure 16-20. </span>A simple D3 axis</h6>
</div></figure>

<figure><div id="d3bar_axis_side_html" class="figure">
<img src="dvpj_1621.png" alt="dvpj 1621" width="825" height="253">
<h6><span class="label">Figure 16-21. </span>The HTML branch created by a D3 axis instance</h6>
</div></figure>

<p>Using the <code>call</code> method on a selection is a common D3 technique to create plugins such as tooltips and brushes. There are loads of examples on <code>bl.ocks.org</code> like <a href="http://bl.ocks.org/cpbotha/5073718">this one</a> by Charl Botha. I wrote a little <a href="http://kyrandale.com/blog/building-d3-plugin/">blog post</a> about extending the technique. The main take-home is that it’s not magic and it’s certainly important that you understand the basics of what’s happening during that <code>call</code> method.</p>
</div></aside>

<p>In order to define our x and y axes, we need to know what ranges and domains we want our axes to represent. In our case, it’s the same one as the ranges and domains of our x and y scales, so we supply these to the axes’ <code>scale</code> method. D3 axes also allow you to specify their orientation, which will fix the relative position of ticks and tick labels. With our bar chart, we want the x-axis on the bottom and the y-axis on the left. Our ordinal x-axis will have a label for each bar, but with our y-axis, the choice of tick numbers is arbitrary. Ten seems like a reasonable number, so we set that using the <code>ticks</code> method.  The following code shows how we declare our bar chart’s axes:</p>

<pre data-type="programlisting" data-code-language="js"><code class="kd">var</code><code> </code><code class="nx">xAxis</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">svg</code><code class="p">.</code><code class="nx">axis</code><code class="p">(</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">scale</code><code class="p">(</code><code class="nx">xScale</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">orient</code><code class="p">(</code><code class="s2">"bottom"</code><code class="p">)</code><code class="p">;</code><code>

</code><code class="kd">var</code><code> </code><code class="nx">yAxis</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">svg</code><code class="p">.</code><code class="nx">axis</code><code class="p">(</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">scale</code><code class="p">(</code><code class="nx">yScale</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">orient</code><code class="p">(</code><code class="s1">'left'</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">ticks</code><code class="p">(</code><code class="mi">10</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">tickFormat</code><code class="p">(</code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code> </code><code class="p">{</code><code> </code><a class="co" id="co_introducing_d3__8212_the_story_of_a_bar_chart_CO12-1" href="#callout_introducing_d3__8212_the_story_of_a_bar_chart_CO12-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
            </code><code class="k">if</code><code class="p">(</code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">valuePerCapita</code><code class="p">)</code><code class="p">{</code><code>
                </code><code class="k">return</code><code> </code><code class="nx">d</code><code class="p">.</code><code class="nx">toExponential</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code>
            </code><code class="p">}</code><code>
            </code><code class="k">return</code><code> </code><code class="nx">d</code><code class="p">;</code><code>
        </code><code class="p">}</code><code class="p">)</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_introducing_d3__8212_the_story_of_a_bar_chart_CO12-1" href="#co_introducing_d3__8212_the_story_of_a_bar_chart_CO12-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>We want the format of our tick labels to change with our chosen metric, per capita or absolute. Per capita produces a very small number that is best represented in exponential form (e.g., 0.000005 → 5e-6). The <code>tickFormat</code> method allows you to take the data value at each tick and return the desired tick string.</p></dd>
</dl>

<p>We’ll also need a little bit of CSS to style the axes correctly, removing the default <code>fill</code>, setting the stroke color to black, and making the shape render crisply. We’ll also specify the font size and family while we’re at it:</p>

<pre data-type="programlisting" data-code-language="css"><code class="c">/* style.css */</code>
<code class="nc">.axis</code> <code class="p">{</code> <code class="k">font</code><code class="o">:</code> <code class="m">10px</code> <code class="nb">sans-serif</code><code class="p">;</code> <code class="p">}</code>
<code class="nc">.axis</code> <code class="nt">path</code><code class="o">,</code> <code class="nc">.axis</code> <code class="nt">line</code> <code class="p">{</code>
    <code class="k">fill</code><code class="o">:</code> <code class="nb">none</code><code class="p">;</code>
    <code class="k">stroke</code><code class="o">:</code> <code class="m">#000</code><code class="p">;</code>
    <code class="k">shape-rendering</code><code class="o">:</code> <code class="n">crispEdges</code><code class="p">;</code>
<code class="p">}</code></pre>

<p>Up to now, we’ve been using a numerical domain as placeholder for our ordinal x-axis (see <a data-type="xref" href="#d3bar_update_code">Example 16-3</a> <img src="1.png" alt="1" width="12" height="12">). Now we need it to contain the bar labels, which will be used to make the x-ticks of our chart. The country data supplied to our <code>update</code> method is of the form:</p>

<pre data-type="programlisting" data-code-language="js"><code class="p">[</code>
  <code class="p">{</code>
   <code class="nx">code</code><code class="o">:</code> <code class="s2">"USA"</code><code class="p">,</code> <code class="c1">// Three-digit country code</code>
   <code class="nx">key</code><code class="o">:</code> <code class="s2">"United States"</code><code class="p">,</code>
   <code class="nx">population</code><code class="o">:</code> <code class="mi">319259000</code><code class="p">,</code>
   <code class="nx">value</code><code class="o">:</code> <code class="mi">336</code>
  <code class="p">},</code>
  <code class="c1">// ... 56 more countries</code>
<code class="p">]</code></pre>

<p>We want to use those three-digit country codes as handy x-labels, which means updating the domain of our ordinal x-scale. The following code uses the data array’s <code>map</code> method to return an array of country codes, which are used to set the domain of our x-scale to [“USA”, “GBR”, “DEU”, …]:</p>

<pre data-type="programlisting" data-code-language="js"><code class="nx">xScale</code><code class="p">.</code><code class="nx">domain</code><code class="p">(</code> <code class="nx">data</code><code class="p">.</code><code class="nx">map</code><code class="p">(</code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code> <code class="p">{</code> <code class="k">return</code> <code class="nx">d</code><code class="p">.</code><code class="nx">code</code><code class="p">;</code> <code class="p">})</code> <code class="p">);</code></pre>

<p>Now that we have our <code>axis</code> generators, we need a couple of SVG groups to hold the axes they produce. Let’s add these to our main <code>svg</code> selector as groups with sensible class names:</p>

<pre data-type="programlisting" data-code-language="js"><code class="nx">svg</code><code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s2">"g"</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"class"</code><code class="p">,</code><code> </code><code class="s2">"x axis"</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"transform"</code><code class="p">,</code><code> </code><code class="s2">"translate(0,"</code><code> </code><code class="o">+</code><code> </code><code class="nx">height</code><code> </code><code class="o">+</code><code> </code><code class="s2">")"</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" id="co_introducing_d3__8212_the_story_of_a_bar_chart_CO13-1" href="#callout_introducing_d3__8212_the_story_of_a_bar_chart_CO13-1"><img src="1.png" alt="1" width="12" height="12"></a><code>

</code><code class="nx">svg</code><code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s2">"g"</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"class"</code><code class="p">,</code><code> </code><code class="s2">"y axis"</code><code class="p">)</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_introducing_d3__8212_the_story_of_a_bar_chart_CO13-1" href="#co_introducing_d3__8212_the_story_of_a_bar_chart_CO13-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>By SVG’s convention, y is measured from the top down, so we want our <em>bottom</em>-oriented x-axis translated from the chart’s top by <em>height</em> pixels.</p></dd>
</dl>

<p>Our bar chart’s axes have fixed ranges (the width and height of the chart), but their domains will change as the user filters the dataset. For example, the number of (country) bars will be reduced if the user filters the data by Economics category: this will change the domain of the ordinal x-scale (number of bars) and the quantitative y-scale (maximum number of winners). We want the displayed axes to change with these changing domains, with a nice transition for good measure.</p>

<p><a data-type="xref" href="#d3bar_axes_code">Example 16-4</a> shows how the axes are updated. First we update our scale domains using the new data (A). These new scale domains are reflected when the axes generators (which are linked to them) are called on their respective axis groups.</p>
<div id="d3bar_axes_code" data-type="example">
<h5><span class="label">Example 16-4. </span>Updating our bar chart’s axes</h5>

<pre data-type="programlisting" data-code-language="js"><code class="nx">update</code><code> </code><code class="o">=</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">data</code><code class="p">)</code><code> </code><code class="p">{</code><code>
    </code><code class="c1">// A. Update scale domains with new data
</code><code>    </code><code class="nx">xScale</code><code class="p">.</code><code class="nx">domain</code><code class="p">(</code><code> </code><code class="nx">data</code><code class="p">.</code><code class="nx">map</code><code class="p">(</code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code> </code><code class="p">{</code><code> </code><code class="k">return</code><code> </code><code class="nx">d</code><code class="p">.</code><code class="nx">code</code><code class="p">;</code><code> </code><code class="p">}</code><code class="p">)</code><code> </code><code class="p">)</code><code class="p">;</code><code>
    </code><code class="nx">yScale</code><code class="p">.</code><code class="nx">domain</code><code class="p">(</code><code class="p">[</code><code class="mi">0</code><code class="p">,</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">max</code><code class="p">(</code><code class="nx">data</code><code class="p">,</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code class="p">{</code><code>
                                       </code><code class="k">return</code><code> </code><code class="o">+</code><code class="nx">d</code><code class="p">.</code><code class="nx">value</code><code class="p">;</code><code> </code><code class="p">}</code><code class="p">)</code><code class="p">]</code><code class="p">)</code><code class="p">;</code><code>
    </code><code class="c1">// B. Use the axes generators with the new scale domains
</code><code>    </code><code class="nx">svg</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s1">'.x.axis'</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">call</code><code class="p">(</code><code class="nx">xAxis</code><code class="p">)</code><code> </code><a class="co" id="co_introducing_d3__8212_the_story_of_a_bar_chart_CO14-1" href="#callout_introducing_d3__8212_the_story_of_a_bar_chart_CO14-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
        </code><code class="p">.</code><code class="nx">selectAll</code><code class="p">(</code><code class="s2">"text"</code><code class="p">)</code><code> </code><a class="co" id="co_introducing_d3__8212_the_story_of_a_bar_chart_CO14-2" href="#callout_introducing_d3__8212_the_story_of_a_bar_chart_CO14-2"><img src="2.png" alt="2" width="12" height="12"></a><code>
        </code><code class="p">.</code><code class="nx">style</code><code class="p">(</code><code class="s2">"text-anchor"</code><code class="p">,</code><code> </code><code class="s2">"end"</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"dx"</code><code class="p">,</code><code> </code><code class="s2">"-.8em"</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"dy"</code><code class="p">,</code><code> </code><code class="s2">".15em"</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"transform"</code><code class="p">,</code><code> </code><code class="s2">"rotate(-65)"</code><code class="p">)</code><code class="p">;</code><code>

    </code><code class="nx">svg</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s1">'.y.axis'</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">call</code><code class="p">(</code><code class="nx">yAxis</code><code class="p">)</code><code class="p">;</code><code>
    </code><code class="c1">// ...</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_introducing_d3__8212_the_story_of_a_bar_chart_CO14-1" href="#co_introducing_d3__8212_the_story_of_a_bar_chart_CO14-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>Calling the D3 <code>axis</code> on our x-axis group element builds all the necessary axis SVG in it, including ticks and tick labels. D3 <code>axis</code> uses an internal update pattern to enable transitions to newly bound data.</p></dd>
<dt><a class="co" id="callout_introducing_d3__8212_the_story_of_a_bar_chart_CO14-2" href="#co_introducing_d3__8212_the_story_of_a_bar_chart_CO14-2"><img src="2.png" alt="2" width="12" height="12"></a></dt>
<dd><p>After creating the x-axis, we perform some SVG manipulations of the text labels generated. First we select the <code>text</code> elements of the axis, the tick labels. We then place their text anchors at the end of the element and shift their position a bit. This is because the text is rotated about its anchor and we want to rotate about the end of the country labels, now positioned under the tick lines. The result of our manipulations is shown in <a data-type="xref" href="#d3bar_x_axis">Figure 16-22</a>. Note that without rotating our labels, they would merge into one another.</p></dd>
</dl></div>

<figure><div id="d3bar_x_axis" class="figure">
<img src="dvpj_1622.png" alt="dvpj 1622" width="240" height="65">
<h6><span class="label">Figure 16-22. </span>Reoriented tick labels on the x-axis</h6>
</div></figure>

<p>Now that we have our working axes, let’s add a little label to the x-axis and then see how the bar chart copes with our real data:</p>

<pre data-type="programlisting" data-code-language="js"><code class="kd">var</code><code> </code><code class="nx">X_PADDING_LEFT</code><code>  </code><code class="o">=</code><code> </code><code class="mi">20</code><code class="p">;</code><code> </code><a class="co" id="co_introducing_d3__8212_the_story_of_a_bar_chart_CO15-1" href="#callout_introducing_d3__8212_the_story_of_a_bar_chart_CO15-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
</code><code class="c1">//...
</code><code class="kd">var</code><code> </code><code class="nx">xScale</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">scale</code><code class="p">.</code><code class="nx">ordinal</code><code class="p">(</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">rangeBands</code><code class="p">(</code><code class="p">[</code><code class="nx">X_PADDING_LEFT</code><code class="p">,</code><code> </code><code class="nx">width</code><code class="p">]</code><code class="p">,</code><code> </code><code class="mf">0.1</code><code class="p">)</code><code class="p">;</code><code>
</code><code class="c1">//...
</code><code class="nx">svg</code><code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s2">"g"</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"class"</code><code class="p">,</code><code> </code><code class="s2">"y axis"</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s2">"text"</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s1">'id'</code><code class="p">,</code><code> </code><code class="s1">'y-axis-label'</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"transform"</code><code class="p">,</code><code> </code><code class="s2">"rotate(-90)"</code><code class="p">)</code><code> </code><a class="co" id="co_introducing_d3__8212_the_story_of_a_bar_chart_CO15-2" href="#callout_introducing_d3__8212_the_story_of_a_bar_chart_CO15-2"><img src="2.png" alt="2" width="12" height="12"></a><code>
    </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"y"</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"dy"</code><code class="p">,</code><code> </code><code class="s2">".71em"</code><code class="p">)</code><code> </code><a class="co" id="co_introducing_d3__8212_the_story_of_a_bar_chart_CO15-3" href="#callout_introducing_d3__8212_the_story_of_a_bar_chart_CO15-3"><img src="3.png" alt="3" width="12" height="12"></a><code>
    </code><code class="p">.</code><code class="nx">style</code><code class="p">(</code><code class="s2">"text-anchor"</code><code class="p">,</code><code> </code><code class="s2">"end"</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">text</code><code class="p">(</code><code class="s1">'Number of winners'</code><code class="p">)</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_introducing_d3__8212_the_story_of_a_bar_chart_CO15-1" href="#co_introducing_d3__8212_the_story_of_a_bar_chart_CO15-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>A left padding constant, in pixels, to make way for the y-axis label.</p></dd>
<dt><a class="co" id="callout_introducing_d3__8212_the_story_of_a_bar_chart_CO15-2" href="#co_introducing_d3__8212_the_story_of_a_bar_chart_CO15-2"><img src="2.png" alt="2" width="12" height="12"></a></dt>
<dd><p>Rotates the text anticlockwise to the upright position.</p></dd>
<dt><a class="co" id="callout_introducing_d3__8212_the_story_of_a_bar_chart_CO15-3" href="#co_introducing_d3__8212_the_story_of_a_bar_chart_CO15-3"><img src="3.png" alt="3" width="12" height="12"></a></dt>
<dd><p><code>dy</code> is a relative coordinate [relative to the <em>y</em> coordinate just specified (6)]. By using the <code>em</code> unit (relative to font size), we can make handy adjustments to the text margin and baseline. See the <a href="https://github.com/mbostock/d3/wiki/SVG-Shapes#svg_text">D3 docs</a> for a full explanation and examples.</p></dd>
</dl>

<p><a data-type="xref" href="#d3bar_update_lit">Figure 16-23</a> shows the result of filtering our Nobel Prize winners’ dataset for Chemistry winners, using our category selector filter. The bar widths increase to reflect the reduced number of countries, and both axes adapt to the new dataset.</p>

<figure><div id="d3bar_update_lit" class="figure">
<img src="dvpj_1623.png" alt="dvpj 1623" width="1565" height="1282">
<h6><span class="label">Figure 16-23. </span>The Nobel Prize bar chart before and after we apply the category filter for Chemistry winners</h6>
</div></figure>

<p>We now have a working bar chart, using the update pattern to adjust itself as the user-driven dataset changes. But although it’s functional, the transition in response to data change is visually stark, even jarring. One way to make the change much more engaging and even informative would be to have the chart update continuously over a short time period, with preserved country bars moving from their old to new position while simultaneously adapting their height and width. Such continuous transitions really add life to a visualization and are seen in many of the most impressive D3 pieces. The good news is that transitions are tightly integrated into D3’s workflow, which means you can achieve these cool visual effects for the cost of a few lines of code.<a data-type="indexterm" data-primary="" data-startref="DBax16" id="idm140319395509408"></a><a data-type="indexterm" data-primary="" data-startref="ax16" id="idm140319395508400"></a><a data-type="indexterm" data-primary="" data-startref="lb16" id="idm140319395507456"></a><a data-type="indexterm" data-primary="" data-startref="D3barax16" id="idm140319395506512"></a></p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Transitions"><div class="sect1" id="sect_transitions">
<h1>Transitions</h1>

<p><a data-type="indexterm" data-primary="data binding (D3 library)" data-secondary="transitions" id="DBtrans16"></a><a data-type="indexterm" data-primary="D3 library" data-secondary="bar charts" data-tertiary="transitions" id="D3bartrans16"></a><a data-type="indexterm" data-primary="transitions (D3 library)" id="trans16"></a>As it stands, our bar chart is perfectly functional. It responds to data changes by adding or removing bar elements and then updating them using the new data. But the immediate change from one reflection of the data to another feels a little stark and visually <span class="keep-together">jarring</span>.</p>

<p>D3’s transitions provide the ability to smooth the visual update of our elements, making them change continuously over a set time period. This can be both aesthetically appealing and, on occasion, informative.<sup><a data-type="noteref" id="idm140319395498720-marker" href="ch16.html#idm140319395498720">8</a></sup>  The important thing is that D3 transitions can be very engaging for the user, which is reason enough to want to master them.</p>

<p><a data-type="xref" href="#d3bar_transitions">Figure 16-24</a> shows the effect we are aiming at. When the bar chart is updated with a newly selected dataset, we want the bars of any countries present before and after the transition to morph smoothly from their old to new positions and dimensions. So in <a data-type="xref" href="#d3bar_transitions">Figure 16-24</a> the bar for France grows from start to finish over the course of the transition—say, a couple of seconds—with intermediate bars of increasing width and height. The axes ticks and labels will adapt too as the x and y scales change.</p>

<figure><div id="d3bar_transitions" class="figure">
<img src="dvpj_1624.png" alt="dvpj 1624" width="127" height="136">
<h6><span class="label">Figure 16-24. </span>Tweened bar transitions on update</h6>
</div></figure>

<p>The effect shown in <a data-type="xref" href="#d3bar_transitions">Figure 16-24</a> is surprisingly easy to achieve but involves understanding the precise way data is joined in D3. By default, when new data is bound to existing DOM elements, it is done by array index. <a data-type="xref" href="#d3bar_data_index">Figure 16-25</a> shows how this works, using our selected bars as an example. The first bar (B0), previously bound to the USA’s data, is now bound to France’s. It stays in first position and updates its size and tick label. Essentially, the USA’s bar becomes France’s.<sup><a data-type="noteref" id="idm140319395369104-marker" href="ch16.html#idm140319395369104">9</a></sup></p>

<figure><div id="d3bar_data_index" class="figure">
<img src="dvpj_1625.png" alt="dvpj 1625" width="296" height="169">
<h6><span class="label">Figure 16-25. </span>By default, new data is joined by index</h6>
</div></figure>

<p>In order to get continuity during our transitions (i.e., for the USA bar to move to its new position while changing to its new height and width), we need the new data to be bound by a unique key, not the index. D3 allows you to specify a function as a second argument to the <code>data</code> method, which returns a key from the object data to use to bind the new data to the correct respective bars, assuming they still exist. <a data-type="xref" href="#d3bar_data_key">Figure 16-26</a> shows how this is done. Now, the first bar (0) is bound to the new USA data, changing its position by index as well as its width and height to that of the new American bar.</p>

<figure><div id="d3bar_data_key" class="figure">
<img src="dvpj_1626.png" alt="dvpj 1626" width="296" height="194">
<h6><span class="label">Figure 16-26. </span>Using an object key to join new data</h6>
</div></figure>

<p>Joining the data by key gives us the correct start and end points for our national bars. Now all we need is a way to create a smooth transition between them. We can do this by using a couple of D3’s coolest methods, <code>transition</code> and <code>duration</code>. By calling these before we change our bar dimension and position attributes, D3 magically performs a smooth transition between then, as shown in <a data-type="xref" href="#d3bar_transitions">Figure 16-24</a>. Adding transitions to our bar chart update requires only a few lines of code:</p>

<pre data-type="programlisting" data-code-language="js"><code class="c1">//...
</code><code class="nx">svg</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s1">'.x.axis'</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">transition</code><code class="p">(</code><code class="p">)</code><code class="p">.</code><code class="nx">duration</code><code class="p">(</code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">TRANS_DURATION</code><code class="p">)</code><code> </code><a class="co" id="co_introducing_d3__8212_the_story_of_a_bar_chart_CO16-1" href="#callout_introducing_d3__8212_the_story_of_a_bar_chart_CO16-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
    </code><code class="p">.</code><code class="nx">call</code><code class="p">(</code><code class="nx">xAxis</code><code class="p">)</code><code> </code><code class="c1">//...
</code><code class="c1">//...
</code><code class="nx">svg</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s1">'.y.axis'</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">transition</code><code class="p">(</code><code class="p">)</code><code class="p">.</code><code class="nx">duration</code><code class="p">(</code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">TRANS_DURATION</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">call</code><code class="p">(</code><code class="nx">yAxis</code><code class="p">)</code><code class="p">;</code><code>
</code><code class="c1">//...
</code><code class="kd">var</code><code> </code><code class="nx">bars</code><code> </code><code class="o">=</code><code> </code><code class="nx">svg</code><code class="p">.</code><code class="nx">selectAll</code><code class="p">(</code><code class="s2">".bar"</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">data</code><code class="p">(</code><code class="nx">data</code><code class="p">,</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code> </code><code class="p">{</code><code>
        </code><code class="k">return</code><code> </code><code class="nx">d</code><code class="p">.</code><code class="nx">code</code><code class="p">;</code><code> </code><a class="co" id="co_introducing_d3__8212_the_story_of_a_bar_chart_CO16-2" href="#callout_introducing_d3__8212_the_story_of_a_bar_chart_CO16-2"><img src="2.png" alt="2" width="12" height="12"></a><code>
    </code><code class="p">}</code><code class="p">)</code><code class="p">;</code><code>
</code><code class="c1">//...
</code><code class="nx">bars</code><code>
    </code><code class="p">.</code><code class="nx">classed</code><code class="p">(</code><code class="s1">'active'</code><code class="p">,</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code> </code><code class="p">{</code><code>
        </code><code class="k">return</code><code> </code><code class="nx">d</code><code class="p">.</code><code class="nx">key</code><code> </code><code class="o">===</code><code> </code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">activeCountry</code><code class="p">;</code><code>
    </code><code class="p">}</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">transition</code><code class="p">(</code><code class="p">)</code><code class="p">.</code><code class="nx">duration</code><code class="p">(</code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">TRANS_DURATION</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"x"</code><code class="p">,</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code> </code><code class="p">{</code><code> </code><code class="k">return</code><code> </code><code class="nx">xScale</code><code class="p">(</code><code class="nx">d</code><code class="p">.</code><code class="nx">code</code><code class="p">)</code><code class="p">;</code><code> </code><code class="p">}</code><code class="p">)</code><code> </code><a class="co" id="co_introducing_d3__8212_the_story_of_a_bar_chart_CO16-3" href="#callout_introducing_d3__8212_the_story_of_a_bar_chart_CO16-3"><img src="3.png" alt="3" width="12" height="12"></a><code>
    </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"width"</code><code class="p">,</code><code> </code><code class="nx">xScale</code><code class="p">.</code><code class="nx">rangeBand</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"y"</code><code class="p">,</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code> </code><code class="p">{</code><code> </code><code class="k">return</code><code> </code><code class="nx">yScale</code><code class="p">(</code><code class="nx">d</code><code class="p">.</code><code class="nx">value</code><code class="p">)</code><code class="p">;</code><code> </code><code class="p">}</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"height"</code><code class="p">,</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code> </code><code class="p">{</code><code>
      </code><code class="k">return</code><code> </code><code class="nx">height</code><code> </code><code class="o">-</code><code> </code><code class="nx">yScale</code><code class="p">(</code><code class="nx">d</code><code class="p">.</code><code class="nx">value</code><code class="p">)</code><code class="p">;</code><code> </code><code class="p">}</code><code class="p">)</code><code class="p">;</code><code>
</code><code class="c1">//...</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_introducing_d3__8212_the_story_of_a_bar_chart_CO16-1" href="#co_introducing_d3__8212_the_story_of_a_bar_chart_CO16-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>A transition with duration of two seconds, which is our <code>TRANS_DURATION</code> constant of 2000 (ms).</p></dd>
<dt><a class="co" id="callout_introducing_d3__8212_the_story_of_a_bar_chart_CO16-2" href="#co_introducing_d3__8212_the_story_of_a_bar_chart_CO16-2"><img src="2.png" alt="2" width="12" height="12"></a></dt>
<dd><p>Using the data object’s <code>code</code> property to make the continuous data joins.</p></dd>
<dt><a class="co" id="callout_introducing_d3__8212_the_story_of_a_bar_chart_CO16-3" href="#co_introducing_d3__8212_the_story_of_a_bar_chart_CO16-3"><img src="3.png" alt="3" width="12" height="12"></a></dt>
<dd><p>These attributes will be smoothly morphed from current values to those defined here.</p></dd>
</dl>

<p>Transitions will work on most obvious attributes and styles of an existing DOM element.<sup><a data-type="noteref" id="idm140319394765296-marker" href="ch16.html#idm140319394765296">10</a></sup></p>

<p>The transitions just shown perform a smooth change of the attributes from starting point to end goal, but D3 allows for a lot of tuning for these effects.  You can, for example, use the <code>delay</code> method to specify the time before the transition starts. This delay can also be a function of the data.</p>

<p><a data-type="indexterm" data-primary="Gizma" id="idm140319394762688"></a>Probably the most useful extra transitioning method is <code>ease</code>, which allows you to specify the way in which the elements’ attributes are updated over the transition’s duration. The default easing function is <a href="https://github.com/mbostock/d3/wiki/Transitions#ease">cubic-in-out</a>, but you can also specify things like <em>quad</em>, which speeds things up as the transition progresses, or <em>bounce</em> and <em>elastic</em>, which do pretty much what is says on the tin, giving a bouncy feel to the change. There’s also <em>sin</em>, which speeds up at the beginning and slows down toward the end. See <a href="http://easings.net/"><em class="hyperlink">http://easings.net/</em></a> for a nice description of different easing functions and <a href="http://bl.ocks.org/hunzy/9929724">this block</a> for a cool little demo of most of those available to D3. <a href="http://gizma.com/easing/">Gizma</a> has a great little app you can use to visualize the different easing functions.</p>

<p>If the easing functions available to D3 don’t suit your needs or you’re feeling particularly ambitious, as with most things D3 you can roll your own to fit any subtle requirements. The <code>tween</code> method provides the fine-grained control you might need.</p>

<p>With a working update pattern and some cool transitions, we have completed our Nobel-viz bar chart. There’s always room for refinement, but this bar chart will more than do the job. Let’s summarize what we’ve learned in this rather large chapter before moving on to the other components of our Nobel Prize visualization.<a data-type="indexterm" data-primary="" data-startref="DBtrans16" id="idm140319394721312"></a><a data-type="indexterm" data-primary="" data-startref="D3bartrans16" id="idm140319394720464"></a><a data-type="indexterm" data-primary="" data-startref="trans16" id="idm140319394719616"></a></p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Summary"><div class="sect1" id="idm140319395505312">
<h1>Summary</h1>

<p>This has been a large and quite challenging chapter. D3 isn’t the easiest library to learn, but I have smoothed the learning curve by breaking things down into digestible chunks. Take your time absorbing the fundamental ideas and, crucially, start setting yourself little objectives to stretch your D3 knowledge. I think D3 is very much an art form and, more than most libraries, one learns while doing.</p>

<p>The key elements to understanding D3 and applying it effectively are the update pattern and the data binding involved.  If you understand this at a fundamental level, most of D3’s other pyrotechnics slot nicely into place. Focus on the <code>data</code>, <code>enter</code>, <code>exit</code>, and <code>remove</code> methods and make sure you really understand what’s going on. It’s the only way to advance from much of the cut-and-paste style of D3 programming, which is initially productive, there being so many cool examples out there, but will eventually frustrate. Use your browser’s developer console (currently Chrome and Chromium have the best tools here) to inspect DOM elements, to see what data is bound to them via the <code>__data__</code> variable. If it doesn’t match your expectations, you’ll learn a lot by finding out why.</p>

<p>You should now have a pretty good grounding in D3’s core techniques. In the next chapter we’ll aim to challenge those new skills with a rather more ambitious chart, our Nobel Prize timeline.</p>
</div></section>







<div data-type="footnotes"><p data-type="footnote" id="idm140319398340448"><sup><a href="ch16.html#idm140319398340448-marker">1</a></sup> We’ll be dealing with axes, labels, and the like later in the chapter when we put D3 into top gear and start binding data.</p><p data-type="footnote" id="idm140319397973952"><sup><a href="ch16.html#idm140319397973952-marker">2</a></sup> See <a href="https://github.com/mbostock/d3/wiki/Scales">D3’s GitHub page</a> for a comprehensive list.</p><p data-type="footnote" id="idm140319397823760"><sup><a href="ch16.html#idm140319397823760-marker">3</a></sup> See <a href="https://github.com/mbostock/d3/wiki/Transitions#d3_interpolate">the D3 docs</a> for full details.</p><p data-type="footnote" id="idm140319397765904"><sup><a href="ch16.html#idm140319397765904-marker">4</a></sup> D3 will truncate whichever is bigger.</p><p data-type="footnote" id="idm140319397765216"><sup><a href="ch16.html#idm140319397765216-marker">5</a></sup> D3 has many built-in colormaps and sophisticated color handling with RGB, HCL, etc. We’ll see a few of these in action in the coming chapters.</p><p data-type="footnote" id="idm140319396453440"><sup><a href="ch16.html#idm140319396453440-marker">6</a></sup> See Mike Bostock’s demonstration of the general update pattern <a href="https://bl.ocks.org/mbostock/3808218">at bl.ocks.org</a>.</p><p data-type="footnote" id="idm140319395122064"><sup><a href="ch16.html#idm140319395122064-marker">7</a></sup> Axes follow a similar pattern to that proposed by Mike Bostock in <a href="https://bost.ocks.org/mike/chart/"><em>Towards Reusable Charts</em></a>, using the JavaScript objects’ <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/call"><code>call</code></a> method to build HTML on the selected DOM element(s).</p><p data-type="footnote" id="idm140319395498720"><sup><a href="ch16.html#idm140319395498720-marker">8</a></sup> For example, when we change our measurement of Nobel Prize wins by country from absolute to per capita, the large amount of movement displayed as the country bars change their order emphasizes the difference between the two metrics.</p><p data-type="footnote" id="idm140319395369104"><sup><a href="ch16.html#idm140319395369104-marker">9</a></sup> See Mike Bostock’s nice demonstration of object constancy at <a href="https://bost.ocks.org/mike/constancy/">his site</a>.</p><p data-type="footnote" id="idm140319394765296"><sup><a href="ch16.html#idm140319394765296-marker">10</a></sup> Transitions only apply to existing elements—you can’t fade in the creation of a DOM element, for example. You could, however, fade it in and out using the <code>opacity</code> CSS style.</p></div></div></section></div>



  <div class="t-sbo-prev sbo-prev sbo-nav-bottom">
  
    
      
        <a href="/library/view/data-visualization-with/9781491920565/ch15.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">15. Building a Visualization</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-bottom">
  
    
      
        <a href="/library/view/data-visualization-with/9781491920565/ch17.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">17. Visualizing Individual Prizes</div>
        </a>
    
  
  </div>


        
    </section>
  </div>
<section class="sbo-saved-archives"></section>



          
          
  




    
    
      <div id="js-subscribe-nag" class="subscribe-nag clearfix trial-panel t-subscribe-nag">
        
        
          
          

          
            <p>You have 7 days left in your trial, Flankpeter. Subscribe today. <a href="/subscribe/" class="ga-active-trial-subscribe-nag">See pricing options.</a></p>
          
        
        

      </div>

    
    



        
      </div>
      




  <footer class="pagefoot t-pagefoot">
    <a href="#" class="icon-up"><div class="visuallyhidden">Back to top</div></a>
    <ul class='js-footer-nav'>
      
        <li><a class="t-recommendations-footer" href="/r/">Recommended</a></li>
      
      <li>
      
      <a class="t-queue-footer" href="/playlists/">Playlists</a>
      
      </li>
      
        <li><a class="t-recent-footer" href="/history/">History</a></li>
        <li><a class="t-topics-footer" href="/topics?q=*&limit=21">Topics</a></li>
      
      
        <li><a class="t-tutorials-footer" href="/tutorials/">Tutorials</a></li>
      
      <li><a class="t-settings-footer js-settings" href="/u/">Settings</a></li>
      <li class="full-support"><a href="https://www.safaribooksonline.com/public/support">Support</a></li>
      <li><a href="https://www.safaribooksonline.com/apps/">Get the App</a></li>
      <li><a href="/accounts/logout/">Sign Out</a></li>
    </ul>
    <span class="copyright">&#169; 2018 <a href="https://www.safaribooksonline.com" target="_blank">Safari</a>.</span>
    <a href="/terms/">Terms of Service</a> /
    <a href="/privacy/">Privacy Policy</a>
  </footer>




    

    <script src="/jsi18n/web/" charset="utf-8"></script>
    <script src="/library/jsi18n/appcache/" charset="utf-8"></script>
  </body>
</html>
