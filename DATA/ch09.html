<!--[if IE]><![endif]--><!DOCTYPE html><!--[if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage"" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/data-visualization-with/9781491920565/ch09.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="2870136"
  data-user-uuid="fee1bd59-4e02-48a4-a7b4-152ec4c157ac"
  data-username="flankpeter"
  data-account-type="Trial"
  
  data-activated-trial-date="05/04/2018"


  data-archive="9781491920565"
  data-publishers="O&#39;Reilly Media, Inc."



  data-htmlfile-name="ch09.html"
  data-epub-title="Data Visualization with Python and JavaScript" data-debug=0 data-testing=0><![endif]--><!--[if gt IE 8]><!--><html class="no-js" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage"" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/data-visualization-with/9781491920565/ch09.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="2870136"
  data-user-uuid="fee1bd59-4e02-48a4-a7b4-152ec4c157ac"
  data-username="flankpeter"
  data-account-type="Trial"
  
  data-activated-trial-date="05/04/2018"


  data-archive="9781491920565"
  data-publishers="O&#39;Reilly Media, Inc."



  data-htmlfile-name="ch09.html"
  data-epub-title="Data Visualization with Python and JavaScript" data-debug=0 data-testing=0><!--<![endif]--><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="author" content="Safari Books Online" /><meta name="format-detection" content="telephone=no"><meta http-equiv="cleartype" content="on"/><meta name="HandheldFriendly" content="True"/><meta name="MobileOptimized" content="320"/><meta name="apple-itunes-app" content="app-id=881697395, app-argument=safaridetail://9781491920565"/><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0"/><meta property="twitter:account_id" content="4503599627559754" /><link rel="apple-touch-icon" href="/static/images/apple-touch-icon.0c29511d2d72.png"/><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"><link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900,200italic,300italic,400italic,600italic,700italic,900italic' rel='stylesheet' type='text/css'><title>9. Cleaning Data with Pandas - Data Visualization with Python and JavaScript</title><link rel="stylesheet" href="/static/CACHE/css/a04cd81b09cd.css" type="text/css" /><link rel="stylesheet" type="text/css" href="/static/css/annotator.ef38b0457d7b.css"/><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"><style type="text/css" title="ibis-book">
    @charset "utf-8";#sbo-rt-content html,#sbo-rt-content div,#sbo-rt-content div,#sbo-rt-content span,#sbo-rt-content applet,#sbo-rt-content object,#sbo-rt-content iframe,#sbo-rt-content h1,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5,#sbo-rt-content h6,#sbo-rt-content p,#sbo-rt-content blockquote,#sbo-rt-content pre,#sbo-rt-content a,#sbo-rt-content abbr,#sbo-rt-content acronym,#sbo-rt-content address,#sbo-rt-content big,#sbo-rt-content cite,#sbo-rt-content code,#sbo-rt-content del,#sbo-rt-content dfn,#sbo-rt-content em,#sbo-rt-content img,#sbo-rt-content ins,#sbo-rt-content kbd,#sbo-rt-content q,#sbo-rt-content s,#sbo-rt-content samp,#sbo-rt-content small,#sbo-rt-content strike,#sbo-rt-content strong,#sbo-rt-content sub,#sbo-rt-content sup,#sbo-rt-content tt,#sbo-rt-content var,#sbo-rt-content b,#sbo-rt-content u,#sbo-rt-content i,#sbo-rt-content center,#sbo-rt-content dl,#sbo-rt-content dt,#sbo-rt-content dd,#sbo-rt-content ol,#sbo-rt-content ul,#sbo-rt-content li,#sbo-rt-content fieldset,#sbo-rt-content form,#sbo-rt-content label,#sbo-rt-content legend,#sbo-rt-content table,#sbo-rt-content caption,#sbo-rt-content tdiv,#sbo-rt-content tfoot,#sbo-rt-content thead,#sbo-rt-content tr,#sbo-rt-content th,#sbo-rt-content td,#sbo-rt-content article,#sbo-rt-content aside,#sbo-rt-content canvas,#sbo-rt-content details,#sbo-rt-content embed,#sbo-rt-content figure,#sbo-rt-content figcaption,#sbo-rt-content footer,#sbo-rt-content header,#sbo-rt-content hgroup,#sbo-rt-content menu,#sbo-rt-content nav,#sbo-rt-content output,#sbo-rt-content ruby,#sbo-rt-content section,#sbo-rt-content summary,#sbo-rt-content time,#sbo-rt-content mark,#sbo-rt-content audio,#sbo-rt-content video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}#sbo-rt-content article,#sbo-rt-content aside,#sbo-rt-content details,#sbo-rt-content figcaption,#sbo-rt-content figure,#sbo-rt-content footer,#sbo-rt-content header,#sbo-rt-content hgroup,#sbo-rt-content menu,#sbo-rt-content nav,#sbo-rt-content section{display:block}#sbo-rt-content div{line-height:1}#sbo-rt-content ol,#sbo-rt-content ul{list-style:none}#sbo-rt-content blockquote,#sbo-rt-content q{quotes:none}#sbo-rt-content blockquote:before,#sbo-rt-content blockquote:after,#sbo-rt-content q:before,#sbo-rt-content q:after{content:none}#sbo-rt-content table{border-collapse:collapse;border-spacing:0}@page{margin:5px !important}#sbo-rt-content p{margin:10px 0 0;line-height:125%;text-align:left}#sbo-rt-content p.byline{text-align:left;margin:-33px auto 35px;font-style:italic;font-weight:bold}#sbo-rt-content div.preface p+p.byline{margin:1em 0 0}#sbo-rt-content div.preface p.byline+p.byline{margin:0}#sbo-rt-content div.sect1>p.byline{margin:-.25em 0 1em}#sbo-rt-content div.sect1>p.byline+p.byline{margin-top:-1em}#sbo-rt-content em{font-style:italic;font-family:inherit}#sbo-rt-content em strong,#sbo-rt-content strong em{font-weight:bold;font-style:italic;font-family:inherit}#sbo-rt-content strong,#sbo-rt-content span.bold{font-weight:bold}#sbo-rt-content em.replaceable{font-style:italic}#sbo-rt-content strong.userinput{font-weight:bold;font-style:normal}#sbo-rt-content span.bolditalic{font-weight:bold;font-style:italic}#sbo-rt-content a.ulink,#sbo-rt-content a.xref,#sbo-rt-content a.email,#sbo-rt-content a.link,#sbo-rt-content a{text-decoration:none;color:#8e0012}#sbo-rt-content span.lineannotation{font-style:italic;color:#a62a2a;font-family:serif}#sbo-rt-content span.underline{text-decoration:underline}#sbo-rt-content span.strikethrough{text-decoration:line-through}#sbo-rt-content span.smallcaps{font-variant:small-caps}#sbo-rt-content span.cursor{background:#000;color:#fff}#sbo-rt-content span.smaller{font-size:75%}#sbo-rt-content .boxedtext,#sbo-rt-content .keycap{border-style:solid;border-width:1px;border-color:#000;padding:1px}#sbo-rt-content span.gray50{color:#7F7F7F;}#sbo-rt-content h1,#sbo-rt-content div.toc-title,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5{-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;font-weight:bold;text-align:left;page-break-after:avoid !important;font-family:sans-serif,"DejaVuSans"}#sbo-rt-content div.toc-title{font-size:1.5em;margin-top:20px !important;margin-bottom:30px !important}#sbo-rt-content section[data-type="sect1"] h1{font-size:1.3em;color:#8e0012;margin:40px 0 8px 0}#sbo-rt-content section[data-type="sect2"] h2{font-size:1.1em;margin:30px 0 8px 0 !important}#sbo-rt-content section[data-type="sect3"] h3{font-size:1em;color:#555;margin:20px 0 8px 0 !important}#sbo-rt-content section[data-type="sect4"] h4{font-size:1em;font-weight:normal;font-style:italic;margin:15px 0 6px 0 !important}#sbo-rt-content section[data-type="chapter"]>div>h1,#sbo-rt-content section[data-type="preface"]>div>h1,#sbo-rt-content section[data-type="appendix"]>div>h1,#sbo-rt-content section[data-type="glossary"]>div>h1,#sbo-rt-content section[data-type="bibliography"]>div>h1,#sbo-rt-content section[data-type="index"]>div>h1{font-size:2em;line-height:1;margin-bottom:50px;color:#000;padding-bottom:10px;border-bottom:1px solid #000}#sbo-rt-content span.label,#sbo-rt-content span.keep-together{font-size:inherit;font-weight:inherit}#sbo-rt-content div[data-type="part"] h1{font-size:2em;text-align:center;margin-top:0 !important;margin-bottom:50px;padding:50px 0 10px 0;border-bottom:1px solid #000}#sbo-rt-content img.width-ninety{width:90%}#sbo-rt-content img{max-width:95%;margin:0 auto;padding:0}#sbo-rt-content div.figure{background-color:transparent;text-align:center !important;margin:15px 0 15px 0 !important;page-break-inside:avoid}#sbo-rt-content figure{margin:15px 0 15px 0 !important;page-break-inside:avoid}#sbo-rt-content div.figure h6{font-size:90%;text-align:center;font-weight:normal;font-style:italic;font-family:serif !important;color:#000;padding-top:10px !important;page-break-before:avoid;page-break-after:avoid}#sbo-rt-content div.informalfigure{text-align:center !important;padding:5px 0 !important}#sbo-rt-content div.sidebar{margin:15px 0 10px 0 !important;border:1px solid #DCDCDC;background-color:#F7F7F7;padding:15px !important;page-break-inside:avoid}#sbo-rt-content aside[data-type="sidebar"]{margin:15px 0 10px 0 !important;page-break-inside:avoid}#sbo-rt-content div.sidebar-title,#sbo-rt-content aside[data-type="sidebar"] h5{font-weight:bold;font-size:1em;font-family:sans-serif;text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px 0 !important;page-break-inside:avoid}#sbo-rt-content div.sidebar ol,#sbo-rt-content div.sidebar ul,#sbo-rt-content aside[data-type="sidebar"] ol,#sbo-rt-content aside[data-type="sidebar"] ul{margin-left:1.25em !important}#sbo-rt-content div.sidebar div.figure p.title,#sbo-rt-content aside[data-type="sidebar"] figcaption,#sbo-rt-content div.sidebar div.informalfigure div.caption{font-size:90%;text-align:center;font-weight:normal;font-style:italic;font-family:serif !important;color:#000;padding:5px !important;page-break-before:avoid;page-break-after:avoid}#sbo-rt-content div.sidebar div.tip,#sbo-rt-content div.sidebar div[data-type="tip"],#sbo-rt-content div.sidebar div.note,#sbo-rt-content div.sidebar div[data-type="note"],#sbo-rt-content div.sidebar div.warning,#sbo-rt-content div.sidebar div[data-type="warning"],#sbo-rt-content div.sidebar div[data-type="caution"],#sbo-rt-content div.sidebar div[data-type="important"]{margin:20px auto 20px auto !important;font-size:90%;width:85%}#sbo-rt-content aside[data-type="sidebar"] p.byline{font-size:90%;font-weight:bold;font-style:italic;text-align:center;text-indent:0;margin:5px auto 6px;page-break-after:avoid}#sbo-rt-content pre{white-space:pre-wrap;font-family:"Ubuntu Mono",monospace;margin:25px 0 25px 20px;font-size:85%;display:block;-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;overflow-wrap:break-word}#sbo-rt-content div.note pre.programlisting,#sbo-rt-content div.tip pre.programlisting,#sbo-rt-content div.warning pre.programlisting,#sbo-rt-content div.caution pre.programlisting,#sbo-rt-content div.important pre.programlisting{margin-bottom:0}#sbo-rt-content code{font-family:"Ubuntu Mono",monospace;-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;overflow-wrap:break-word}#sbo-rt-content code strong em,#sbo-rt-content code em strong,#sbo-rt-content pre em strong,#sbo-rt-content pre strong em,#sbo-rt-content strong code em code,#sbo-rt-content em code strong code,#sbo-rt-content span.bolditalic code{font-weight:bold;font-style:italic;font-family:"Ubuntu Mono BoldItal",monospace}#sbo-rt-content code em,#sbo-rt-content em code,#sbo-rt-content pre em,#sbo-rt-content em.replaceable{font-family:"Ubuntu Mono Ital",monospace;font-style:italic}#sbo-rt-content code strong,#sbo-rt-content strong code,#sbo-rt-content pre strong,#sbo-rt-content strong.userinput{font-family:"Ubuntu Mono Bold",monospace;font-weight:bold}#sbo-rt-content div[data-type="example"]{margin:10px 0 15px 0 !important}#sbo-rt-content div[data-type="example"] h1,#sbo-rt-content div[data-type="example"] h2,#sbo-rt-content div[data-type="example"] h3,#sbo-rt-content div[data-type="example"] h4,#sbo-rt-content div[data-type="example"] h5,#sbo-rt-content div[data-type="example"] h6{font-style:italic;font-weight:normal;text-align:left !important;text-transform:none !important;font-family:serif !important;margin:10px 0 5px 0 !important;border-bottom:1px solid #000}#sbo-rt-content li pre.example{padding:10px 0 !important}#sbo-rt-content div[data-type="example"] pre[data-type="programlisting"],#sbo-rt-content div[data-type="example"] pre[data-type="screen"]{margin:0}#sbo-rt-content section[data-type="titlepage"]>div>h1{font-size:2em;margin:50px 0 10px 0 !important;line-height:1;text-align:center}#sbo-rt-content section[data-type="titlepage"] h2,#sbo-rt-content section[data-type="titlepage"] p.subtitle,#sbo-rt-content section[data-type="titlepage"] p[data-type="subtitle"]{font-size:1.3em;font-weight:normal;text-align:center;margin-top:.5em;color:#555}#sbo-rt-content section[data-type="titlepage"]>div>h2[data-type="author"],#sbo-rt-content section[data-type="titlepage"] p.author{font-size:1.3em;font-family:serif !important;font-weight:bold;margin:50px 0 !important;text-align:center}#sbo-rt-content section[data-type="titlepage"] p.edition{text-align:center;text-transform:uppercase;margin-top:2em}#sbo-rt-content div.book div.titlepage div.publishername{margin-top:60%;margin-bottom:20px;text-align:center;font-size:1.25em}#sbo-rt-content div.book div.titlepage div.locations p{margin:0;text-align:center}#sbo-rt-content div.book div.titlepage div.locations p.cities{font-size:80%;text-align:center;margin-top:5px}#sbo-rt-content section.preface[title="Dedication"]>div.titlepage h2.title{text-align:center;text-transform:uppercase;font-size:1.5em;margin-top:50px;margin-bottom:50px}#sbo-rt-content ul.stafflist{margin:15px 0 15px 20px !important}#sbo-rt-content ul.stafflist li{list-style-type:none;padding:5px 0}#sbo-rt-content ul.printings li{list-style-type:none}#sbo-rt-content section.preface[title="Dedication"] p{font-style:italic;text-align:center}#sbo-rt-content div.colophon h1.title{font-size:1.3em;margin:0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon h2.subtitle{margin:0 !important;color:#000;font-family:serif !important;font-size:1em;font-weight:normal}#sbo-rt-content div.colophon div.author h3.author{font-size:1.1em;font-family:serif !important;margin:10px 0 0 !important;font-weight:normal}#sbo-rt-content div.colophon div.editor h4,#sbo-rt-content div.colophon div.editor h3.editor{color:#000;font-size:.8em;margin:15px 0 0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon div.editor h3.editor{font-size:.8em;margin:0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon div.publisher{margin-top:10px}#sbo-rt-content div.colophon div.publisher p,#sbo-rt-content div.colophon div.publisher span.publishername{margin:0;font-size:.8em}#sbo-rt-content div.legalnotice p,#sbo-rt-content div.timestamp p{font-size:.8em}#sbo-rt-content div.timestamp p{margin-top:10px}#sbo-rt-content div.colophon[title="About the Author"] h1.title,#sbo-rt-content div.colophon[title="Colophon"] h1.title{font-size:1.5em;margin:0 !important;font-family:sans-serif !important}#sbo-rt-content section.chapter div.titlepage div.author{margin:10px 0 10px 0}#sbo-rt-content section.chapter div.titlepage div.author div.affiliation{font-style:italic}#sbo-rt-content div.attribution{margin:5px 0 0 50px !important}#sbo-rt-content h3.author span.orgname{display:none}#sbo-rt-content div.epigraph{margin:10px 0 10px 20px !important;page-break-inside:avoid;font-size:90%}#sbo-rt-content div.epigraph p{font-style:italic}#sbo-rt-content blockquote,#sbo-rt-content div.blockquote{margin:10px !important;page-break-inside:avoid;font-size:95%}#sbo-rt-content blockquote p,#sbo-rt-content div.blockquote p{font-style:italic;margin:.75em 0 0 !important}#sbo-rt-content blockquote div.attribution,#sbo-rt-content blockquote p[data-type="attribution"]{margin:5px 0 10px 30px !important;text-align:right;width:80%}#sbo-rt-content blockquote div.attribution p,#sbo-rt-content blockquote p[data-type="attribution"]{font-style:normal;margin-top:5px}#sbo-rt-content blockquote div.attribution p:before,#sbo-rt-content blockquote p[data-type="attribution"]:before{font-style:normal;content:"—";-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none}#sbo-rt-content p.right{text-align:right;margin:0}#sbo-rt-content div[data-type="footnotes"]{border-top:1px solid black;margin-top:1.5em}#sbo-rt-content sub,#sbo-rt-content sup{font-size:75%;line-height:0;position:relative}#sbo-rt-content sup{top:-.5em}#sbo-rt-content sub{bottom:-.25em}#sbo-rt-content div.refentry p.refname{font-size:1em;font-family:sans-serif,"DejaVuSans";font-weight:bold;margin-bottom:5px;overflow:auto;width:100%}#sbo-rt-content div.refentry{width:100%;display:block;margin-top:2em}#sbo-rt-content div.refsynopsisdiv{display:block;clear:both}#sbo-rt-content div.refentry header{page-break-inside:avoid !important;display:block;break-inside:avoid !important;padding-top:0;border-bottom:1px solid #000}#sbo-rt-content div.refsect1 h6{font-size:.9em;font-family:sans-serif,"DejaVuSans";font-weight:bold}#sbo-rt-content div.refsect1{margin-top:3em}#sbo-rt-content dt{padding-top:10px !important;padding-bottom:0 !important}#sbo-rt-content dd{margin-left:1.5em !important;margin-bottom:.25em}#sbo-rt-content dd,#sbo-rt-content li{text-align:left}#sbo-rt-content ul{list-style-type:disc}#sbo-rt-content ul ul{list-style-type:square}#sbo-rt-content ul ul ul{list-style-type:circle}#sbo-rt-content ol{list-style-type:decimal}#sbo-rt-content ol ol{list-style-type:lower-alpha}#sbo-rt-content ol ol ol{list-style-type:lower-roman}#sbo-rt-content ol ul{list-style-type:disc}#sbo-rt-content ol ul ol{list-style-type:decimal}#sbo-rt-content ul ol{list-style-type:decimal}#sbo-rt-content ul ol ul{list-style-type:disc}#sbo-rt-content ol,#sbo-rt-content ul{list-style-position:outside;margin:15px 0 15px 1.25em}#sbo-rt-content ol li,#sbo-rt-content ul li{margin:.5em 0 .65em;line-height:125%}#sbo-rt-content div.orderedlistalpha{list-style-type:upper-alpha}#sbo-rt-content table.simplelist,#sbo-rt-content ul.simplelist{margin:15px 0 15px 20px !important}#sbo-rt-content ul.simplelist li{list-style-type:none;padding:5px 0}#sbo-rt-content table.simplelist td{border:none}#sbo-rt-content table.simplelist tr{border-bottom:none}#sbo-rt-content table.simplelist tr:nth-of-type(even){background-color:transparent}#sbo-rt-content dl.calloutlist p:first-child{margin-top:-25px !important}#sbo-rt-content dl.calloutlist dd{padding-left:0;margin-top:-25px}#sbo-rt-content dl.calloutlist img,#sbo-rt-content a.co img{padding:0}#sbo-rt-content div.toc ol{margin-top:8px !important;margin-bottom:8px !important;margin-left:0 !important;padding-left:0 !important}#sbo-rt-content div.toc ol ol{margin-left:30px !important;padding-left:0 !important}#sbo-rt-content div.toc ol li{list-style-type:none}#sbo-rt-content div.toc a{color:#8e0012}#sbo-rt-content div.toc ol a{font-size:1em;font-weight:bold}#sbo-rt-content div.toc ol>li>ol a{font-weight:bold;font-size:1em}#sbo-rt-content div.toc ol>li>ol>li>ol a{text-decoration:none;font-weight:normal;font-size:1em}#sbo-rt-content div.tip,#sbo-rt-content div[data-type="tip"],#sbo-rt-content div.note,#sbo-rt-content div[data-type="note"],#sbo-rt-content div.warning,#sbo-rt-content div[data-type="warning"],#sbo-rt-content div[data-type="caution"],#sbo-rt-content div[data-type="important"]{margin:30px !important;font-size:90%;padding:10px 8px 20px 8px !important;page-break-inside:avoid}#sbo-rt-content div.tip ol,#sbo-rt-content div.tip ul,#sbo-rt-content div[data-type="tip"] ol,#sbo-rt-content div[data-type="tip"] ul,#sbo-rt-content div.note ol,#sbo-rt-content div.note ul,#sbo-rt-content div[data-type="note"] ol,#sbo-rt-content div[data-type="note"] ul,#sbo-rt-content div.warning ol,#sbo-rt-content div.warning ul,#sbo-rt-content div[data-type="warning"] ol,#sbo-rt-content div[data-type="warning"] ul,#sbo-rt-content div[data-type="caution"] ol,#sbo-rt-content div[data-type="caution"] ul,#sbo-rt-content div[data-type="important"] ol,#sbo-rt-content div[data-type="important"] ul{margin-left:1.5em !important}#sbo-rt-content div.tip,#sbo-rt-content div[data-type="tip"],#sbo-rt-content div.note,#sbo-rt-content div[data-type="note"]{border:1px solid #BEBEBE;background-color:transparent}#sbo-rt-content div.warning,#sbo-rt-content div[data-type="warning"],#sbo-rt-content div[data-type="caution"],#sbo-rt-content div[data-type="important"]{border:1px solid #BC8F8F}#sbo-rt-content div.tip h3,#sbo-rt-content div[data-type="tip"] h6,#sbo-rt-content div[data-type="tip"] h1,#sbo-rt-content div.note h3,#sbo-rt-content div[data-type="note"] h6,#sbo-rt-content div[data-type="note"] h1,#sbo-rt-content div.warning h3,#sbo-rt-content div[data-type="warning"] h6,#sbo-rt-content div[data-type="warning"] h1,#sbo-rt-content div[data-type="caution"] h6,#sbo-rt-content div[data-type="caution"] h1,#sbo-rt-content div[data-type="important"] h1,#sbo-rt-content div[data-type="important"] h6{font-weight:bold;font-size:110%;font-family:sans-serif !important;text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px !important}#sbo-rt-content div.tip h3,#sbo-rt-content div[data-type="tip"] h6,#sbo-rt-content div.note h3,#sbo-rt-content div[data-type="note"] h6,#sbo-rt-content div[data-type="tip"] h1,#sbo-rt-content div[data-type="note"] h1{color:#737373}#sbo-rt-content div.warning h3,#sbo-rt-content div[data-type="warning"] h6,#sbo-rt-content div[data-type="caution"] h6,#sbo-rt-content div[data-type="important"] h6,#sbo-rt-content div[data-type="warning"] h1,#sbo-rt-content div[data-type="caution"] h1,#sbo-rt-content div[data-type="important"] h1{color:#C67171}#sbo-rt-content div.sect1[title="Safari® Books Online"] div.note,#sbo-rt-content div.safarienabled{background-color:transparent;margin:8px 0 0 !important;border:0 solid #BEBEBE;font-size:100%;padding:0 !important;page-break-inside:avoid}#sbo-rt-content div.sect1[title="Safari® Books Online"] div.note h3,#sbo-rt-content div.safarienabled h6{display:none}#sbo-rt-content div.table,#sbo-rt-content table{margin:15px 0 30px 0 !important;max-width:95%;border:none !important;background:none;display:table !important}#sbo-rt-content div.table,#sbo-rt-content div.informaltable,#sbo-rt-content table{page-break-inside:avoid}#sbo-rt-content tr,#sbo-rt-content tr td{border-bottom:1px solid #c3c3c3}#sbo-rt-content thead td,#sbo-rt-content thead th{border-bottom:#9d9d9d 1px solid !important;border-top:#9d9d9d 1px solid !important}#sbo-rt-content tr:nth-of-type(even){background-color:#f1f6fc}#sbo-rt-content thead{font-family:sans-serif;font-weight:bold}#sbo-rt-content td,#sbo-rt-content th{display:table-cell;padding:.3em;text-align:left;vertical-align:middle;font-size:80%}#sbo-rt-content div.informaltable table{margin:10px auto !important}#sbo-rt-content div.informaltable table tr{border-bottom:none}#sbo-rt-content div.informaltable table tr:nth-of-type(even){background-color:transparent}#sbo-rt-content div.informaltable td,#sbo-rt-content div.informaltable th{border:#9d9d9d 1px solid}#sbo-rt-content div.table-title,#sbo-rt-content table caption{font-weight:normal;font-style:italic;font-family:serif;font-size:1em;margin:10px 0 10px 0 !important;padding:0;page-break-after:avoid;text-align:left !important}#sbo-rt-content table code{font-size:smaller}#sbo-rt-content div.equation,#sbo-rt-content div[data-type="equation"]{margin:10px 0 15px 0 !important}#sbo-rt-content div.equation-title,#sbo-rt-content div[data-type="equation"] h5{font-style:italic;font-weight:normal;font-family:serif !important;font-size:90%;margin:20px 0 10px 0 !important;page-break-after:avoid}#sbo-rt-content div.equation-contents{margin-left:20px}#sbo-rt-content span.inlinemediaobject{height:.85em;display:inline-block;margin-bottom:.2em}#sbo-rt-content span.inlinemediaobject img{margin:0;height:.85em}#sbo-rt-content div.informalequation{margin:20px 0 20px 20px;width:75%}#sbo-rt-content div.informalequation img{width:75%}#sbo-rt-content div.index{text-indent:0}#sbo-rt-content div.index li{line-height:140%}#sbo-rt-content div.index a.indexterm{color:#8e0012}#sbo-rt-content div.index ul,#sbo-rt-content div[data-type="index"] ul{list-style-type:none;padding-left:0;margin-left:0}#sbo-rt-content div.index ul li{padding-left:0;margin-left:0}#sbo-rt-content div.index ul li ul li{margin-left:1em}#sbo-rt-content code.boolean,#sbo-rt-content .navy{color:rgb(0,0,128);}#sbo-rt-content code.character,#sbo-rt-content .olive{color:rgb(128,128,0);}#sbo-rt-content code.comment,#sbo-rt-content .blue{color:rgb(0,0,255);}#sbo-rt-content code.conditional,#sbo-rt-content .limegreen{color:rgb(50,205,50);}#sbo-rt-content code.constant,#sbo-rt-content .darkorange{color:rgb(255,140,0);}#sbo-rt-content code.debug,#sbo-rt-content .darkred{color:rgb(139,0,0);}#sbo-rt-content code.define,#sbo-rt-content .darkgoldenrod,#sbo-rt-content .gold{color:rgb(184,134,11);}#sbo-rt-content code.delimiter,#sbo-rt-content .dimgray{color:rgb(105,105,105);}#sbo-rt-content code.error,#sbo-rt-content .red{color:rgb(255,0,0);}#sbo-rt-content code.exception,#sbo-rt-content .salmon{color:rgb(250,128,11);}#sbo-rt-content code.float,#sbo-rt-content .steelblue{color:rgb(70,130,180);}#sbo-rt-content pre code.function,#sbo-rt-content .green{color:rgb(0,128,0);}#sbo-rt-content code.identifier,#sbo-rt-content .royalblue{color:rgb(65,105,225);}#sbo-rt-content code.ignore,#sbo-rt-content .gray{color:rgb(128,128,128);}#sbo-rt-content code.include,#sbo-rt-content .purple{color:rgb(128,0,128);}#sbo-rt-content code.keyword,#sbo-rt-content .sienna{color:rgb(160,82,45);}#sbo-rt-content code.label,#sbo-rt-content .deeppink{color:rgb(255,20,147);}#sbo-rt-content code.macro,#sbo-rt-content .orangered{color:rgb(255,69,0);}#sbo-rt-content code.number,#sbo-rt-content .brown{color:rgb(165,42,42);}#sbo-rt-content code.operator,#sbo-rt-content .black{color:#000;}#sbo-rt-content code.preCondit,#sbo-rt-content .teal{color:rgb(0,128,128);}#sbo-rt-content code.preProc,#sbo-rt-content .fuschia{color:rgb(255,0,255);}#sbo-rt-content code.repeat,#sbo-rt-content .indigo{color:rgb(75,0,130);}#sbo-rt-content code.special,#sbo-rt-content .saddlebrown{color:rgb(139,69,19);}#sbo-rt-content code.specialchar,#sbo-rt-content .magenta{color:rgb(255,0,255);}#sbo-rt-content code.specialcomment,#sbo-rt-content .seagreen{color:rgb(46,139,87);}#sbo-rt-content code.statement,#sbo-rt-content .forestgreen{color:rgb(34,139,34);}#sbo-rt-content code.storageclass,#sbo-rt-content .plum{color:rgb(221,160,221);}#sbo-rt-content code.string,#sbo-rt-content .darkred{color:rgb(139,0,0);}#sbo-rt-content code.structure,#sbo-rt-content .chocolate{color:rgb(210,106,30);}#sbo-rt-content code.tag,#sbo-rt-content .darkcyan{color:rgb(0,139,139);}#sbo-rt-content code.todo,#sbo-rt-content .black{color:#000;}#sbo-rt-content code.type,#sbo-rt-content .mediumslateblue{color:rgb(123,104,238);}#sbo-rt-content code.typedef,#sbo-rt-content .darkgreen{color:rgb(0,100,0);}#sbo-rt-content code.underlined{text-decoration:underline;}#sbo-rt-content pre code.hll{background-color:#ffc}#sbo-rt-content pre code.c{color:#09F;font-style:italic}#sbo-rt-content pre code.err{color:#A00}#sbo-rt-content pre code.k{color:#069;font-weight:bold}#sbo-rt-content pre code.o{color:#555}#sbo-rt-content pre code.cm{color:#35586C;font-style:italic}#sbo-rt-content pre code.cp{color:#099}#sbo-rt-content pre code.c1{color:#35586C;font-style:italic}#sbo-rt-content pre code.cs{color:#35586C;font-weight:bold;font-style:italic}#sbo-rt-content pre code.gd{background-color:#FCC}#sbo-rt-content pre code.ge{font-style:italic}#sbo-rt-content pre code.gr{color:#F00}#sbo-rt-content pre code.gh{color:#030;font-weight:bold}#sbo-rt-content pre code.gi{background-color:#CFC}#sbo-rt-content pre code.go{color:#000}#sbo-rt-content pre code.gp{color:#009;font-weight:bold}#sbo-rt-content pre code.gs{font-weight:bold}#sbo-rt-content pre code.gu{color:#030;font-weight:bold}#sbo-rt-content pre code.gt{color:#9C6}#sbo-rt-content pre code.kc{color:#069;font-weight:bold}#sbo-rt-content pre code.kd{color:#069;font-weight:bold}#sbo-rt-content pre code.kn{color:#069;font-weight:bold}#sbo-rt-content pre code.kp{color:#069}#sbo-rt-content pre code.kr{color:#069;font-weight:bold}#sbo-rt-content pre code.kt{color:#078;font-weight:bold}#sbo-rt-content pre code.m{color:#F60}#sbo-rt-content pre code.s{color:#C30}#sbo-rt-content pre code.na{color:#309}#sbo-rt-content pre code.nb{color:#366}#sbo-rt-content pre code.nc{color:#0A8;font-weight:bold}#sbo-rt-content pre code.no{color:#360}#sbo-rt-content pre code.nd{color:#99F}#sbo-rt-content pre code.ni{color:#999;font-weight:bold}#sbo-rt-content pre code.ne{color:#C00;font-weight:bold}#sbo-rt-content pre code.nf{color:#C0F}#sbo-rt-content pre code.nl{color:#99F}#sbo-rt-content pre code.nn{color:#0CF;font-weight:bold}#sbo-rt-content pre code.nt{color:#309;font-weight:bold}#sbo-rt-content pre code.nv{color:#033}#sbo-rt-content pre code.ow{color:#000;font-weight:bold}#sbo-rt-content pre code.w{color:#bbb}#sbo-rt-content pre code.mf{color:#F60}#sbo-rt-content pre code.mh{color:#F60}#sbo-rt-content pre code.mi{color:#F60}#sbo-rt-content pre code.mo{color:#F60}#sbo-rt-content pre code.sb{color:#C30}#sbo-rt-content pre code.sc{color:#C30}#sbo-rt-content pre code.sd{color:#C30;font-style:italic}#sbo-rt-content pre code.s2{color:#C30}#sbo-rt-content pre code.se{color:#C30;font-weight:bold}#sbo-rt-content pre code.sh{color:#C30}#sbo-rt-content pre code.si{color:#A00}#sbo-rt-content pre code.sx{color:#C30}#sbo-rt-content pre code.sr{color:#3AA}#sbo-rt-content pre code.s1{color:#C30}#sbo-rt-content pre code.ss{color:#A60}#sbo-rt-content pre code.bp{color:#366}#sbo-rt-content pre code.vc{color:#033}#sbo-rt-content pre code.vg{color:#033}#sbo-rt-content pre code.vi{color:#033}#sbo-rt-content pre code.il{color:#F60}#sbo-rt-content pre code.g{color:#050}#sbo-rt-content pre code.l{color:#C60}#sbo-rt-content pre code.l{color:#F90}#sbo-rt-content pre code.n{color:#008}#sbo-rt-content pre code.nx{color:#008}#sbo-rt-content pre code.py{color:#96F}#sbo-rt-content pre code.p{color:#000}#sbo-rt-content pre code.x{color:#F06}#sbo-rt-content div.blockquote_sampler_toc{width:95%;margin:5px 5px 5px 10px !important}#sbo-rt-content div{font-family:serif;text-align:left}#sbo-rt-content .gray-background,#sbo-rt-content .reverse-video{background:#2E2E2E;color:#FFF}#sbo-rt-content .light-gray-background{background:#A0A0A0}#sbo-rt-content .preserve-whitespace{white-space:pre-wrap}#sbo-rt-content span.gray{color:#4C4C4C}
    </style><script> // <![CDATA[
    var g = {
      position_cache: {
        
          "chapter": "/api/v1/book/9781491920565/chapter/ch09.html",
          "book_id": "9781491920565",
          "chapter_uri": "ch09.html",
          "position": 0,
          "user_uuid": "fee1bd59-4e02-48a4-a7b4-152ec4c157ac",
          "next_chapter_uri": "/library/view/data-visualization-with/9781491920565/ch10.html"
        
      },
      title: "Data Visualization with Python and JavaScript",
      author_list: "Kyran Dale",
      format: "book",
      source: "application/epub+zip",
      is_system_book: true,
      is_public: false,
      loaded_from_server: true,
      allow_scripts: false,
      has_mathml: false,
      show_ios_app_teaser: false
    };
    // ]]></script><script src="/static/js/src/modernizr.js"></script><script>
    
      
       window.PUBLIC_ANNOTATIONS = false;
      

      window.MOBILE_PUBLIC_ANNOTATIONS = false;

    

    
      window.PRIVACY_CONTROL_OVERRIDE = false;
    

    
      window.PRIVACY_CONTROL_SWITCH = true;
    

    
      window.PUBLISHER_PAGES = true;
    

      window.SBO = {
        "constants": {
          "SITB_ENDPOINT": "https://www.safaribooksonline.com/api/v2/sitb/",
          "SEARCH_SELECT_ENDPOINT": "https://www.safaribooksonline.com/api/v2/search/select/",
          "ENABLE_ONLINE_TRAINING": true
        }
      };
  </script><link rel="canonical" href="https://www.safaribooksonline.com/library/view/data-visualization-with/9781491920565/ch09.html"/><meta name="description" content=" Chapter 9. Cleaning Data with Pandas The previous two chapters introduced Pandas and NumPy, the Numeric Python library it extends. Armed with basic Pandas know-how, we’re ready to start ... "><meta property="og:title" content="9. Cleaning Data with Pandas" /><meta itemprop="isPartOf" content="/library/view/data-visualization-with/9781491920565/" /><meta itemprop="name" content="9. Cleaning Data with Pandas" /><meta property="og:url" itemprop="url" content="https://www.safaribooksonline.com/library/view/data-visualization-with/9781491920565/ch09.html" /><meta property="og:site_name" content="Safari" /><meta property="og:image" itemprop="thumbnailUrl" content="https://www.safaribooksonline.com/library/cover/9781491920565/" /><meta property="og:description" itemprop="description" content=" Chapter 9. Cleaning Data with Pandas The previous two chapters introduced Pandas and NumPy, the Numeric Python library it extends. Armed with basic Pandas know-how, we’re ready to start ... "><meta itemprop="inLanguage" content="en" /><meta itemprop="publisher" content="O&#39;Reilly Media, Inc." /><meta property="og:type" content="book" /><meta property="og:book:isbn" itemprop="isbn" content="9781491920510" /><meta property="og:book:author" itemprop="author" content="Kyran Dale" /><meta property="og:book:tag" itemprop="about" content="JavaScript" /><meta property="og:book:tag" itemprop="about" content="Python" /><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@safari"><script>
    window.ENABLE_BOWERBIRD_COLLECTIONS = true;
  </script><style type="text/css" id="font-styles" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-size: <%= font_size %> !important; }"></style><style type="text/css" id="font-family" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-family: <%= font_family %> !important; }"></style><style type="text/css" id="column-width" data-template="#sbo-rt-content { max-width: <%= column_width %>% !important; margin: 0 auto !important; }"></style><noscript><meta http-equiv="refresh" content="0; url=/library/no-js/" /></noscript><script type="text/javascript">
    (function(i,s,o,g,r,a,m) {
      i['GoogleAnalyticsObject']=r;
      i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();
      a=s.createElement(o),m=s.getElementsByTagName(o)[0];
      a.async=1;
      a.src=g;
      m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    var matches = document.cookie.match(/BrowserCookie\s*=\s*([a-f0-9\-]{36})/),
      user_uuid = null;

    if (matches && matches.length === 2) {
      user_uuid = matches[1];
    }

  
    ga('create', 'UA-39299553-7', {'userId': 'fee1bd59-4e02-48a4-a7b4-152ec4c157ac' });
  

  
    
      ga('set', 'dimension1', 'Trial');
    
  

  ga('set', 'dimension6', user_uuid);

  
    ga('set', 'dimension2', 'fee1bd59-4e02-48a4-a7b4-152ec4c157ac');
    
  

  

  

  //enable enhanced link tracking
  ga('require', 'linkid', 'linkid.js');

  // reading interface will track pageviews itself
  if (document.location.pathname.indexOf("/library/view") !== 0) {
    ga('send', 'pageview');
  }
  </script><script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5P4V6Z');
  </script><script defer src="/static/js/build/vendor.e2e622a103f9.js"></script><script defer src="/static/js/build/reader.84feb506aa44.js"></script></head>


<body class="reading sidenav nav-collapsed  scalefonts">

    
  
  <noscript> 
    <iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P4V6Z"
            height="0" width="0"
            style="display:none;visibility:hidden">
    </iframe>
  </noscript>
  



    
      <div class="hide working" role="status">
        <div class="working-image"></div>
      </div>
      <div class="sbo-site-nav">
        





<a href="#container" class="skip">Skip to content</a><header class="topbar t-topbar"><nav role="navigation" class="js-site-nav"><ul class="topnav"><li class="t-logo"><a href="/home/" class="l0 None safari-home nav-icn js-keyboard-nav-home"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>Safari Home Icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M4 9.9L4 9.9 4 18 16 18 16 9.9 10 4 4 9.9ZM2.6 8.1L2.6 8.1 8.7 1.9 10 0.5 11.3 1.9 17.4 8.1 18 8.7 18 9.5 18 18.1 18 20 16.1 20 3.9 20 2 20 2 18.1 2 9.5 2 8.7 2.6 8.1Z"/><rect x="10" y="12" width="3" height="7"/><rect transform="translate(18.121320, 10.121320) rotate(-315.000000) translate(-18.121320, -10.121320) " x="16.1" y="9.1" width="4" height="2"/><rect transform="translate(2.121320, 10.121320) scale(-1, 1) rotate(-315.000000) translate(-2.121320, -10.121320) " x="0.1" y="9.1" width="4" height="2"/></g></svg><span>Safari Home</span></a></li><li><a href="/r/" class="t-recommendations-nav l0 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>recommendations icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M50 25C50 18.2 44.9 12.5 38.3 11.7 37.5 5.1 31.8 0 25 0 18.2 0 12.5 5.1 11.7 11.7 5.1 12.5 0 18.2 0 25 0 31.8 5.1 37.5 11.7 38.3 12.5 44.9 18.2 50 25 50 31.8 50 37.5 44.9 38.3 38.3 44.9 37.5 50 31.8 50 25ZM25 3.1C29.7 3.1 33.6 6.9 34.4 11.8 30.4 12.4 26.9 15.1 25 18.8 23.1 15.1 19.6 12.4 15.6 11.8 16.4 6.9 20.3 3.1 25 3.1ZM34.4 15.6C33.6 19.3 30.7 22.2 27.1 22.9 27.8 19.2 30.7 16.3 34.4 15.6ZM22.9 22.9C19.2 22.2 16.3 19.3 15.6 15.6 19.3 16.3 22.2 19.2 22.9 22.9ZM3.1 25C3.1 20.3 6.9 16.4 11.8 15.6 12.4 19.6 15.1 23.1 18.8 25 15.1 26.9 12.4 30.4 11.8 34.4 6.9 33.6 3.1 29.7 3.1 25ZM22.9 27.1C22.2 30.7 19.3 33.6 15.6 34.4 16.3 30.7 19.2 27.8 22.9 27.1ZM25 46.9C20.3 46.9 16.4 43.1 15.6 38.2 19.6 37.6 23.1 34.9 25 31.3 26.9 34.9 30.4 37.6 34.4 38.2 33.6 43.1 29.7 46.9 25 46.9ZM27.1 27.1C30.7 27.8 33.6 30.7 34.4 34.4 30.7 33.6 27.8 30.7 27.1 27.1ZM38.2 34.4C37.6 30.4 34.9 26.9 31.3 25 34.9 23.1 37.6 19.6 38.2 15.6 43.1 16.4 46.9 20.3 46.9 25 46.9 29.7 43.1 33.6 38.2 34.4Z"/></g></svg><span>Recommended</span></a></li><li><a href="/playlists/" class="t-queue-nav l0 nav-icn None"><?xml version="1.0" encoding="UTF-8"?><svg width="21px" height="17px" viewBox="0 0 21 17" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><!-- Generator: Sketch 46.2 (44496) - http://www.bohemiancoding.com/sketch --><title>icon_Playlist_sml</title><desc>Created with Sketch.</desc><defs></defs><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="icon_Playlist_sml" fill-rule="nonzero" fill="#000000"><g id="playlist-icon"><g id="Group-6"><rect id="Rectangle-path" x="5" y="0" width="16" height="3" rx="0.5"></rect><circle id="Oval" cx="1.5" cy="1.5" r="1.5"></circle></g><g id="Group-5" transform="translate(0.000000, 7.000000)"><circle id="Oval" cx="1.5" cy="1.5" r="1.5"></circle><rect id="Rectangle-path" x="5" y="0" width="16" height="3" rx="0.5"></rect></g><g id="Group-5-Copy" transform="translate(0.000000, 14.000000)"><circle id="Oval" cx="1.5" cy="1.5" r="1.5"></circle><rect id="Rectangle-path" x="5" y="0" width="16" height="3" rx="0.5"></rect></g></g></g></g></svg><span>
                 Playlists
              </span></a></li><li class="search"><a href="#" class="t-search-nav trigger nav-icn l0" data-dropdown-selector=".searchbox"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>search icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M31.3 0C20.9 0 12.5 8.4 12.5 18.8 12.5 22.5 13.6 25.9 15.4 28.8L1.2 42.9C-0.4 44.5-0.4 47.2 1.2 48.8 2 49.6 3.1 50 4.2 50 5.2 50 6.3 49.6 7.1 48.8L21.2 34.6C24.1 36.5 27.5 37.5 31.3 37.5 41.6 37.5 50 29.1 50 18.8 50 8.4 41.6 0 31.3 0ZM31.3 31.3C24.4 31.3 18.8 25.6 18.8 18.8 18.8 11.9 24.4 6.3 31.3 6.3 38.1 6.3 43.8 11.9 43.8 18.8 43.8 25.6 38.1 31.3 31.3 31.3Z"/></g></svg><span>Search</span></a></li><li class="usermenu dropdown"><a href="#" class="trigger l0 nav-icn nav-dropdown"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>navigation arrow</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M0.1 12.5L9.7 3.1C9.8 3 9.9 3 10 3 10.1 3 10.2 3 10.3 3.1L19.9 12.5C20 12.5 20 12.6 20 12.8 20 12.9 20 13 19.9 13L17 15.9C16.9 16 16.8 16 16.7 16 16.5 16 16.4 16 16.4 15.9L10 9.7 3.6 15.9C3.6 16 3.5 16 3.3 16 3.2 16 3.1 16 3 15.9L0.1 13C0 12.9 0 12.8 0 12.7 0 12.7 0 12.6 0.1 12.5Z"/></g></svg><span>Expand Nav</span></a><div class="drop-content"><ul><li><a href="/history/" class="t-recent-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>recent items icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 0C11.2 0 0 11.2 0 25 0 38.8 11.2 50 25 50 38.8 50 50 38.8 50 25 50 11.2 38.8 0 25 0ZM6.3 25C6.3 14.6 14.6 6.3 25 6.3 35.4 6.3 43.8 14.6 43.8 25 43.8 35.4 35.4 43.8 25 43.8 14.6 43.8 6.3 35.4 6.3 25ZM31.8 31.5C32.5 30.5 32.4 29.2 31.6 28.3L27.1 23.8 27.1 12.8C27.1 11.5 26.2 10.4 25 10.4 23.9 10.4 22.9 11.5 22.9 12.8L22.9 25.7 28.8 31.7C29.2 32.1 29.7 32.3 30.2 32.3 30.8 32.3 31.3 32 31.8 31.5Z"/></g></svg><span>History</span></a></li><li><a href="/topics" class="t-topics-link l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 55" width="20" height="20" version="1.1" fill="#4A3C31"><desc>topics icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 55L50 41.262 50 13.762 25 0 0 13.762 0 41.262 25 55ZM8.333 37.032L8.333 17.968 25 8.462 41.667 17.968 41.667 37.032 25 46.538 8.333 37.032Z"/></g></svg><span>Topics</span></a></li><li><a href="/tutorials/" class="l1 nav-icn t-tutorials-nav js-toggle-menu-item None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>tutorials icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M15.8 18.2C15.8 18.2 15.9 18.2 16 18.2 16.1 18.2 16.2 18.2 16.4 18.2 16.5 18.2 16.7 18.1 16.9 18 17 17.9 17.1 17.8 17.2 17.7 17.3 17.6 17.4 17.5 17.4 17.4 17.5 17.2 17.6 16.9 17.6 16.7 17.6 16.6 17.6 16.5 17.6 16.4 17.5 16.2 17.5 16.1 17.4 15.9 17.3 15.8 17.2 15.6 17 15.5 16.8 15.3 16.6 15.3 16.4 15.2 16.2 15.2 16 15.2 15.8 15.2 15.7 15.2 15.5 15.3 15.3 15.4 15.2 15.4 15.1 15.5 15 15.7 14.9 15.8 14.8 15.9 14.7 16 14.7 16.1 14.6 16.3 14.6 16.4 14.6 16.5 14.6 16.6 14.6 16.6 14.6 16.7 14.6 16.9 14.6 17 14.6 17.1 14.7 17.3 14.7 17.4 14.8 17.6 15 17.7 15.1 17.9 15.2 18 15.3 18 15.5 18.1 15.5 18.1 15.6 18.2 15.7 18.2 15.7 18.2 15.7 18.2 15.8 18.2L15.8 18.2ZM9.4 11.5C9.5 11.5 9.5 11.5 9.6 11.5 9.7 11.5 9.9 11.5 10 11.5 10.2 11.5 10.3 11.4 10.5 11.3 10.6 11.2 10.8 11.1 10.9 11 10.9 10.9 11 10.8 11.1 10.7 11.2 10.5 11.2 10.2 11.2 10 11.2 9.9 11.2 9.8 11.2 9.7 11.2 9.5 11.1 9.4 11 9.2 10.9 9.1 10.8 8.9 10.6 8.8 10.5 8.7 10.3 8.6 10 8.5 9.9 8.5 9.7 8.5 9.5 8.5 9.3 8.5 9.1 8.6 9 8.7 8.8 8.7 8.7 8.8 8.6 9 8.5 9.1 8.4 9.2 8.4 9.3 8.2 9.5 8.2 9.8 8.2 10 8.2 10.1 8.2 10.2 8.2 10.3 8.2 10.5 8.3 10.6 8.4 10.7 8.5 10.9 8.6 11.1 8.7 11.2 8.9 11.3 9 11.4 9.1 11.4 9.2 11.4 9.3 11.5 9.3 11.5 9.3 11.5 9.4 11.5 9.4 11.5L9.4 11.5ZM3 4.8C3.1 4.8 3.1 4.8 3.2 4.8 3.4 4.8 3.5 4.8 3.7 4.8 3.8 4.8 4 4.7 4.1 4.6 4.3 4.5 4.4 4.4 4.5 4.3 4.6 4.2 4.6 4.1 4.7 4 4.8 3.8 4.8 3.5 4.8 3.3 4.8 3.1 4.8 3 4.8 2.9 4.7 2.8 4.7 2.6 4.6 2.5 4.5 2.3 4.4 2.2 4.2 2.1 4 1.9 3.8 1.9 3.6 1.8 3.5 1.8 3.3 1.8 3.1 1.8 2.9 1.8 2.7 1.9 2.6 2 2.4 2.1 2.3 2.2 2.2 2.3 2.1 2.4 2 2.5 2 2.6 1.8 2.8 1.8 3 1.8 3.3 1.8 3.4 1.8 3.5 1.8 3.6 1.8 3.8 1.9 3.9 2 4 2.1 4.2 2.2 4.4 2.4 4.5 2.5 4.6 2.6 4.7 2.7 4.7 2.8 4.7 2.9 4.8 2.9 4.8 3 4.8 3 4.8 3 4.8L3 4.8ZM13.1 15.2C13.2 15.1 13.2 15.1 13.2 15.1 13.3 14.9 13.4 14.7 13.6 14.5 13.8 14.2 14.1 14 14.4 13.8 14.7 13.6 15.1 13.5 15.5 13.4 15.9 13.4 16.3 13.4 16.7 13.5 17.2 13.5 17.6 13.7 17.9 13.9 18.2 14.1 18.5 14.4 18.7 14.7 18.9 15 19.1 15.3 19.2 15.6 19.3 15.9 19.4 16.1 19.4 16.4 19.4 17 19.3 17.5 19.1 18.1 19 18.3 18.9 18.5 18.7 18.7 18.5 19 18.3 19.2 18 19.4 17.7 19.6 17.3 19.8 16.9 19.9 16.6 20 16.3 20 16 20 15.8 20 15.6 20 15.4 19.9 15.4 19.9 15.4 19.9 15.4 19.9 15.2 19.9 15 19.8 14.9 19.8 14.8 19.7 14.7 19.7 14.6 19.7 14.4 19.6 14.3 19.5 14.1 19.3 13.7 19.1 13.4 18.7 13.2 18.4 13.1 18.1 12.9 17.8 12.9 17.5 12.8 17.3 12.8 17.1 12.8 16.9L3.5 14.9C3.3 14.9 3.1 14.8 3 14.8 2.7 14.7 2.4 14.5 2.1 14.3 1.7 14 1.4 13.7 1.2 13.3 1 13 0.9 12.6 0.8 12.3 0.7 12 0.7 11.7 0.7 11.4 0.7 11 0.8 10.5 1 10.1 1.1 9.8 1.3 9.5 1.6 9.2 1.8 8.9 2.1 8.7 2.4 8.5 2.8 8.3 3.2 8.1 3.6 8.1 3.9 8 4.2 8 4.5 8 4.6 8 4.8 8 4.9 8.1L6.8 8.5C6.8 8.4 6.8 8.4 6.8 8.4 6.9 8.2 7.1 8 7.2 7.8 7.5 7.5 7.7 7.3 8 7.1 8.4 6.9 8.7 6.8 9.1 6.7 9.5 6.7 10 6.7 10.4 6.8 10.8 6.8 11.2 7 11.5 7.2 11.8 7.5 12.1 7.7 12.4 8 12.6 8.3 12.7 8.6 12.8 8.9 12.9 9.2 13 9.4 13 9.7 13 9.7 13 9.8 13 9.8 13.6 9.9 14.2 10.1 14.9 10.2 15 10.2 15 10.2 15.1 10.2 15.3 10.2 15.4 10.2 15.6 10.2 15.8 10.1 16 10 16.2 9.9 16.4 9.8 16.5 9.6 16.6 9.5 16.8 9.2 16.9 8.8 16.9 8.5 16.9 8.3 16.9 8.2 16.8 8 16.8 7.8 16.7 7.7 16.6 7.5 16.5 7.3 16.3 7.2 16.2 7.1 16 7 15.9 6.9 15.8 6.9 15.7 6.9 15.6 6.8 15.5 6.8L6.2 4.8C6.2 5 6 5.2 5.9 5.3 5.7 5.6 5.5 5.8 5.3 6 4.9 6.2 4.5 6.4 4.1 6.5 3.8 6.6 3.5 6.6 3.2 6.6 3 6.6 2.8 6.6 2.7 6.6 2.6 6.6 2.6 6.5 2.6 6.5 2.5 6.5 2.3 6.5 2.1 6.4 1.8 6.3 1.6 6.1 1.3 6 1 5.7 0.7 5.4 0.5 5 0.3 4.7 0.2 4.4 0.1 4.1 0 3.8 0 3.6 0 3.3 0 2.8 0.1 2.2 0.4 1.7 0.5 1.5 0.7 1.3 0.8 1.1 1.1 0.8 1.3 0.6 1.6 0.5 2 0.3 2.3 0.1 2.7 0.1 3.1 0 3.6 0 4 0.1 4.4 0.2 4.8 0.3 5.1 0.5 5.5 0.8 5.7 1 6 1.3 6.2 1.6 6.3 1.9 6.4 2.3 6.5 2.5 6.6 2.7 6.6 3 6.6 3 6.6 3.1 6.6 3.1 9.7 3.8 12.8 4.4 15.9 5.1 16.1 5.1 16.2 5.2 16.4 5.2 16.7 5.3 16.9 5.5 17.2 5.6 17.5 5.9 17.8 6.2 18.1 6.5 18.3 6.8 18.4 7.2 18.6 7.5 18.6 7.9 18.7 8.2 18.7 8.6 18.7 9 18.6 9.4 18.4 9.8 18.3 10.1 18.2 10.3 18 10.6 17.8 10.9 17.5 11.1 17.3 11.3 16.9 11.6 16.5 11.8 16 11.9 15.7 12 15.3 12 15 12 14.8 12 14.7 12 14.5 11.9 13.9 11.8 13.3 11.7 12.6 11.5 12.5 11.7 12.4 11.9 12.3 12 12.1 12.3 11.9 12.5 11.7 12.7 11.3 12.9 10.9 13.1 10.5 13.2 10.2 13.3 9.9 13.3 9.6 13.3 9.4 13.3 9.2 13.3 9 13.2 9 13.2 9 13.2 9 13.2 8.8 13.2 8.7 13.2 8.5 13.1 8.2 13 8 12.8 7.7 12.6 7.4 12.4 7.1 12 6.8 11.7 6.7 11.4 6.6 11.1 6.5 10.8 6.4 10.6 6.4 10.4 6.4 10.2 5.8 10.1 5.2 9.9 4.5 9.8 4.4 9.8 4.4 9.8 4.3 9.8 4.1 9.8 4 9.8 3.8 9.8 3.6 9.9 3.4 10 3.2 10.1 3 10.2 2.9 10.4 2.8 10.5 2.6 10.8 2.5 11.1 2.5 11.5 2.5 11.6 2.5 11.8 2.6 12 2.6 12.1 2.7 12.3 2.8 12.5 2.9 12.6 3.1 12.8 3.2 12.9 3.3 13 3.5 13.1 3.6 13.1 3.7 13.1 3.8 13.2 3.9 13.2L13.1 15.2 13.1 15.2Z"/></g></svg><span>Tutorials</span></a></li><li class="nav-offers flyout-parent"><a href="#" class="l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>offers icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M35.9 20.6L27 15.5C26.1 15 24.7 15 23.7 15.5L14.9 20.6C13.9 21.1 13.2 22.4 13.2 23.4L13.2 41.4C13.2 42.4 13.9 43.7 14.9 44.2L23.3 49C24.2 49.5 25.6 49.5 26.6 49L35.9 43.6C36.8 43.1 37.6 41.8 37.6 40.8L37.6 23.4C37.6 22.4 36.8 21.1 35.9 20.6L35.9 20.6ZM40 8.2C39.1 7.6 37.6 7.6 36.7 8.2L30.2 11.9C29.3 12.4 29.3 13.2 30.2 13.8L39.1 18.8C40 19.4 40.7 20.6 40.7 21.7L40.7 39C40.7 40.1 41.4 40.5 42.4 40L48.2 36.6C49.1 36.1 49.8 34.9 49.8 33.8L49.8 15.6C49.8 14.6 49.1 13.3 48.2 12.8L40 8.2 40 8.2ZM27 10.1L33.6 6.4C34.5 5.9 34.5 5 33.6 4.5L26.6 0.5C25.6 0 24.2 0 23.3 0.5L16.7 4.2C15.8 4.7 15.8 5.6 16.7 6.1L23.7 10.1C24.7 10.6 26.1 10.6 27 10.1ZM10.1 21.7C10.1 20.6 10.8 19.4 11.7 18.8L20.6 13.8C21.5 13.2 21.5 12.4 20.6 11.9L13.6 7.9C12.7 7.4 11.2 7.4 10.3 7.9L1.6 12.8C0.7 13.3 0 14.6 0 15.6L0 33.8C0 34.9 0.7 36.1 1.6 36.6L8.4 40.5C9.3 41 10.1 40.6 10.1 39.6L10.1 21.7 10.1 21.7Z"/></g></svg><span>Offers & Deals</span></a><ul class="flyout"><li><a href="https://get.oreilly.com/email-signup.html" target="_blank" class="l2 nav-icn"><span>Newsletters</span></a></li></ul></li><li class="nav-highlights"><a href="/u/fee1bd59-4e02-48a4-a7b4-152ec4c157ac/" class="t-highlights-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 35" width="20" height="20" version="1.1" fill="#4A3C31"><desc>highlights icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M13.325 18.071L8.036 18.071C8.036 11.335 12.36 7.146 22.5 5.594L22.5 0C6.37 1.113 0 10.632 0 22.113 0 29.406 3.477 35 10.403 35 15.545 35 19.578 31.485 19.578 26.184 19.578 21.556 17.211 18.891 13.325 18.071L13.325 18.071ZM40.825 18.071L35.565 18.071C35.565 11.335 39.86 7.146 50 5.594L50 0C33.899 1.113 27.5 10.632 27.5 22.113 27.5 29.406 30.977 35 37.932 35 43.045 35 47.078 31.485 47.078 26.184 47.078 21.556 44.74 18.891 40.825 18.071L40.825 18.071Z"/></g></svg><span>Highlights</span></a></li><li><a href="/u/" class="t-settings-nav l1 js-settings nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"/></g></svg><span>Settings</span></a></li><li><a href="https://www.safaribooksonline.com/public/support" class="l1 no-icon">Support</a></li><li><a href="/accounts/logout/" class="l1 no-icon">Sign Out</a></li></ul><ul class="profile"><li><a href="/u/" class="l2 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"/></g></svg><span>Settings</span></a><span class="l2 t-nag-notification"  id="nav-nag" ><strong class="trial-green">6</strong> days left in your trial.
  
  

  
    
      

<a class="" href="/subscribe/">Subscribe</a>.


    
  

  

</span></li><li><a href="https://www.safaribooksonline.com/public/support" class="l2">Support</a></li><li><a href="/accounts/logout/" class="l2">Sign Out</a></li></ul></div></li></ul></nav></header>


      </div>
      <div id="container" class="application">
        
          <div class="nav-container clearfix">
            


            
            
          </div>

          

  <div class="js-toc">
    
      <div class="sbo-reading-menu sbo-menu-top"><section class="sbo-toc-container toc-menu"><a href="#" class="sbo-toc-thumb"><span class="sbo-title ss-list"><h1><div class="visuallyhidden">Table of Contents for </div>
      
      Data Visualization with Python and JavaScript
      
    </h1></span></a><div class="toc-contents"></div></section></div>

    

    <div class="interface-controls interface-controls-top">
      <ul class="interface-control-btns js-bitlist js-reader">
        <li class="js-search-in-archive search-in-archive t-search-in-archive"><a href="#" title="Search in archive" class="js-search-controls search-controls"><span class="icon">Search in book...</span></a><form class="search-archive-bar js-search-form"><input type="search" name="query" placeholder="Search inside this book..." autocomplete="off"></form><div class="search-archive-results"><div class="js-sitb-results-region"></div></div></li><li class="queue-control"><div class="js-content-uri" data-content-uri="/api/v1/book/9781491920565/chapter/ch09.html"><div class="js-collections-dropdown collections-dropdown menu-bit-cards"></div></div></li><li class="js-font-control-panel font-control-activator"><a href="#" data-push-state="false" id="font-controls" title="Change font size" aria-label="Change font size"><span class="icon">Toggle Font Controls</span></a></li><li class="dropdown sharing-controls"><a href="#" class="trigger" data-push-state="false" title="Share" aria-label="Share"><i class="fa fa-share"></i></a><ul class="social-sharing dropdown-menu"><li><a
        class="twitter share-button t-twitter"
        target="_blank"
        aria-label="Share this section on Twitter"
        title="Share this section on Twitter"
      
        href="https://twitter.com/share?url=https://www.safaribooksonline.com/library/view/data-visualization-with/9781491920565/ch09.html&text=Data%20Visualization%20with%20Python%20and%20JavaScript&via=safari"
      ><span>Twitter</span></a></li><li><a
        class="facebook share-button t-facebook"
        target="_blank"
        aria-label="Share this section on Facebook"
        title="Share this section on Facebook"
        href="https://www.facebook.com/sharer/sharer.php?u=https://www.safaribooksonline.com/library/view/data-visualization-with/9781491920565/ch09.html"
      ><span>Facebook</span></a></li><li><a
        class="googleplus share-button t-googleplus"
        target="_blank"
        aria-label="Share this secton on Google Plus"
        title="Share this secton on Google Plus"
        href="https://plus.google.com/share?url=https://www.safaribooksonline.com/library/view/data-visualization-with/9781491920565/ch09.html"
      ><span>Google Plus</span></a></li><li><a
        class="email share-button t-email"
        aria-label="Share this section via email"
        title="Share this section via email"
      
        href="mailto:?subject=Safari: 9.%20Cleaning%20Data%20with%20Pandas&body=https://www.safaribooksonline.com/library/view/data-visualization-with/9781491920565/ch09.html%0D%0Afrom Data%20Visualization%20with%20Python%20and%20JavaScript%0D%0A"
      ><span>Email</span></a></li></ul></li>
      </ul>
    </div>

    <section role="document">
        
        



 <!--[if lt IE 9]>
  
<![endif]-->



  <script defer src="/static/js/build/djangoMessagesPage.893631b34e7a.js"></script>


        
	  <div class="t-sbo-prev sbo-prev sbo-nav-top">
  
    
      
        <a href="/library/view/data-visualization-with/9781491920565/ch08.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">8. Introduction to Pandas</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-top">
  
    
      
        <a href="/library/view/data-visualization-with/9781491920565/ch10.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">10. Visualizing Data with Matplotlib</div>
        </a>
    
  
  </div>



<div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 9. Cleaning Data with Pandas"><div class="chapter" id="chapter_cleaning">
<h1><span class="label">Chapter 9. </span>Cleaning Data with Pandas</h1>


<p><a data-type="indexterm" data-primary="Pandas" data-secondary="cleaning data with" id="Pclean9"></a>The previous two chapters introduced Pandas and NumPy, the Numeric Python library it extends. Armed with basic Pandas know-how, we’re ready to start the cleaning stage of our toolchain, aiming to find and eliminate the dirty data in our scraped dataset (see <a data-type="xref" href="ch06.html#chapter_heavy_scraping">Chapter 6</a>). This chapter will also extend your Pandas knowledge, introducing new methods in a working context.</p>

<p>In <a data-type="xref" href="ch08.html#chapter_intro_to_pandas">Chapter 8</a>, we covered the core components of Pandas: the <code>DataFrame</code>, a programmatic spreadsheet capable of dealing with the many different datatypes found in the real world, and its building block, the <code>Series</code>, a heterogeneous extension of NumPy’s homogeneous <code>ndarray</code>. We also covered how to read from and write to different datastores, including JSON, CSV files, MongoDB, and SQL databases. Now we’ll start to put Pandas through its paces showing how it can be used to clean dirty data. I’ll introduce the key elements of data cleaning using our dirty Nobel Prize dataset as an example.</p>

<p>I’ll take it slowly, introducing key Pandas concepts in a working environment. Let’s first establish why cleaning data is such an important part of a data visualizer’s work.</p>






<section data-type="sect1" data-pdf-bookmark="Coming Clean About Dirty Data"><div class="sect1" id="idm140319420135520">
<h1>Coming Clean About Dirty Data</h1>

<p><a data-type="indexterm" data-primary="data cleaning" data-secondary="importance of" id="DCimp9"></a>I think it’s fair to say that most people entering the field of data visualization underestimate, often by a fairly large factor, the amount of time they’re going to spend trying to make their data presentable. The fact is that getting clean datasets that are a pleasure to transform into cool visualizations could well take over half your time. Data in the wild is very rarely pristine, often bearing the sticky paw prints of mistaken manual data entry, missing whole fields due to oversight or parsing errors and/or mixed datetime formats.</p>

<p>For this book, and to pose a properly meaty challenge, our Nobel Prize dataset has been scraped from Wikipedia, a manually edited website with fairly informal guidelines. In this sense, the data is bound to be dirty—humans make mistakes even when the environment is a good deal more forgiving. But even data from the official APIs of—for example, large social media sites—is often flawed, with missing or incomplete fields, scar tissue from countless changes to the data schemas, deliberate misentry, and the like.</p>

<p>So cleaning data is a fundamental part of the job of a data visualizer, stealing time from all the cool stuff you’d rather be doing—which is an excellent reason to get really good at it and free up that drudge time for more meaningful pursuits. And a large part of getting good at cleaning data is choosing the right toolset, which is where Pandas comes in. It’s a great way to slice and dice even fairly large datasets,<sup><a data-type="noteref" id="idm140319420130224-marker" href="ch09.html#idm140319420130224">1</a></sup> and being comfortable with it could save you a lot of time. That is where this chapter comes in.</p>

<p>To recap, scraping the Nobel data from Wikipedia using Python’s Scrapy library (see <a data-type="xref" href="ch06.html#chapter_heavy_scraping">Chapter 6</a>) produced an array of JSON objects of the form:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="p">{</code>
  <code class="s2">"category"</code><code class="o">:</code> <code class="s2">"Physics"</code><code class="p">,</code>
  <code class="s2">"name"</code><code class="o">:</code> <code class="s2">"Albert Einstein"</code><code class="p">,</code>
  <code class="s2">"gender"</code><code class="o">:</code> <code class="s2">"male"</code><code class="p">,</code>
  <code class="s2">"place_of_birth"</code><code class="o">:</code> <code class="s2">"Ulm ,  Baden-W\u00fcrttemberg ,</code>
<code class="s2">    German Empire"</code><code class="p">,</code>
  <code class="s2">"date_of_death"</code><code class="o">:</code> <code class="s2">"1955-04-18"</code><code class="p">,</code>
  <code class="p">...</code>
<code class="p">}</code></pre>

<p>The job of this chapter is to turn that array into as clean a data source as possible before we explore it with Pandas in the next <span class="keep-together">chapter</span>.</p>

<p class="pagebreak-before"><a data-type="indexterm" data-primary="data cleaning" data-secondary="dirty data examples" id="idm140319420172400"></a>There are many forms of dirty data, most commonly:</p>

<ul>
<li>
<p>Duplicate entries/rows</p>
</li>
<li>
<p>Missing fields</p>
</li>
<li>
<p>Misaligned rows</p>
</li>
<li>
<p>Corrupted fields</p>
</li>
<li>
<p>Mixed datatypes in a column</p>
</li>
</ul>

<p>We’ll now probe our Nobel Prize data for these kinds of anomalies.</p>

<p>First we need to load our JSON data into a <code>DataFrame</code>, as shown in the previous chapter (see <a data-type="xref" href="ch08.html#load_save_dataframe">“Creating and Saving DataFrames”</a>). We can open the JSON data file directly:</p>

<pre data-type="programlisting" data-code-language="python"><code class="kn">import</code> <code class="nn">pandas</code> <code class="kn">as</code> <code class="nn">pd</code>

<code class="n">df</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_json</code><code class="p">(</code><code class="nb">open</code><code class="p">(</code><code class="s1">'data/nobel_winners_full.json'</code><code class="p">))</code></pre>

<p>But, by preference, using our MongoDB database is cleaner and cuts down on the file management. Let’s use the utility function we defined in <a data-type="xref" href="ch08.html#mongo_to_dataframe">“MongoDB”</a> to load our freshly scraped collection of Nobel Prize winners into a <code>DataFrame</code>:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">df</code><code> </code><code class="o">=</code><code> </code><code class="n">mongo_to_dataframe</code><code class="p">(</code><code class="s1">'</code><code class="s1">nobel_prize</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">winners</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO1-1" href="#callout_cleaning_data_with_pandas_CO1-1"><img src="1.png" alt="1" width="12" height="12"></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO1-1" href="#co_cleaning_data_with_pandas_CO1-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>Create a <code>DataFrame</code> with the entire collection of winners from our <code>nobel_prize</code> database.</p></dd>
</dl>

<p>Now that we’ve got our dirty scraped data into a <code>DataFrame</code>, let’s get a broad overview of what we have.<a data-type="indexterm" data-primary="" data-startref="DCimp9" id="idm140319420402496"></a></p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Inspecting the Data"><div class="sect1" id="idm140319420134896">
<h1>Inspecting the Data</h1>

<p><a data-type="indexterm" data-primary="data cleaning" data-secondary="inspecting data" id="DCinspect9"></a>The Pandas <code>DataFrame</code> has a number of methods and properties that give a quick overview of the data contained within. The most general is <code>info</code>, which gives a neat summary of the number of data entries by column:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">df</code><code class="o">.</code><code class="n">info</code><code class="p">()</code>
<code class="o">&lt;</code><code class="k">class</code> <code class="err">'</code><code class="nc">pandas</code><code class="o">.</code><code class="n">core</code><code class="o">.</code><code class="n">frame</code><code class="o">.</code><code class="n">DataFrame</code><code class="s1">'&gt;</code>
<code class="n">Int64Index</code><code class="p">:</code> <code class="mi">1052</code> <code class="n">entries</code><code class="p">,</code> <code class="mi">0</code> <code class="n">to</code> <code class="mi">1051</code>
<code class="n">Data</code> <code class="n">columns</code> <code class="p">(</code><code class="n">total</code> <code class="mi">12</code> <code class="n">columns</code><code class="p">):</code>
<code class="n">born_in</code>           <code class="mi">1052</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code> <code class="nb">object</code>
<code class="n">category</code>          <code class="mi">1052</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code> <code class="nb">object</code>
<code class="n">date_of_birth</code>     <code class="mi">1044</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code> <code class="nb">object</code>
<code class="n">date_of_death</code>     <code class="mi">1044</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code> <code class="nb">object</code>
<code class="n">gender</code>            <code class="mi">1040</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code> <code class="nb">object</code> <code class="c1"># missing fields</code>
<code class="n">link</code>              <code class="mi">1052</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code> <code class="nb">object</code>
<code class="n">name</code>              <code class="mi">1052</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code> <code class="nb">object</code>
<code class="n">country</code>           <code class="mi">1052</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code> <code class="nb">object</code>
<code class="n">place_of_birth</code>    <code class="mi">1044</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code> <code class="nb">object</code>
<code class="n">place_of_death</code>    <code class="mi">1044</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code> <code class="nb">object</code>
<code class="n">text</code>              <code class="mi">1052</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code> <code class="nb">object</code>
<code class="n">year</code>              <code class="mi">1052</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code> <code class="n">int64</code>
<code class="n">dtypes</code><code class="p">:</code> <code class="n">int64</code><code class="p">(</code><code class="mi">1</code><code class="p">),</code> <code class="nb">object</code><code class="p">(</code><code class="mi">11</code><code class="p">)</code>
<code class="n">memory</code> <code class="n">usage</code><code class="p">:</code> <code class="mf">106.8</code> <code class="n">KB</code></pre>

<p>You can see that some fields are missing entries. For example, although there are 1,052 rows in our <code>DataFrame</code>, there are only 1,040 gender attributes. Note also the handy <code>memory_usage</code>—Pandas <code>DataFrame</code>s are held in RAM so as datasets increase in size, this number gives a nice indication of how close we are to our machine-specific memory limits.</p>

<p><code>DataFrame</code>’s <code>describe</code> method gives a handy statistical summary of relevant columns.</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">df</code><code class="o">.</code><code class="n">describe</code><code class="p">()</code>
<code class="n">Out</code><code class="p">:</code>
              <code class="n">year</code>
<code class="n">count</code>  <code class="mf">1052.000000</code>
<code class="n">mean</code>   <code class="mf">1968.729087</code>
<code class="n">std</code>      <code class="mf">33.155829</code>
<code class="nb">min</code>    <code class="mf">1809.000000</code>
<code class="mi">25</code><code class="o">%</code>    <code class="mf">1947.000000</code>
<code class="mi">50</code><code class="o">%</code>    <code class="mf">1975.000000</code>
<code class="mi">75</code><code class="o">%</code>    <code class="mf">1996.000000</code>
<code class="nb">max</code>    <code class="mf">2014.000000</code></pre>

<p>As you can see, by default only numerical columns are described. Already we can see an error in the data, the minimum year being 1809, which is impossible when the first Nobel was awarded in 1901.</p>

<p><code>describe</code> takes an <code>include</code> parameter that allows us to specify the column datatypes (<code>dtype</code>s) to be assessed. Other than year, the columns in our Nobel Prize dataset are all objects, which are Pandas’ default, catch-all <code>dtype</code>, capable of representing any numbers, strings, data times, and more. <a data-type="xref" href="#describe_objects">Example 9-1</a> shows how to get their stats.</p>
<div id="describe_objects" data-type="example" class="pagebreak-before">
<h5><span class="label">Example 9-1. </span>Describing the DataFrame</h5>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">140</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">describe</code><code class="p">(</code><code class="n">include</code><code class="o">=</code><code class="p">[</code><code class="s1">'</code><code class="s1">object</code><code class="s1">'</code><code class="p">]</code><code class="p">)</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO2-1" href="#callout_cleaning_data_with_pandas_CO2-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">140</code><code class="p">]</code><code class="p">:</code><code>
</code><code>       </code><code class="n">born_in</code><code>  </code><code class="n">category</code><code> </code><code class="n">date_of_birth</code><code> </code><code class="n">date_of_death</code><code> </code><code class="n">gender</code><code>  </code><code>\
</code><code class="n">count</code><code>     </code><code class="mi">1052</code><code>      </code><code class="mi">1052</code><code>          </code><code class="mi">1044</code><code>          </code><code class="mi">1044</code><code>   </code><code class="mi">1040</code><code>
</code><code class="n">unique</code><code>      </code><code class="mi">40</code><code>         </code><code class="mi">7</code><code>           </code><code class="mi">853</code><code>           </code><code class="mi">563</code><code>      </code><code class="mi">2</code><code>
</code><code class="n">top</code><code>             </code><code class="n">Physio</code><code class="o">.</code><code class="o">.</code><code>    </code><code class="mi">9</code><code> </code><code class="n">May</code><code> </code><code class="mi">1947</code><code>                 </code><code class="n">male</code><code>
</code><code class="n">freq</code><code>       </code><code class="mi">910</code><code>       </code><code class="mi">250</code><code>             </code><code class="mi">4</code><code>           </code><code class="mi">362</code><code>    </code><code class="mi">983</code><code>
</code><code>
</code><code>                              </code><code class="n">link</code><code>             </code><code class="n">name</code><code>  </code><code>\
</code><code class="n">count</code><code>                         </code><code class="mi">1052</code><code>             </code><code class="mi">1052</code><code>
</code><code class="n">unique</code><code>                         </code><code class="mi">893</code><code>              </code><code class="mi">998</code><code>
</code><code class="n">top</code><code>     </code><code class="n">http</code><code class="p">:</code><code class="o">/</code><code class="o">/</code><code class="n">eg</code><code class="o">/</code><code class="n">wiki</code><code class="o">/</code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code>                     </code><code class="n">Daniel</code><code> </code><code class="n">Kahneman</code><code>
</code><code class="n">freq</code><code>                             </code><code class="mi">4</code><code>                </code><code class="mi">2</code><code>
</code><code>
</code><code>          </code><code class="n">country</code><code> </code><code class="n">place_of_birth</code><code> </code><code class="n">place_of_death</code><code>  </code><code>\
</code><code class="n">count</code><code>            </code><code class="mi">1052</code><code>           </code><code class="mi">1044</code><code>           </code><code class="mi">1044</code><code>
</code><code class="n">unique</code><code>             </code><code class="mi">59</code><code>            </code><code class="mi">735</code><code>            </code><code class="mi">410</code><code>
</code><code class="n">top</code><code>     </code><code class="n">United</code><code> </code><code class="n">States</code><code>
</code><code class="n">freq</code><code>              </code><code class="mi">350</code><code>             </code><code class="mi">29</code><code>            </code><code class="mi">409</code><code>
</code><code class="o">.</code><code class="o">.</code><code class="o">.</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO2-1" href="#co_cleaning_data_with_pandas_CO2-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>The <code>include</code> argument is a list (or single item) of columnar <code>dtype</code>s to summarize.</p></dd>
</dl></div>

<p>There’s quite a lot of useful information to be gleaned from the output of <a data-type="xref" href="#describe_objects">Example 9-1</a>, such as that there are 59 unique nationalities with the United States, at 350, being the largest group.</p>

<p>One interesting tidbit is that of 1,044 recorded dates of birth, only 853 are unique, which could mean any number of things. Possibly some auspicious days saw the birth of more than one laureate or, wearing our data-cleaning hats,  it’s more likely that there are some duplicated winners or that some dates are wrong or have only recorded the year. The duplicated winners hypothesis is confirmed by the observation that of 1,052 name counts, only 998 are unique. Now there have been a few multiple winners but not enough to account for 54 duplicates.</p>

<p><code>DataFrame</code>’s <code>head</code> and <code>tail</code> methods provide another easy way to get a quick feel for the data. By default, they display the top or bottom five rows, but we can set that number by passing an integer as the first argument. <a data-type="xref" href="#dataframe_head">Example 9-2</a> shows the result of using <code>head</code> with our Nobel <code>DataFrame</code>.</p>
<div id="dataframe_head" data-type="example">
<h5><span class="label">Example 9-2. </span>Sampling the first five DataFrame rows</h5>

<pre data-type="programlisting" data-code-language="python"><code class="n">df</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="p">)</code><code>
</code><code class="n">Out</code><code class="p">:</code><code>
</code><code>                  </code><code class="n">born_in</code><code>                </code><code class="n">category</code><code>   </code><code class="n">date_of_bi</code><code class="o">.</code><code class="o">.</code><code>
</code><code class="mi">0</code><code>                          </code><code class="n">Physiology</code><code> </code><code class="ow">or</code><code> </code><code class="n">Medicine</code><code>  </code><code class="mi">8</code><code> </code><code class="n">October</code><code> </code><code class="mf">1.</code><code class="o">.</code><code>
</code><code class="mi">1</code><code>  </code><code class="n">Bosnia</code><code> </code><code class="ow">and</code><code> </code><code class="n">Herzegovina</code><code>              </code><code class="n">Literature</code><code>  </code><code class="mi">9</code><code> </code><code class="n">October</code><code> </code><code class="mf">1.</code><code class="o">.</code><a class="co" id="co_cleaning_data_with_pandas_CO3-1" href="#callout_cleaning_data_with_pandas_CO3-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
</code><code class="mi">2</code><code>  </code><code class="n">Bosnia</code><code> </code><code class="ow">and</code><code> </code><code class="n">Herzegovina</code><code>               </code><code class="n">Chemistry</code><code>   </code><code class="n">July</code><code> </code><code class="mi">23</code><code class="p">,</code><code> </code><code class="mf">1.</code><code class="o">.</code><code>
</code><code class="mi">3</code><code>                                           </code><code class="n">Peace</code><code>             </code><code class="o">.</code><code class="o">.</code><code>
</code><code class="mi">4</code><code>                                           </code><code class="n">Peace</code><code>    </code><code class="mi">26</code><code> </code><code class="n">July</code><code> </code><code class="mf">1.</code><code class="o">.</code><code>
</code><code>
</code><code>    </code><code class="n">date_of_death</code><code> </code><code class="n">gender</code><code>                                      </code><code class="o">.</code><code class="o">.</code><code>
</code><code class="mi">0</code><code>   </code><code class="mi">24</code><code> </code><code class="n">March</code><code> </code><code class="mi">2002</code><code>   </code><code class="n">male</code><code>   </code><code class="n">http</code><code class="p">:</code><code class="o">/</code><code class="o">/</code><code class="n">en</code><code class="o">.</code><code class="n">wikipedia</code><code class="o">.</code><code class="n">org</code><code class="o">/</code><code class="n">wiki</code><code class="o">/</code><code class="n">C</code><code class="o">%</code><code class="n">C3</code><code class="o">%</code><code class="n">A</code><code class="o">.</code><code class="o">.</code><code>
</code><code class="mi">1</code><code>   </code><code class="mi">13</code><code> </code><code class="n">March</code><code> </code><code class="mi">1975</code><code>   </code><code class="n">male</code><code>            </code><code class="n">http</code><code class="p">:</code><code class="o">/</code><code class="o">/</code><code class="n">en</code><code class="o">.</code><code class="n">wikipedia</code><code class="o">.</code><code class="n">org</code><code class="o">/</code><code class="n">wi</code><code class="o">.</code><code class="o">.</code><code>
</code><code class="mi">2</code><code>      </code><code class="mi">1998</code><code class="o">-</code><code class="mo">01</code><code class="o">-</code><code class="mo">07</code><code>   </code><code class="n">male</code><code>       </code><code class="n">http</code><code class="p">:</code><code class="o">/</code><code class="o">/</code><code class="n">en</code><code class="o">.</code><code class="n">wikipedia</code><code class="o">.</code><code class="n">org</code><code class="o">/</code><code class="n">wiki</code><code class="o">/</code><code class="n">Vl</code><code class="o">.</code><code class="o">.</code><a class="co" id="co_cleaning_data_with_pandas_CO3-2" href="#callout_cleaning_data_with_pandas_CO3-2"><img src="2.png" alt="2" width="12" height="12"></a><code>
</code><code class="mi">3</code><code>             </code><code class="n">NaN</code><code>   </code><code class="bp">None</code><code>  </code><code class="n">http</code><code class="p">:</code><code class="o">/</code><code class="o">/</code><code class="n">en</code><code class="o">.</code><code class="n">wikipedia</code><code class="o">.</code><code class="n">org</code><code class="o">/</code><code class="n">wiki</code><code class="o">/</code><code class="n">Institu</code><code class="o">.</code><code class="o">.</code><code>
</code><code class="mi">4</code><code>  </code><code class="mi">6</code><code> </code><code class="n">October</code><code> </code><code class="mi">1912</code><code>   </code><code class="n">male</code><code>  </code><code class="n">http</code><code class="p">:</code><code class="o">/</code><code class="o">/</code><code class="n">en</code><code class="o">.</code><code class="n">wikipedia</code><code class="o">.</code><code class="n">org</code><code class="o">/</code><code class="n">wiki</code><code class="o">/</code><code class="n">Auguste</code><code class="o">.</code><code class="o">.</code><code>
</code><code>
</code><code>                              </code><code class="n">name</code><code> </code><code class="n">country</code><code>  </code><code>\
</code><code class="mi">0</code><code>                   </code><code class="n">C</code><code class="err">é</code><code class="n">sar</code><code> </code><code class="n">Milstein</code><code>   </code><code class="n">Argentina</code><code>
</code><code class="mi">1</code><code>                     </code><code class="n">Ivo</code><code> </code><code class="n">Andric</code><code> </code><code class="o">*</code><code>               </code><a class="co" id="co_cleaning_data_with_pandas_CO3-3" href="#callout_cleaning_data_with_pandas_CO3-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
</code><code class="mi">2</code><code>                </code><code class="n">Vladimir</code><code> </code><code class="n">Prelog</code><code> </code><code class="o">*</code><code>
</code><code class="mi">3</code><code>  </code><code class="n">Institut</code><code> </code><code class="n">de</code><code> </code><code class="n">Droit</code><code> </code><code class="n">International</code><code>     </code><code class="n">Belgium</code><code>
</code><code class="mi">4</code><code>                </code><code class="n">Auguste</code><code> </code><code class="n">Beernaert</code><code>     </code><code class="n">Belgium</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO3-1" href="#co_cleaning_data_with_pandas_CO3-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>These rows have an entry for the <code>born_in</code> field and an asterisk by their name.</p></dd>
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO3-2" href="#co_cleaning_data_with_pandas_CO3-2"><img src="2.png" alt="2" width="12" height="12"></a></dt>
<dd><p>The <code>date_of_death</code> field has a different time format than the other rows.</p></dd>
</dl></div>

<p>The first five winners in <a data-type="xref" href="#dataframe_head">Example 9-2</a> show a couple of useful things. First we see the names in rows 1 and 2 are marked by an asterisk and have an entry in the <code>born_in</code> field <img src="1.png" alt="1" width="12" height="12">. Second, note that row 2 has a different time format for <code>date_of_death</code> than the others, and that there are both month-day and day-month time formats in the <code>date_of_birth</code> field <img src="2.png" alt="2" width="12" height="12">. This kind of inconsistency is a perennial problem for human-edited data, particularly dates and times. We’ll see how to fix it with Pandas later.</p>

<p><a data-type="xref" href="#describe_objects">Example 9-1</a> gives an object count of 1,052 for the <code>born_in</code> field, indicating no empty fields, but <code>head</code> shows only rows 1 and 2 have content. This suggests that the missing fields are an empty string or space, both of which count as data to Pandas. Let’s change them to a noncounted <code>NaN</code>, which will make more sense of the numbers. But first we’re going to need a little primer in Pandas data selection.<a data-type="indexterm" data-primary="" data-startref="DCinspect9" id="idm140319419306704"></a></p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Indices and Pandas Data Selection"><div class="sect1" id="idm140319420400928">
<h1>Indices and Pandas Data Selection</h1>

<p><a data-type="indexterm" data-primary="data cleaning" data-secondary="selecting data in Pandas" id="DCselect9"></a><a data-type="indexterm" data-primary="DataFrames (Pandas)" data-secondary="selecting groups (subsets)" id="DFgroups"></a><a data-type="indexterm" data-primary="DataFrames (Pandas)" data-secondary="indices" id="DFind9"></a>Before beginning to clean our data, let’s do a quick recap of basic Pandas data selection, using the Nobel Prize dataset as an example.</p>

<p>Pandas indexes by rows and columns. Usually column indices are specified by the data file, SQL table, and so on, but, as shown in the last chapter, we can set or override these when the <code>DataFrame</code> is created by using the <code>names</code> argument to pass a list of column names. The columns index is accessible as a <code>DataFrame</code> property:</p>

<pre data-type="programlisting" data-code-language="python"><code class="c1"># Our Nobel dataset's columns</code>
<code class="n">df</code><code class="o">.</code><code class="n">columns</code>
<code class="n">Out</code><code class="p">:</code> <code class="n">Index</code><code class="p">([</code><code class="s-Affix">u</code><code class="s1">'born_in'</code><code class="p">,</code> <code class="s-Affix">u</code><code class="s1">'category'</code><code class="p">,</code> <code class="s-Affix">u</code><code class="s1">'date_of_birth'</code><code class="p">,</code>
<code class="o">...</code>
        <code class="s-Affix">u</code><code class="s1">'place_of_death'</code><code class="p">,</code> <code class="s-Affix">u</code><code class="s1">'text'</code><code class="p">,</code> <code class="s-Affix">u</code><code class="s1">'year'</code><code class="p">],</code> <code class="n">dtype</code><code class="o">=</code><code class="s1">'object'</code><code class="p">)</code></pre>

<p>By default, Pandas specifies a zero-base integer index for the rows, but we can override this by passing a list in the <code>index</code> parameter on creation of the <code>DataFrame</code> or afterward by setting the <code>index</code> property directly. More often we want to use one or more<sup><a data-type="noteref" id="idm140319419573584-marker" href="ch09.html#idm140319419573584">2</a></sup> of the <code>DataFrame</code>’s columns as an index. We can do this using the <code>set_index</code> method. If you want to return to the default index, you can use the <code>reset_index</code> method, as shown in <a data-type="xref" href="#settingDFindex">Example 9-3</a>.</p>
<div id="settingDFindex" data-type="example">
<h5><span class="label">Example 9-3. </span>Setting the DataFrame’s index</h5>

<pre data-type="programlisting" data-code-language="python"><code class="c1"># set the name field as index</code><code>
</code><code class="n">df</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">set_index</code><code class="p">(</code><code class="s1">'</code><code class="s1">name</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO4-1" href="#callout_cleaning_data_with_pandas_CO4-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
</code><code class="n">df</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code><code>
</code><code class="n">Out</code><code class="p">:</code><code>
</code><code>                               </code><code class="n">born_in</code><code>                </code><code class="n">category</code><code>  </code><code>\
</code><code class="n">name</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO4-2" href="#callout_cleaning_data_with_pandas_CO4-2"><img src="2.png" alt="2" width="12" height="12"></a><code>
</code><code class="n">C</code><code class="err">é</code><code class="n">sar</code><code> </code><code class="n">Milstein</code><code>                          </code><code class="n">Physiology</code><code> </code><code class="ow">or</code><code> </code><code class="n">Medicine</code><code>
</code><code class="n">Ivo</code><code> </code><code class="n">Andric</code><code> </code><code class="o">*</code><code>    </code><code class="n">Bosnia</code><code> </code><code class="ow">and</code><code> </code><code class="n">Herzegovina</code><code>              </code><code class="n">Literature</code><code>
</code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code>
</code><code>
</code><code class="n">df</code><code class="o">.</code><code class="n">reset_index</code><code class="p">(</code><code class="n">inplace</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO4-3" href="#callout_cleaning_data_with_pandas_CO4-3"><img src="3.png" alt="3" width="12" height="12"></a><code>
</code><code>
</code><code class="n">df</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code><code>
</code><code class="n">Out</code><code class="p">:</code><code>
</code><code>             </code><code class="n">name</code><code>                 </code><code class="n">born_in</code><code>                </code><code class="n">category</code><code>  </code><code>\
</code><code class="mi">0</code><code>  </code><code class="n">C</code><code class="err">é</code><code class="n">sar</code><code> </code><code class="n">Milstein</code><code>                          </code><code class="n">Physiology</code><code> </code><code class="ow">or</code><code> </code><code class="n">Medicine</code><code>  </code><a class="co" id="co_cleaning_data_with_pandas_CO4-4" href="#callout_cleaning_data_with_pandas_CO4-4"><img src="4.png" alt="4" width="12" height="12"></a><code>
</code><code class="mi">1</code><code>    </code><code class="n">Ivo</code><code> </code><code class="n">Andric</code><code> </code><code class="o">*</code><code>  </code><code class="n">Bosnia</code><code> </code><code class="ow">and</code><code> </code><code class="n">Herzegovina</code><code>              </code><code class="n">Literature</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO4-1" href="#co_cleaning_data_with_pandas_CO4-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>Sets the frame’s index to its name column. Set the result back to <code>df</code>.</p></dd>
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO4-2" href="#co_cleaning_data_with_pandas_CO4-2"><img src="2.png" alt="2" width="12" height="12"></a></dt>
<dd><p>The rows are now indexed by name.</p></dd>
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO4-3" href="#co_cleaning_data_with_pandas_CO4-3"><img src="3.png" alt="3" width="12" height="12"></a></dt>
<dd><p>Resets the index to its integer. Note that we change it in place this time.</p></dd>
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO4-4" href="#co_cleaning_data_with_pandas_CO4-4"><img src="4.png" alt="4" width="12" height="12"></a></dt>
<dd><p>The index is now by integer position.</p></dd>
</dl></div>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>There are two ways to change a Pandas <code>DataFrame</code> or <code>Series</code>: by altering the data in place or by assigning a copy. There is no guarantee that in place is faster, plus method-chaining requires that the operation return a changed object. Generally, I use the <code>df = df.foo(…)</code> form, but most mutating methods have an <code>inplace</code> argument <code>df.foo(…, inplace=True)</code>.</p>
</div>

<p>Now that we understand the row-columnar indexing system, let’s start selecting slices of the <code>DataFrame</code>.</p>

<p>We can select a column of the <code>DataFrame</code> by dot notation (where no spaces or special characters are in the name) or square-bracket notation. Let’s take a look at that <code>born_in</code> column:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">bi_col</code> <code class="o">=</code> <code class="n">df</code><code class="o">.</code><code class="n">born_in</code> <code class="c1"># or bi = df['born_in']</code>
<code class="n">bi_col</code>
<code class="n">Out</code><code class="p">:</code>
<code class="mi">0</code>
<code class="mi">1</code>     <code class="n">Bosnia</code> <code class="ow">and</code> <code class="n">Herzegovina</code>
<code class="mi">2</code>     <code class="n">Bosnia</code> <code class="ow">and</code> <code class="n">Herzegovina</code>
<code class="mi">3</code>
<code class="o">...</code>
<code class="mi">1051</code>
<code class="n">Name</code><code class="p">:</code> <code class="n">born_in</code><code class="p">,</code> <code class="n">Length</code><code class="p">:</code> <code class="mi">1052</code><code class="p">,</code> <code class="n">dtype</code><code class="p">:</code> <code class="nb">object</code>

<code class="nb">type</code><code class="p">(</code><code class="n">bi_col</code><code class="p">)</code>
<code class="n">Out</code><code class="p">:</code> <code class="n">pandas</code><code class="o">.</code><code class="n">core</code><code class="o">.</code><code class="n">series</code><code class="o">.</code><code class="n">Series</code></pre>

<p>Note that the column selection returns a Pandas <code>Series</code>, with the <code>DataFrame</code> indexing preserved.</p>

<p><code>DataFrame</code>s and <code>Series</code> share the same methods for accessing rows/members. <code>iloc</code> selects by integer position, <code>loc</code> selects by label, and <code>ix</code> selects by label with an positional integer fallback. One gotcha with <code>ix</code> happens if we use an alternative integer index. In this case, only label-based access is supported and explicit use of <code>iloc</code> is needed to specify position.</p>

<pre data-type="programlisting" data-code-language="python"><code class="c1"># access the first row</code>
<code class="n">df</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code> <code class="c1"># or df.ix[0]</code>
<code class="n">Out</code><code class="p">:</code>
<code class="n">name</code>                                 <code class="n">C</code><code class="err">é</code><code class="n">sar</code> <code class="n">Milstein</code>
<code class="n">born_in</code>
<code class="n">category</code>                             <code class="n">Physiology</code> <code class="ow">or</code> <code class="n">Medicine</code>
<code class="o">...</code>

<code class="c1"># set the index to 'name' and access by name-label</code>
<code class="n">df</code><code class="o">.</code><code class="n">set_index</code><code class="p">(</code><code class="s1">'name'</code><code class="p">,</code> <code class="n">inplace</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code>
<code class="n">df</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="s1">'Albert Einstein'</code><code class="p">]</code> <code class="c1"># or df.ix['Albert Einstein']</code>
<code class="n">Out</code><code class="p">:</code>
                <code class="n">born_in</code> <code class="n">category</code> <code class="n">date_of_birth</code> <code class="n">date_of_death</code><code class="o">...</code>
<code class="n">Albert</code> <code class="n">Einstein</code>         <code class="n">Physics</code>  <code class="mi">1879</code><code class="o">-</code><code class="mo">03</code><code class="o">-</code><code class="mi">14</code>    <code class="mi">1955</code><code class="o">-</code><code class="mo">04</code><code class="o">-</code><code class="mf">18.</code><code class="o">..</code>
<code class="o">...</code></pre>








<section data-type="sect2" data-pdf-bookmark="Selecting Multiple Rows"><div class="sect2" id="idm140319418907120">
<h2>Selecting Multiple Rows</h2>

<p>Standard Python array slicing can be used with a <code>DataFrame</code> to select multiple rows:</p>

<pre data-type="programlisting" data-code-language="python"><code class="c1"># select the first 10 rows</code>
<code class="n">df</code><code class="p">[</code><code class="mi">0</code><code class="p">:</code><code class="mi">10</code><code class="p">]</code>
<code class="n">Out</code><code class="p">:</code>
                  <code class="n">born_in</code>                <code class="n">category</code>   <code class="n">date_of_b</code><code class="o">..</code>
<code class="mi">0</code>                          <code class="n">Physiology</code> <code class="ow">or</code> <code class="n">Medicine</code>  <code class="mi">8</code> <code class="n">October</code> <code class="o">..</code>
<code class="mi">1</code>  <code class="n">Bosnia</code> <code class="ow">and</code> <code class="n">Herzegovina</code>              <code class="n">Literature</code>  <code class="mi">9</code> <code class="n">October</code> <code class="o">..</code>
<code class="o">...</code>
<code class="mi">9</code>                                           <code class="n">Peace</code>      <code class="mi">1910</code><code class="o">-</code><code class="mf">0.</code><code class="o">.</code>
<code class="c1"># select the last four rows</code>
<code class="n">df</code><code class="p">[</code><code class="o">-</code><code class="mi">4</code><code class="p">:]</code>
<code class="n">Out</code><code class="p">:</code>
     <code class="n">born_in</code>                <code class="n">category</code>      <code class="n">date_of_birth</code> <code class="n">date_</code><code class="o">..</code>
<code class="mi">1048</code>                           <code class="n">Peace</code>   <code class="n">November</code> <code class="mi">1</code><code class="p">,</code> <code class="mi">1878</code>   <code class="n">May</code><code class="o">..</code>
<code class="mi">1049</code>          <code class="n">Physiology</code> <code class="ow">or</code> <code class="n">Medicine</code>         <code class="mi">1887</code><code class="o">-</code><code class="mo">04</code><code class="o">-</code><code class="mi">10</code>    <code class="mf">19.</code><code class="o">.</code>
<code class="mi">1050</code>                       <code class="n">Chemistry</code>           <code class="mi">1906</code><code class="o">-</code><code class="mi">9</code><code class="o">-</code><code class="mi">6</code>     <code class="mf">1.</code><code class="o">.</code>
<code class="mi">1051</code>                           <code class="n">Peace</code>  <code class="n">November</code> <code class="mi">26</code><code class="p">,</code> <code class="mi">1931</code>      <code class="o">..</code></pre>

<p>The standard way to select multiple rows based on a conditional expression (e.g., is the value of the column <code>value</code> greater than <code>x</code>) is to create a Boolean mask and use it in a selector. Let’s find all the Nobel Prize winners after the year 2000. First we create a mask by performing a Boolean expression on each of the rows:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">mask</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">year</code><code> </code><code class="o">&gt;</code><code> </code><code class="mi">2000</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO5-1" href="#callout_cleaning_data_with_pandas_CO5-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
</code><code class="n">mask</code><code>
</code><code class="n">Out</code><code class="p">:</code><code>
</code><code class="mi">0</code><code>     </code><code class="bp">False</code><code>
</code><code class="mi">1</code><code>     </code><code class="bp">False</code><code>
</code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code>
</code><code class="mi">13</code><code>     </code><code class="bp">True</code><code>
</code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code>
</code><code class="mi">1047</code><code>     </code><code class="bp">True</code><code>
</code><code class="mi">1048</code><code>    </code><code class="bp">False</code><code>
</code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code>
</code><code class="n">Name</code><code class="p">:</code><code> </code><code class="n">year</code><code class="p">,</code><code> </code><code class="n">Length</code><code class="p">:</code><code> </code><code class="mi">1052</code><code class="p">,</code><code> </code><code class="n">dtype</code><code class="p">:</code><code> </code><code class="nb">bool</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO5-1" href="#co_cleaning_data_with_pandas_CO5-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p><code>True</code> for all rows where the <code>year</code> field is greater than 2000.</p></dd>
</dl>

<p>The resulting Boolean mask shares our <code>DataFrame</code>’s index and can be used to select all <code>True</code> rows:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">mask</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">year</code><code> </code><code class="o">&gt;</code><code> </code><code class="mi">2000</code><code>
</code><code class="n">winners_since_2000</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="p">[</code><code class="n">mask</code><code class="p">]</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO6-1" href="#callout_cleaning_data_with_pandas_CO6-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
</code><code class="n">winners_since_2000</code><code class="o">.</code><code class="n">count</code><code class="p">(</code><code class="p">)</code><code>
</code><code class="n">Out</code><code class="p">:</code><code>
</code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code>
</code><code class="n">year</code><code>              </code><code class="mi">202</code><code> </code><code class="c1"># number of winners since 2000</code><code>
</code><code class="n">dtype</code><code class="p">:</code><code> </code><code class="n">int64</code><code>
</code><code>
</code><code class="n">winners_since_2000</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="p">)</code><code>
</code><code class="n">Out</code><code class="p">:</code><code>
</code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code>
</code><code>                                               </code><code class="n">text</code><code>  </code><code class="n">year</code><code>
</code><code class="mi">13</code><code>                 </code><code class="n">Fran</code><code class="err">ç</code><code class="n">ois</code><code> </code><code class="n">Englert</code><code> </code><code class="p">,</code><code> </code><code class="n">Physics</code><code class="p">,</code><code> </code><code class="mi">2013</code><code>  </code><code class="mi">2013</code><code>
</code><code class="mi">32</code><code>      </code><code class="n">Christopher</code><code> </code><code class="n">A</code><code class="o">.</code><code> </code><code class="n">Pissarides</code><code> </code><code class="p">,</code><code> </code><code class="n">Economics</code><code class="p">,</code><code> </code><code class="mi">2010</code><code>  </code><code class="mi">2010</code><code>
</code><code class="mi">66</code><code>                         </code><code class="n">Kofi</code><code> </code><code class="n">Annan</code><code> </code><code class="p">,</code><code> </code><code class="n">Peace</code><code class="p">,</code><code> </code><code class="mi">2001</code><code>  </code><code class="mi">2001</code><code>
</code><code class="mi">87</code><code>               </code><code class="n">Riccardo</code><code> </code><code class="n">Giacconi</code><code> </code><code class="o">*</code><code class="p">,</code><code> </code><code class="n">Physics</code><code class="p">,</code><code> </code><code class="mi">2002</code><code>  </code><code class="mi">2002</code><code>
</code><code class="mi">88</code><code>   </code><code class="n">Mario</code><code> </code><code class="n">Capecchi</code><code> </code><code class="o">*</code><code class="p">,</code><code> </code><code class="n">Physiology</code><code> </code><code class="ow">or</code><code> </code><code class="n">Medicine</code><code class="p">,</code><code> </code><code class="mi">2007</code><code>  </code><code class="mi">2007</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO6-1" href="#co_cleaning_data_with_pandas_CO6-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>This will return a <code>DataFrame</code> containing only those rows where the Boolean <code>mask</code> array is <code>True</code>.</p></dd>
</dl>

<p>Boolean masking is a very powerful technique capable of selecting any subset of the data you need. I recommend setting a few targets to practice constructing the right Boolean expressions. Generally, we dispense with the intermediate mask creation:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">winners_since_2000</code> <code class="o">=</code> <code class="n">df</code><code class="p">[</code><code class="n">df</code><code class="o">.</code><code class="n">year</code> <code class="o">&gt;</code> <code class="mi">2000</code><code class="p">]</code></pre>

<p>Now that we can select individual and multiple rows by slicing or using a Boolean mask, in the next sections we’ll see how we can change our <code>DataFrame</code>, purging it of dirty data as we go.<a data-type="indexterm" data-primary="" data-startref="DCselect9" id="idm140319418399568"></a><a data-type="indexterm" data-primary="" data-startref="DFind9" id="idm140319418433088"></a><a data-type="indexterm" data-primary="" data-startref="DFgroups" id="idm140319418432144"></a></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Cleaning the Data"><div class="sect1" id="idm140319419305264">
<h1>Cleaning the Data</h1>

<p>Now that we know how to access our data, let’s see how we can change it for the better, starting with what looks like empty <code>born_in</code> fields we saw in <a data-type="xref" href="#dataframe_head">Example 9-2</a>. If we look at the count of the <code>born_in</code> columns, it doesn’t show any missing rows, which it would were any fields missing or <code>NaN</code>  (not a number):</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">0</code><code class="p">]:</code> <code class="n">df</code><code class="o">.</code><code class="n">born_in</code><code class="o">.</code><code class="n">describe</code><code class="p">()</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">0</code><code class="p">]:</code>
<code class="n">count</code>     <code class="mi">1052</code>
<code class="n">unique</code>      <code class="mi">40</code>
<code class="n">top</code>
<code class="n">freq</code>       <code class="mi">910</code>
<code class="n">Name</code><code class="p">:</code> <code class="n">born_in</code><code class="p">,</code> <code class="n">dtype</code><code class="p">:</code> <code class="nb">object</code></pre>








<section data-type="sect2" data-pdf-bookmark="Finding Mixed Types"><div class="sect2" id="idm140319418437808">
<h2>Finding Mixed Types</h2>

<p><a data-type="indexterm" data-primary="data cleaning" data-secondary="finding mixed types" id="idm140319418465696"></a>Note that Pandas stores all string-like data using the <code>dtype</code> object. A cursory inspection suggests that the column is a mixture of empty and country-name strings. We can quickly check that all the column members are Unicode by mapping the Python <a href="https://docs.python.org/2/library/functions.html#type"><code>type</code></a> function to all members using the <code>apply</code> method and then making a set of the resulting list of column members by type:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">1</code><code class="p">]:</code> <code class="nb">set</code><code class="p">(</code><code class="n">df</code><code class="o">.</code><code class="n">born_in</code><code class="o">.</code><code class="n">apply</code><code class="p">(</code><code class="nb">type</code><code class="p">))</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">1</code><code class="p">]:</code> <code class="p">{</code><code class="nb">unicode</code><code class="p">}</code></pre>

<p>This shows that all of the <code>born_in</code> column members are of type <code>unicode</code>. Now let’s replace any empty strings with an empty field.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Replacing Strings"><div class="sect2" id="idm140319418497920">
<h2>Replacing Strings</h2>

<p><a data-type="indexterm" data-primary="data cleaning" data-secondary="replacing strings" id="DCreplace9"></a><a data-type="indexterm" data-primary="strings" data-secondary="replacing" id="Sreplace8"></a>We want to replace these empty strings with a <code>NaN</code>, to prevent them being counted.<sup><a data-type="noteref" id="idm140319418507104-marker" href="ch09.html#idm140319418507104">3</a></sup> The Pandas <code>replace</code> method is tailor-made for this and can be applied to the whole <code>DataFrame</code> or individual <code>Series</code>:</p>

<pre data-type="programlisting" data-code-language="python"><code class="kn">import</code><code> </code><code class="nn">numpy</code><code> </code><code class="kn">as</code><code> </code><code class="nn">np</code><code>
</code><code>
</code><code class="n">bi_col</code><code class="o">.</code><code class="n">replace</code><code class="p">(</code><code class="s1">'</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">nan</code><code class="p">,</code><code> </code><code class="n">inplace</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code><code>
</code><code class="n">bi_col</code><code>
</code><code class="n">Out</code><code class="p">:</code><code>
</code><code class="mi">0</code><code>                        </code><code class="n">NaN</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO7-1" href="#callout_cleaning_data_with_pandas_CO7-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
</code><code class="mi">1</code><code>     </code><code class="n">Bosnia</code><code> </code><code class="ow">and</code><code> </code><code class="n">Herzegovina</code><code>
</code><code class="mi">2</code><code>     </code><code class="n">Bosnia</code><code> </code><code class="ow">and</code><code> </code><code class="n">Herzegovina</code><code>
</code><code class="mi">3</code><code>                        </code><code class="n">NaN</code><code>
</code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code>
</code><code>
</code><code class="n">bi_col</code><code class="o">.</code><code class="n">count</code><code class="p">(</code><code class="p">)</code><code>
</code><code class="n">Out</code><code class="p">:</code><code> </code><code class="mi">142</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO7-2" href="#callout_cleaning_data_with_pandas_CO7-2"><img src="2.png" alt="2" width="12" height="12"></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO7-1" href="#co_cleaning_data_with_pandas_CO7-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>Our empty <code>''</code> strings have been replaced with NumPy’s <code>NaN</code>.</p></dd>
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO7-2" href="#co_cleaning_data_with_pandas_CO7-2"><img src="2.png" alt="2" width="12" height="12"></a></dt>
<dd><p>Unlike the empty strings, the <code>NaN</code> fields are discounted.</p></dd>
</dl>

<p>After replacing the empty strings with <code>NaN</code>s, we get a true count of 142 for the <code>born_in</code> field.</p>

<p>Let’s replace all empty strings in our <code>DataFrame</code> with discounted <code>NaN</code>s:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">df</code><code class="o">.</code><code class="n">replace</code><code class="p">(</code><code class="s1">''</code><code class="p">,</code> <code class="n">np</code><code class="o">.</code><code class="n">nan</code><code class="p">,</code> <code class="n">inplace</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code></pre>

<p>Pandas allows sophisticated replacement of strings (and other objects) in columns (e.g., allowing you to craft <a href="https://en.wikipedia.org/wiki/Regular_expression">regex expressions</a>,  which are applied to whole <code>Series</code>, typically <code>DataFrame</code> columns). Let’s look at a little example, using the asterisk-marked names in our Nobel Prize <code>DataFrame</code>.</p>

<p><a data-type="xref" href="#dataframe_head">Example 9-2</a>  showed that some of our Nobel Prize names are marked with an asterisk, denoting that these winners are recorded by country of birth, not country at the time of winning the prize:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">df</code><code class="o">.</code><code class="n">head</code><code class="p">()</code>
<code class="n">Out</code><code class="p">:</code>
<code class="o">...</code>
                              <code class="n">name</code> <code class="n">country</code>  \
<code class="mi">0</code>                   <code class="n">C</code><code class="err">é</code><code class="n">sar</code> <code class="n">Milstein</code>   <code class="n">Argentina</code>
<code class="mi">1</code>                     <code class="n">Ivo</code> <code class="n">Andric</code> <code class="o">*</code>
<code class="mi">2</code>                <code class="n">Vladimir</code> <code class="n">Prelog</code> <code class="o">*</code>
<code class="mi">3</code>  <code class="n">Institut</code> <code class="n">de</code> <code class="n">Droit</code> <code class="n">International</code>     <code class="n">Belgium</code>
<code class="mi">4</code>                <code class="n">Auguste</code> <code class="n">Beernaert</code>     <code class="n">Belgium</code></pre>

<p>Let’s set ourselves the task of cleaning up those names by removing the asterisks and stripping any remaining whitespace.</p>

<p>Pandas <code>Series</code> have a handy <code>str</code> member, which provides a number of useful string methods to be performed on the array. Let’s use it to check how many asterisked names we have:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">df</code><code class="p">[</code><code class="n">df</code><code class="o">.</code><code class="n">name</code><code class="o">.</code><code class="n">str</code><code class="o">.</code><code class="n">contains</code><code class="p">(</code><code class="s1">'</code><code class="s1">\</code><code class="s1">*</code><code class="s1">'</code><code class="p">)</code><code class="p">]</code><code class="p">[</code><code class="s1">'</code><code class="s1">name</code><code class="s1">'</code><code class="p">]</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO8-1" href="#callout_cleaning_data_with_pandas_CO8-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
</code><code class="n">Out</code><code class="p">:</code><code>
</code><code class="mi">1</code><code>              </code><code class="n">Ivo</code><code> </code><code class="n">Andric</code><code> </code><code class="o">*</code><code>
</code><code class="mi">2</code><code>         </code><code class="n">Vladimir</code><code> </code><code class="n">Prelog</code><code> </code><code class="o">*</code><code>
</code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code>
</code><code class="mi">1041</code><code>       </code><code class="n">John</code><code> </code><code class="n">Warcup</code><code> </code><code class="n">Cornforth</code><code> </code><code class="o">*</code><code>
</code><code class="mi">1046</code><code>      </code><code class="n">Elizabeth</code><code> </code><code class="n">H</code><code class="o">.</code><code> </code><code class="n">Blackburn</code><code> </code><code class="o">*</code><code>
</code><code class="n">Name</code><code class="p">:</code><code> </code><code class="n">name</code><code class="p">,</code><code> </code><code class="n">Length</code><code class="p">:</code><code> </code><code class="mi">142</code><code class="p">,</code><code> </code><code class="n">dtype</code><code class="p">:</code><code> </code><code class="nb">object</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO8-2" href="#callout_cleaning_data_with_pandas_CO8-2"><img src="2.png" alt="2" width="12" height="12"></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO8-1" href="#co_cleaning_data_with_pandas_CO8-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>We use <code>str</code>’s <code>contains</code> method on the <code>name</code> column. Note that we have to escape the asterisk (<code>'\*'</code>) as this is a regex string. The Boolean mask is then applied to our Nobel Prize <code>DataFrame</code> and the resulting names listed.</p></dd>
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO8-2" href="#co_cleaning_data_with_pandas_CO8-2"><img src="2.png" alt="2" width="12" height="12"></a></dt>
<dd><p>142 of our 1,052 rows have a name containing <code>*</code>.</p></dd>
</dl>

<p>To clean up the names, let’s replace the asterisks with an empty string and strip any whitespace from the resulting names:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">df</code><code class="o">.</code><code class="n">name</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">name</code><code class="o">.</code><code class="n">str</code><code class="o">.</code><code class="n">replace</code><code class="p">(</code><code class="s1">'</code><code class="s1">*</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO9-1" href="#callout_cleaning_data_with_pandas_CO9-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
</code><code class="c1"># strip the whitespace from the names</code><code>
</code><code class="n">df</code><code class="o">.</code><code class="n">name</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">name</code><code class="o">.</code><code class="n">str</code><code class="o">.</code><code class="n">strip</code><code class="p">(</code><code class="p">)</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO9-1" href="#co_cleaning_data_with_pandas_CO9-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>Removes all asterisks in the name fields and return the result to the <code>DataFrame</code>.</p></dd>
</dl>

<p>A quick check shows that the names are now clean:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">df</code><code class="p">[</code><code class="n">df</code><code class="o">.</code><code class="n">name</code><code class="o">.</code><code class="n">str</code><code class="o">.</code><code class="n">contains</code><code class="p">(</code><code class="s1">'\*'</code><code class="p">)]</code>
<code class="n">Out</code><code class="p">:</code>
<code class="n">Empty</code> <code class="n">DataFrame</code></pre>

<p>Pandas <code>Series</code> have an impressive number of string-handling functions, enabling you to search and adapt your string columns. You can find a full list of these <a href="http://pandas.pydata.org/pandas-docs/stable/api.html#string-handling">in the API docs</a>.<a data-type="indexterm" data-primary="" data-startref="Sreplace8" id="idm140319417898848"></a><a data-type="indexterm" data-primary="" data-startref="DCreplace9" id="idm140319417897904"></a></p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Removing Rows"><div class="sect2" id="idm140319418497008">
<h2>Removing Rows</h2>

<p><a data-type="indexterm" data-primary="data cleaning" data-secondary="removing rows" id="idm140319417895856"></a>To recap, the 142 winners with <code>born_in</code> fields are duplicates, having an entry in the Wikipedia by both the country they were born in and their country when given the prize. Although the former could form the basis of an interesting visualization,<sup><a data-type="noteref" id="idm140319417894144-marker" href="ch09.html#idm140319417894144">4</a></sup> for our visualization we want each individual prize represented once only and so need to remove these from our <code>DataFrame</code>.</p>

<p>We want to create a new <code>DataFrame</code> using only those rows with a <code>NaN</code> <code>born_in</code> field. You might naively assume that a conditional expression comparing the <code>born_in</code> field to <code>NaN</code> would work here, but by definition<sup><a data-type="noteref" id="idm140319417890000-marker" href="ch09.html#idm140319417890000">5</a></sup>  <code>NaN</code> boolean comparisons always return <code>False</code>:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">np</code><code class="o">.</code><code class="n">nan</code> <code class="o">==</code> <code class="n">np</code><code class="o">.</code><code class="n">nan</code>
<code class="n">Out</code><code class="p">:</code> <code class="bp">False</code></pre>

<p>As a result, Pandas provides the dedicated <code>isnull</code> method to check for discounted (null) fields:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">df</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="p">[</code><code class="n">df</code><code class="o">.</code><code class="n">born_in</code><code class="o">.</code><code class="n">isnull</code><code class="p">(</code><code class="p">)</code><code class="p">]</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO10-1" href="#callout_cleaning_data_with_pandas_CO10-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
</code><code class="n">df</code><code class="o">.</code><code class="n">count</code><code class="p">(</code><code class="p">)</code><code>
</code><code class="n">Out</code><code class="p">:</code><code>
</code><code class="n">born_in</code><code>             </code><code class="mi">0</code><code> </code><code class="c1"># all entries now empty</code><code>
</code><code class="n">category</code><code>          </code><code class="mi">910</code><code>
</code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code>
</code><code class="n">dtype</code><code class="p">:</code><code> </code><code class="n">int64</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO10-1" href="#co_cleaning_data_with_pandas_CO10-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p><code>isnull</code> produces a Boolean mask with <code>True</code> for all rows with an empty <code>born_in</code> field.</p></dd>
</dl>

<p>The <code>born_in</code> column is no longer of use, so let’s remove it:<sup><a data-type="noteref" id="idm140319417782128-marker" href="ch09.html#idm140319417782128">6</a></sup></p>

<pre data-type="programlisting" data-code-language="python"><code class="n">df</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">drop</code><code class="p">(</code><code class="s1">'</code><code class="s1">born_in</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">axis</code><code class="o">=</code><code class="mi">1</code><code class="p">)</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO11-1" href="#callout_cleaning_data_with_pandas_CO11-1"><img src="1.png" alt="1" width="12" height="12"></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO11-1" href="#co_cleaning_data_with_pandas_CO11-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p><code>drop</code> takes a single label or index (or list of same) as a first argument and an <code>axis</code> argument to indicate row (<code>0</code> and default)  or column (<code>1</code>) index.</p></dd>
</dl>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Finding Duplicates"><div class="sect2" id="idm140319417896704">
<h2>Finding Duplicates</h2>

<p><a data-type="indexterm" data-primary="data cleaning" data-secondary="finding duplicates" id="DCdup9"></a><a data-type="indexterm" data-primary="duplicates" data-secondary="finding" id="dupfind9"></a>Now, a quick Internet search shows that 889 people and organizations have received the Nobel Prize up to 2014. With 910 remaining rows, we still have a few duplicates or anomalies to account for.</p>

<p>Pandas has a handy <code>duplicated</code> method for finding matching rows. This matches by column name or list of column names. Let’s get the list of all duplicates by name:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">dupes_by_name</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="p">[</code><code class="n">df</code><code class="o">.</code><code class="n">duplicated</code><code class="p">(</code><code class="s1">'</code><code class="s1">name</code><code class="s1">'</code><code class="p">)</code><code class="p">]</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO12-1" href="#callout_cleaning_data_with_pandas_CO12-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
</code><code class="n">dupes_by_name</code><code class="o">.</code><code class="n">count</code><code class="p">(</code><code class="p">)</code><code>
</code><code class="n">Out</code><code class="p">:</code><code>
</code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code>
</code><code class="n">year</code><code>              </code><code class="mi">46</code><code>
</code><code class="n">dtype</code><code class="p">:</code><code> </code><code class="n">int64</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO12-1" href="#co_cleaning_data_with_pandas_CO12-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p><code>duplicated</code> returns a Boolean array with <code>True</code> for the first occurrence of any rows with the same <code>name</code> field.</p></dd>
</dl>

<p>Now, a few people have won the Nobel Prize more than once but not 46, which means 40-odd winners are duplicated. Given that the Wikipedia page we scraped listed prize winners by country, the best bet is winners being “claimed” by more than one country.</p>

<p>Let’s look at some of the ways we can find duplicates by name in our Nobel Prize <code>DataFrame</code>. Some of these are pretty inefficient, but it’s a nice way to demonstrate a few Pandas functions.</p>

<p>By default, <code>duplicated</code> indicates all duplicates after the first occurrence, but it has a <code>take_last</code> option to prioritize the last occurrence. By combining these two using a Boolean <em>or</em> (|), we can get the full list of duplicates.</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">all_dupes</code> <code class="o">=</code> <code class="n">df</code><code class="p">[</code><code class="n">df</code><code class="o">.</code><code class="n">duplicated</code><code class="p">(</code><code class="s1">'name'</code><code class="p">)</code>\
               <code class="o">|</code> <code class="n">df</code><code class="o">.</code><code class="n">duplicated</code><code class="p">(</code><code class="s1">'name'</code><code class="p">,</code> <code class="n">keep</code><code class="o">=</code><code class="s1">'last'</code><code class="p">)]</code>
<code class="n">all_dupes</code><code class="o">.</code><code class="n">count</code><code class="p">()</code>
<code class="n">Out</code><code class="p">:</code>
<code class="o">...</code>
<code class="n">year</code>              <code class="mi">92</code>
<code class="n">dtype</code><code class="p">:</code> <code class="n">int64</code></pre>

<p>We could also get all the duplicates by testing whether our <code>DataFrame</code> rows have a name in the list of duplicate names. Pandas has a handy <code>isin</code> method for this.</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">all_dupes</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="p">[</code><code class="n">df</code><code class="o">.</code><code class="n">name</code><code class="o">.</code><code class="n">isin</code><code class="p">(</code><code class="n">dupes_by_name</code><code class="o">.</code><code class="n">name</code><code class="p">)</code><code class="p">]</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO13-1" href="#callout_cleaning_data_with_pandas_CO13-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
</code><code class="n">all_dupes</code><code class="o">.</code><code class="n">count</code><code class="p">(</code><code class="p">)</code><code>
</code><code class="n">Out</code><code class="p">:</code><code>
</code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code>
</code><code class="n">year</code><code>              </code><code class="mi">92</code><code>
</code><code class="n">dtype</code><code class="p">:</code><code> </code><code class="n">int64</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO13-1" href="#co_cleaning_data_with_pandas_CO13-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p><code>dupes_by_name.name</code> is a column <code>Series</code> containing all the duplicated names.</p></dd>
</dl>

<p>We can also find all duplicates by using Pandas’ powerful <code>groupby</code> method, which groups our <code>DataFrame</code>’s rows by column or list of columns. It returns a list of key-value pairs with the column value(s) as key and list of rows as values:</p>

<pre data-type="programlisting" data-code-language="python"><code class="k">for</code><code> </code><code class="n">name</code><code class="p">,</code><code> </code><code class="n">rows</code><code> </code><code class="ow">in</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">groupby</code><code class="p">(</code><code class="s1">'</code><code class="s1">name</code><code class="s1">'</code><code class="p">)</code><code class="p">:</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO14-1" href="#callout_cleaning_data_with_pandas_CO14-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
</code><code>    </code><code class="k">print</code><code class="p">(</code><code class="s1">'</code><code class="s1">name: </code><code class="si">%s</code><code class="s1">, number of rows: </code><code class="si">%d</code><code class="s1">'</code><code class="o">%</code><code class="p">(</code><code class="n">name</code><code class="p">,</code><code> </code><code class="nb">len</code><code class="p">(</code><code class="n">rows</code><code class="p">)</code><code class="p">)</code><code class="p">)</code><code>
</code><code>
</code><code class="n">name</code><code class="p">:</code><code> </code><code class="n">A</code><code class="o">.</code><code> </code><code class="n">Michael</code><code> </code><code class="n">Spence</code><code class="p">,</code><code> </code><code class="n">number</code><code> </code><code class="n">of</code><code> </code><code class="n">rows</code><code class="p">:</code><code> </code><code class="mi">1</code><code>
</code><code class="n">name</code><code class="p">:</code><code> </code><code class="n">Aage</code><code> </code><code class="n">Bohr</code><code class="p">,</code><code> </code><code class="n">number</code><code> </code><code class="n">of</code><code> </code><code class="n">rows</code><code class="p">:</code><code> </code><code class="mi">1</code><code>
</code><code class="n">name</code><code class="p">:</code><code> </code><code class="n">Aaron</code><code> </code><code class="n">Ciechanover</code><code class="p">,</code><code> </code><code class="n">number</code><code> </code><code class="n">of</code><code> </code><code class="n">rows</code><code class="p">:</code><code> </code><code class="mi">1</code><code>
</code><code class="o">.</code><code class="o">.</code><code class="o">.</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO14-1" href="#co_cleaning_data_with_pandas_CO14-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p><code>groupby</code> returns an iterator of (group name, group) tuples.</p></dd>
</dl>

<p>In order to get all duplicate rows, we merely need to check the length of the list of rows returned by key. Anything greater than one has name duplicates. Here we use Pandas’ <code>concat</code> method, which takes a list of row lists and creates a <code>DataFrame</code> with all the duplicated rows. A Python list constructor is used to filter for groups with more than one row:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">pd</code><code class="o">.</code><code class="n">concat</code><code class="p">(</code><code class="p">[</code><code class="n">g</code><code> </code><code class="k">for</code><code> </code><code class="n">_</code><code class="p">,</code><code class="n">g</code><code> </code><code class="ow">in</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">groupby</code><code class="p">(</code><code class="s1">'</code><code class="s1">name</code><code class="s1">'</code><code class="p">)</code><code>\</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO15-1" href="#callout_cleaning_data_with_pandas_CO15-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
</code><code>                     </code><code class="k">if</code><code> </code><code class="nb">len</code><code class="p">(</code><code class="n">g</code><code class="p">)</code><code> </code><code class="o">&gt;</code><code> </code><code class="mi">1</code><code class="p">]</code><code class="p">)</code><code class="p">[</code><code class="s1">'</code><code class="s1">name</code><code class="s1">'</code><code class="p">]</code><code>
</code><code>
</code><code class="n">Out</code><code class="p">:</code><code>
</code><code class="mi">121</code><code>           </code><code class="n">Aaron</code><code> </code><code class="n">Klug</code><code>
</code><code class="mi">131</code><code>           </code><code class="n">Aaron</code><code> </code><code class="n">Klug</code><code>
</code><code class="mi">615</code><code>      </code><code class="n">Albert</code><code> </code><code class="n">Einstein</code><code>
</code><code class="mi">844</code><code>      </code><code class="n">Albert</code><code> </code><code class="n">Einstein</code><code>
</code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code>
</code><code class="mi">489</code><code>      </code><code class="n">Yoichiro</code><code> </code><code class="n">Nambu</code><code>
</code><code class="mi">773</code><code>      </code><code class="n">Yoichiro</code><code> </code><code class="n">Nambu</code><code>
</code><code class="n">Name</code><code class="p">:</code><code> </code><code class="n">name</code><code class="p">,</code><code> </code><code class="n">Length</code><code class="p">:</code><code> </code><code class="mi">92</code><code class="p">,</code><code> </code><code class="n">dtype</code><code class="p">:</code><code> </code><code class="nb">object</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO15-1" href="#co_cleaning_data_with_pandas_CO15-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>Create a Python list by filtering the <code>name</code> row groups for those with more than one row (i.e., duplicated names).</p></dd>
</dl>
<div data-type="tip"><h1>Different paths to the same goal</h1>
<p>With a large library like Pandas, there are usually a number of ways to achieve the same thing. With small datasets like our Nobel Prize winners, any one will do, but for large datasets there could be significant performance implications. Just because Pandas will do what you ask doesn’t mean it’s necessarily efficient. With a lot of complex data manipulation going on behind the scenes, it’s a good idea to be prepared to be flexible and alert to inefficient approaches.<a data-type="indexterm" data-primary="" data-startref="DCdup9" id="idm140319417318656"></a><a data-type="indexterm" data-primary="" data-startref="dupfind9" id="idm140319417311888"></a></p>
</div>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Sorting Data"><div class="sect2" id="idm140319417310560">
<h2>Sorting Data</h2>

<p><a data-type="indexterm" data-primary="data cleaning" data-secondary="sorting data" id="DCsort9"></a>Now that we have our <code>all_dupes</code> <code>DataFrame</code>, with all duplicated rows by name, let’s use it to demonstrate Pandas’ <code>sort</code> method.</p>

<p>Pandas provides a sophisticated <code>sort</code> method for the <code>DataFrame</code> and <code>Series</code> classes, capable of sorting on multiple column names.</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">df2</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code>\
</code><code>     </code><code class="p">{</code><code class="s1">'</code><code class="s1">name</code><code class="s1">'</code><code class="p">:</code><code class="p">[</code><code class="s1">'</code><code class="s1">zak</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">alice</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">bob</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">mike</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">bob</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">bob</code><code class="s1">'</code><code class="p">]</code><code class="p">,</code><code>\
</code><code>      </code><code class="s1">'</code><code class="s1">score</code><code class="s1">'</code><code class="p">:</code><code class="p">[</code><code class="mi">4</code><code class="p">,</code><code> </code><code class="mi">3</code><code class="p">,</code><code> </code><code class="mi">5</code><code class="p">,</code><code> </code><code class="mi">2</code><code class="p">,</code><code> </code><code class="mi">3</code><code class="p">,</code><code> </code><code class="mi">7</code><code class="p">]</code><code class="p">}</code><code class="p">)</code><code>
</code><code class="n">df2</code><code class="o">.</code><code class="n">sort_values</code><code class="p">(</code><code class="p">[</code><code class="s1">'</code><code class="s1">name</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">score</code><code class="s1">'</code><code class="p">]</code><code class="p">,</code><code>\</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO16-1" href="#callout_cleaning_data_with_pandas_CO16-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
</code><code>        </code><code class="n">ascending</code><code class="o">=</code><code class="p">[</code><code class="mi">1</code><code class="p">,</code><code class="mi">0</code><code class="p">]</code><code class="p">)</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO16-2" href="#callout_cleaning_data_with_pandas_CO16-2"><img src="2.png" alt="2" width="12" height="12"></a><code>
</code><code>
</code><code class="n">Out</code><code class="p">:</code><code>
</code><code>    </code><code class="n">name</code><code>  </code><code class="n">score</code><code>
</code><code class="mi">1</code><code>  </code><code class="n">alice</code><code>      </code><code class="mi">3</code><code>
</code><code class="mi">5</code><code>    </code><code class="n">bob</code><code>      </code><code class="mi">7</code><code>
</code><code class="mi">2</code><code>    </code><code class="n">bob</code><code>      </code><code class="mi">5</code><code>
</code><code class="mi">4</code><code>    </code><code class="n">bob</code><code>      </code><code class="mi">3</code><code>
</code><code class="mi">3</code><code>   </code><code class="n">mike</code><code>      </code><code class="mi">2</code><code>
</code><code class="mi">0</code><code>    </code><code class="n">zak</code><code>      </code><code class="mi">4</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO16-1" href="#co_cleaning_data_with_pandas_CO16-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>Sorts the <code>DataFrame</code> first by name, then by score within those subgroups. Older Pandas versions use <code>sort</code>, now deprecated.</p></dd>
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO16-2" href="#co_cleaning_data_with_pandas_CO16-2"><img src="2.png" alt="2" width="12" height="12"></a></dt>
<dd><p>Sorts the names in alphabetical ascending order; sorts scores from high to low.</p></dd>
</dl>

<p class="pagebreak-before">Let’s sort the <code>DataFrame</code> of <code>all_dupes</code> by name and then look at the name, country, and year columns:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">306</code><code class="p">]:</code> <code class="n">all_dupes</code><code class="o">.</code><code class="n">sort_values</code><code class="p">(</code><code class="s1">'name'</code><code class="p">)</code>\
  <code class="p">[[</code><code class="s1">'name'</code><code class="p">,</code> <code class="s1">'country'</code><code class="p">,</code> <code class="s1">'year'</code><code class="p">]]</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">306</code><code class="p">]:</code>
                          <code class="n">name</code>         <code class="n">country</code>  <code class="n">year</code>
<code class="mi">121</code>                 <code class="n">Aaron</code> <code class="n">Klug</code>    <code class="n">South</code> <code class="n">Africa</code>  <code class="mi">1982</code>
<code class="mi">131</code>                 <code class="n">Aaron</code> <code class="n">Klug</code>  <code class="n">United</code> <code class="n">Kingdom</code>  <code class="mi">1982</code>
<code class="mi">615</code>            <code class="n">Albert</code> <code class="n">Einstein</code>     <code class="n">Switzerland</code>  <code class="mi">1921</code>
<code class="mi">844</code>            <code class="n">Albert</code> <code class="n">Einstein</code>         <code class="n">Germany</code>  <code class="mi">1921</code>
<code class="o">...</code>
<code class="mi">910</code>                <code class="n">Marie</code> <code class="n">Curie</code>          <code class="n">France</code>  <code class="mi">1903</code>
<code class="mi">919</code>                <code class="n">Marie</code> <code class="n">Curie</code>          <code class="n">France</code>  <code class="mi">1911</code>
<code class="mi">706</code>     <code class="n">Marie</code> <code class="n">Sk</code><code class="err">ł</code><code class="n">odowska</code><code class="o">-</code><code class="n">Curie</code>          <code class="n">Poland</code>  <code class="mi">1903</code>
<code class="mi">709</code>     <code class="n">Marie</code> <code class="n">Sk</code><code class="err">ł</code><code class="n">odowska</code><code class="o">-</code><code class="n">Curie</code>          <code class="n">Poland</code>  <code class="mi">1911</code>
<code class="o">...</code>
<code class="mi">650</code>              <code class="n">Ragnar</code> <code class="n">Granit</code>          <code class="n">Sweden</code>  <code class="mi">1967</code>
<code class="mi">960</code>              <code class="n">Ragnar</code> <code class="n">Granit</code>         <code class="n">Finland</code>  <code class="mi">1809</code>
<code class="o">...</code>
<code class="mi">396</code>              <code class="n">Sidney</code> <code class="n">Altman</code>   <code class="n">United</code> <code class="n">States</code>  <code class="mi">1990</code>
<code class="mi">995</code>              <code class="n">Sidney</code> <code class="n">Altman</code>          <code class="n">Canada</code>  <code class="mi">1989</code>
<code class="o">...</code>
<code class="p">[</code><code class="mi">92</code> <code class="n">rows</code> <code class="n">x</code> <code class="mi">3</code> <code class="n">columns</code><code class="p">]</code></pre>

<p>This output shows that, as expected, some winners have been attributed twice for the same year with different countries. It also reveals a few other anomalies. Although Marie Curie did win a Nobel Prize twice, she’s included here with both French and Polish nationalities.<sup><a data-type="noteref" id="idm140319417106352-marker" href="ch09.html#idm140319417106352">7</a></sup> The fairest thing here is to split the spoils between Poland and France while settling on the single compound surname. We have also found our anomalous year of 1809 at row 960. Sidney Altman is both duplicated and given the wrong year of 1990.<a data-type="indexterm" data-primary="" data-startref="DCsort9" id="idm140319417104944"></a></p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Removing Duplicates"><div class="sect2" id="idm140319417008688">
<h2>Removing Duplicates</h2>

<p><a data-type="indexterm" data-primary="duplicates" data-secondary="removing" id="Dremov9"></a><a data-type="indexterm" data-primary="data cleaning" data-secondary="removing duplicates" id="RCdup9"></a>Let’s go about removing the duplicates we just identified and start compiling a little cleaning function.</p>
<aside data-type="sidebar" epub:type="sidebar" class="pagebreak-before"><div class="sidebar" id="idm140319417004208">
<h5>Views Versus Copies</h5>
<p><a data-type="indexterm" data-primary="Pandas" data-secondary="altering views vs. copies" id="idm140319417002368"></a><a data-type="indexterm" data-primary="DataFrames (Pandas)" data-secondary="altering views vs. copies" id="idm140319417001424"></a>It’s very important when working with Pandas to be clear whether you are altering a view or copy of your <code>DataFrame</code>, <code>Series</code>, and so on. The following seems like a natural way to change the <code>country</code> field of a row (Marie Curie’s) but gives a potentially confusing warning:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">df</code><code class="p">[</code><code class="s1">'</code><code class="s1">country</code><code class="s1">'</code><code class="p">]</code><code class="p">[</code><code class="mi">709</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">France</code><code class="s1">'</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO17-1" href="#callout_cleaning_data_with_pandas_CO17-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
</code><code class="o">-</code><code class="n">c</code><code class="p">:</code><code class="mi">1</code><code class="p">:</code><code> </code><code class="n">SettingWithCopyWarning</code><code class="p">:</code><code>
</code><code class="n">A</code><code> </code><code class="n">value</code><code> </code><code class="ow">is</code><code> </code><code class="n">trying</code><code> </code><code class="n">to</code><code> </code><code class="n">be</code><code> </code><code class="nb">set</code><code> </code><code class="n">on</code><code> </code><code class="n">a</code><code> </code><code class="n">copy</code><code> </code><code class="n">of</code><code> </code><code class="n">a</code><code> </code><code class="nb">slice</code><code> </code><code class="kn">from</code><code> </code><code class="nn">a</code><code>
</code><code class="n">DataFrame</code><code>
</code><code>
</code><code class="n">See</code><code> </code><code class="n">the</code><code> </code><code class="n">caveats</code><code> </code><code class="ow">in</code><code> </code><code class="n">the</code><code> </code><code class="n">documentation</code><code class="p">:</code><code>
</code><code>    </code><code class="n">http</code><code class="p">:</code><code class="o">/</code><code class="o">/</code><code class="n">pandas</code><code class="o">.</code><code class="n">pydata</code><code class="o">.</code><code class="n">org</code><code class="o">/</code><code class="n">pandas</code><code class="o">-</code><code class="n">docs</code><code class="o">/</code><code class="n">stable</code><code class="o">/</code><code class="o">.</code><code class="o">.</code><code class="o">.</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO17-1" href="#co_cleaning_data_with_pandas_CO17-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>Set the country of row 709, Marie Curie, from Poland to France.</p></dd>
</dl>

<p>This is all the more confusing when you find that it has worked as expected:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">df</code><code class="p">[</code><code class="s1">'country'</code><code class="p">][</code><code class="mi">709</code><code class="p">]</code>
<code class="n">Out</code><code class="p">:</code> <code class="s1">'France'</code></pre>

<p>It turns out that such <em>chained</em> operations are discouraged by the Pandas devs because it’s easy to unintentionally alter a copy of the datatype, not the original (view).<sup><a data-type="noteref" id="idm140319416887136-marker" href="ch09.html#idm140319416887136">8</a></sup></p>

<p>These warnings<sup><a data-type="noteref" id="idm140319416885600-marker" href="ch09.html#idm140319416885600">9</a></sup> are there to encourage best practice, which is to use the <code>ix</code> (or the more specific <code>loc</code> and <code>iloc</code>) method:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">df</code><code class="o">.</code><code class="n">ix</code><code class="p">[</code><code class="mi">709</code><code class="p">,</code> <code class="s1">'country'</code><code class="p">]</code> <code class="o">=</code> <code class="s1">'France'</code></pre>
</div></aside>
<div data-type="tip"><h6>Tip</h6>
<p>Changing rows by numeric index is fine if you know your dataset is stable and don’t anticipate running any of your cleaning scripts again. But if, as in the case of our scraped Nobel Prize data, you may want to run the same cleaning script on an updated dataset, it’s much better to use stable indicators (i.e., grab the row with name Marie Curie and year 1911, not index 919).</p>
</div>

<p>A more robust way of changing the country of a specific row is to use stable column values to select the row rather than its index. So to change Marie Curie’s 1911 prize country to France, we can use a Boolean mask with the <code>loc</code> method to select a row and then set its country column to France. Note that we need to specify the Unicode to include the Polish ł.</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">df</code><code class="o">.</code><code class="n">loc</code><code class="p">[(</code><code class="n">df</code><code class="o">.</code><code class="n">name</code> <code class="o">==</code> <code class="s-Affix">u</code><code class="s1">'Marie Sk</code><code class="se">\u0142</code><code class="s1">odowska-Curie'</code><code class="p">)</code> <code class="o">&amp;</code>\
      <code class="p">(</code><code class="n">df</code><code class="o">.</code><code class="n">year</code> <code class="o">==</code> <code class="mi">1911</code><code class="p">),</code> <code class="s1">'country'</code><code class="p">]</code> <code class="o">=</code> <code class="s1">'France'</code></pre>

<p>As well as changing Marie Curie’s country, we want to remove or drop some rows from our <code>DataFrame</code>, based on column values. There are two ways we can do this, firstly by using the <code>DataFrame</code>’s <code>drop</code> method, which takes a list of index labels, or by creating a new <code>DataFrame</code> with a Boolean mask that filters the rows we want to drop. If we use <code>drop</code>, we can use the <code>inplace</code> argument to change the existing <code>DataFrame</code>.</p>

<p>In the following code, we drop our duplicate Sidney Altman row by creating a <code>DataFrame</code> with the single row we want (remember, index labels are preserved) and passing that index to the <code>drop</code> method and changing the <code>DataFrame</code> in place:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">df</code><code class="o">.</code><code class="n">drop</code><code class="p">(</code><code class="n">df</code><code class="p">[(</code><code class="n">df</code><code class="o">.</code><code class="n">name</code> <code class="o">==</code> <code class="s1">'Sidney Altman'</code><code class="p">)</code> <code class="o">&amp;</code>\
 <code class="p">(</code><code class="n">df</code><code class="o">.</code><code class="n">year</code> <code class="o">==</code> <code class="mi">1990</code><code class="p">)]</code><code class="o">.</code><code class="n">index</code><code class="p">,</code>
    <code class="n">inplace</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code></pre>

<p>Another way to remove the row is to use the same Boolean mask with a logical not (~) to create a new <code>DataFrame</code> with all rows except the one(s) we’re selecting:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">df</code> <code class="o">=</code> <code class="n">df</code><code class="p">[</code><code class="o">~</code><code class="p">((</code><code class="n">df</code><code class="o">.</code><code class="n">name</code> <code class="o">==</code> <code class="s1">'Sidney Altman'</code><code class="p">)</code> <code class="o">&amp;</code> <code class="p">(</code><code class="n">df</code><code class="o">.</code><code class="n">year</code> <code class="o">==</code> <code class="mi">1990</code><code class="p">))]</code></pre>

<p>Let’s add this change and all current modifications to a <code>clean_data</code> method:</p>

<pre data-type="programlisting" data-code-language="python"><code class="k">def</code> <code class="nf">clean_data</code><code class="p">(</code><code class="n">df</code><code class="p">):</code>
    <code class="n">df</code> <code class="o">=</code> <code class="n">df</code><code class="o">.</code><code class="n">replace</code><code class="p">(</code><code class="s1">''</code><code class="p">,</code> <code class="n">np</code><code class="o">.</code><code class="n">nan</code><code class="p">)</code>
    <code class="n">df</code> <code class="o">=</code> <code class="n">df</code><code class="p">[</code><code class="n">df</code><code class="o">.</code><code class="n">born_in</code><code class="o">.</code><code class="n">isnull</code><code class="p">()]</code>
    <code class="n">df</code> <code class="o">=</code> <code class="n">df</code><code class="o">.</code><code class="n">drop</code><code class="p">(</code><code class="s1">'born_in'</code><code class="p">,</code> <code class="n">axis</code><code class="o">=</code><code class="mi">1</code><code class="p">)</code>
    <code class="n">df</code><code class="o">.</code><code class="n">drop</code><code class="p">(</code><code class="n">df</code><code class="p">[</code><code class="n">df</code><code class="o">.</code><code class="n">year</code> <code class="o">==</code> <code class="mi">1809</code><code class="p">]</code><code class="o">.</code><code class="n">index</code><code class="p">,</code> <code class="n">inplace</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code>
    <code class="n">df</code> <code class="o">=</code> <code class="n">df</code><code class="p">[</code><code class="o">~</code><code class="p">(</code><code class="n">df</code><code class="o">.</code><code class="n">name</code> <code class="o">==</code> <code class="s1">'Marie Curie'</code><code class="p">)]</code>
    <code class="n">df</code><code class="o">.</code><code class="n">loc</code><code class="p">[(</code><code class="n">df</code><code class="o">.</code><code class="n">name</code> <code class="o">==</code> <code class="s-Affix">u</code><code class="s1">'Marie Sk</code><code class="se">\u0142</code><code class="s1">odowska-Curie'</code><code class="p">)</code> <code class="o">&amp;</code>\
           <code class="p">(</code><code class="n">df</code><code class="o">.</code><code class="n">year</code> <code class="o">==</code> <code class="mi">1911</code><code class="p">),</code> <code class="s1">'country'</code><code class="p">]</code> <code class="o">=</code> <code class="s1">'France'</code>
    <code class="n">df</code> <code class="o">=</code> <code class="n">df</code><code class="p">[</code><code class="o">~</code><code class="p">((</code><code class="n">df</code><code class="o">.</code><code class="n">name</code> <code class="o">==</code> <code class="s1">'Sidney Altman'</code><code class="p">)</code> <code class="o">&amp;</code>\
     <code class="p">(</code><code class="n">df</code><code class="o">.</code><code class="n">year</code> <code class="o">==</code> <code class="mi">1990</code><code class="p">))]</code>
    <code class="k">return</code> <code class="n">df</code></pre>

<p>We now have a mix of valid duplicates (those few multiple Nobel Prize winners) and those with dual country.  For the purposes of our visualization, we want each prize to count only once so have to discard half the dual-country prizes. The easiest way is to use the <code>duplicated</code> method, but because we collected the winners alphabetically by country, this would favor those nationalities with first letters earlier in the alphabet. Short of a fair amount of research and debate, the fairest way seems to pick one out at random and discard it. There are various ways to do this, but the simplest is to randomize the order of the rows before using <code>drop_duplicates</code>, a Pandas method that drops all duplicated rows after the first encountered or, with the <code>take_last</code> argument set to <code>True</code>, all before the last.</p>

<p>NumPy has a number of very useful methods in its <code>random</code> module, of which <code>permutation</code> is perfect for randomizing the row index. This method takes an array (or Pandas index) of values and shuffles them. We can then use the <code>DataFrame</code> <code>reindex</code> method to apply the shuffled result. Note that we drop those rows sharing both name and year, which will preserve the legitimate double winners with different years for their prizes.</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">df</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">reindex</code><code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">random</code><code class="o">.</code><code class="n">permutation</code><code class="p">(</code><code class="n">df</code><code class="o">.</code><code class="n">index</code><code class="p">)</code><code class="p">)</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO18-1" href="#callout_cleaning_data_with_pandas_CO18-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
</code><code class="n">df</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">drop_duplicates</code><code class="p">(</code><code class="p">[</code><code class="s1">'</code><code class="s1">name</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">year</code><code class="s1">'</code><code class="p">]</code><code class="p">)</code><code>        </code><a class="co" id="co_cleaning_data_with_pandas_CO18-2" href="#callout_cleaning_data_with_pandas_CO18-2"><img src="2.png" alt="2" width="12" height="12"></a><code>
</code><code class="n">df</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">sort_index</code><code class="p">(</code><code class="p">)</code><code>                             </code><a class="co" id="co_cleaning_data_with_pandas_CO18-3" href="#callout_cleaning_data_with_pandas_CO18-3"><img src="3.png" alt="3" width="12" height="12"></a><code>
</code><code class="n">df</code><code class="o">.</code><code class="n">count</code><code class="p">(</code><code class="p">)</code><code>
</code><code class="n">Out</code><code class="p">:</code><code>
</code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code>
</code><code class="n">year</code><code>              </code><code class="mi">865</code><code>
</code><code class="n">dtype</code><code class="p">:</code><code> </code><code class="n">int64</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO18-1" href="#co_cleaning_data_with_pandas_CO18-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>Create a shuffled version of <code>df</code>’s index and reindex <code>df</code> with it.</p></dd>
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO18-2" href="#co_cleaning_data_with_pandas_CO18-2"><img src="2.png" alt="2" width="12" height="12"></a></dt>
<dd><p>Drop all duplicates sharing name and year.</p></dd>
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO18-3" href="#co_cleaning_data_with_pandas_CO18-3"><img src="3.png" alt="3" width="12" height="12"></a></dt>
<dd><p>Return the index to sorted-by-integer position.</p></dd>
</dl>

<p>If our data wrangling has been successful, we should have only valid duplicates left, those vaunted double-prize winners. Let’s list the remaining duplicates to check:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">:</code><code> </code><code class="n">df</code><code class="p">[</code><code class="n">df</code><code class="o">.</code><code class="n">duplicated</code><code class="p">(</code><code class="s1">'</code><code class="s1">name</code><code class="s1">'</code><code class="p">)</code><code> </code><code class="o">|</code><code>
</code><code>             </code><code class="n">df</code><code class="o">.</code><code class="n">duplicated</code><code class="p">(</code><code class="s1">'</code><code class="s1">name</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">keep</code><code class="o">=</code><code class="s1">'</code><code class="s1">last</code><code class="s1">'</code><code class="p">)</code><code class="p">]</code><code>\</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO19-1" href="#callout_cleaning_data_with_pandas_CO19-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
</code><code>             </code><code class="o">.</code><code class="n">sort_values</code><code class="p">(</code><code class="n">by</code><code class="o">=</code><code class="s1">'</code><code class="s1">name</code><code class="s1">'</code><code class="p">)</code><code>\
</code><code>             </code><code class="p">[</code><code class="p">[</code><code class="s1">'</code><code class="s1">name</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">country</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">year</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">category</code><code class="s1">'</code><code class="p">]</code><code class="p">]</code><code>
</code><code class="n">Out</code><code class="p">:</code><code>
</code><code>                       </code><code class="n">name</code><code>     </code><code class="n">country</code><code>  </code><code class="n">year</code><code>   </code><code class="n">category</code><code>
</code><code class="mi">548</code><code>        </code><code class="n">Frederick</code><code> </code><code class="n">Sanger</code><code>  </code><code class="n">United</code><code> </code><code class="n">Kingdom</code><code>  </code><code class="mi">1958</code><code>  </code><code class="n">Chemistry</code><code>
</code><code class="mi">580</code><code>        </code><code class="n">Frederick</code><code> </code><code class="n">Sanger</code><code>  </code><code class="n">United</code><code> </code><code class="n">Kingdom</code><code>  </code><code class="mi">1980</code><code>  </code><code class="n">Chemistry</code><code>
</code><code class="mi">292</code><code>            </code><code class="n">John</code><code> </code><code class="n">Bardeen</code><code>   </code><code class="n">United</code><code> </code><code class="n">States</code><code>  </code><code class="mi">1956</code><code>    </code><code class="n">Physics</code><code>
</code><code class="mi">326</code><code>            </code><code class="n">John</code><code> </code><code class="n">Bardeen</code><code>   </code><code class="n">United</code><code> </code><code class="n">States</code><code>  </code><code class="mi">1972</code><code>    </code><code class="n">Physics</code><code>
</code><code class="mi">285</code><code>        </code><code class="n">Linus</code><code> </code><code class="n">C</code><code class="o">.</code><code> </code><code class="n">Pauling</code><code>   </code><code class="n">United</code><code> </code><code class="n">States</code><code>  </code><code class="mi">1954</code><code>  </code><code class="n">Chemistry</code><code>
</code><code class="mi">309</code><code>        </code><code class="n">Linus</code><code> </code><code class="n">C</code><code class="o">.</code><code> </code><code class="n">Pauling</code><code>   </code><code class="n">United</code><code> </code><code class="n">States</code><code>  </code><code class="mi">1962</code><code>      </code><code class="n">Peace</code><code>
</code><code class="mi">706</code><code>  </code><code class="n">Marie</code><code> </code><code class="n">Sk</code><code class="err">ł</code><code class="n">odowska</code><code class="o">-</code><code class="n">Curie</code><code>          </code><code class="n">Poland</code><code>  </code><code class="mi">1903</code><code>    </code><code class="n">Physics</code><code>
</code><code class="mi">709</code><code>  </code><code class="n">Marie</code><code> </code><code class="n">Sk</code><code class="err">ł</code><code class="n">odowska</code><code class="o">-</code><code class="n">Curie</code><code>          </code><code class="n">France</code><code>  </code><code class="mi">1911</code><code>  </code><code class="n">Chemistry</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO19-1" href="#co_cleaning_data_with_pandas_CO19-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>We combine duplicates from the first with the last to get them all. If using an older version of Pandas, you may need to use the argument <code>take_last=True</code>.</p></dd>
</dl>

<p>A quick Internet check shows that we have the correct four double-prize winners.</p>

<p>Assuming we’ve caught the unwanted duplicates,<sup><a data-type="noteref" id="idm140319416204224-marker" href="ch09.html#idm140319416204224">10</a></sup> let’s move on to other “dirty” aspects of the data.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Dealing with Missing Fields"><div class="sect2" id="idm140319417007776">
<h2>Dealing with Missing Fields</h2>

<p>Let’s see where we stand as far as <em>null</em> fields are concerned by counting our <code>DataFrame</code>:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">df</code><code class="o">.</code><code class="n">count</code><code class="p">()</code>
<code class="n">Out</code><code class="p">:</code>
<code class="n">category</code>          <code class="mi">864</code> <code class="c1"># missing field</code>
<code class="n">date_of_birth</code>     <code class="mi">857</code>
<code class="n">date_of_death</code>     <code class="mi">566</code>
<code class="n">gender</code>            <code class="mi">858</code> <code class="c1"># seven missing genders</code>
<code class="n">link</code>              <code class="mi">865</code>
<code class="n">name</code>              <code class="mi">865</code>
<code class="n">country</code>           <code class="mi">865</code>
<code class="n">place_of_birth</code>    <code class="mi">831</code>
<code class="n">place_of_death</code>    <code class="mi">524</code>
<code class="n">text</code>              <code class="mi">865</code>
<code class="n">year</code>              <code class="mi">865</code>
<code class="n">dtype</code><code class="p">:</code> <code class="n">int64</code></pre>

<p>We appear to be missing a <code>category</code> field, which suggests a data entry mistake. If you remember, while scraping our Nobel Prize data we checked the category against a valid list (see <a data-type="xref" href="ch06.html#scrapy_process_li">Example 6-3</a>). One of them appears to have failed this check. Let’s find out which one it is by grabbing the row where the category field is null and showing its name and text columns:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">df</code><code class="p">[</code><code class="n">df</code><code class="o">.</code><code class="n">category</code><code class="o">.</code><code class="n">isnull</code><code class="p">()][[</code><code class="s1">'name'</code><code class="p">,</code> <code class="s1">'text'</code><code class="p">]]</code>
<code class="n">Out</code><code class="p">:</code>
              <code class="n">name</code>                            <code class="n">text</code>
<code class="mi">922</code>  <code class="n">Alexis</code> <code class="n">Carrel</code>  <code class="n">Alexis</code> <code class="n">Carrel</code> <code class="p">,</code> <code class="n">Medicine</code><code class="p">,</code> <code class="mi">1912</code></pre>

<p>We saved the original link text for our winners and, as you can see, Alexis Carrel was listed as winning the Nobel prize for <code>Medicine</code>, when it should have been <code>Physiology or Medicine</code>. Let’s correct that now:</p>

<pre data-type="programlisting" data-code-language="python"><code class="o">...</code>
<code class="n">df</code><code class="o">.</code><code class="n">ix</code><code class="p">[</code><code class="n">df</code><code class="o">.</code><code class="n">name</code> <code class="o">==</code> <code class="s1">'Alexis Carrel'</code><code class="p">,</code> <code class="s1">'category'</code><code class="p">]</code> <code class="o">=</code>\
 <code class="s1">'Physiology or Medicine'</code></pre>

<p>We are also missing <code>gender</code> for seven winners. Let’s list them:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">df</code><code class="p">[</code><code class="n">df</code><code class="o">.</code><code class="n">gender</code><code class="o">.</code><code class="n">isnull</code><code class="p">()][</code><code class="s1">'name'</code><code class="p">]</code>
<code class="n">Out</code><code class="p">:</code>
<code class="mi">3</code>                        <code class="n">Institut</code> <code class="n">de</code> <code class="n">Droit</code> <code class="n">International</code>
<code class="mi">156</code>                              <code class="n">Friends</code> <code class="n">Service</code> <code class="n">Council</code>
<code class="mi">574</code>                                <code class="n">Amnesty</code> <code class="n">International</code>
<code class="mi">650</code>                                        <code class="n">Ragnar</code> <code class="n">Granit</code>
<code class="mi">947</code>                             <code class="n">M</code><code class="err">é</code><code class="n">decins</code> <code class="n">Sans</code> <code class="n">Fronti</code><code class="err">è</code><code class="n">res</code>
<code class="mi">1000</code>    <code class="n">Pugwash</code> <code class="n">Conferences</code> <code class="n">on</code> <code class="n">Science</code> <code class="ow">and</code> <code class="n">World</code> <code class="n">Affairs</code>
<code class="mi">1033</code>                  <code class="n">International</code> <code class="n">Atomic</code> <code class="n">Energy</code> <code class="n">Agency</code>
<code class="n">Name</code><code class="p">:</code> <code class="n">name</code><code class="p">,</code> <code class="n">dtype</code><code class="p">:</code> <code class="nb">object</code></pre>

<p>With the exception of Ragnar Granit, all these are genderless (missing person data) institutions. The focus of our visualization is on individual winners, so we’ll remove these while establishing Ragnar Granit’s gender:</p>

<pre data-type="programlisting" data-code-language="python"><code class="o">...</code>
<code class="k">def</code> <code class="nf">clean_data</code><code class="p">(</code><code class="n">df</code><code class="p">):</code>
<code class="o">...</code>
    <code class="n">df</code><code class="o">.</code><code class="n">ix</code><code class="p">[</code><code class="n">df</code><code class="o">.</code><code class="n">name</code> <code class="o">==</code> <code class="s1">'Ragnar Granit'</code><code class="p">,</code> <code class="s1">'gender'</code><code class="p">]</code> <code class="o">=</code> <code class="s1">'male'</code>
    <code class="n">df</code> <code class="o">=</code> <code class="n">df</code><code class="p">[</code><code class="n">df</code><code class="o">.</code><code class="n">gender</code><code class="o">.</code><code class="n">notnull</code><code class="p">()]</code> <code class="c1"># remove genderless entries</code></pre>

<p>Let’s see where those changes leave us by performing another count on our <code>DataFrame</code>:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">df</code><code class="o">.</code><code class="n">count</code><code class="p">()</code>
<code class="n">Out</code><code class="p">:</code>
<code class="n">category</code>          <code class="mi">858</code>
<code class="n">date_of_birth</code>     <code class="mi">857</code> <code class="c1"># missing field</code>
<code class="o">...</code>
<code class="n">year</code>              <code class="mi">858</code>
<code class="n">dtype</code><code class="p">:</code> <code class="n">int64</code></pre>

<p>Having removed all the institutions, all entries should have at least a date of birth. Let’s find the missing entry and fix it:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">df</code><code class="p">[</code><code class="n">df</code><code class="o">.</code><code class="n">date_of_birth</code><code class="o">.</code><code class="n">isnull</code><code class="p">()][</code><code class="s1">'name'</code><code class="p">]</code>
<code class="n">Out</code><code class="p">:</code>
<code class="mi">782</code>    <code class="n">Hiroshi</code> <code class="n">Amano</code>
<code class="n">Name</code><code class="p">:</code> <code class="n">name</code><code class="p">,</code> <code class="n">dtype</code><code class="p">:</code> <code class="nb">object</code></pre>

<p>Probably because Hiroshi Amano is a very recent (2014) winner, his date of birth was not available to be scraped. A quick web search establishes Amano’s date of birth, which we add to the <code>DataFrame</code> by hand:</p>

<pre data-type="programlisting" data-code-language="python"><code class="o">...</code>
    <code class="n">df</code><code class="o">.</code><code class="n">ix</code><code class="p">[</code><code class="n">df</code><code class="o">.</code><code class="n">name</code> <code class="o">==</code> <code class="s1">'Hiroshi Amano'</code><code class="p">,</code> <code class="s1">'date_of_birth'</code><code class="p">]</code> <code class="o">=</code>\
    <code class="s1">'11 September 1960'</code></pre>

<p>We now have 858 individual winners. Let’s do a final count to see where we stand:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">df</code><code class="o">.</code><code class="n">count</code><code class="p">()</code>
<code class="n">Out</code><code class="p">:</code>
<code class="n">category</code>          <code class="mi">858</code>
<code class="n">date_of_birth</code>     <code class="mi">858</code>
<code class="n">date_of_death</code>     <code class="mi">566</code>
<code class="n">gender</code>            <code class="mi">858</code>
<code class="n">link</code>              <code class="mi">858</code>
<code class="n">name</code>              <code class="mi">858</code>
<code class="n">country</code>           <code class="mi">858</code>
<code class="n">place_of_birth</code>    <code class="mi">831</code>
<code class="n">place_of_death</code>    <code class="mi">524</code>
<code class="n">text</code>              <code class="mi">858</code>
<code class="n">year</code>              <code class="mi">858</code>
<code class="n">dtype</code><code class="p">:</code> <code class="n">int64</code></pre>

<p>The key fields of <code>category</code>, <code>date_of_birth</code>, <code>gender</code>, <code>country</code>, and <code>year</code> are all filled and there’s a healthy amount of data in the remaining stats. All in all, there’s enough clean data to form the basis for a rich visualization.</p>

<p>Now let’s put on the finishing touches by making our temporal fields more usable.<a data-type="indexterm" data-primary="" data-startref="Dremov9" id="idm140319415718784"></a><a data-type="indexterm" data-primary="" data-startref="RCdup9" id="idm140319415717808"></a></p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Dealing with Times and Dates"><div class="sect2" id="idm140319415984272">
<h2>Dealing with Times and Dates</h2>

<p><a data-type="indexterm" data-primary="data cleaning" data-secondary="dealing with times/dates" id="DCtimedate9"></a><a data-type="indexterm" data-primary="times" id="time9"></a><a data-type="indexterm" data-primary="dates" id="dates9"></a>Currently the <code>date_of_birth</code> and <code>date_of_death</code> fields are represented by strings. As we’ve seen, Wikipedia’s informal editing guidelines have led to a number of different time formats.  Our original <code>DataFrame</code> shows an impressive variety of formats in the first 10 entries:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">df</code><code class="p">[[</code><code class="s1">'name'</code><code class="p">,</code> <code class="s1">'date_of_birth'</code><code class="p">]]</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">14</code><code class="p">]:</code>
                             <code class="n">name</code>      <code class="n">date_of_birth</code>
<code class="mi">0</code>                  <code class="n">C</code><code class="err">é</code><code class="n">sar</code> <code class="n">Milstein</code>     <code class="mi">8</code> <code class="n">October</code> <code class="mi">1927</code>
<code class="o">...</code>
<code class="mi">2</code>               <code class="n">Vladimir</code> <code class="n">Prelog</code> <code class="o">*</code>      <code class="n">July</code> <code class="mi">23</code><code class="p">,</code> <code class="mi">1906</code>
<code class="o">...</code>
<code class="mi">9</code>                    <code class="n">Georges</code> <code class="n">Pire</code>         <code class="mi">1910</code><code class="o">-</code><code class="mo">02</code><code class="o">-</code><code class="mi">10</code>
<code class="o">...</code></pre>

<p>In order to compare the date fields (for example, subtracting the prize <em>year</em> from <em>date of birth</em> to give the winners’ ages), we need to get them into a format that allows such operations. Unsurprisingly, Pandas is good with parsing messy dates and times, converting them by default into the NumPy <code>datetime64</code> object, which has a slew of useful methods and operators.</p>

<p>Converting a time column to <code>datetime64</code>, we use Pandas’ <code>to_datetime</code> method:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">pd</code><code class="o">.</code><code class="n">to_datetime</code><code class="p">(</code><code class="n">df</code><code class="o">.</code><code class="n">date_of_birth</code><code class="p">,</code><code> </code><code class="n">errors</code><code class="o">=</code><code class="s1">'</code><code class="s1">raise</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO20-1" href="#callout_cleaning_data_with_pandas_CO20-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
</code><code class="n">Out</code><code class="p">:</code><code>
</code><code class="mi">0</code><code>    </code><code class="mi">1927</code><code class="o">-</code><code class="mi">10</code><code class="o">-</code><code class="mi">08</code><code>
</code><code class="mi">4</code><code>    </code><code class="mi">1829</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">26</code><code>
</code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code>
</code><code class="mi">1050</code><code>   </code><code class="mi">1906</code><code class="o">-</code><code class="mi">09</code><code class="o">-</code><code class="mo">06</code><code>
</code><code class="mi">1051</code><code>   </code><code class="mi">1931</code><code class="o">-</code><code class="mi">11</code><code class="o">-</code><code class="mi">26</code><code>
</code><code class="n">Name</code><code class="p">:</code><code> </code><code class="n">date_of_birth</code><code class="p">,</code><code> </code><code class="n">Length</code><code class="p">:</code><code> </code><code class="mi">858</code><code class="p">,</code><code> </code><code class="n">dtype</code><code class="p">:</code><code> </code><code class="n">datetime64</code><code class="p">[</code><code class="n">ns</code><code class="p">]</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO20-1" href="#co_cleaning_data_with_pandas_CO20-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p><code>errors</code>' default is <code>ignore</code>, but we want them flagged.</p></dd>
</dl>

<p>By default <code>to_datetime</code> ignores errors, but here we want to know if Pandas has been unable to parse a <code>date_of_birth</code>, giving us the opportunity to fix it manually. Thankfully, the conversion passes without error.</p>

<p>Running <code>to_datetime</code> on the <code>date_of_birth</code> field raises a <code>ValueError</code> and an unhelpful one at that, giving no indication of the entry that triggered it.</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">143</code><code class="p">]:</code> <code class="n">pd</code><code class="o">.</code><code class="n">to_datetime</code><code class="p">(</code><code class="n">df</code><code class="o">.</code><code class="n">date_of_death</code><code class="p">,</code> <code class="n">errors</code><code class="o">=</code><code class="s1">'raise'</code><code class="p">)</code>
<code class="o">--------------------------------------------------------------</code>
<code class="ne">ValueError</code>                   <code class="n">Traceback</code> <code class="p">(</code><code class="n">most</code> <code class="n">recent</code> <code class="n">call</code> <code class="n">last</code><code class="p">)</code>
<code class="o">...</code>
    <code class="mi">301</code>     <code class="k">if</code> <code class="n">arg</code> <code class="ow">is</code> <code class="bp">None</code><code class="p">:</code>

<code class="ne">ValueError</code><code class="p">:</code> <code class="n">month</code> <code class="n">must</code> <code class="n">be</code> <code class="ow">in</code> <code class="mf">1.</code><code class="o">.</code><code class="mi">12</code></pre>

<p>One naive way to find the bad dates would be to iterate through our rows of data, and catch and display any errors. Pandas has a handy <code>iterrows</code> method that provides a row iterator. Combined with a Python <code>try-except</code> block, this successfully finds our problem date fields.</p>

<pre data-type="programlisting" data-code-language="python"><code class="k">for</code><code> </code><code class="n">i</code><code class="p">,</code><code class="n">row</code><code> </code><code class="ow">in</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">iterrows</code><code class="p">(</code><code class="p">)</code><code class="p">:</code><code>
</code><code>    </code><code class="k">try</code><code class="p">:</code><code>
</code><code>        </code><code class="n">pd</code><code class="o">.</code><code class="n">to_datetime</code><code class="p">(</code><code class="n">row</code><code class="o">.</code><code class="n">date_of_death</code><code class="p">,</code><code> </code><code class="n">errors</code><code class="o">=</code><code class="s1">'</code><code class="s1">raise</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO21-1" href="#callout_cleaning_data_with_pandas_CO21-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
</code><code>    </code><code class="k">except</code><code class="p">:</code><code>
</code><code>        </code><code class="k">print</code><code> </code><code class="s1">'</code><code class="si">%s</code><code class="s1">(</code><code class="si">%s</code><code class="s1">, </code><code class="si">%d</code><code class="s1">)</code><code class="s1">'</code><code class="o">%</code><code class="p">(</code><code class="n">row</code><code class="o">.</code><code class="n">date_of_death</code><code class="o">.</code><code class="n">ljust</code><code class="p">(</code><code class="mi">30</code><code class="p">)</code><code class="p">,</code><code>\</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO21-2" href="#callout_cleaning_data_with_pandas_CO21-2"><img src="2.png" alt="2" width="12" height="12"></a><code>
</code><code>                            </code><code class="n">row</code><code class="p">[</code><code class="s1">'</code><code class="s1">name</code><code class="s1">'</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">i</code><code class="p">)</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO21-3" href="#callout_cleaning_data_with_pandas_CO21-3"><img src="3.png" alt="3" width="12" height="12"></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO21-1" href="#co_cleaning_data_with_pandas_CO21-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>Run <code>to_datetime</code> on the individual row and catch any errors.</p></dd>
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO21-2" href="#co_cleaning_data_with_pandas_CO21-2"><img src="2.png" alt="2" width="12" height="12"></a></dt>
<dd><p>We left-justify the date of death in a text column of width 30.</p></dd>
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO21-3" href="#co_cleaning_data_with_pandas_CO21-3"><img src="3.png" alt="3" width="12" height="12"></a></dt>
<dd><p>Pandas rows have a masking <code>Name</code> property, so we use string-key access with <code>[<em>name</em>]</code>.</p></dd>
</dl>

<p>This lists the offending rows:</p>

<pre data-type="programlisting">1968-23-07              (Henry Hallett Dale, 150)
May 30, 2011 (aged 89)  (Rosalyn Yalow, 349)
living                  (David Trimble, 581)
Diederik Korteweg       (Johannes Diderik van der Waals, 746)
living                  (Shirin Ebadi, 809)
living                  (Rigoberta Menchú, 833)
1 February 1976, age 74 (Werner Karl Heisenberg, 858)</pre>

<p>which is a good demonstration of the kind of data errors you get with collaborative editing.</p>

<p>Although the last method works, whenever you find yourself iterating through rows of a Pandas <code>DataFrame</code>, you should pause for a second and try to find a better way, one that exploits the multirow array handling that is a fundamental aspect of Pandas’ efficiency.</p>

<p>A better way to find the bad dates exploits the fact that Pandas’ <code>to_datetime</code> method has a <code>coerce</code> argument, which, if <code>True</code>, converts any date exceptions to <code>NaT</code> (not a time), the temporal equivalent of <code>NaN</code>. We can then create a Boolean mask out of the resulting <code>DataFrame</code> based on the <code>NaT</code> date rows, producing <a data-type="xref" href="#clean_dodgy_dates">Figure 9-1</a>.</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">with_death_dates</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="p">[</code><code class="n">df</code><code class="o">.</code><code class="n">date_of_death</code><code class="o">.</code><code class="n">notnull</code><code class="p">(</code><code class="p">)</code><code class="p">]</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO22-1" href="#callout_cleaning_data_with_pandas_CO22-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
</code><code class="n">bad_dates</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">isnull</code><code class="p">(</code><code class="n">pd</code><code class="o">.</code><code class="n">to_datetime</code><code class="p">(</code><code>\
</code><code>            </code><code class="n">with_death_dates</code><code class="o">.</code><code class="n">date_of_death</code><code class="p">,</code><code> </code><code class="n">errors</code><code class="o">=</code><code class="s1">'</code><code class="s1">coerce</code><code class="s1">'</code><code class="p">)</code><code class="p">)</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO22-2" href="#callout_cleaning_data_with_pandas_CO22-2"><img src="2.png" alt="2" width="12" height="12"></a><code>
</code><code class="n">with_death_dates</code><code class="p">[</code><code class="n">bad_dates</code><code class="p">]</code><code class="p">[</code><code class="p">[</code><code class="s1">'</code><code class="s1">category</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">date_of_death</code><code class="s1">'</code><code class="p">,</code><code>\
</code><code class="s1">'</code><code class="s1">name</code><code class="s1">'</code><code class="p">]</code><code class="p">]</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO22-1" href="#co_cleaning_data_with_pandas_CO22-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>Gets all rows with non-null date fields.</p></dd>
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO22-2" href="#co_cleaning_data_with_pandas_CO22-2"><img src="2.png" alt="2" width="12" height="12"></a></dt>
<dd><p>Creates a Boolean mask for all bad dates in <code>with_death_dates</code> by checking against null (<code>NaT</code>) after coercing failed conversions to <code>NaT</code>. For older Pandas versions, you may need to use <code>coerce=True</code>.</p></dd>
</dl>

<figure><div id="clean_dodgy_dates" class="figure">
<img src="dvpj_0901.png" alt="dvpj 0901" width="627" height="261">
<h6><span class="label">Figure 9-1. </span>The unparseable date fields</h6>
</div></figure>

<p>Depending on how fastidious you want to be, these can be corrected by hand or coerced to NumPy’s time equivalent of <code>NaN</code>, <code>NaT</code>. We’ve got more than 500 valid dates of death, which is enough to get some interesting time stats, so we’ll run <code>to_datetime</code> again and force errors to null:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">df</code><code class="o">.</code><code class="n">date_of_death</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">to_datetime</code><code class="p">(</code><code class="n">df</code><code class="o">.</code><code class="n">date_of_death</code><code class="p">,</code>\
<code class="n">errors</code><code class="o">=</code><code class="s1">'coerce'</code><code class="p">)</code></pre>

<p>Now that we have our time fields in a usable format, let’s add a field for the age of the winner on receiving his/her Nobel Prize. In order to get the year value of our new dates, we need to tell Pandas that it’s dealing with a date column, using the <code>DatetimeIndex</code> method.</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">df</code><code class="p">[</code><code class="s1">'</code><code class="s1">award_age</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">year</code><code> </code><code class="o">-</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">DatetimeIndex</code><code class="p">(</code><code class="n">df</code><code class="o">.</code><code class="n">date_of_birth</code><code class="p">)</code><code>\
</code><code class="o">.</code><code class="n">year</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO23-1" href="#callout_cleaning_data_with_pandas_CO23-1"><img src="1.png" alt="1" width="12" height="12"></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO23-1" href="#co_cleaning_data_with_pandas_CO23-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>Convert the column to a <code>DatetimeIndex</code>, an <code>ndarray</code> of <code>datetime64</code> data, and use the <code>year</code> property.</p></dd>
</dl>

<p>Let’s use our new <code>award_age</code> field to see the youngest recipients of the Nobel Prize:</p>

<pre data-type="programlisting" data-code-language="python"><code class="c1"># use +sort+ for older Pandas</code><code>
</code><code class="n">df</code><code class="o">.</code><code class="n">sort_values</code><code class="p">(</code><code class="s1">'</code><code class="s1">award_age</code><code class="s1">'</code><code class="p">)</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="p">:</code><code class="mi">10</code><code class="p">]</code><code>\
</code><code>        </code><code class="p">[</code><code class="p">[</code><code class="s1">'</code><code class="s1">name</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">award_age</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">category</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">year</code><code class="s1">'</code><code class="p">]</code><code class="p">]</code><code>
</code><code class="n">Out</code><code class="p">:</code><code>
</code><code>                       </code><code class="n">name</code><code>  </code><code class="n">award_age</code><code>      </code><code class="n">category</code><code>  </code><code class="n">year</code><code>
</code><code class="mi">725</code><code>        </code><code class="n">Malala</code><code> </code><code class="n">Yousafzai</code><code>         </code><code class="mi">17</code><code>         </code><code class="n">Peace</code><code>  </code><code class="mi">2014</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO24-1" href="#callout_cleaning_data_with_pandas_CO24-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
</code><code class="mi">525</code><code>  </code><code class="n">William</code><code> </code><code class="n">Lawrence</code><code> </code><code class="n">Bragg</code><code>         </code><code class="mi">25</code><code>       </code><code class="n">Physics</code><code>  </code><code class="mi">1915</code><code>
</code><code class="mi">626</code><code>    </code><code class="n">Georges</code><code> </code><code class="n">J</code><code class="o">.</code><code> </code><code class="n">F</code><code class="o">.</code><code> </code><code class="n">K</code><code class="err">ö</code><code class="n">hler</code><code>         </code><code class="mi">30</code><code>  </code><code class="n">P</code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code class="n">Medicine</code><code>  </code><code class="mi">1976</code><code>
</code><code class="mi">247</code><code>           </code><code class="n">Carl</code><code> </code><code class="n">Anderson</code><code>         </code><code class="mi">31</code><code>       </code><code class="n">Physics</code><code>  </code><code class="mi">1936</code><code>
</code><code class="mi">858</code><code>  </code><code class="n">Werner</code><code> </code><code class="n">Karl</code><code> </code><code class="n">Heisenberg</code><code>         </code><code class="mi">31</code><code>       </code><code class="n">Physics</code><code>  </code><code class="mi">1932</code><code>
</code><code class="mi">294</code><code>           </code><code class="n">Tsung</code><code class="o">-</code><code class="n">Dao</code><code> </code><code class="n">Lee</code><code>         </code><code class="mi">31</code><code>       </code><code class="n">Physics</code><code>  </code><code class="mi">1957</code><code>
</code><code class="mi">146</code><code>              </code><code class="n">Paul</code><code> </code><code class="n">Dirac</code><code>         </code><code class="mi">31</code><code>       </code><code class="n">Physics</code><code>  </code><code class="mi">1933</code><code>
</code><code class="mi">226</code><code>         </code><code class="n">Tawakkol</code><code> </code><code class="n">Karman</code><code>         </code><code class="mi">32</code><code>         </code><code class="n">Peace</code><code>  </code><code class="mi">2011</code><code>
</code><code class="mi">986</code><code>    </code><code class="n">Frederick</code><code> </code><code class="n">G</code><code class="o">.</code><code> </code><code class="n">Banting</code><code>         </code><code class="mi">32</code><code>  </code><code class="n">P</code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code class="n">Medicine</code><code>  </code><code class="mi">1923</code><code>
</code><code class="mi">877</code><code>        </code><code class="n">Rudolf</code><code> </code><code class="n">M</code><code class="err">ö</code><code class="n">ssbauer</code><code>         </code><code class="mi">32</code><code>       </code><code class="n">Physics</code><code>  </code><code class="mi">1961</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO24-1" href="#co_cleaning_data_with_pandas_CO24-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>For activism for female education, I’d recommend reading more about <a href="http://en.wikipedia.org/wiki/Malala_Yousafzai">Malala’s inspirational story</a>.</p></dd>
</dl>

<p>Now we have our date fields in a manipulable form, let’s have a look at the full <code>clean_data</code> function, which summarizes this chapter’s cleaning efforts.<a data-type="indexterm" data-primary="" data-startref="DCtimedate9" id="idm140319414949440"></a><a data-type="indexterm" data-primary="" data-startref="time9" id="idm140319414948464"></a><a data-type="indexterm" data-primary="" data-startref="dates9" id="idm140319415043168"></a></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="The Full clean_data Function"><div class="sect1" id="idm140319418406448">
<h1>The Full clean_data Function</h1>

<p><a data-type="indexterm" data-primary="data cleaning" data-secondary="full clean_data function" id="idm140319415041616"></a>For manually edited data like scraped Wikipedia datasets, it’s unlikely that you’ll catch all the errors on a first pass. So expect to pick up a few during the data exploration phase. Nevertheless, our Nobel Prize dataset is looking very usable. We’ll declare it clean enough and the job of this chapter done. <a data-type="xref" href="#clean_data">Example 9-4</a> shows the steps we used to achieve this cleaning feat.</p>
<div id="clean_data" data-type="example">
<h5><span class="label">Example 9-4. </span>The full Nobel Prize dataset cleaning function</h5>

<pre data-type="programlisting" data-code-language="python"><code class="k">def</code><code> </code><code class="nf">clean_data</code><code class="p">(</code><code class="n">df</code><code class="p">)</code><code class="p">:</code><code>
</code><code>    </code><code class="n">df</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">replace</code><code class="p">(</code><code class="s1">'</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">nan</code><code class="p">)</code><code>
</code><code>    </code><code class="n">df_born_in</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="p">[</code><code class="n">df</code><code class="o">.</code><code class="n">born_in</code><code class="o">.</code><code class="n">notnull</code><code class="p">(</code><code class="p">)</code><code class="p">]</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO25-1" href="#callout_cleaning_data_with_pandas_CO25-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
</code><code>    </code><code class="n">df</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="p">[</code><code class="n">df</code><code class="o">.</code><code class="n">born_in</code><code class="o">.</code><code class="n">isnull</code><code class="p">(</code><code class="p">)</code><code class="p">]</code><code>
</code><code>    </code><code class="n">df</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">drop</code><code class="p">(</code><code class="s1">'</code><code class="s1">born_in</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">axis</code><code class="o">=</code><code class="mi">1</code><code class="p">)</code><code>
</code><code>    </code><code class="n">df</code><code class="o">.</code><code class="n">drop</code><code class="p">(</code><code class="n">df</code><code class="p">[</code><code class="n">df</code><code class="o">.</code><code class="n">year</code><code> </code><code class="o">==</code><code> </code><code class="mi">1809</code><code class="p">]</code><code class="o">.</code><code class="n">index</code><code class="p">,</code><code> </code><code class="n">inplace</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code><code>
</code><code>    </code><code class="n">df</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="p">[</code><code class="o">~</code><code class="p">(</code><code class="n">df</code><code class="o">.</code><code class="n">name</code><code> </code><code class="o">==</code><code> </code><code class="s1">'</code><code class="s1">Marie Curie</code><code class="s1">'</code><code class="p">)</code><code class="p">]</code><code>
</code><code>    </code><code class="n">df</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="p">(</code><code class="n">df</code><code class="o">.</code><code class="n">name</code><code> </code><code class="o">==</code><code> </code><code class="s-Affix">u</code><code class="s1">'</code><code class="s1">Marie Sk</code><code class="se">\u0142</code><code class="s1">odowska-Curie</code><code class="s1">'</code><code class="p">)</code><code> </code><code class="o">&amp;</code><code>\
</code><code>           </code><code class="p">(</code><code class="n">df</code><code class="o">.</code><code class="n">year</code><code> </code><code class="o">==</code><code> </code><code class="mi">1911</code><code class="p">)</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">country</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">France</code><code class="s1">'</code><code>
</code><code>    </code><code class="n">df</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="p">[</code><code class="o">~</code><code class="p">(</code><code class="p">(</code><code class="n">df</code><code class="o">.</code><code class="n">name</code><code> </code><code class="o">==</code><code> </code><code class="s1">'</code><code class="s1">Sidney Altman</code><code class="s1">'</code><code class="p">)</code><code> </code><code class="o">&amp;</code><code> </code><code class="p">(</code><code class="n">df</code><code class="o">.</code><code class="n">year</code><code> </code><code class="o">==</code><code> </code><code class="mi">1990</code><code class="p">)</code><code class="p">)</code><code class="p">]</code><code>
</code><code>    </code><code class="n">df</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">reindex</code><code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">random</code><code class="o">.</code><code class="n">permutation</code><code class="p">(</code><code class="n">df</code><code class="o">.</code><code class="n">index</code><code class="p">)</code><code class="p">)</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO25-2" href="#callout_cleaning_data_with_pandas_CO25-2"><img src="2.png" alt="2" width="12" height="12"></a><code>
</code><code>    </code><code class="n">df</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">drop_duplicates</code><code class="p">(</code><code class="p">[</code><code class="s1">'</code><code class="s1">name</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">year</code><code class="s1">'</code><code class="p">]</code><code class="p">)</code><code>
</code><code>    </code><code class="n">df</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">sort_index</code><code class="p">(</code><code class="p">)</code><code>
</code><code>    </code><code class="n">df</code><code class="o">.</code><code class="n">ix</code><code class="p">[</code><code class="n">df</code><code class="o">.</code><code class="n">name</code><code> </code><code class="o">==</code><code> </code><code class="s1">'</code><code class="s1">Alexis Carrel</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">category</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code>\
</code><code>        </code><code class="s1">'</code><code class="s1">Physiology or Medicine</code><code class="s1">'</code><code>
</code><code>    </code><code class="n">df</code><code class="o">.</code><code class="n">ix</code><code class="p">[</code><code class="n">df</code><code class="o">.</code><code class="n">name</code><code> </code><code class="o">==</code><code> </code><code class="s1">'</code><code class="s1">Ragnar Granit</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">gender</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">male</code><code class="s1">'</code><code>
</code><code>    </code><code class="n">df</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="p">[</code><code class="n">df</code><code class="o">.</code><code class="n">gender</code><code class="o">.</code><code class="n">notnull</code><code class="p">(</code><code class="p">)</code><code class="p">]</code><code> </code><code class="c1"># remove institutional prizes</code><code>
</code><code>    </code><code class="n">df</code><code class="o">.</code><code class="n">ix</code><code class="p">[</code><code class="n">df</code><code class="o">.</code><code class="n">name</code><code> </code><code class="o">==</code><code> </code><code class="s1">'</code><code class="s1">Hiroshi Amano</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">date_of_birth</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code>\
</code><code>    </code><code class="s1">'</code><code class="s1">11 September 1960</code><code class="s1">'</code><code>
</code><code>    </code><code class="n">df</code><code class="o">.</code><code class="n">date_of_birth</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">to_datetime</code><code class="p">(</code><code class="n">df</code><code class="o">.</code><code class="n">date_of_birth</code><code class="p">)</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO25-3" href="#callout_cleaning_data_with_pandas_CO25-3"><img src="3.png" alt="3" width="12" height="12"></a><code>
</code><code>    </code><code class="n">df</code><code class="o">.</code><code class="n">date_of_death</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">to_datetime</code><code class="p">(</code><code class="n">df</code><code class="o">.</code><code class="n">date_of_death</code><code class="p">,</code><code>\
</code><code>    </code><code class="n">errors</code><code class="o">=</code><code class="s1">'</code><code class="s1">coerce</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>    </code><code class="n">df</code><code class="p">[</code><code class="s1">'</code><code class="s1">award_age</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">year</code><code> </code><code class="o">-</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">DatetimeIndex</code><code class="p">(</code><code class="n">df</code><code class="o">.</code><code class="n">date_of_birth</code><code class="p">)</code><code>\
</code><code>    </code><code class="o">.</code><code class="n">year</code><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="n">df</code><code class="p">,</code><code> </code><code class="n">df_born_in</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO25-1" href="#co_cleaning_data_with_pandas_CO25-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>Makes a <code>DataFrame</code> containing the rows with <code>born_in</code> fields.</p></dd>
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO25-2" href="#co_cleaning_data_with_pandas_CO25-2"><img src="2.png" alt="2" width="12" height="12"></a></dt>
<dd><p>Removes duplicates from the <code>DataFrame</code> after randomizing the row order.</p></dd>
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO25-3" href="#co_cleaning_data_with_pandas_CO25-3"><img src="3.png" alt="3" width="12" height="12"></a></dt>
<dd><p>Converts the date columns to the practical <code>datetime64</code> datatype.</p></dd>
</dl></div>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Saving the Cleaned Dataset"><div class="sect1" id="saving_datasets">
<h1>Saving the Cleaned Dataset</h1>

<p><a data-type="indexterm" data-primary="data cleaning" data-secondary="saving cleaned data sets" id="idm140319414301200"></a>Now let’s save the results of our cleaning function to our Mongo database using the utility method we wrote in the last chapter (see <a data-type="xref" href="ch08.html#mongo_to_dataframe">“MongoDB”</a>).</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">df_clean</code><code class="p">,</code><code> </code><code class="n">df_born_in</code><code> </code><code class="o">=</code><code> </code><code class="n">clean_data</code><code class="p">(</code><code class="p">)</code><code>
</code><code>
</code><code class="n">dataframe_to_mongo</code><code class="p">(</code><code class="n">df_clean</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">nobel_prize</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">winners</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO26-1" href="#callout_cleaning_data_with_pandas_CO26-1"><img src="1.png" alt="1" width="12" height="12"></a><code>
</code><code class="n">dataframe_to_mongo</code><code class="p">(</code><code class="n">df_born_in</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">nobel_prize</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">winners_born_in</code><code class="s1">'</code><code class="p">)</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO26-1" href="#co_cleaning_data_with_pandas_CO26-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p>Save the cleaned <code>DataFrame</code> to the <code>nobel_prize</code> database, collection name <code>winners_cleaned</code>.</p></dd>
</dl>

<p>Let’s also save a copy of our <code>df_clean</code> <code>DataFrame</code> to an SQLite <code>nobel_prize</code> database in a local <em>data</em> directory. We’ll use this to demonstrate the Flask-Restless SQL web API in <a data-type="xref" href="ch13.html#sect_restless">“RESTful SQL with Flask-Restless”</a>.  Three lines of Python and the data <span class="keep-together">frame’s</span> <code>to_sql</code> method do the job succinctly (see <a data-type="xref" href="ch08.html#sect_pandas_sql">“SQL”</a> for more details):</p>

<pre data-type="programlisting" data-code-language="python"><code class="kn">import</code> <code class="nn">sqlalchemy</code>

<code class="n">engine</code> <code class="o">=</code> <code class="n">sqlalchemy</code><code class="o">.</code><code class="n">create_engine</code><code class="p">(</code>\
<code class="s1">'sqlite:///data/nobel_prize.db'</code><code class="p">)</code>
<code class="n">df_clean</code><code class="o">.</code><code class="n">to_sql</code><code class="p">(</code><code class="s1">'winners'</code><code class="p">,</code> <code class="n">engine</code><code class="p">)</code></pre>








<section data-type="sect2" data-pdf-bookmark="Merging DataFrames"><div class="sect2" id="idm140319414368128">
<h2>Merging DataFrames</h2>

<p><a data-type="indexterm" data-primary="data cleaning" data-secondary="merging DataFrames" id="idm140319414357744"></a><a data-type="indexterm" data-primary="DataFrames (Pandas)" data-secondary="merging" id="idm140319414402256"></a>At this point, we can also create a merged database of our clean <code>winners</code> data and the image and biography dataset we scraped in <a data-type="xref" href="ch06.html#scraping_bio">“Scraping Text and Images with a Pipeline”</a>. This will provide a good opportunity to demonstrate Pandas’ ability to merge <code>DataFrame</code>s. The following code shows how to merge <code>df_clean</code> and the bio dataset:</p>

<pre data-type="programlisting" data-code-language="python"><code class="c1"># Read the Scrapy bio-data into a DataFrame</code><code>
</code><code class="n">df_winners_bios</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">read_json</code><code class="p">(</code><code>\
</code><code class="nb">open</code><code class="p">(</code><code class="s1">'</code><code class="s1">data/scrapy_nwinners_minibio.json</code><code class="s1">'</code><code class="p">)</code><code class="p">)</code><code>
</code><code>
</code><code class="n">df_winners_all</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">merge</code><code class="p">(</code><code class="n">df_clean</code><code class="p">,</code><code> </code><code class="n">df_winners_bios</code><code class="p">,</code><code>\
</code><code class="n">how</code><code class="o">=</code><code class="s1">'</code><code class="s1">outer</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">on</code><code class="o">=</code><code class="s1">'</code><code class="s1">link</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" id="co_cleaning_data_with_pandas_CO27-1" href="#callout_cleaning_data_with_pandas_CO27-1"><img src="1.png" alt="1" width="12" height="12"></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_cleaning_data_with_pandas_CO27-1" href="#co_cleaning_data_with_pandas_CO27-1"><img src="1.png" alt="1" width="12" height="12"></a></dt>
<dd><p><a href="http://bit.ly/1UT8fd7">Panda’s <code>merge</code></a> takes two <code>DataFrame</code>s and merges them based on shared column name(s) (<code>link</code>, in this case). The <a href="http://bit.ly/1UdUSC2"><code>how</code></a> argument specifies how to determine which keys are to be included in the resulting table and works in the same way as SQL joins. In this case, <code>outer</code> specifies a <code>FULL_OUTER_JOIN</code>.</p></dd>
</dl>

<p>Merging the two <code>DataFrame</code>s results in redundancies in our merged dataset, with more than the 858 winning rows:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">df_winners_all</code><code class="o">.</code><code class="n">count</code><code class="p">()</code>
<code class="n">Out</code><code class="p">:</code>
<code class="n">award_age</code>         <code class="mi">1023</code>
<code class="n">category</code>          <code class="mi">1023</code>
<code class="o">...</code>
<code class="n">bio_image</code>          <code class="mi">978</code>
<code class="n">mini_bio</code>          <code class="mi">1086</code></pre>

<p>We can easily remove these by using <code>drop_duplicates</code> to remove any rows that share a <code>link</code> and <code>year</code> field after removing any rows without a <code>name</code> field:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">df_winners_all</code> <code class="o">=</code> <code class="n">df_winners_all</code><code class="p">[</code><code class="o">~</code><code class="n">df_winners_all</code><code class="o">.</code><code class="n">name</code><code class="o">.</code><code class="n">isnull</code><code class="p">()]</code>\
<code class="o">.</code><code class="n">drop_duplicates</code><code class="p">(</code><code class="n">subset</code><code class="o">=</code><code class="p">[</code><code class="s1">'link'</code><code class="p">,</code> <code class="s1">'year'</code><code class="p">])</code></pre>

<p>A quick count shows that we now have the right number of winners with images for 770 and a <code>mini_bio</code> for all but one:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">df_winners_all</code><code class="o">.</code><code class="n">count</code><code class="p">()</code>
<code class="n">award_age</code>         <code class="mi">858</code>
<code class="n">category</code>          <code class="mi">858</code>
<code class="o">...</code>
<code class="n">bio_image</code>         <code class="mi">770</code>
<code class="n">mini_bio</code>          <code class="mi">857</code>
<code class="n">dtype</code><code class="p">:</code> <code class="n">int64</code></pre>

<p>While we’re cleaning our dataset, let’s see which winner is missing a <code>mini_bio</code> field:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">df_winners_all</code><code class="p">[</code><code class="n">df_winners_all</code><code class="o">.</code><code class="n">mini_bio</code><code class="o">.</code><code class="n">isnull</code><code class="p">()]</code>
<code class="n">Out</code><code class="p">:</code>
<code class="o">...</code>
                                            <code class="n">link</code>        <code class="n">name</code>  \
<code class="mi">229</code>  <code class="n">http</code><code class="p">:</code><code class="o">//</code><code class="n">en</code><code class="o">.</code><code class="n">wikipedia</code><code class="o">.</code><code class="n">org</code><code class="o">/</code><code class="n">wiki</code><code class="o">/</code><code class="n">L</code><code class="o">%</code><code class="n">C3</code><code class="o">%</code><code class="n">AA_</code><code class="o">%</code><code class="n">C3</code><code class="o">...</code>  <code class="n">L</code><code class="err">ê</code> <code class="err">Ðứ</code><code class="n">c</code> <code class="n">Th</code><code class="err">ọ</code>
<code class="o">...</code></pre>

<p>It turns out to be a Unicode error in creating the Wikipedia link for Lê Ðức Thọ, the Vietnamese Peace Prize winner. This can be corrected by hand.</p>

<p>It only remains to save our merged dataset to MongoDB:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">dataframe_to_mongo</code><code class="p">(</code><code class="n">df_winners_all</code><code class="p">,</code> <code class="s1">'nobel_prize'</code><code class="p">,</code> <code class="s1">'winners_all'</code><code class="p">)</code></pre>

<p>With our cleaned data in the database, we’re ready to start exploring it in the next chapter.<a data-type="indexterm" data-primary="" data-startref="Pclean9" id="idm140319414626864"></a></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Summary"><div class="sect1" id="idm140319414358464">
<h1>Summary</h1>

<p>In this chapter, you learned how to clean a fairly messy dataset, producing data that will be much nicer to explore and generally work with. Along the way, a number of new Pandas methods and techniques were introduced to extend the last chapter’s introduction to basic Pandas.</p>

<p>In the next chapter, we will use our newly minted dataset to start getting a feel for the Nobel Prize recipients, their country, gender, age, and any interesting correlations (or lack thereof) we can find.</p>
</div></section>







<div data-type="footnotes"><p data-type="footnote" id="idm140319420130224"><sup><a href="ch09.html#idm140319420130224-marker">1</a></sup> <em>Large</em> is a very relative term, but Pandas will take pretty much whatever will fit in your computer’s RAM memory, which is where <code>DataFrame</code>s live.</p><p data-type="footnote" id="idm140319419573584"><sup><a href="ch09.html#idm140319419573584-marker">2</a></sup> Pandas supports multiple indices using the <code>MultiIndex</code> object. This provides a very powerful way of refining higher-dimensional data. Check out the details <a href="http://pandas.pydata.org/pandas-docs/stable/advanced.html#advanced">in the Pandas documentation</a>.</p><p data-type="footnote" id="idm140319418507104"><sup><a href="ch09.html#idm140319418507104-marker">3</a></sup> By default, Pandas uses NumPy’s <code>NaN</code> (not a number) float to designate missing values.</p><p data-type="footnote" id="idm140319417894144"><sup><a href="ch09.html#idm140319417894144-marker">4</a></sup> One interesting visualization might be charting the migration of Nobel Prize winners from their homeland.</p><p data-type="footnote" id="idm140319417890000"><sup><a href="ch09.html#idm140319417890000-marker">5</a></sup> See IEEE 754 and <a href="http://en.wikipedia.org/wiki/NaN"><em class="hyperlink">http://en.wikipedia.org/wiki/NaN</em></a>.</p><p data-type="footnote" id="idm140319417782128"><sup><a href="ch09.html#idm140319417782128-marker">6</a></sup> As you’ll see in the next chapter, the <code>born_in</code> fields contain some interesting information about the movements of Nobel Prize winners. We’ll keep a copy of them for that purpose.</p><p data-type="footnote" id="idm140319417106352"><sup><a href="ch09.html#idm140319417106352-marker">7</a></sup> While France was Curie’s adopted country,  she retained Polish citizenship and named her first discovered radioactive isotope <em>polonium</em> after her home country.</p><p data-type="footnote" id="idm140319416887136"><sup><a href="ch09.html#idm140319416887136-marker">8</a></sup> Some users dismiss such warnings as nannying paranoia. See the discussion <a href="http://stackoverflow.com/questions/20625582/how-to-deal-with-this-pandas-warning">on Stack Overflow</a>.</p><p data-type="footnote" id="idm140319416885600"><sup><a href="ch09.html#idm140319416885600-marker">9</a></sup> They can be turned off with <code>pd.options.mode.chained_assignment = None  # default=<em>warn</em></code>.</p><p data-type="footnote" id="idm140319416204224"><sup><a href="ch09.html#idm140319416204224-marker">10</a></sup> Depending on the dataset, the cleaning phase is unlikely to catch all transgressors.</p></div></div></section></div>



  <div class="t-sbo-prev sbo-prev sbo-nav-bottom">
  
    
      
        <a href="/library/view/data-visualization-with/9781491920565/ch08.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">8. Introduction to Pandas</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-bottom">
  
    
      
        <a href="/library/view/data-visualization-with/9781491920565/ch10.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">10. Visualizing Data with Matplotlib</div>
        </a>
    
  
  </div>


        
    </section>
  </div>
<section class="sbo-saved-archives"></section>



          
          
  




    
    
      <div id="js-subscribe-nag" class="subscribe-nag clearfix trial-panel t-subscribe-nag">
        
        
          
          

          
            <p>You have 6 days left in your trial, Flankpeter. Subscribe today. <a href="/subscribe/" class="ga-active-trial-subscribe-nag">See pricing options.</a></p>
          
        
        

      </div>

    
    



        
      </div>
      




  <footer class="pagefoot t-pagefoot">
    <a href="#" class="icon-up"><div class="visuallyhidden">Back to top</div></a>
    <ul class='js-footer-nav'>
      
        <li><a class="t-recommendations-footer" href="/r/">Recommended</a></li>
      
      <li>
      
      <a class="t-queue-footer" href="/playlists/">Playlists</a>
      
      </li>
      
        <li><a class="t-recent-footer" href="/history/">History</a></li>
        <li><a class="t-topics-footer" href="/topics?q=*&limit=21">Topics</a></li>
      
      
        <li><a class="t-tutorials-footer" href="/tutorials/">Tutorials</a></li>
      
      <li><a class="t-settings-footer js-settings" href="/u/">Settings</a></li>
      <li class="full-support"><a href="https://www.safaribooksonline.com/public/support">Support</a></li>
      <li><a href="https://www.safaribooksonline.com/apps/">Get the App</a></li>
      <li><a href="/accounts/logout/">Sign Out</a></li>
    </ul>
    <span class="copyright">&#169; 2018 <a href="https://www.safaribooksonline.com" target="_blank">Safari</a>.</span>
    <a href="/terms/">Terms of Service</a> /
    <a href="/privacy/">Privacy Policy</a>
  </footer>




    

    <script src="/jsi18n/web/" charset="utf-8"></script>
    <script src="/library/jsi18n/appcache/" charset="utf-8"></script>
  </body>
</html>
